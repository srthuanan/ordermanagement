import{j as e}from"./vendor-pdf-Dyj7cThZ.js";import{r as s,R as Ve}from"./vendor-react-KfUPlHYY.js";import{h as q}from"./vendor-utils-C5S46NFB.js";import{S as Ke,B as ge,C as Le,t as Ee,c as ze,P as it,d as ct,i as te,e as Re,f as be,n as Be,y as Xe,h as ot,j as dt,g as ht,a as xt,k as mt,p as ut,l as gt,r as Oe,b as pt,m as ft,o as bt,A as ie,E as yt}from"./index-DPKgMFYH.js";const Fe=({text:t,showToast:g,className:l,label:f,wrap:i=!1})=>{if(!t||t==="N/A")return e.jsxs("div",{className:l,children:[f?`${f}: `:"","N/A"]});const c=r=>{r.stopPropagation(),navigator.clipboard.writeText(t).then(()=>{g("Đã sao chép!",`${t} đã được sao chép.`,"success",2e3)}).catch(()=>g("Lỗi","Không thể sao chép.","error"))};return e.jsxs("div",{className:`cursor-pointer ${l}`,title:`Click để sao chép: ${t}`,onClick:c,children:[e.jsx("span",{children:f?`${f}: `:""}),e.jsx("span",{className:i?"break-words":"truncate",children:t})]})},Nt=({status:t,viewType:g,onAction:l,onToggle:f,isProcessing:i})=>{const[c,r]=s.useState(!1),v=Ve.useRef(null),h=a=>{r(a),f(a)};s.useEffect(()=>{const a=u=>{v.current&&!v.current.contains(u.target)&&h(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[f]);const b=t.toLowerCase(),T=(g==="invoices"?[{type:"approve",label:"Phê Duyệt",icon:"fa-check-double",condition:b==="chờ phê duyệt"||b==="đã bổ sung"},{type:"supplement",label:"Y/C Bổ Sung",icon:"fa-exclamation-triangle",condition:b==="chờ phê duyệt"||b==="đã bổ sung"},{type:"pendingSignature",label:"Chờ Ký HĐ",icon:"fa-signature",condition:b==="đã phê duyệt"},{type:"uploadInvoice",label:"Tải Lên HĐ",icon:"fa-upload",condition:b==="chờ ký hóa đơn"},{type:"resend",label:"Gửi lại Email",icon:"fa-paper-plane",condition:b==="yêu cầu bổ sung"||b==="đã xuất hóa đơn"},{type:"cancel",label:"Hủy Yêu Cầu",icon:"fa-trash-alt",isDanger:!0,condition:b!=="đã xuất hóa đơn"&&b!=="đã hủy"}]:g==="pending"?[{type:"manualMatch",label:"Ghép Thủ Công",icon:"fa-link",condition:!0},{type:"cancel",label:"Hủy Yêu Cầu",icon:"fa-trash-alt",isDanger:!0,condition:!0}]:g==="paired"?[{type:"requestInvoice",label:"Y/C Xuất Hóa Đơn",icon:"fa-file-invoice-dollar",condition:!0},{type:"unmatch",label:"Hủy Ghép Xe",icon:"fa-unlink",isDanger:!0,condition:!0}]:[]).filter(a=>a.condition),p=a=>{l(a.type),h(!1)};return e.jsxs("div",{className:"relative",ref:v,onClick:a=>a.stopPropagation(),children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),!i&&h(!c)},className:`w-8 h-8 rounded-full ${i?"bg-surface-ground cursor-wait":"hover:bg-surface-hover"} flex items-center justify-center`,children:i?e.jsx("i",{className:"fas fa-spinner fa-spin text-accent-primary"}):e.jsx("i",{className:"fas fa-ellipsis-h text-text-secondary"})}),c&&e.jsxs("div",{className:"absolute right-0 mt-1 w-48 bg-surface-card border border-border-secondary rounded-lg shadow-2xl z-20 p-0.5 animate-fade-in-scale-up",style:{animationDuration:"150ms"},children:[T.map(a=>e.jsxs("button",{onClick:()=>p(a),className:`flex items-center gap-3 w-full text-left px-2 py-1.5 text-sm font-medium rounded-md ${a.isDanger?"text-danger hover:bg-danger-bg":"text-text-primary hover:bg-surface-hover"}`,children:[e.jsx("i",{className:`fas ${a.icon} fa-fw w-5 text-center`}),e.jsx("span",{children:a.label})]},a.type)),T.length===0&&e.jsx("div",{className:"px-3 py-2 text-sm text-text-secondary text-center",children:"Không có hành động"})]})]})},vt=({order:t,index:g,viewType:l,selectedRows:f,onToggleRow:i,onAction:c,showToast:r,suggestions:v,onShowSuggestions:h,processingId:b})=>{const T=t["Số đơn hàng"],p=t["Trạng thái xử lý"]||t["Kết quả"]||"N/A",a=v==null?void 0:v.get(T),u=f.has(T),d=b===T,A=k=>{c(k,t)};return e.jsxs("div",{className:`bg-white rounded-xl border transition-all duration-200 group relative ${u?"border-accent-primary shadow-md bg-accent-primary/5":"border-border-primary hover:border-accent-primary/50 hover:shadow-sm"}`,onClick:()=>i(T),children:[e.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-1 rounded-l-xl transition-colors ${u?"bg-accent-primary":"bg-transparent group-hover:bg-accent-primary/30"}`}),e.jsxs("div",{className:"p-3 pl-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0 pr-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("h3",{className:"font-bold text-text-primary truncate",title:t["Tên khách hàng"],children:t["Tên khách hàng"]}),e.jsx("span",{className:"text-[10px] font-mono text-text-secondary bg-surface-ground px-1.5 rounded border border-border-secondary",children:g+1})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-secondary",children:[e.jsx(Fe,{text:T,showToast:r,className:"font-mono hover:text-accent-primary transition-colors"}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"truncate",title:t["Tên tư vấn bán hàng"],children:t["Tên tư vấn bán hàng"]})]})]}),e.jsx("div",{className:"flex-shrink-0",onClick:k=>k.stopPropagation(),children:e.jsx(Ke,{status:p,size:"sm"})})]}),e.jsxs("div",{className:"bg-surface-ground rounded-lg p-2 mb-2 border border-border-secondary/50",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm text-text-primary",children:t["Dòng xe"]}),e.jsx("div",{className:"text-xs text-text-secondary",children:t["Phiên bản"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs font-medium text-text-primary",children:t["Ngoại thất"]}),e.jsx("div",{className:"text-xs text-text-secondary",children:t["Nội thất"]})]})]}),l==="paired"&&e.jsxs("div",{className:"mt-1.5 pt-1.5 border-t border-border-secondary/50 flex justify-between items-center",children:[e.jsx("span",{className:"text-[10px] text-text-secondary uppercase font-bold",children:"VIN"}),e.jsx(Fe,{text:t.VIN||"",showToast:r,className:"font-mono font-bold text-accent-primary text-xs"})]})]}),e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsx("div",{className:"text-xs text-text-secondary space-y-0.5",children:l==="pending"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5",title:"Ngày cọc",children:[e.jsx("i",{className:"fas fa-money-bill-wave text-text-placeholder w-3"}),e.jsx("span",{children:t["Ngày cọc"]?q(t["Ngày cọc"]).format("DD/MM"):"--"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",title:"Ngày yêu cầu",children:[e.jsx("i",{className:"fas fa-clock text-text-placeholder w-3"}),e.jsx("span",{className:q(t["Thời gian nhập"]).isBefore(q().subtract(3,"days"))?"text-danger font-medium":"",children:t["Thời gian nhập"]?q(t["Thời gian nhập"]).format("DD/MM"):"--"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5",title:"Ngày cọc",children:[e.jsx("i",{className:"fas fa-money-bill-wave text-text-placeholder w-3"}),e.jsx("span",{children:t["Ngày cọc"]?q(t["Ngày cọc"]).format("DD/MM"):"--"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",title:"Ngày ghép",children:[e.jsx("i",{className:"fas fa-link text-text-placeholder w-3"}),e.jsx("span",{children:t["Thời gian ghép"]?q(t["Thời gian ghép"]).format("DD/MM"):"--"})]})]})}),e.jsxs("div",{className:"flex items-center gap-1",onClick:k=>k.stopPropagation(),children:[l==="pending"&&a&&a.length>0&&h&&e.jsx("button",{onClick:k=>{k.stopPropagation(),h(t,a)},className:"w-8 h-8 rounded-full bg-yellow-100 text-yellow-600 hover:bg-yellow-200 flex items-center justify-center transition-colors shadow-sm animate-pulse",title:`Có ${a.length} xe gợi ý`,children:e.jsx("i",{className:"fas fa-lightbulb"})}),e.jsx(Nt,{status:p,viewType:l,onAction:A,onToggle:()=>{},isProcessing:d})]})]})]})]})},Ue=({orders:t,viewType:g,sortConfig:l,onSort:f,selectedRows:i,onToggleRow:c,onToggleAllRows:r,onAction:v,showToast:h,suggestions:b,onShowSuggestions:T,processingId:p})=>{const a=t.length>0&&i.size===t.length,u=[{key:"Thời gian nhập",label:"Ngày Yêu Cầu"},{key:"Tên khách hàng",label:"Tên Khách Hàng"},{key:"Dòng xe",label:"Dòng Xe"},{key:"Kết quả",label:"Trạng Thái"}];return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white border-b border-border-secondary sticky top-0 z-10 shadow-sm",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none group",children:[e.jsx("input",{type:"checkbox",className:"custom-checkbox",checked:a,onChange:r}),e.jsx("span",{className:"text-sm font-medium text-text-secondary group-hover:text-text-primary transition-colors",children:i.size>0?`Đã chọn ${i.size}`:"Chọn tất cả"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-text-secondary hidden sm:inline",children:"Sắp xếp:"}),e.jsx("select",{className:"text-xs border-none bg-surface-ground rounded-lg py-1.5 pl-2 pr-8 font-medium text-text-primary focus:ring-1 focus:ring-accent-primary cursor-pointer",value:(l==null?void 0:l.key)||"",onChange:d=>f(d.target.value),children:u.map(d=>e.jsx("option",{value:d.key,children:d.label},d.key))}),e.jsx("button",{onClick:()=>f(l==null?void 0:l.key),className:"w-7 h-7 flex items-center justify-center rounded-lg bg-surface-ground hover:bg-surface-hover text-text-secondary transition-colors",title:(l==null?void 0:l.direction)==="asc"?"Tăng dần":"Giảm dần",children:e.jsx("i",{className:`fas fa-sort-amount-${(l==null?void 0:l.direction)==="asc"?"down-alt":"down"}`})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 custom-scrollbar bg-surface-ground",children:t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-text-placeholder",children:[e.jsx("i",{className:"fas fa-box-open text-4xl mb-3 opacity-50"}),e.jsx("p",{children:"Không có đơn hàng nào"})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:t.map((d,A)=>e.jsx(vt,{order:d,index:A,viewType:g,selectedRows:i,onToggleRow:c,onAction:v,showToast:h,suggestions:b,onShowSuggestions:T,processingId:p},d["Số đơn hàng"]))})})]})},Ae=({text:t,showToast:g,className:l,label:f,wrap:i=!1})=>{if(!t||t==="N/A")return e.jsxs("div",{className:l,children:[f?`${f}: `:"","N/A"]});const c=r=>{r.stopPropagation(),navigator.clipboard.writeText(t).then(()=>{g("Đã sao chép!",`${t} đã được sao chép.`,"success",2e3)}).catch(()=>g("Lỗi","Không thể sao chép.","error"))};return e.jsxs("div",{className:`cursor-pointer ${l}`,title:`Click để sao chép: ${t}`,onClick:c,children:[e.jsx("span",{children:f?`${f}: `:""}),e.jsx("span",{className:i?"break-words":"truncate",children:t})]})},jt=({url:t,label:g,icon:l,onPreview:f})=>{const[i,c]=s.useState(null),[r,v]=s.useState(!1),[h,b]=s.useState(0),[T,p]=s.useState(!1),a=s.useMemo(()=>{if(!t)return"unknown";const A=t.toLowerCase();return A.includes("drive.google.com")?"drive":A.includes(".pdf")?"pdf":/\.(jpg|jpeg|png|gif|webp|bmp|svg)/.test(A)?"image":"other"},[t]);s.useEffect(()=>{v(!1),b(0),p(!1),c(a==="drive"&&t?Ee(t,500):a==="image"&&t?t:null)},[t,a]);const u=()=>{if(a!=="drive"||!t){v(!0);return}const A=ze(t);if(!A){v(!0);return}h===0?(b(1),c(`https://lh3.googleusercontent.com/d/${A}=w500`)):h===1?(b(2),p(!0)):v(!0)},d=s.useMemo(()=>{if(a==="drive"&&t){const A=ze(t);if(A)return`https://drive.google.com/file/d/${A}/preview`}return null},[t,a]);return e.jsxs("div",{className:`flex flex-col rounded-lg border transition-all overflow-hidden group ${t?"border-border-secondary bg-surface-ground cursor-pointer hover:shadow-md hover:border-accent-primary":"border-border-secondary/50 bg-surface-ground/50 opacity-60"}`,onClick:()=>t&&f(),children:[e.jsx("div",{className:`w-full h-24 md:h-40 flex items-center justify-center overflow-hidden border-b border-border-secondary relative ${t?"bg-white":"bg-gray-100"}`,children:(a==="pdf"||a==="drive"&&g.toLowerCase().includes("pdf"))&&t?e.jsx(it,{url:t,width:200,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"}):T&&d?e.jsxs(e.Fragment,{children:[e.jsx("iframe",{src:d,className:"w-full h-full border-0 pointer-events-none scale-[1.5] origin-top-left",title:g,tabIndex:-1}),e.jsx("div",{className:"absolute inset-0 bg-transparent z-10"})]}):i&&!r?e.jsx("img",{src:i,alt:g,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110",onError:u}):e.jsx("i",{className:`fas ${a==="pdf"?"fa-file-pdf text-red-500":l+(t?" text-accent-primary":" text-gray-400")} text-5xl`})}),e.jsxs("div",{className:"p-1",children:[e.jsx("div",{className:"font-bold text-[10px] md:text-xs text-text-primary truncate",title:g,children:g}),e.jsxs("div",{className:"flex items-center justify-between h-5",children:[t?e.jsx("div",{}):e.jsx("span",{className:"text-[10px] px-1.5 rounded-full bg-gray-100 text-gray-400",children:"Chưa có"}),t&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:ct(t),target:"_blank",rel:"noopener noreferrer",className:"text-text-placeholder hover:text-accent-primary transition-colors",title:"Tải xuống",onClick:A=>A.stopPropagation(),children:e.jsx("i",{className:"fas fa-download text-xs"})}),e.jsx("i",{className:"fas fa-external-link-alt text-xs text-text-placeholder group-hover:text-accent-primary transition-colors"})]})]})]})]})},wt=({orders:t,onAction:g,showToast:l,onOpenFilePreview:f,onUpdateInvoiceDetails:i,selectedFolder:c,selectedOrderId:r,onFolderChange:v,onOrderSelect:h,processingId:b,processingActionType:T})=>{const[p,a]=s.useState(!1),[u,d]=s.useState(!1),[A,k]=s.useState({engineNumber:"",policy:"",commission:"",vpoint:""}),S=Ve.useRef(null),F=o=>{var G;const $=(G=o.target.files)==null?void 0:G[0];$&&N&&g("uploadInvoice",N,{file:$}),o.target&&(o.target.value="")},x=s.useMemo(()=>t.filter(o=>{const $=(o["Trạng thái xử lý"]||o["Kết quả"]||"").toLowerCase();switch(c){case"pending_approval":return $==="chờ phê duyệt";case"approved":return $==="đã phê duyệt";case"request_supplement":return $==="yêu cầu bổ sung";case"supplemented":return $==="đã bổ sung";case"pending_signature":return $==="chờ ký hóa đơn"||$==="chờ ký hóa đơn";case"completed":return $==="đã xuất hóa đơn";case"all":return!0;default:return!0}}),[t,c]),N=s.useMemo(()=>t.find(o=>o["Số đơn hàng"]===r),[t,r]);s.useEffect(()=>{if(x.length>0){const o=x[0]["Số đơn hàng"];h(o)}},[c]),s.useEffect(()=>{N&&!p&&k({engineNumber:N["Số động cơ"]||"",policy:N["CHÍNH SÁCH"]||"",commission:N["Hoa hồng ứng"]||"",vpoint:N["Điểm Vpoint sử dụng"]||""})},[N,p]);const m=async()=>{if(!N||!i)return;d(!0);const o=await i(N["Số đơn hàng"],A);d(!1),o&&a(!1)},H=[{id:"pending_approval",label:"Chờ Phê Duyệt",icon:"fa-clock",count:t.filter(o=>(o["Trạng thái xử lý"]||o["Kết quả"]||"").toLowerCase()==="chờ phê duyệt").length},{id:"approved",label:"Đã Phê Duyệt",icon:"fa-check",count:t.filter(o=>(o["Trạng thái xử lý"]||o["Kết quả"]||"").toLowerCase()==="đã phê duyệt").length},{id:"request_supplement",label:"Yêu Cầu Bổ Sung",icon:"fa-exclamation-circle",count:t.filter(o=>(o["Trạng thái xử lý"]||o["Kết quả"]||"").toLowerCase()==="yêu cầu bổ sung").length},{id:"supplemented",label:"Đã Bổ Sung",icon:"fa-plus-circle",count:t.filter(o=>(o["Trạng thái xử lý"]||o["Kết quả"]||"").toLowerCase()==="đã bổ sung").length},{id:"pending_signature",label:"Chờ Ký Hóa Đơn",icon:"fa-file-signature",count:t.filter(o=>["chờ ký hóa đơn","chờ ký hóa đơn"].includes((o["Trạng thái xử lý"]||o["Kết quả"]||"").toLowerCase())).length},{id:"completed",label:"Đã Xuất Hóa Đơn",icon:"fa-check-double",count:t.filter(o=>(o["Trạng thái xử lý"]||o["Kết quả"]||"").toLowerCase()==="đã xuất hóa đơn").length},{id:"all",label:"Tất Cả",icon:"fa-list",count:t.length}],X=o=>{const $=o.toLowerCase();return[{type:"approve",label:"Phê Duyệt",icon:"fa-check-double",variant:"primary",condition:$==="chờ phê duyệt"||$==="đã bổ sung"},{type:"supplement",label:"Yêu Cầu Bổ Sung",icon:"fa-exclamation-triangle",variant:"secondary",condition:$==="chờ phê duyệt"||$==="đã bổ sung"},{type:"pendingSignature",label:"Chuyển Chờ Ký",icon:"fa-signature",variant:"primary",condition:$==="đã phê duyệt"},{type:"uploadInvoice",label:"Tải Lên Hóa Đơn",icon:"fa-upload",variant:"success",condition:$==="chờ ký hóa đơn",onClick:()=>{var G;return(G=S.current)==null?void 0:G.click()}},{type:"resend",label:"Gửi Lại Email",icon:"fa-paper-plane",variant:"secondary",condition:$==="yêu cầu bổ sung"||$==="đã xuất hóa đơn"},{type:"cancel",label:"Hủy Yêu Cầu",icon:"fa-trash-alt",variant:"danger",condition:$!=="đã xuất hóa đơn"&&$!=="đã hủy"}].filter(G=>G.condition)},[K,z]=s.useState("folders"),R=o=>{v(o),z("list")},J=o=>{h(o),o&&z("detail")},[Q,M]=s.useState(null),[D,y]=s.useState(null),I=50,ee=o=>{y(null),M(o.targetTouches[0].clientX)},ne=o=>{y(o.targetTouches[0].clientX)},Z=()=>{if(!Q||!D)return;const o=Q-D,$=o>I,G=o<-I;if($||G){const re=x.findIndex(me=>me["Số đơn hàng"]===r);if(re===-1)return;$&&re<x.length-1?J(x[re+1]["Số đơn hàng"]):G&&re>0&&J(x[re-1]["Số đơn hàng"])}},ce=s.useMemo(()=>{if(c!=="pending_signature")return null;const o={};return x.forEach($=>{const G=$["Ngày xuất hóa đơn"],re=G?q(G).format("DD/MM/YYYY"):"Chưa có ngày";o[re]||(o[re]=[]),o[re].push($)}),Object.entries(o).sort(($,G)=>$[0]==="Chưa có ngày"?1:G[0]==="Chưa có ngày"?-1:q($[0],"DD/MM/YYYY").valueOf()-q(G[0],"DD/MM/YYYY").valueOf())},[x,c]),oe=o=>e.jsx("div",{onClick:()=>J(o["Số đơn hàng"]),className:`p-3 cursor-pointer hover:bg-surface-hover transition-all duration-200 group ${r===o["Số đơn hàng"]?"bg-accent-primary/10 border-l-4 border-accent-primary shadow-inner":"border-l-4 border-transparent"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0 pr-3",children:[e.jsx("div",{className:"text-text-primary text-sm truncate mb-0.5",children:o["Tên khách hàng"]}),e.jsxs("div",{className:"text-xs text-text-secondary truncate",children:[o["Dòng xe"]," ",e.jsx("span",{className:"text-text-placeholder",children:"•"})," ",o["Phiên bản"]]})]}),e.jsx("div",{className:"w-16 h-10 flex-shrink-0",children:e.jsx(Le,{model:o["Dòng xe"],exteriorColor:o["Ngoại thất"],className:"w-full h-full object-contain opacity-50 group-hover:opacity-100 group-hover:scale-110 transition-all duration-300"})})]})},o["Số đơn hàng"]);return e.jsxs("div",{className:"flex h-full bg-surface-card rounded-xl shadow-md border border-border-primary overflow-hidden animate-fade-in relative",children:[e.jsx("div",{className:`w-full md:w-64 flex-shrink-0 border-r border-border-primary bg-surface-ground flex flex-col ${K!=="folders"?"hidden md:flex":"flex"}`,children:e.jsx("nav",{className:"flex-1 p-2 space-y-1 overflow-y-auto",children:H.map(o=>e.jsxs("button",{onClick:()=>R(o.id),className:`w-full flex items-center justify-between px-3 py-2 rounded-lg text-xs font-medium transition-colors ${c===o.id?"bg-accent-primary/10 text-accent-primary":"text-text-secondary hover:bg-surface-hover hover:text-text-primary"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("i",{className:`fas ${o.icon} w-5 text-center`}),e.jsx("span",{children:o.label})]}),o.count>0&&e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${c===o.id?"bg-accent-primary text-white":"bg-surface-hover text-text-secondary"}`,children:o.count})]},o.id))})}),e.jsxs("div",{className:`w-full md:w-64 flex-shrink-0 border-r border-border-primary flex flex-col bg-white ${K!=="list"?"hidden md:flex":"flex"}`,children:[e.jsxs("div",{className:"md:hidden p-2 border-b border-border-secondary flex items-center gap-2",children:[e.jsx("button",{onClick:()=>z("folders"),className:"p-2 hover:bg-surface-ground rounded-full",children:e.jsx("i",{className:"fas fa-arrow-left text-text-secondary"})}),e.jsx("span",{className:"font-bold text-sm",children:"Danh sách"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:x.length===0?e.jsx("div",{className:"p-8 text-center text-text-placeholder text-sm",children:"Không tìm thấy đơn hàng nào."}):e.jsx("div",{className:"divide-y divide-border-secondary",children:ce?ce.map(([o,$])=>e.jsxs(Ve.Fragment,{children:[e.jsxs("div",{className:"bg-surface-ground px-3 py-2 text-xs font-bold text-text-secondary sticky top-0 z-10 border-b border-border-secondary flex justify-between items-center shadow-sm",children:[e.jsx("span",{children:o}),e.jsx("span",{className:"bg-surface-card px-1.5 py-0.5 rounded-full text-[10px] border border-border-secondary",children:$.length})]}),$.map(G=>oe(G))]},o)):x.map(o=>oe(o))})})]}),e.jsx("div",{className:`flex-1 flex flex-col bg-surface-ground min-w-0 ${K!=="detail"?"hidden md:flex":"flex"}`,onTouchStart:ee,onTouchMove:ne,onTouchEnd:Z,children:N?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-4 py-3 bg-white border-b border-border-primary flex flex-col md:flex-row justify-between items-start md:items-center shadow-sm z-10 gap-3 md:gap-0",children:[e.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto",children:[e.jsx("button",{onClick:()=>z("list"),className:"md:hidden p-1 hover:bg-surface-ground rounded-full mr-1",children:e.jsx("i",{className:"fas fa-arrow-left text-text-secondary"})}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-accent-primary/10 flex items-center justify-center text-accent-primary font-bold text-base flex-shrink-0",children:N["Tên khách hàng"].charAt(0)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h2",{className:"text-base font-bold text-text-primary leading-tight cursor-pointer hover:text-accent-primary transition-colors truncate",title:"Click để sao chép tên khách hàng",onClick:o=>{o.stopPropagation(),navigator.clipboard.writeText(N["Tên khách hàng"]),l("Đã sao chép","Tên khách hàng đã được sao chép","success")},children:N["Tên khách hàng"]}),e.jsxs("div",{className:"text-xs text-text-secondary flex items-center gap-2 mt-0.5",children:[e.jsx("span",{className:"font-mono cursor-pointer hover:text-accent-primary border-b border-dashed border-transparent hover:border-accent-primary transition-all truncate",title:"Click để sao chép số đơn hàng",onClick:o=>{o.stopPropagation(),navigator.clipboard.writeText(N["Số đơn hàng"]),l("Đã sao chép","Số đơn hàng đã được sao chép","success")},children:N["Số đơn hàng"]}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"truncate",children:N["Tên tư vấn bán hàng"]})]})]})]}),e.jsx("div",{className:"flex gap-2 w-full md:w-auto overflow-x-auto pb-1 md:pb-0 no-scrollbar",children:X(N["Trạng thái xử lý"]||N["Kết quả"]||"").map(o=>e.jsx(ge,{onClick:o.onClick?o.onClick:()=>g(o.type,N),variant:o.variant,size:"sm",leftIcon:e.jsx("i",{className:`fas ${o.icon}`}),className:"whitespace-nowrap",isLoading:b===N["Số đơn hàng"]&&T===o.type,disabled:!!b,children:o.label},o.type))})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 custom-scrollbar",children:e.jsxs("div",{className:"max-w-5xl mx-auto space-y-2",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-border-primary px-3 py-2 flex items-center justify-between shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-xs text-text-secondary",children:"Trạng thái:"}),e.jsx(Ke,{status:N["Trạng thái xử lý"]||N["Kết quả"]||"",size:"sm"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"text-text-secondary",children:"Ngày yêu cầu:"}),e.jsx("span",{className:"font-medium text-text-primary",children:q(N["Thời gian nhập"]).format("HH:mm DD/MM/YYYY")})]}),N["Ngày xuất hóa đơn"]&&e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"text-text-secondary",children:"Ngày XHĐ:"}),e.jsx("span",{className:"font-medium text-text-primary",children:q(N["Ngày xuất hóa đơn"]).format("DD/MM/YYYY")})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-border-primary shadow-sm",children:[e.jsx("div",{className:"bg-gray-100 px-3 py-1.5 border-b border-border-secondary",children:e.jsx("h3",{className:"text-xs font-bold text-text-secondary uppercase tracking-wider",children:"Thông Tin Xe"})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 p-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-text-secondary block mb-0.5 uppercase",children:"Dòng xe / Phiên bản"}),e.jsxs("div",{className:"text-sm font-medium truncate",title:`${N["Dòng xe"]} - ${N["Phiên bản"]}`,children:[N["Dòng xe"]," - ",N["Phiên bản"]]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-text-secondary block mb-0.5 uppercase",children:"Màu sắc"}),e.jsxs("div",{className:"text-sm font-medium truncate",title:`${N["Ngoại thất"]} / ${N["Nội thất"]}`,children:[N["Ngoại thất"]," / ",N["Nội thất"]]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-text-secondary block mb-0.5 uppercase",children:"Số VIN"}),e.jsx(Ae,{text:N.VIN||"",showToast:l,className:"font-mono font-bold text-accent-primary text-sm truncate"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-text-secondary block mb-0.5 uppercase",children:"Số Máy"}),p?e.jsx("input",{type:"text",value:A.engineNumber,onChange:o=>k({...A,engineNumber:o.target.value}),className:"w-full text-xs border border-accent-primary rounded px-2 py-1"}):e.jsx(Ae,{text:N["Số động cơ"]||"",showToast:l,className:"font-mono text-sm truncate"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-border-primary shadow-sm",children:[e.jsxs("div",{className:"bg-gray-100 px-3 py-1.5 border-b border-border-secondary flex justify-between items-center rounded-t-lg",children:[e.jsx("h3",{className:"text-xs font-bold text-text-secondary uppercase tracking-wider",children:"Thanh Toán & Chính Sách"}),p?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ge,{onClick:m,disabled:u,variant:"success",size:"sm",className:"!p-1 h-auto",leftIcon:e.jsx("i",{className:"fas fa-save"}),children:"Lưu"}),e.jsx(ge,{onClick:()=>a(!1),disabled:u,variant:"danger",size:"sm",className:"!p-1 h-auto",leftIcon:e.jsx("i",{className:"fas fa-times"}),children:"Hủy"})]}):e.jsx(ge,{onClick:()=>a(!0),variant:"ghost",size:"sm",className:"!p-1 h-auto text-accent-primary hover:text-accent-primary-hover",leftIcon:e.jsx("i",{className:"fas fa-edit"}),children:"Sửa"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 p-2",children:[e.jsxs("div",{className:"md:col-span-2 flex flex-col",children:[e.jsx("label",{className:"text-[10px] text-text-secondary block mb-0.5 uppercase font-semibold",children:"Chính Sách"}),p?e.jsx("textarea",{value:A.policy,onChange:o=>k({...A,policy:o.target.value}),className:"w-full text-xs border border-accent-primary rounded px-2 py-1.5 flex-1 min-h-[80px] resize-none focus:outline-none focus:ring-1 focus:ring-accent-primary leading-tight",placeholder:"Nhập nội dung chính sách..."}):e.jsx("div",{className:"text-xs bg-surface-ground rounded border border-border-secondary flex-1 min-h-[60px] max-h-[100px] overflow-y-auto",children:(()=>{const o=N["CHÍNH SÁCH"];if(!o)return e.jsx("div",{className:"p-2 text-gray-400",children:"Không có chính sách"});const $=String(o).split(", ").filter(U=>U.trim()),G=Math.ceil($.length/2),re=$.slice(0,G),me=$.slice(G);return e.jsxs("div",{className:"grid grid-cols-2 h-full divide-x divide-border-secondary",children:[e.jsx("div",{className:"flex flex-col gap-1 p-2",children:re.map((U,le)=>e.jsxs("div",{className:"leading-tight flex items-start",children:[e.jsx("span",{className:"mr-1.5 font-bold text-text-secondary",children:"-"}),e.jsx("span",{children:U})]},`l-${le}`))}),e.jsx("div",{className:"flex flex-col gap-1 p-2",children:me.map((U,le)=>e.jsxs("div",{className:"leading-tight flex items-start",children:[e.jsx("span",{className:"mr-1.5 font-bold text-text-secondary",children:"-"}),e.jsx("span",{children:U})]},`r-${le}`))})]})})()})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("label",{className:"text-[10px] text-text-secondary block mb-0.5 uppercase font-semibold",children:"Hoa Hồng Ứng"}),p?e.jsx("input",{type:"text",value:A.commission,onChange:o=>k({...A,commission:o.target.value}),className:"w-full text-xs border border-accent-primary rounded px-2 py-1 font-semibold h-full focus:outline-none focus:ring-1 focus:ring-accent-primary",placeholder:"Nhập số tiền..."}):e.jsx("div",{className:"h-full",children:e.jsx(Ae,{text:N["Hoa hồng ứng"]?Number(String(N["Hoa hồng ứng"]).replace(/[^0-9]/g,"")).toLocaleString("en-US")+" đ":"0 đ",showToast:l,className:"text-xs font-bold bg-surface-ground p-0 rounded border border-border-secondary w-full h-full flex items-center justify-center text-green-600 hover:bg-surface-hover transition-colors",wrap:!0})})]}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("label",{className:"text-[10px] text-text-secondary block mb-0.5 uppercase font-semibold",children:"Điểm Vpoint Sử Dụng"}),p?e.jsx("input",{type:"text",value:A.vpoint,onChange:o=>k({...A,vpoint:o.target.value}),className:"w-full text-xs border border-accent-primary rounded px-2 py-1 font-semibold h-full focus:outline-none focus:ring-1 focus:ring-accent-primary",placeholder:"Nhập điểm..."}):e.jsx("div",{className:"h-full",children:e.jsx(Ae,{text:N["Điểm Vpoint sử dụng"]?Number(String(N["Điểm Vpoint sử dụng"]).replace(/[^0-9]/g,"")).toLocaleString("en-US")+" Điểm":"0 Điểm",showToast:l,className:"text-xs font-bold bg-surface-ground p-0 rounded border border-border-secondary w-full h-full flex items-center justify-center text-blue-600 hover:bg-surface-hover transition-colors",wrap:!0})})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-border-primary shadow-sm flex flex-col h-full",children:[e.jsx("div",{className:"bg-gray-100 px-3 py-1.5 border-b border-border-secondary",children:e.jsx("h3",{className:"text-xs font-bold text-text-secondary uppercase tracking-wider",children:"Hồ Sơ Đính Kèm"})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 p-2",children:[{key:"LinkHopDong",label:"Hợp đồng",icon:"fa-file-contract"},{key:"LinkDeNghiXHD",label:"Đề nghị XHĐ",icon:"fa-file-invoice"},{key:"LinkHoaDonDaXuat",label:"Hóa Đơn Đã Xuất",icon:"fa-file-invoice-dollar"}].map(o=>{const $=N[o.key];return e.jsx(jt,{url:$,label:o.label,icon:o.icon,onPreview:()=>$&&f($,`${o.label} - ${N["Tên khách hàng"]}`)},o.key)})})]})]})})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-text-placeholder",children:[e.jsx("i",{className:"fas fa-inbox text-6xl mb-4 opacity-20"}),e.jsx("p",{children:"Chọn một đơn hàng để xem chi tiết"})]})}),e.jsx("input",{type:"file",ref:S,className:"hidden",accept:".pdf,.jpeg,.png,.jpg",onChange:F})]})},St=({pendingOrders:t,pairedOrders:g,stockData:l,onAction:f,filters:i,showToast:c,activeTab:r,selectedOrderId:v,onTabChange:h,onOrderSelect:b})=>{const[T,p]=s.useState("requests"),a=x=>!x.VIN||String(x["Kết quả"]||"").toLowerCase().includes("chưa"),u=s.useMemo(()=>{const x=(i==null?void 0:i.keyword)||"";let N=r==="pending"?t:g;return x&&(N=[...t,...g]),N.filter(m=>!(!(!x||te(m["Tên khách hàng"],x)||te(m["Số đơn hàng"],x)||te(m["Dòng xe"],x)||te(m.VIN,x)||te(m["Phiên bản"],x)||te(m["Ngoại thất"],x)||te(m["Nội thất"],x)||te(m["Tên tư vấn bán hàng"],x)||te(m["CHÍNH SÁCH"],x)||te(m["Số động cơ"],x))||i&&(i.tvbh&&i.tvbh.length>0&&!i.tvbh.includes(m["Tên tư vấn bán hàng"])||i.dongXe&&i.dongXe.length>0&&!i.dongXe.includes(m["Dòng xe"])||i.version&&i.version.length>0&&!i.version.includes(m["Phiên bản"])||i.ngoaiThat&&i.ngoaiThat.length>0&&!i.ngoaiThat.includes(m["Ngoại thất"]))))},[r,t,g,i]),d=s.useMemo(()=>u.find(x=>x["Số đơn hàng"]===v),[u,v]);s.useEffect(()=>{u.length>0&&!v&&b(u[0]["Số đơn hàng"])},[u,v,b]);const A=s.useMemo(()=>!d||!a(d)?[]:l.filter(x=>{const N=x["Dòng xe"]===d["Dòng xe"],m=x["Ngoại thất"]===d["Ngoại thất"],H=x["Nội thất"]===d["Nội thất"],X=!d["Phiên bản"]||x["Phiên bản"]===d["Phiên bản"],K=!x["Trạng thái"]||x["Trạng thái"]==="Chưa ghép";return N&&m&&H&&X&&K}).map(x=>({...x,matchScore:100})),[d,l]),k=x=>l.some(H=>H["Dòng xe"]===x["Dòng xe"]&&H["Ngoại thất"]===x["Ngoại thất"]&&H["Nội thất"]===x["Nội thất"]&&(!H["Trạng thái"]||H["Trạng thái"]==="Chưa ghép"))?"success":l.some(H=>H["Dòng xe"]===x["Dòng xe"]&&(!H["Trạng thái"]||H["Trạng thái"]==="Chưa ghép"))?"warning":"danger",S=(x,N)=>{x&&(navigator.clipboard.writeText(x),c("Đã sao chép!",`${N} đã được sao chép.`,"success",2e3))},F=x=>{b(x),p("radar")};return e.jsxs("div",{className:"flex flex-col h-full bg-surface-card rounded-xl shadow-md border border-border-primary overflow-hidden animate-fade-in relative",children:[e.jsxs("div",{className:"md:hidden flex border-b border-border-primary bg-white flex-shrink-0",children:[e.jsxs("button",{onClick:()=>p("requests"),className:`flex-1 py-3 text-sm font-bold text-center border-b-2 transition-colors ${T==="requests"?"border-accent-primary text-accent-primary bg-accent-primary/5":"border-transparent text-text-secondary"}`,children:["Danh Sách (",u.length,")"]}),e.jsxs("button",{onClick:()=>p("radar"),className:`flex-1 py-3 text-sm font-bold text-center border-b-2 transition-colors ${T==="radar"?"border-accent-primary text-accent-primary bg-accent-primary/5":"border-transparent text-text-secondary"}`,children:["Chi Tiết (",d?"1":"0",")"]})]}),e.jsxs("div",{className:"flex-1 flex min-h-0 relative",children:[e.jsxs("div",{className:`w-full md:w-[30%] flex flex-col border-r border-border-primary bg-surface-ground absolute md:relative inset-0 z-10 md:z-auto transition-transform duration-300 ${T==="requests"?"translate-x-0":"-translate-x-full md:translate-x-0"}`,children:[e.jsxs("div",{className:"flex border-b border-border-primary bg-white flex-shrink-0",children:[e.jsxs("button",{onClick:()=>h("pending"),className:`flex-1 py-3 text-xs font-bold transition-colors uppercase tracking-wider ${r==="pending"?"text-accent-primary border-b-2 border-accent-primary bg-accent-primary/5":"text-text-secondary hover:bg-surface-hover border-b-2 border-transparent"}`,children:["Chờ Ghép (",t.length,")"]}),e.jsxs("button",{onClick:()=>h("paired"),className:`flex-1 py-3 text-xs font-bold transition-colors uppercase tracking-wider ${r==="paired"?"text-success border-b-2 border-success bg-success/5":"text-text-secondary hover:bg-surface-hover border-b-2 border-transparent"}`,children:["Đã Ghép (",g.length,")"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-2 space-y-2",children:[u.map(x=>{var K;const N=v===x["Số đơn hàng"],m=a(x),H=m?k(x):null,X=m?l.filter(z=>z["Dòng xe"]===x["Dòng xe"]&&z["Ngoại thất"]===x["Ngoại thất"]&&z["Nội thất"]===x["Nội thất"]&&(!x["Phiên bản"]||z["Phiên bản"]===x["Phiên bản"])&&(!z["Trạng thái"]||z["Trạng thái"]==="Chưa ghép")).length:0;return e.jsxs("div",{onClick:()=>F(x["Số đơn hàng"]),className:`p-3 rounded-lg cursor-pointer transition-all duration-200 relative border ${N?"bg-white border-accent-primary shadow-md ring-1 ring-accent-primary/20":"bg-white border-border-secondary hover:border-accent-primary/50 hover:shadow-sm"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("h3",{className:`text-sm font-bold truncate pr-2 ${N?"text-accent-primary":"text-text-primary"}`,children:x["Tên khách hàng"]}),m&&e.jsxs("div",{className:"flex items-center gap-1",children:[X>0&&e.jsx("span",{className:"text-[9px] font-bold text-white bg-success px-1.5 py-0.5 rounded shadow-sm animate-pulse",children:"CÓ XE"}),e.jsx("div",{className:`w-2.5 h-2.5 rounded-full flex-shrink-0 ${H==="success"?"bg-success shadow-[0_0_8px_rgba(34,197,94,0.6)]":H==="warning"?"bg-warning":"bg-danger"}`})]}),!m&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[10px] font-mono font-bold text-success bg-success/10 px-1.5 py-0.5 rounded border border-success/20",children:(K=x.VIN)==null?void 0:K.slice(-6)}),e.jsx("i",{className:"fas fa-check-circle text-success text-xs"})]})]}),e.jsxs("div",{className:"text-xs text-text-secondary mb-1 truncate",children:[e.jsx("span",{className:"font-medium text-text-primary",children:x["Dòng xe"]}),e.jsx("span",{className:"mx-1 text-text-placeholder",children:"|"}),e.jsx("span",{children:x["Phiên bản"]})]}),e.jsxs("div",{className:"flex justify-between items-center text-[10px] text-text-secondary mt-2 pt-2 border-t border-border-secondary/30",children:[e.jsx("span",{className:"truncate max-w-[60%]",children:x["Tên tư vấn bán hàng"]}),e.jsx("span",{className:"font-mono",children:q(x["Thời gian nhập"]).format("DD/MM")})]})]},x["Số đơn hàng"])}),u.length===0&&e.jsx("div",{className:"text-center py-8 text-text-placeholder text-sm",children:"Không tìm thấy đơn hàng"})]})]}),e.jsx("div",{className:`w-full md:w-[70%] flex flex-col bg-surface-ground min-w-0 absolute md:relative inset-0 z-0 md:z-auto transition-transform duration-300 ${T==="radar"?"translate-x-0":"translate-x-full md:translate-x-0"}`,children:d?e.jsxs("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:"m-3 md:m-4 p-4 bg-white rounded-2xl border border-border-primary shadow-sm flex flex-col md:flex-row justify-between items-start md:items-center gap-4 flex-shrink-0 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-accent-primary/5 rounded-full blur-3xl -mr-10 -mt-10 pointer-events-none"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-text-primary",children:d["Tên khách hàng"]}),e.jsx("span",{className:"px-2 py-0.5 rounded text-[10px] font-mono bg-surface-ground border border-border-secondary text-text-secondary",children:d["Số đơn hàng"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsx("span",{className:"px-2.5 py-1 rounded-lg bg-accent-primary/10 text-accent-primary text-xs font-bold border border-accent-primary/20",children:d["Dòng xe"]}),e.jsx("span",{className:"px-2.5 py-1 rounded-lg bg-surface-ground text-text-primary text-xs font-medium border border-border-secondary",children:d["Phiên bản"]}),e.jsxs("span",{className:"px-2.5 py-1 rounded-lg bg-surface-ground text-text-primary text-xs font-medium border border-border-secondary flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-gray-800"}),d["Ngoại thất"]," / ",d["Nội thất"]]})]})]}),e.jsxs("div",{className:"flex gap-4 text-right relative z-10",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-text-secondary uppercase tracking-wider font-bold",children:"Ngày Yêu Cầu"}),e.jsx("div",{className:"text-sm font-bold text-text-primary",children:q(d["Thời gian nhập"]).format("DD/MM/YYYY")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-text-secondary uppercase tracking-wider font-bold",children:"Ngày Cọc"}),e.jsx("div",{className:"text-sm font-bold text-text-primary",children:d["Ngày cọc"]?q(d["Ngày cọc"]).format("DD/MM/YYYY"):"--"})]})]})]}),a(d)?e.jsxs("div",{className:"flex-1 flex flex-col min-h-0 overflow-hidden px-3 md:px-4 pb-3 md:pb-4",children:[e.jsxs("div",{className:"flex-1 bg-gradient-to-b from-gray-900 to-gray-800 rounded-2xl shadow-inner border border-gray-700 relative overflow-hidden flex items-center justify-center mb-3 group",children:[e.jsx("div",{className:"absolute inset-0 opacity-20",style:{backgroundImage:"radial-gradient(circle, #4ade80 1px, transparent 1px)",backgroundSize:"30px 30px"}}),e.jsx("div",{className:"absolute w-[500px] h-[500px] border border-emerald-500/20 rounded-full animate-[ping_3s_linear_infinite]"}),e.jsx("div",{className:"absolute w-[350px] h-[350px] border border-emerald-500/30 rounded-full"}),e.jsx("div",{className:"absolute w-[200px] h-[200px] border border-emerald-500/50 rounded-full"}),e.jsx("div",{className:"absolute w-full h-1/2 top-0 bg-gradient-to-b from-transparent to-emerald-500/10 origin-bottom animate-[spin_4s_linear_infinite] border-b border-emerald-500/50"}),e.jsx("div",{className:"relative z-10 flex flex-col items-center",children:A.length>0?e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-emerald-500/20 blur-xl rounded-full animate-pulse"}),e.jsx("div",{className:"bg-white p-2 rounded-full shadow-[0_0_30px_rgba(16,185,129,0.4)] border-4 border-emerald-500 relative z-10 w-32 h-32 flex items-center justify-center overflow-hidden",children:e.jsx(Le,{model:d["Dòng xe"],exteriorColor:d["Ngoại thất"],className:"w-full h-full object-contain transform scale-125"})}),e.jsx("div",{className:"absolute -bottom-4 left-1/2 transform -translate-x-1/2 bg-emerald-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg whitespace-nowrap z-20",children:"Best Match"})]}):e.jsxs("div",{className:"flex flex-col items-center text-emerald-500/50",children:[e.jsx("i",{className:"fas fa-satellite-dish text-4xl mb-2 animate-bounce"}),e.jsx("span",{className:"text-sm font-mono tracking-widest",children:"SCANNING..."})]})}),e.jsxs("div",{className:"absolute top-4 left-4 text-emerald-500/80 font-mono text-xs",children:[e.jsx("div",{children:"RADAR: ACTIVE"}),e.jsxs("div",{children:["TARGET: ",d["Dòng xe"]]})]}),e.jsxs("div",{className:"absolute bottom-4 right-4 text-emerald-500/80 font-mono text-xs text-right",children:[e.jsxs("div",{children:["MATCHES: ",A.length]}),e.jsxs("div",{children:["STATUS: ",A.length>0?"FOUND":"SEARCHING"]})]})]}),e.jsxs("div",{className:"h-48 md:h-60 bg-white rounded-2xl border border-border-primary shadow-sm flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-2 border-b border-border-secondary bg-surface-ground flex justify-between items-center",children:[e.jsxs("h3",{className:"text-xs font-bold text-text-secondary uppercase tracking-wider",children:["Kho Xe Phù Hợp (",A.length,")"]}),e.jsx("button",{className:"text-accent-primary text-xs hover:underline",children:"Xem tất cả kho"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 custom-scrollbar",children:A.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:A.map(x=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white border border-border-secondary rounded-xl hover:border-accent-primary hover:shadow-md transition-all group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-10 h-10 rounded-full bg-emerald-50 text-emerald-600 flex items-center justify-center font-bold text-sm border border-emerald-100",children:[x.matchScore,"%"]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-text-primary",children:x.VIN}),e.jsxs("div",{className:"text-[10px] text-text-secondary",children:[x["Ngoại thất"]," / ",x["Nội thất"]]})]})]}),e.jsx(ge,{onClick:()=>f("pair",d,{vin:x.VIN}),variant:"primary",size:"sm",className:"opacity-0 group-hover:opacity-100 transition-opacity",children:"Ghép"})]},x.VIN))}):e.jsx("div",{className:"flex flex-col items-center justify-center h-full text-text-placeholder",children:e.jsx("p",{className:"text-sm",children:"Chưa tìm thấy xe phù hợp trong kho."})})})]})]}):e.jsxs("div",{className:"flex-1 p-4 flex flex-col items-center justify-center relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-success/5 to-accent-primary/5 pointer-events-none"}),e.jsx("div",{className:"absolute top-1/4 left-1/4 w-64 h-64 bg-success/10 rounded-full blur-3xl pointer-events-none animate-pulse"}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl p-8 rounded-3xl border border-white/50 shadow-2xl text-center max-w-2xl w-full relative z-10 animate-scale-in",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-success/10 text-success font-bold text-sm mb-6 border border-success/20 shadow-sm",children:[e.jsx("i",{className:"fas fa-check-circle"}),"ĐÃ GHÉP XE THÀNH CÔNG"]}),e.jsxs("div",{className:"relative mb-8 group h-48 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-x-0 bottom-0 h-4 bg-black/20 blur-xl rounded-[100%] transform scale-x-75 opacity-0 group-hover:opacity-100 transition-opacity duration-500"}),e.jsx(Le,{model:d["Dòng xe"],exteriorColor:d["Ngoại thất"],className:"w-full h-full object-contain drop-shadow-2xl transform transition-transform duration-500 hover:scale-110"})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"text-xs text-text-secondary uppercase tracking-widest font-bold mb-2",children:"Số Khung (VIN)"}),e.jsx("div",{className:"text-3xl md:text-5xl font-mono font-black text-transparent bg-clip-text bg-gradient-to-r from-text-primary to-text-secondary tracking-wider cursor-pointer hover:opacity-80 transition-opacity select-all",onClick:()=>S(d.VIN||"","VIN"),title:"Click để sao chép",children:d.VIN})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs(ge,{onClick:()=>f("unmatch",d),variant:"danger",className:"px-8 py-3 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all",children:[e.jsx("i",{className:"fas fa-unlink mr-2"}),"Hủy Ghép Xe"]})})]})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-text-placeholder bg-surface-ground",children:[e.jsx("i",{className:"fas fa-satellite text-6xl mb-4 opacity-10"}),e.jsx("p",{className:"text-lg font-medium opacity-50",children:"Chọn đơn hàng để bắt đầu"})]})})]})]})},_e=({text:t,showToast:g,className:l,label:f,wrap:i=!1})=>{if(!t||t==="N/A")return e.jsxs("div",{className:l,children:[f?`${f}: `:"","N/A"]});const c=r=>{r.stopPropagation(),navigator.clipboard.writeText(t).then(()=>{g("Đã sao chép!",`${t} đã được sao chép.`,"success",2e3)}).catch(()=>g("Lỗi","Không thể sao chép.","error"))};return e.jsxs("div",{className:`cursor-pointer ${l}`,title:`Click để sao chép: ${t}`,onClick:c,children:[e.jsx("span",{children:f?`${f}: `:""}),e.jsx("span",{className:i?"break-words":"truncate",children:t})]})},kt=({url:t,label:g,icon:l,onClick:f})=>{const[i,c]=s.useState(Ee(t,320)),[r,v]=s.useState(!1);return s.useEffect(()=>{c(Ee(t,320)),v(!1)},[t]),e.jsxs("div",{className:"flex flex-col rounded border border-border-secondary bg-surface-ground cursor-pointer hover:bg-surface-hover transition-all overflow-hidden group",onClick:h=>{h.stopPropagation(),f()},children:[e.jsxs("div",{className:"h-32 bg-white flex items-center justify-center overflow-hidden relative",children:[r?e.jsx("div",{className:"w-12 h-12 rounded-full bg-surface-ground shadow-sm flex items-center justify-center text-accent-primary",children:e.jsx("i",{className:`fas ${l} text-2xl opacity-50`})}):e.jsx("img",{src:i,alt:g,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110",onError:()=>v(!0)}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center",children:e.jsx("i",{className:"fas fa-search-plus text-white opacity-0 group-hover:opacity-100 transform scale-50 group-hover:scale-100 transition-all duration-300 drop-shadow-md"})})]}),e.jsxs("div",{className:"p-2 text-center border-t border-border-secondary bg-surface-ground",children:[e.jsx("div",{className:"font-medium text-xs text-text-primary truncate",title:g,children:g}),e.jsx("div",{className:"text-[10px] text-text-secondary mt-0.5",children:"Nhấn để xem"})]})]})},Ct=({requests:t,onAction:g,showToast:l,onOpenImagePreview:f,onDownloadAll:i,selectedFolder:c,selectedRequestId:r,onFolderChange:v,onRequestSelect:h})=>{var D;const[b,T]=s.useState("folders"),[p,a]=s.useState(null),u=s.useMemo(()=>t.filter(y=>{const I=(y["Trạng thái xử lý"]||"").toLowerCase();switch(c){case"pending":return I==="chờ duyệt ycvc";case"approved":return I.includes("đã duyệt")||I.includes("hoàn thành")||I.includes("đã phê duyệt");case"rejected":return I.includes("từ chối")||I.includes("hủy");case"all":return!0;default:return!0}}),[t,c]),d=s.useMemo(()=>t.find(y=>y["Số đơn hàng"]===r),[t,r]);s.useEffect(()=>{if(u.length>0){const y=u[0]["Số đơn hàng"];h(y)}},[c]),s.useEffect(()=>{!r&&u.length>0&&h(u[0]["Số đơn hàng"])},[u,r,h]);const A=[{id:"pending",label:"Chờ Duyệt",icon:"fa-clock",count:t.filter(y=>(y["Trạng thái xử lý"]||"").toLowerCase()==="chờ duyệt ycvc").length},{id:"approved",label:"Đã phê duyệt",icon:"fa-check-circle",count:t.filter(y=>{const I=(y["Trạng thái xử lý"]||"").toLowerCase();return I.includes("đã duyệt")||I.includes("hoàn thành")||I.includes("đã phê duyệt")}).length},{id:"rejected",label:"Đã Từ Chối",icon:"fa-ban",count:t.filter(y=>(y["Trạng thái xử lý"]||"").toLowerCase().includes("từ chối")).length},{id:"all",label:"Tất Cả",icon:"fa-list",count:t.length}],k=y=>{const I=y.toLowerCase();return[{type:"approveVc",label:"Phê Duyệt",icon:"fa-check-circle",className:"btn-success",condition:I==="chờ duyệt ycvc"},{type:"rejectVc",label:"Từ Chối",icon:"fa-ban",className:"btn-danger",condition:I==="chờ duyệt ycvc"}].filter(ee=>ee.condition)},S={idCardFront:{label:"CCCD Trước",icon:"fa-id-card"},idCardBack:{label:"CCCD Sau",icon:"fa-id-card"},businessLicense:{label:"GPKD",icon:"fa-file-alt"},regFront:{label:"Cavet Trước",icon:"fa-car"},regBack:{label:"Cavet Sau",icon:"fa-car"},unc:{label:"UNC",icon:"fa-file-invoice-dollar"}},F=y=>{let I={};try{y.FileUrls?I=JSON.parse(y.FileUrls):y["URL hình ảnh"]&&(I={unc:y["URL hình ảnh"]})}catch(Z){console.error("Failed to parse FileUrls",Z)}const ee=Object.entries(I),ne=ee.map(([Z,ce])=>{const oe=S[Z]||{label:Z};return{src:ce,originalUrl:ce,label:oe.label}});return{docEntries:ee,allImageSources:ne,fileUrls:I}},x=y=>{v(y),T("list")},N=y=>{h(y),T("detail")},m=async(y,I)=>{a({id:I["Số đơn hàng"],type:y});try{await g(y,I)}catch(ee){console.error(ee)}finally{a(null)}},[H,X]=s.useState(null),[K,z]=s.useState(null),R=50,J=y=>{z(null),X(y.targetTouches[0].clientX)},Q=y=>{z(y.targetTouches[0].clientX)},M=()=>{if(!H||!K)return;const y=H-K,I=y>R,ee=y<-R;if(I||ee){const ne=u.findIndex(Z=>Z["Số đơn hàng"]===r);if(ne===-1)return;I&&ne<u.length-1?N(u[ne+1]["Số đơn hàng"]):ee&&ne>0&&N(u[ne-1]["Số đơn hàng"])}};return e.jsxs("div",{className:"flex h-full bg-surface-card rounded-xl shadow-md border border-border-primary overflow-hidden animate-fade-in relative",children:[e.jsxs("div",{className:`w-full md:w-64 flex-shrink-0 border-r border-border-primary bg-surface-ground flex flex-col absolute md:relative inset-0 z-20 md:z-auto transition-transform duration-300 ${b==="folders"?"translate-x-0":"-translate-x-full md:translate-x-0"}`,children:[e.jsx("div",{className:"p-4 border-b border-border-primary md:hidden flex items-center justify-between bg-white",children:e.jsx("span",{className:"font-bold text-lg",children:"Danh Mục"})}),e.jsx("nav",{className:"flex-1 p-2 space-y-1 overflow-y-auto",children:A.map(y=>e.jsxs("button",{onClick:()=>x(y.id),className:`w-full flex items-center justify-between px-3 py-2 rounded-lg text-xs font-medium transition-colors ${c===y.id?"bg-accent-primary/10 text-accent-primary":"text-text-secondary hover:bg-surface-hover hover:text-text-primary"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("i",{className:`fas ${y.icon} w-5 text-center`}),e.jsx("span",{children:y.label})]}),y.count>0&&e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${c===y.id?"bg-accent-primary text-white":"bg-surface-hover text-text-secondary"}`,children:y.count})]},y.id))})]}),e.jsxs("div",{className:`w-full md:w-80 flex-shrink-0 border-r border-border-primary flex flex-col bg-white absolute md:relative inset-0 z-20 md:z-auto transition-transform duration-300 ${b==="list"?"translate-x-0":b==="detail"?"-translate-x-full md:translate-x-0":"translate-x-full md:translate-x-0"}`,children:[e.jsxs("div",{className:"p-3 border-b border-border-primary md:hidden flex items-center gap-3 bg-white shadow-sm",children:[e.jsx("button",{onClick:()=>T("folders"),className:"w-8 h-8 rounded-full bg-surface-ground flex items-center justify-center text-text-secondary hover:bg-surface-hover",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsx("span",{className:"font-bold text-text-primary",children:(D=A.find(y=>y.id===c))==null?void 0:D.label})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:u.length===0?e.jsx("div",{className:"p-8 text-center text-text-placeholder text-sm",children:"Không tìm thấy yêu cầu nào."}):e.jsx("div",{className:"divide-y divide-border-secondary",children:u.map(y=>e.jsxs("div",{onClick:()=>N(y["Số đơn hàng"]),className:`px-3 py-2 cursor-pointer hover:bg-surface-hover transition-all duration-200 flex items-center justify-between ${r===y["Số đơn hàng"]?"bg-accent-primary/10 border-l-4 border-accent-primary shadow-inner":"border-l-4 border-transparent"}`,children:[e.jsx("span",{className:"text-text-primary text-sm truncate pr-2",children:y["Tên khách hàng"]}),e.jsx("div",{className:"flex-shrink-0",children:(()=>{const I=(y["Trạng thái xử lý"]||"").toLowerCase();return I.includes("chờ")?e.jsx("i",{className:"fas fa-clock text-warning text-base",title:y["Trạng thái xử lý"]}):I.includes("đã duyệt")||I.includes("hoàn thành")||I.includes("phê duyệt")?e.jsx("i",{className:"fas fa-check-circle text-blue-400 text-sm",title:y["Trạng thái xử lý"]}):I.includes("từ chối")?e.jsx("i",{className:"fas fa-ban text-danger text-base",title:y["Trạng thái xử lý"]}):e.jsx("i",{className:"fas fa-question-circle text-text-secondary text-base",title:y["Trạng thái xử lý"]})})()})]},y["Số đơn hàng"]))})})]}),e.jsx("div",{className:`w-full flex-1 flex flex-col bg-surface-ground min-w-0 absolute md:relative inset-0 z-30 md:z-auto transition-transform duration-300 ${b==="detail"?"translate-x-0":"translate-x-full md:translate-x-0"}`,onTouchStart:J,onTouchMove:Q,onTouchEnd:M,children:d?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-4 py-3 bg-white border-b border-border-primary flex justify-between items-center shadow-sm z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>T("list"),className:"md:hidden w-8 h-8 rounded-full bg-surface-ground flex items-center justify-center text-text-secondary hover:bg-surface-hover",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-accent-primary/10 flex items-center justify-center text-accent-primary font-bold text-base hidden sm:flex",children:d["Tên khách hàng"].charAt(0)}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{className:"text-base font-bold text-text-primary leading-tight cursor-pointer hover:text-accent-primary transition-colors truncate",title:"Click để sao chép tên khách hàng",onClick:y=>{y.stopPropagation(),navigator.clipboard.writeText(d["Tên khách hàng"]),l("Đã sao chép","Tên khách hàng đã được sao chép","success")},children:d["Tên khách hàng"]}),e.jsxs("div",{className:"text-xs text-text-secondary flex items-center gap-2 mt-0.5",children:[e.jsx("span",{className:"font-mono cursor-pointer hover:text-accent-primary border-b border-dashed border-transparent hover:border-accent-primary transition-all",title:"Click để sao chép số đơn hàng",onClick:y=>{y.stopPropagation(),navigator.clipboard.writeText(d["Số đơn hàng"]),l("Đã sao chép","Số đơn hàng đã được sao chép","success")},children:d["Số đơn hàng"]}),e.jsx("span",{className:"hidden sm:inline",children:"•"}),e.jsx("span",{className:"hidden sm:inline",children:d["Người YC"]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>i(d),className:"btn btn-secondary px-2.5 py-1 text-xs flex items-center gap-1.5 rounded",title:"Tải tất cả hồ sơ",children:[e.jsx("i",{className:"fas fa-file-archive"}),e.jsx("span",{className:"hidden xl:inline",children:"Tải Hồ Sơ"})]}),k(d["Trạng thái xử lý"]||"").map(y=>e.jsx("button",{onClick:()=>m(y.type,d),disabled:p!==null,className:`btn ${y.className} px-2.5 py-1 text-xs flex items-center gap-1.5 rounded w-[100px] justify-center ${(p==null?void 0:p.id)===d["Số đơn hàng"]&&p.type===y.type?"opacity-80 cursor-wait":""}`,children:(p==null?void 0:p.id)===d["Số đơn hàng"]&&p.type===y.type?e.jsx("i",{className:"fas fa-spinner fa-spin"}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:`fas ${y.icon}`}),e.jsx("span",{className:"hidden xl:inline",children:y.label})]})},y.type))]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar",children:e.jsxs("div",{className:"max-w-5xl mx-auto space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-border-primary px-4 py-3 flex items-center justify-between shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-xs text-text-secondary",children:"Trạng thái:"}),e.jsx(Ke,{status:d["Trạng thái xử lý"]||"",size:"sm"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"text-text-secondary",children:"Ngày yêu cầu:"}),e.jsx("span",{className:"font-medium text-text-primary",children:q(d["Thời gian YC"]).format("HH:mm DD/MM/YYYY")})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-border-primary p-3 shadow-sm",children:[e.jsx("h3",{className:"text-xs font-bold text-text-secondary uppercase tracking-wider mb-2 border-b border-border-secondary pb-1.5",children:"Thông Tin Yêu Cầu"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-text-secondary block mb-0.5 uppercase",children:"Loại Yêu Cầu"}),e.jsx("div",{className:"text-sm font-medium truncate",children:d["Loại YC"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-text-secondary block mb-0.5 uppercase",children:"Mã KH DMS"}),e.jsx(_e,{text:d["Mã KH DMS"]||"",showToast:l,className:"font-mono text-sm truncate"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-text-secondary block mb-0.5 uppercase",children:"Số VIN"}),e.jsx(_e,{text:d.VIN||"",showToast:l,className:"font-mono font-bold text-accent-primary text-sm truncate"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-text-secondary block mb-0.5 uppercase",children:"Ghi chú"}),e.jsx("div",{className:"text-sm truncate",title:d["Ghi chú"],children:d["Ghi chú"]||"—"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-border-primary p-3 shadow-sm flex flex-col h-full",children:[e.jsx("h3",{className:"text-xs font-bold text-text-secondary uppercase tracking-wider mb-2 border-b border-border-secondary pb-1.5",children:"Hồ Sơ Đính Kèm"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:(()=>{const{docEntries:y,allImageSources:I}=F(d);return y.length===0?e.jsx("div",{className:"col-span-full text-center py-4 text-text-placeholder text-sm",children:"Không có hồ sơ đính kèm"}):y.map(([ee,ne],Z)=>{const ce=S[ee]||{label:ee,icon:"fa-file"};return e.jsx(kt,{url:ne,label:ce.label,icon:ce.icon,onClick:()=>f(I,Z,d["Tên khách hàng"])},ee)})})()})]})]})})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-text-placeholder",children:[e.jsx("i",{className:"fas fa-inbox text-6xl mb-4 opacity-20"}),e.jsx("p",{children:"Chọn một yêu cầu để xem chi tiết"})]})})]})};q.locale("vi");const Ce=({title:t,icon:g,color:l="text-gray-800",action:f})=>e.jsxs("div",{className:"flex justify-between items-center mb-0 p-3 bg-gray-100 border-b border-gray-200 rounded-t-xl",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[g&&e.jsx("i",{className:`fas ${g} ${l} text-sm`}),e.jsx("h3",{className:`font-bold text-sm tracking-widest uppercase ${l}`,children:t})]}),f]}),He=({label:t,value:g,icon:l,color:f,onClick:i})=>e.jsxs("div",{onClick:i,className:"flex items-center justify-between p-3 rounded-xl bg-white border border-gray-100 shadow-sm hover:shadow-md hover:-translate-y-0.5 transition-all group cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg ${f} bg-opacity-10 flex items-center justify-center`,children:e.jsx("i",{className:`fas ${l} ${f} text-sm`})}),e.jsx("span",{className:"text-sm text-gray-600 font-medium group-hover:text-gray-900 transition-colors",children:t})]}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:g})]}),Tt=({title:t,count:g,icon:l,color:f,onClick:i})=>e.jsxs("div",{onClick:i,className:"flex items-center justify-between py-2.5 px-3 rounded-lg cursor-pointer hover:bg-white hover:shadow-sm transition-all group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${g>0?`${f} text-white shadow-md`:"bg-gray-200 text-gray-400"}`,children:e.jsx("i",{className:`fas ${l} text-xs`})}),e.jsx("span",{className:`text-sm font-bold ${g>0?"text-gray-800":"text-gray-400"}`,children:t})]}),e.jsx("span",{className:`text-sm font-mono font-bold px-2 py-0.5 rounded-md ${g>0?"bg-white text-gray-900 shadow-sm border border-gray-100":"text-gray-300"}`,children:g})]}),Mt=({allOrders:t,stockData:g,soldData:l,invoiceData:f,teamData:i,allUsers:c,onTabChange:r,onNavigateTo:v,onShowOrderDetails:h})=>{const[b,T]=s.useState("pending"),p=s.useMemo(()=>{const a=t.filter(M=>{var D;return(D=M["Kết quả"])==null?void 0:D.toLowerCase().includes("chưa")}),u=g.filter(M=>{var D;return((D=M["Trạng thái"])==null?void 0:D.toLowerCase())==="chưa ghép"}).length,d=l.length,A=Object.keys(i).length,k=c.filter(M=>M.role==="Tư vấn bán hàng").length,S=[{title:"Chờ Ghép",count:a.length,icon:"fa-hourglass-start",color:"bg-amber-500",action:()=>r("pending")},{title:"Đã Ghép",count:t.filter(M=>{var D;return((D=M["Kết quả"])==null?void 0:D.toLowerCase())==="đã ghép"}).length,icon:"fa-link",color:"bg-blue-500",action:()=>r("paired")},{title:"Chờ Duyệt",count:t.filter(M=>{var D;return((D=M["Kết quả"])==null?void 0:D.toLowerCase())==="chờ phê duyệt"}).length,icon:"fa-user-check",color:"bg-indigo-500",action:()=>r("invoices",{trangThai:["Chờ phê duyệt"]})},{title:"Chờ Ký",count:t.filter(M=>{var D;return((D=M["Kết quả"])==null?void 0:D.toLowerCase())==="chờ ký hóa đơn"}).length,icon:"fa-file-signature",color:"bg-purple-500",action:()=>r("invoices",{trangThai:["Chờ ký hóa đơn"]})},{title:"Đã Xuất",count:t.filter(M=>{var D;return((D=M["Kết quả"])==null?void 0:D.toLowerCase())==="đã xuất hóa đơn"}).length,icon:"fa-check-circle",color:"bg-emerald-500",action:()=>r("invoices",{trangThai:["Đã xuất hóa đơn"]})}],F=[...a].sort((M,D)=>new Date(M["Thời gian nhập"]).getTime()-new Date(D["Thời gian nhập"]).getTime()).slice(0,10),x=t.filter(M=>{var D;return["đã ghép","chờ phê duyệt","đã phê duyệt","chờ ký hóa đơn","yêu cầu bổ sung"].includes(((D=M["Kết quả"])==null?void 0:D.toLowerCase())??"")}).sort((M,D)=>new Date(M["Thời gian ghép"]||M["Thời gian nhập"]).getTime()-new Date(D["Thời gian ghép"]||D["Thời gian nhập"]).getTime()).slice(0,10),N={};a.forEach(M=>{const D=`${M["Dòng xe"]||"N/A"}|${M["Phiên bản"]||"N/A"}|${M["Ngoại thất"]||"N/A"}|${M["Nội thất"]||"N/A"}`;N[D]=(N[D]||0)+1});const m=Object.entries(N).map(([M,D])=>{const[y,I,ee,ne]=M.split("|");return{model:`${y} - ${I}`,colors:`${ee} / ${ne}`,count:D}}).sort((M,D)=>D.count-M.count).slice(0,10),H=Math.max(...m.map(M=>M.count),1),X=q().month(),K=q().year(),z=f.filter(M=>{if(!M["Ngày xuất hóa đơn"])return!1;const D=q(M["Ngày xuất hóa đơn"],["YYYY-MM-DD","DD/MM/YYYY","D/M/YYYY",q.ISO_8601]);return D.isValid()&&D.month()===X&&D.year()===K}),R={};z.forEach(M=>{const D=M["Tên tư vấn bán hàng"];if(D){const y=Re(D);R[y]=(R[y]||0)+1}});const Q=c.filter(M=>M.role==="Tư vấn bán hàng").map(M=>{const D=Re(M.name);return{name:M.name,count:R[D]||0}}).sort((M,D)=>D.count!==M.count?D.count-M.count:M.name.localeCompare(D.name));return{pendingRequests:a.length,availableStock:u,totalSold:d,totalTeams:A,totalTVBH:k,pipeline:S,oldestPendingRequests:F,pairedButNotSold:x,pendingRequestsByModel:m,maxPendingCount:H,monthlySalesData:Q}},[t,g,l,i,c,f]);return e.jsxs("div",{className:"h-auto md:h-[calc(100vh-140px)] min-h-[500px] animate-fade-in flex flex-col md:flex-row gap-4 p-4 rounded-xl shadow-xl overflow-y-auto md:overflow-hidden relative bg-white",children:[e.jsxs("div",{className:"w-full md:w-[280px] h-auto md:h-full flex-shrink-0 !bg-white rounded-xl border border-gray-200 shadow-sm flex flex-col relative overflow-hidden z-20",style:{backgroundColor:"#ffffff"},children:[e.jsxs("div",{className:"relative z-10",children:[e.jsx(Ce,{title:"Quy Trình",icon:"fa-stream",color:"text-blue-600"}),e.jsx("div",{className:"space-y-1 p-4 pt-2",children:p.pipeline.map((a,u)=>e.jsx(Tt,{title:a.title,count:a.count,icon:a.icon,color:a.color,onClick:a.action},u))})]}),e.jsxs("div",{className:"flex-grow relative z-10",children:[e.jsx(Ce,{title:"Chỉ Số",icon:"fa-chart-pie",color:"text-purple-600"}),e.jsxs("div",{className:"space-y-2 p-4 pt-2",children:[e.jsx(He,{label:"Kho Xe",value:p.availableStock,icon:"fa-warehouse",color:"text-indigo-600",onClick:()=>v==null?void 0:v("stock")}),e.jsx(He,{label:"Đã Bán (Năm)",value:p.totalSold,icon:"fa-hand-holding-dollar",color:"text-emerald-600"}),e.jsx(He,{label:"Nhân Sự",value:p.totalTVBH,icon:"fa-users",color:"text-blue-600"}),e.jsx(He,{label:"Phòng KD",value:p.totalTeams,icon:"fa-briefcase",color:"text-amber-600",onClick:()=>r("phongkd")})]})]}),e.jsx("div",{className:"mt-auto pt-4 border-t border-gray-100 relative z-10",children:e.jsxs("p",{className:"text-[10px] text-gray-400 text-center flex items-center justify-center gap-1",children:[e.jsx("i",{className:"fas fa-clock"}),"Cập nhật: ",q().format("HH:mm")]})})]}),e.jsxs("div",{className:"flex-grow flex flex-col min-w-0 gap-4 relative z-10",children:[e.jsxs("div",{className:"h-auto min-h-[250px] md:h-[45%] !bg-white rounded-xl border border-gray-200 shadow-sm flex flex-col z-20 relative",style:{backgroundColor:"#ffffff"},children:[e.jsx(Ce,{title:"Cần Xử Lý",icon:"fa-bell",color:"text-red-500",action:e.jsxs("div",{className:"flex bg-gray-100 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>T("pending"),className:`px-3 py-1 text-xs font-bold uppercase tracking-wider rounded-md transition-all flex items-center gap-2 ${b==="pending"?"bg-white text-red-600 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx("i",{className:"fas fa-clock"})," Chờ Lâu"]}),e.jsxs("button",{onClick:()=>T("stuck"),className:`px-3 py-1 text-xs font-bold uppercase tracking-wider rounded-md transition-all flex items-center gap-2 ${b==="stuck"?"bg-white text-orange-600 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx("i",{className:"fas fa-exclamation-triangle"})," Kẹt Xe"]})]})}),e.jsx("div",{className:"flex-grow overflow-x-auto hidden-scrollbar pb-2 p-4",children:e.jsx("div",{className:"flex gap-3 h-full",children:b==="pending"?e.jsxs(e.Fragment,{children:[p.oldestPendingRequests.map(a=>e.jsx("div",{onClick:()=>h(a),className:"min-w-[200px] w-[200px] bg-white rounded-xl border border-gray-100 shadow-sm hover:shadow-md hover:-translate-y-1 transition-all cursor-pointer group flex flex-col relative overflow-hidden",children:e.jsxs("div",{className:"p-3 flex-grow flex flex-col relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"text-xs font-bold text-gray-500 bg-gray-100 px-1.5 py-0.5 rounded uppercase tracking-wider",children:a["Số đơn hàng"]}),e.jsx("i",{className:"fas fa-clock text-red-400 text-sm"})]}),e.jsx("h4",{className:"text-sm font-bold text-gray-900 line-clamp-2 mb-1",title:a["Tên khách hàng"],children:a["Tên khách hàng"]}),e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:a["Dòng xe"]}),e.jsxs("div",{className:"mt-auto pt-2 border-t border-gray-50 flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] text-gray-400",children:"Chờ đợi"}),e.jsx("span",{className:"text-xs font-bold text-red-600 bg-red-50 px-2 py-0.5 rounded-full",children:q(a["Thời gian nhập"]).fromNow(!0)})]})]})},a["Số đơn hàng"])),p.oldestPendingRequests.length===0&&e.jsxs("div",{className:"w-full flex flex-col items-center justify-center text-gray-400",children:[e.jsx("i",{className:"fas fa-check-circle text-3xl text-green-100 mb-2"}),e.jsx("span",{className:"text-xs",children:"Không có yêu cầu chờ lâu"})]})]}):e.jsxs(e.Fragment,{children:[p.pairedButNotSold.map(a=>e.jsx("div",{onClick:()=>h(a),className:"min-w-[200px] w-[200px] bg-white rounded-xl border border-gray-100 shadow-sm hover:shadow-md hover:-translate-y-1 transition-all cursor-pointer group flex flex-col relative overflow-hidden",children:e.jsxs("div",{className:"p-3 flex-grow flex flex-col relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"text-xs font-bold text-gray-500 bg-gray-100 px-1.5 py-0.5 rounded font-mono",children:a.VIN||"N/A"}),e.jsx("i",{className:"fas fa-car-crash text-orange-400 text-sm"})]}),e.jsx("h4",{className:"text-sm font-bold text-gray-900 line-clamp-2 mb-1",title:a["Kết quả"],children:a["Kết quả"]}),e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:a["Dòng xe"]}),e.jsxs("div",{className:"mt-auto pt-2 border-t border-gray-50 flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] text-gray-400",children:"Tồn đọng"}),e.jsx("span",{className:"text-xs font-bold text-orange-600 bg-orange-50 px-2 py-0.5 rounded-full",children:q(a["Thời gian ghép"]||a["Thời gian nhập"]).fromNow(!0)})]})]})},a.VIN||a["Số đơn hàng"])),p.pairedButNotSold.length===0&&e.jsxs("div",{className:"w-full flex flex-col items-center justify-center text-gray-400",children:[e.jsx("i",{className:"fas fa-check-circle text-3xl text-green-100 mb-2"}),e.jsx("span",{className:"text-xs",children:"Không có xe bị kẹt"})]})]})})})]}),e.jsxs("div",{className:"flex-grow flex flex-col md:flex-row min-h-0 gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/2 !bg-white rounded-xl border border-gray-200 shadow-sm flex flex-col z-20 relative",style:{backgroundColor:"#ffffff"},children:[e.jsx(Ce,{title:"Nhu Cầu",icon:"fa-chart-bar",color:"text-teal-600"}),e.jsxs("div",{className:"flex-grow overflow-y-auto hidden-scrollbar pr-1 p-4",children:[e.jsx("div",{className:"grid grid-cols-2 gap-3",children:p.pendingRequestsByModel.map((a,u)=>e.jsx("div",{className:"bg-white p-3 rounded-xl border border-gray-100 shadow-sm hover:shadow-md hover:-translate-y-0.5 transition-all relative overflow-hidden group",children:e.jsxs("div",{className:"relative z-10",children:[e.jsx("h4",{className:"font-bold text-gray-800 text-xs uppercase truncate pr-2",title:a.model,children:a.model}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-0.5 truncate",title:a.colors,children:a.colors}),e.jsxs("div",{className:"mt-3 flex items-end justify-between",children:[e.jsx("div",{className:"h-1 w-12 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-teal-500",style:{width:`${a.count/p.maxPendingCount*100}%`}})}),e.jsx("span",{className:"text-xl font-bold text-teal-600 leading-none",children:a.count})]})]})},u))}),p.pendingRequestsByModel.length===0&&e.jsx("div",{className:"text-center text-gray-400 text-xs py-8",children:"Chưa có yêu cầu"})]})]}),e.jsxs("div",{className:"w-full md:w-1/2 !bg-white rounded-xl border border-gray-200 shadow-sm flex flex-col z-20 relative",style:{backgroundColor:"#ffffff"},children:[e.jsx(Ce,{title:"Top Sales",icon:"fa-trophy",color:"text-yellow-500"}),e.jsxs("div",{className:"flex-grow overflow-y-auto hidden-scrollbar pr-2 p-4",children:[p.monthlySalesData.length>0&&e.jsxs("div",{className:"flex items-end justify-center gap-2 mb-6 mt-2",children:[p.monthlySalesData[1]&&e.jsxs("div",{className:"flex flex-col items-center w-1/3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-100 border-2 border-gray-300 flex items-center justify-center mb-2 shadow-sm relative z-10",children:e.jsx("span",{className:"font-bold text-gray-500 text-xs",children:"2"})}),e.jsxs("div",{className:"bg-white p-2 rounded-lg shadow-sm border border-gray-100 text-center w-full relative -mt-4 pt-5",children:[e.jsx("p",{className:"text-[10px] font-bold truncate text-gray-700",children:p.monthlySalesData[1].name}),e.jsx("p",{className:"text-sm font-bold text-gray-900 mt-0.5",children:p.monthlySalesData[1].count})]})]}),p.monthlySalesData[0]&&e.jsxs("div",{className:"flex flex-col items-center w-1/3 -mb-1",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-yellow-100 border-2 border-yellow-400 flex items-center justify-center mb-2 shadow-md relative z-10",children:e.jsx("i",{className:"fas fa-crown text-yellow-500 text-sm"})}),e.jsxs("div",{className:"bg-white p-2 rounded-lg shadow-md border border-yellow-200 text-center w-full relative -mt-4 pt-6",children:[e.jsx("p",{className:"text-[10px] font-bold truncate text-yellow-900",children:p.monthlySalesData[0].name}),e.jsx("p",{className:"text-base font-bold text-yellow-600 mt-0.5",children:p.monthlySalesData[0].count})]})]}),p.monthlySalesData[2]&&e.jsxs("div",{className:"flex flex-col items-center w-1/3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-50 border-2 border-orange-200 flex items-center justify-center mb-2 shadow-sm relative z-10",children:e.jsx("span",{className:"font-bold text-orange-400 text-xs",children:"3"})}),e.jsxs("div",{className:"bg-white p-2 rounded-lg shadow-sm border border-gray-100 text-center w-full relative -mt-4 pt-5",children:[e.jsx("p",{className:"text-[10px] font-bold truncate text-gray-700",children:p.monthlySalesData[2].name}),e.jsx("p",{className:"text-sm font-bold text-gray-900 mt-0.5",children:p.monthlySalesData[2].count})]})]})]}),e.jsx("div",{className:"space-y-1.5",children:p.monthlySalesData.slice(3).map((a,u)=>e.jsxs("div",{className:"flex items-center gap-3 py-1.5 px-2 rounded-lg hover:bg-gray-50 transition-colors border border-transparent hover:border-gray-100",children:[e.jsx("span",{className:"text-xs font-bold text-gray-400 w-4 text-center",children:u+4}),e.jsx("div",{className:"flex-grow min-w-0",children:e.jsx("p",{className:"text-xs font-medium text-gray-700 truncate",children:a.name})}),e.jsx("span",{className:"text-xs font-mono font-bold text-gray-900 bg-gray-100 px-1.5 py-0.5 rounded",children:a.count})]},a.name))}),p.monthlySalesData.length===0&&e.jsx("div",{className:"text-center text-gray-400 text-xs py-8",children:"Chưa có dữ liệu"})]})]})]})]})]})},$e=({isOpen:t,onClose:g,onSubmit:l,title:f,orderNumber:i,reasonLabel:c,icon:r,theme:v,showToast:h})=>{const[b,T]=s.useState(""),[p,a]=s.useState([]),[u,d]=s.useState(!1),A=be();s.useEffect(()=>{t&&d(!1)},[t]);const k=s.useCallback(async m=>{const H=m.clipboardData.items;for(const X of H)if(X.type.indexOf("image")!==-1){m.preventDefault();const K=X.getAsFile();if(K){const z=new File([K],"pasted_image.jpg",{type:K.type});try{const R=new FileReader;R.onload=J=>a(Q=>{var M;return[...Q,(M=J.target)==null?void 0:M.result]}),R.readAsDataURL(z)}catch(R){console.error("Paste handling failed",R);const J=new FileReader;J.onload=Q=>a(M=>{var D;return[...M,(D=Q.target)==null?void 0:D.result]}),J.readAsDataURL(K)}}}},[]),S=m=>{a(H=>H.filter((X,K)=>K!==m))},F=async()=>{if(!b.trim()&&c.includes("bắt buộc")){h?h("Thông tin không hợp lệ","Vui lòng nhập nội dung yêu cầu.","warning"):alert("Vui lòng nhập nội dung yêu cầu.");return}d(!0),await l(b,p)||d(!1)};if(!t)return null;const x={primary:{iconBg:"bg-blue-100",iconText:"text-accent-primary",btn:"btn-primary",barBg:"bg-accent-primary"},danger:{iconBg:"bg-danger-bg",iconText:"text-danger",btn:"btn-danger",barBg:"bg-danger"},warning:{iconBg:"bg-warning-bg",iconText:"text-warning",btn:"btn-primary",barBg:"bg-warning"}},N=x[v]||x.primary;return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-0 md:p-4",onClick:g,children:e.jsxs("div",{className:"bg-surface-card w-full md:max-w-lg h-full md:h-auto rounded-none md:rounded-2xl shadow-xl animate-fade-in-scale-up flex flex-col",onClick:m=>m.stopPropagation(),style:A,children:[e.jsx("div",{className:`h-1.5 rounded-t-none md:rounded-t-2xl ${N.barBg} flex-shrink-0`}),e.jsxs("header",{className:"flex items-start justify-between p-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:`flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center ${N.iconBg}`,children:e.jsx("i",{className:`fas ${r} text-2xl ${N.iconText}`})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-text-primary",children:f}),e.jsxs("p",{className:"text-sm text-text-secondary mt-1",children:["Đang thực hiện cho: ",e.jsx("strong",{className:"font-mono text-text-primary",children:i})]})]})]}),e.jsx("button",{onClick:g,className:"w-9 h-9 rounded-full flex items-center justify-center text-text-secondary hover:bg-surface-hover -mt-1 -mr-1",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("main",{className:"p-4 md:p-6 space-y-4 overflow-y-auto flex-grow min-h-0",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"modal-reason-input",className:"block text-sm font-medium text-text-primary mb-1.5",children:c}),e.jsx("textarea",{id:"modal-reason-input",value:b,onChange:m=>T(m.target.value),rows:3,className:"w-full bg-surface-ground border border-border-primary rounded-lg p-2 futuristic-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-1.5",children:"Dán ảnh minh họa (Tùy chọn)"}),e.jsx("div",{onPaste:k,contentEditable:!0,suppressContentEditableWarning:!0,className:"p-2 border-2 border-dashed border-border-primary rounded-lg min-h-[60px] text-center text-text-placeholder focus:outline-none focus:border-accent-primary",children:"Click và nhấn Ctrl+V để dán"}),p.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:p.map((m,H)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:m,className:"h-20 w-20 object-cover rounded-md",alt:`Pasted ${H}`}),e.jsx("button",{onClick:()=>S(H),className:"absolute top-0 right-0 w-5 h-5 bg-danger text-white rounded-full text-xs hidden group-hover:flex items-center justify-center",children:"×"})]},H))})]})]}),e.jsxs("footer",{className:"px-3 py-2 flex justify-end items-center gap-1.5 bg-surface-ground rounded-none md:rounded-b-2xl border-t border-border-primary flex-shrink-0",children:[e.jsx("div",{onClick:u?void 0:g,title:"Hủy",className:`cursor-pointer ${u?"opacity-50 cursor-not-allowed":"hover:scale-110 transition-transform"}`,children:e.jsx("lottie-player",{src:Be,background:"transparent",speed:"1",style:{width:"52px",height:"52px"},loop:!0,autoplay:!0})}),e.jsx("div",{onClick:u?void 0:F,title:"Gửi Yêu Cầu",className:`cursor-pointer flex items-center justify-center w-[52px] h-[52px] ${u?"opacity-50 cursor-not-allowed":"hover:scale-110 transition-transform"}`,children:u?e.jsx("i",{className:"fas fa-spinner fa-spin text-2xl text-accent-primary"}):e.jsx("lottie-player",{src:Xe,background:"transparent",speed:"1",style:{width:"52px",height:"52px"},loop:!0,autoplay:!0})})]})]})})},Dt=({isOpen:t,onClose:g,onSubmit:l,order:f,showToast:i})=>{const[c,r]=s.useState(null),[v,h]=s.useState(!1),b=be(),T=async()=>{if(!c){i?i("Chưa chọn tệp","Vui lòng chọn một tệp hóa đơn.","warning"):alert("Vui lòng chọn một tệp hóa đơn.");return}h(!0),await l(c)?(r(null),g()):h(!1)};return t?e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-0 md:p-4",onClick:g,children:e.jsxs("div",{className:"bg-surface-card w-full md:max-w-lg h-full md:h-auto rounded-none md:rounded-2xl shadow-xl animate-fade-in-scale-up flex flex-col",onClick:p=>p.stopPropagation(),style:b,children:[e.jsx("div",{className:"h-1.5 rounded-t-none md:rounded-t-2xl bg-success flex-shrink-0"}),e.jsxs("header",{className:"flex items-start justify-between p-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center bg-success-bg",children:e.jsx("i",{className:"fas fa-upload text-2xl text-success"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-text-primary",children:"Tải Lên Hóa Đơn Đã Xuất"}),e.jsxs("p",{className:"text-sm text-text-secondary mt-1",children:["Tải file hóa đơn (PDF, ảnh...) cho ĐH: ",e.jsx("strong",{className:"font-mono text-text-primary",children:f["Số đơn hàng"]}),"."]})]})]}),e.jsx("button",{onClick:g,className:"w-9 h-9 rounded-full flex items-center justify-center text-text-secondary hover:bg-surface-hover -mt-1 -mr-1",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsx("main",{className:"px-3 pb-3 space-y-2",children:e.jsx(ot,{id:"issued-invoice-upload",label:"File Hóa Đơn",onFileSelect:r,required:!0,accept:".pdf,.jpeg,.png,.jpg",disableCompression:!0})}),e.jsxs("footer",{className:"px-3 py-2 flex justify-end items-center gap-1.5 bg-surface-ground rounded-none md:rounded-b-2xl border-t border-border-primary flex-shrink-0",children:[e.jsx("div",{onClick:v?void 0:g,title:"Hủy",className:`cursor-pointer ${v?"opacity-50 cursor-not-allowed":"hover:scale-110 transition-transform"}`,children:e.jsx("lottie-player",{src:Be,background:"transparent",speed:"1",style:{width:"52px",height:"52px"},loop:!0,autoplay:!0})}),e.jsx("div",{onClick:!v&&c?T:void 0,title:"Tải Lên & Hoàn Tất",className:`cursor-pointer flex items-center justify-center w-[52px] h-[52px] ${v||!c?"opacity-50 cursor-not-allowed":"hover:scale-110 transition-transform"}`,children:v?e.jsx("i",{className:"fas fa-spinner fa-spin text-2xl text-accent-primary"}):e.jsx("lottie-player",{src:Xe,background:"transparent",speed:"1",style:{width:"52px",height:"52px"},loop:!0,autoplay:!0})})]})]})}):null},It=({item:t})=>e.jsxs("div",{className:"relative pl-6 py-2 group",children:[e.jsx("div",{className:"absolute top-2 left-0 w-4 h-4 rounded-full bg-accent-primary/20 border-4 border-surface-card group-hover:bg-accent-primary transition-colors"}),e.jsxs("div",{className:"pl-2",children:[e.jsx("p",{className:"font-bold text-text-primary",children:t["Hành động"]}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:t["Chi tiết"]}),e.jsxs("div",{className:"text-xs text-text-secondary mt-2 flex items-center gap-2",children:[e.jsxs("span",{children:[e.jsx("i",{className:"fas fa-user fa-fw mr-1.5"}),t["Người thực hiện"]]}),e.jsxs("span",{children:[e.jsx("i",{className:"fas fa-clock fa-fw mr-1.5"}),q(t["Thời gian"]).format("HH:mm DD/MM/YYYY")]})]})]}),e.jsx("div",{className:"absolute top-4 left-[7px] h-full border-l-2 border-dashed border-border-primary group-last:border-none"})]}),At=({isOpen:t,onClose:g})=>{const[l,f]=s.useState(""),[i,c]=s.useState(!1),[r,v]=s.useState(null),[h,b]=s.useState(null),T=be(),p=s.useCallback(async()=>{if(!l.trim()){v("Vui lòng nhập số đơn hàng.");return}c(!0),v(null),b(null);try{const u=await dt(l.trim());u.history&&u.history.length>0?b(u.history):v(`Không tìm thấy lịch sử cho đơn hàng "${l.trim()}".`)}catch(u){const d=u instanceof Error?u.message:"Đã xảy ra lỗi không xác định.";v(d)}finally{c(!1)}},[l]),a=()=>{f(""),b(null),v(null),c(!1),g()};return t?e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-0 md:p-4",onClick:g,children:e.jsxs("div",{className:"bg-surface-card w-full md:max-w-3xl h-[100dvh] md:h-auto md:max-h-[85vh] rounded-none md:rounded-2xl shadow-xl animate-fade-in-scale-up flex flex-col",onClick:u=>u.stopPropagation(),style:T,children:[e.jsxs("header",{className:"flex items-center justify-between p-2.5 border-b border-border-primary flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center bg-blue-100",children:e.jsx("i",{className:"fas fa-history text-lg text-accent-primary"})}),e.jsx("h2",{className:"text-xl font-bold text-text-primary",children:"Tra Cứu Lịch Sử Đơn Hàng"})]}),e.jsx("button",{onClick:a,className:"w-9 h-9 rounded-full flex items-center justify-center text-text-secondary hover:bg-surface-hover",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("main",{className:"p-4 md:p-6 overflow-y-auto flex-grow min-h-0 hidden-scrollbar",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{type:"text",value:l,onChange:u=>f(u.target.value),onKeyPress:u=>u.key==="Enter"&&p(),placeholder:"Nhập Số đơn hàng...",className:"flex-grow bg-surface-ground border border-border-primary rounded-lg p-2 focus:ring-accent-primary focus:border-accent-primary transition futuristic-input"}),e.jsx("button",{onClick:p,disabled:i,className:"btn-primary flex-shrink-0",children:i?e.jsx("i",{className:"fas fa-spinner fa-spin"}):e.jsx("i",{className:"fas fa-search"})})]}),e.jsxs("div",{className:"min-h-[20rem]",children:[i&&e.jsx("div",{className:"flex justify-center items-center h-full pt-16",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-3xl text-accent-primary"})}),r&&e.jsx("div",{className:"text-center pt-16 text-danger bg-danger-bg p-4 rounded-lg",children:r}),!i&&!r&&!h&&e.jsxs("div",{className:"text-center pt-16 text-text-secondary",children:[e.jsx("i",{className:"fas fa-history text-4xl mb-4"}),e.jsx("p",{children:"Nhập số đơn hàng để bắt đầu tra cứu."})]}),h&&e.jsx("div",{className:"mt-4 border-t border-border-primary",children:h.map((u,d)=>e.jsx(It,{item:u},d))})]})]}),e.jsx("footer",{className:"p-2 border-t border-border-primary flex justify-end items-center gap-2 bg-surface-ground rounded-b-2xl flex-shrink-0",children:e.jsx("button",{onClick:a,className:"btn-secondary",children:"Đóng"})})]})}):null},Ht=({isOpen:t,onClose:g,onConfirm:l,order:f,suggestedCars:i,showToast:c})=>{const[r,v]=s.useState(i.length>0?i[0].VIN:""),[h,b]=s.useState(!1),T=be();if(!t)return null;const p=(u,d)=>{u.stopPropagation(),navigator.clipboard.writeText(d).then(()=>{c("Đã Sao Chép",`Số VIN ${d} đã được sao chép thành công.`,"success",2e3)}).catch(A=>{console.error("Lỗi sao chép VIN: ",A),c("Sao Chép Thất Bại","Không thể truy cập vào clipboard của bạn.","error",3e3)})},a=async()=>{r&&(b(!0),await l(f["Số đơn hàng"],r),b(!1))};return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-0 md:p-4",onClick:g,children:e.jsxs("div",{className:"bg-surface-card w-full md:max-w-2xl h-full md:h-auto md:max-h-[90vh] rounded-none md:rounded-2xl shadow-xl animate-fade-in-scale-up flex flex-col",onClick:u=>u.stopPropagation(),style:T,children:[e.jsx("div",{className:"h-1.5 rounded-t-2xl bg-warning"}),e.jsxs("header",{className:"flex-shrink-0 flex items-start justify-between p-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center bg-yellow-100",children:e.jsx("i",{className:"fas fa-lightbulb text-2xl text-amber-500"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-text-primary",children:"Gợi Ý & Ghép Xe Thủ Công"}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:"Chọn xe phù hợp từ kho để ghép vào đơn hàng."})]})]}),e.jsx("button",{onClick:g,className:"w-9 h-9 rounded-full flex items-center justify-center text-text-secondary hover:bg-surface-hover -mt-2 -mr-2",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("main",{className:"p-3 space-y-2 overflow-y-auto",children:[e.jsx("div",{className:"p-2 bg-surface-ground rounded-lg border border-border-primary space-y-1",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-text-secondary",children:"Khách hàng:"})," ",e.jsx("strong",{className:"text-text-primary",children:f["Tên khách hàng"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-secondary",children:"Số ĐH:"})," ",e.jsx("strong",{className:"text-text-primary font-mono",children:f["Số đơn hàng"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-secondary",children:"Dòng xe:"})," ",e.jsxs("strong",{className:"text-text-primary",children:[f["Dòng xe"]," - ",f["Phiên bản"]]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-secondary",children:"Màu:"})," ",e.jsxs("strong",{className:"text-text-primary",children:[f["Ngoại thất"]," / ",f["Nội thất"]]})]})]})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-text-primary mb-2",children:["Tìm thấy ",i.length," xe phù hợp trong kho (ưu tiên xe nhập sớm):"]}),i.length>0?e.jsx("div",{className:"max-h-64 overflow-y-auto border border-border-primary rounded-lg hidden-scrollbar",children:e.jsxs("table",{className:"min-w-full text-sm responsive-table",children:[e.jsx("thead",{className:"bg-surface-hover sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-1 px-1.5 text-left w-10",children:"Chọn"}),e.jsx("th",{className:"py-1 px-1.5 text-left",children:"Số VIN"}),e.jsx("th",{className:"py-1 px-1.5 text-left",children:"Nội Thất"}),e.jsx("th",{className:"py-1 px-1.5 text-left",children:"Ngày Nhập Kho"})]})}),e.jsx("tbody",{className:"divide-y divide-border-primary bg-surface-card",children:i.map(u=>e.jsxs("tr",{className:"hover:bg-surface-hover",children:[e.jsx("td",{className:"py-1.5 px-1.5","data-label":"Chọn",children:e.jsx("input",{type:"radio",name:"suggested-vin",value:u.VIN,checked:r===u.VIN,onChange:()=>v(u.VIN),className:"h-4 w-4 text-accent-primary focus:ring-accent-primary border-border-secondary"})}),e.jsx("td",{className:"py-1.5 px-1.5 font-mono text-text-primary","data-label":"Số VIN",children:e.jsxs("div",{className:"group relative inline-flex items-center gap-2 cursor-pointer",title:"Click để sao chép VIN",onClick:d=>p(d,u.VIN),children:[e.jsx("span",{className:"text-accent-primary group-hover:text-accent-primary-hover font-semibold transition-colors",children:u.VIN}),e.jsx("i",{className:"fas fa-copy text-text-placeholder opacity-0 group-hover:opacity-100 transition-opacity"})]})}),e.jsx("td",{className:"py-1.5 px-1.5 text-text-secondary","data-label":"Nội Thất",children:u["Nội thất"]}),e.jsx("td",{className:"py-1.5 px-1.5 text-text-secondary","data-label":"Ngày Nhập Kho",children:u["Thời gian nhập"]?q(u["Thời gian nhập"]).format("DD/MM/YYYY"):"N/A"})]},u.VIN))})]})}):e.jsxs("div",{className:"text-center py-8 text-text-secondary bg-surface-ground rounded-lg",children:[e.jsx("i",{className:"fas fa-box-open fa-2x mb-3"}),e.jsx("p",{children:"Không tìm thấy xe nào phù hợp trong kho."})]})]})]}),e.jsxs("footer",{className:"flex-shrink-0 px-3 py-2 flex justify-end items-center gap-1.5 bg-surface-ground rounded-b-2xl border-t border-border-primary",children:[e.jsx("button",{onClick:g,disabled:h,className:"btn-secondary",children:"Hủy"}),e.jsx("button",{onClick:a,disabled:h||!r||i.length===0,className:"btn-primary",children:h?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"})," Đang ghép..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-link mr-2"})," Xác Nhận Ghép"]})})]})]})})},Vt=({isOpen:t,onClose:g,matches:l,onConfirmMatch:f})=>{const i=be(),c=s.useMemo(()=>[...l].sort((r,v)=>{const h=p=>{if(!p)return Number.MAX_SAFE_INTEGER;const a=q(p);return a.isValid()?a.valueOf():Number.MAX_SAFE_INTEGER},b=h(r.order["Ngày cọc"]),T=h(v.order["Ngày cọc"]);return b-T}),[l]);return t?e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-0 md:p-4",onClick:g,children:e.jsxs("div",{className:"bg-surface-card w-full md:max-w-3xl h-[100dvh] md:h-auto md:max-h-[85vh] rounded-none md:rounded-2xl shadow-xl animate-fade-in-scale-up flex flex-col",onClick:r=>r.stopPropagation(),style:i,children:[e.jsxs("header",{className:"flex-shrink-0 flex items-center justify-between p-3 border-b border-border-primary bg-surface-card/80 backdrop-blur-sm rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-accent-primary/10 flex items-center justify-center text-accent-primary animate-pulse",children:e.jsx("i",{className:"fas fa-magic text-sm"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gradient leading-tight",children:"Gợi Ý Ghép Xe"}),e.jsxs("p",{className:"text-xs text-text-secondary",children:["Tìm thấy ",e.jsx("strong",{className:"text-accent-primary",children:l.length})," đơn hàng phù hợp."]})]})]}),e.jsx("button",{onClick:g,className:"w-8 h-8 rounded-full flex items-center justify-center text-text-secondary hover:bg-surface-hover transition-colors",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsx("main",{className:"flex-grow min-h-0 overflow-y-auto p-2 bg-surface-ground/50 hidden-scrollbar",children:e.jsx("div",{className:"space-y-2",children:c.map(({order:r,cars:v},h)=>{const b=v[0];return e.jsxs("div",{className:"bg-surface-card border border-border-primary rounded-lg p-2.5 shadow-sm hover:shadow-md transition-all flex flex-col sm:flex-row gap-3 items-center animate-fade-in-up",style:{animationDelay:`${h*30}ms`},children:[e.jsxs("div",{className:"flex-1 min-w-0 w-full relative",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("span",{className:"text-[10px] font-mono text-text-secondary bg-surface-ground px-1 rounded border border-border-secondary/50",children:r["Số đơn hàng"]}),r["Ngày cọc"]&&e.jsxs("span",{className:"text-[10px] text-accent-secondary font-medium",children:[e.jsx("i",{className:"fas fa-money-bill-wave mr-1"}),q(r["Ngày cọc"]).format("DD/MM")]})]}),e.jsx("h3",{className:"font-bold text-text-primary text-sm truncate",children:r["Tên khách hàng"]}),e.jsxs("div",{className:"text-xs text-text-secondary mt-0.5 flex flex-wrap gap-x-2",children:[e.jsxs("span",{className:"font-medium text-text-primary",children:[r["Dòng xe"]," ",r["Phiên bản"]]}),e.jsxs("span",{className:"flex items-center gap-1",style:ht(r["Ngoại thất"]),children:["• ",r["Ngoại thất"]]}),e.jsxs("span",{className:"flex items-center gap-1",style:xt(r["Nội thất"]),children:["/ ",r["Nội thất"]]})]})]}),e.jsx("div",{className:"hidden sm:flex flex-col items-center justify-center text-border-secondary",children:e.jsx("i",{className:"fas fa-chevron-right text-sm"})}),e.jsxs("div",{className:"flex-shrink-0 w-full sm:w-auto border-t sm:border-t-0 sm:border-l border-border-primary pt-2 sm:pt-0 sm:pl-3 flex sm:flex-col items-center sm:items-end justify-between sm:justify-center gap-2",children:[e.jsxs("div",{className:"text-left sm:text-right",children:[e.jsx("div",{className:"flex items-center sm:justify-end gap-1.5 mb-0.5",children:e.jsxs("span",{className:"text-[10px] font-bold text-success bg-success-bg px-1.5 rounded-full",children:["Kho: ",v.length]})}),e.jsx("p",{className:"font-mono font-bold text-base text-text-primary tracking-wide",children:b.VIN})]}),e.jsxs("button",{onClick:()=>f(r["Số đơn hàng"],b.VIN),className:"btn-primary !px-3 !py-1.5 !text-xs !h-auto shadow-sm hover:shadow transition-all active:scale-95 flex-shrink-0 whitespace-nowrap",children:[e.jsx("i",{className:"fas fa-link mr-1.5"}),"Ghép Ngay"]})]})]},r["Số đơn hàng"])})})}),e.jsx("footer",{className:"flex-shrink-0 p-2.5 border-t border-border-primary bg-surface-card rounded-b-2xl flex justify-end",children:e.jsx("button",{onClick:g,className:"btn-secondary !py-1.5 !px-4 !text-sm",children:"Đóng"})})]})}):null},Pt=t=>new Promise((g,l)=>{const f=new FileReader;f.readAsDataURL(t),f.onload=()=>g(f.result.split(",")[1]),f.onerror=i=>l(i)}),$t=({isOpen:t,onClose:g,onSuccess:l,showToast:f,hideToast:i})=>{const[c,r]=s.useState([]),[v,h]=s.useState(!1),[b,T]=s.useState(!1),p=s.useRef(null),a=be();s.useEffect(()=>{t&&(r([]),h(!1))},[t]);const u=s.useCallback(()=>{r([]),h(!1),g()},[g]),d=s.useCallback(async m=>{if(!m)return;f("Đang xử lý",`Đang chuẩn bị ${m.length} tệp...`,"loading");const H=Array.from(m),X=await Promise.all(H.map(async z=>z));i();const K=X.map(z=>{const R=/^(N\d{5}-VSO-\d{2}-\d{2}-\d{4})/i,J=z.name.match(R),Q=J?J[1].toUpperCase():null;return{file:z,orderNumber:Q,status:Q?"valid":"invalid_name"}});r(z=>{const R=new Set(z.map(Q=>Q.file.name)),J=K.filter(Q=>!R.has(Q.file.name));return[...z,...J]})},[f,i]),A=m=>{m.preventDefault(),m.stopPropagation(),m.type==="dragenter"||m.type==="dragover"?T(!0):m.type==="dragleave"&&T(!1)},k=m=>{m.preventDefault(),m.stopPropagation(),T(!1),m.dataTransfer.files&&d(m.dataTransfer.files)},S=m=>{m.preventDefault(),m.target.files&&d(m.target.files)},F=m=>{r(H=>H.filter(X=>X.file.name!==m))},x=async()=>{const m=c.filter(H=>H.status==="valid");if(m.length===0){f("Không có tệp hợp lệ","Vui lòng chọn các tệp có tên đúng định dạng.","warning");return}h(!0),f("Đang tải lên...",`Chuẩn bị tải lên ${m.length} hóa đơn.`,"loading");try{const H=await Promise.all(m.map(async({file:K,orderNumber:z})=>({orderNumber:z,base64Data:await Pt(K),mimeType:K.type,fileName:K.name}))),X=await mt(H);i(),f("Hoàn tất!",X.message,X.status==="SUCCESS"?"success":"warning",1e4),X.status==="SUCCESS"&&(l(),u())}catch(H){i();const X=H instanceof Error?H.message:"Lỗi không xác định.";f("Tải lên thất bại",X,"error")}finally{h(!1)}};if(!t)return null;const N=c.filter(m=>m.status==="valid");return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-0 md:p-4",onClick:g,children:e.jsxs("div",{className:"bg-surface-card w-full md:max-w-4xl h-full md:h-auto md:max-h-[90vh] rounded-none md:rounded-2xl shadow-xl animate-fade-in-scale-up flex flex-col",onClick:m=>m.stopPropagation(),style:a,children:[e.jsx("div",{className:"h-1.5 rounded-t-none md:rounded-t-2xl bg-accent-primary flex-shrink-0"}),e.jsxs("header",{className:"flex-shrink-0 p-3 border-b border-border-primary flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-text-primary",children:"Tải Lên Hóa Đơn Hàng Loạt"}),e.jsx("button",{onClick:u,className:"w-9 h-9 rounded-full flex items-center justify-center text-text-secondary hover:bg-surface-hover -mt-1 -mr-1",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("main",{className:"p-4 md:p-6 overflow-y-auto flex-grow min-h-0",children:[e.jsxs("div",{onDragEnter:A,onDragOver:A,onDragLeave:A,onDrop:k,className:"w-full",children:[e.jsx("input",{ref:p,type:"file",multiple:!0,className:"hidden",accept:".pdf,.png,.jpg,.jpeg",onChange:S}),e.jsx("div",{className:`relative w-full h-40 border-2 border-dashed rounded-lg flex items-center justify-center transition-all duration-300 group cursor-pointer overflow-hidden bg-surface-ground ${b?"border-accent-primary bg-surface-accent":"border-border-primary"}`,onClick:()=>{var m;return(m=p.current)==null?void 0:m.click()},children:e.jsxs("div",{className:"text-center text-text-placeholder group-hover:text-text-primary transition-colors",children:[e.jsx("i",{className:"fas fa-file-upload fa-3x mb-2 group-hover:text-accent-primary"}),e.jsx("p",{className:"font-semibold text-text-primary",children:"Kéo & thả hoặc nhấn để tải file"}),e.jsx("p",{className:"text-xs",children:"Định dạng tên file: SỐ_ĐƠN_HÀNG.pdf (VD: N31913-VSO-25-01-0001.pdf)"})]})})]}),c.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("h3",{className:"text-sm font-semibold mb-2",children:["Tệp đã chọn: (",c.length,")"]}),e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-2 border p-1 rounded-lg bg-surface-ground hidden-scrollbar",children:c.map((m,H)=>e.jsxs("div",{className:`flex items-center gap-1.5 p-1 rounded-md border ${m.status==="invalid_name"?"bg-danger-bg border-danger-bg":"bg-white border-border-secondary"}`,children:[e.jsx("i",{className:`fas ${m.status==="invalid_name"?"fa-exclamation-triangle text-danger":"fa-file-alt text-accent-secondary"}`}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:m.file.name}),e.jsx("p",{className:`text-xs ${m.status==="invalid_name"?"text-danger font-semibold":"text-text-secondary"}`,children:m.status==="invalid_name"?"Sai định dạng SĐH":`SĐH: ${m.orderNumber}`})]}),e.jsx("button",{onClick:()=>F(m.file.name),className:"flex-shrink-0 w-6 h-6 rounded-full hover:bg-surface-hover flex items-center justify-center",children:e.jsx("i",{className:"fas fa-times text-xs"})})]},H))})]})]}),e.jsxs("footer",{className:"flex-shrink-0 px-3 py-2 border-t border-border-primary flex justify-end items-center gap-1.5 bg-surface-ground rounded-none md:rounded-b-2xl",children:[e.jsx("div",{onClick:v?void 0:u,title:"Hủy",className:`cursor-pointer ${v?"opacity-50 cursor-not-allowed":"hover:scale-110 transition-transform"}`,children:e.jsx("lottie-player",{src:Be,background:"transparent",speed:"1",style:{width:"52px",height:"52px"},loop:!0,autoplay:!0})}),e.jsx("div",{onClick:!v&&N.length>0?x:void 0,title:"Tải Lên & Hoàn Tất",className:`cursor-pointer flex items-center justify-center w-[52px] h-[52px] ${v||N.length===0?"opacity-50 cursor-not-allowed":"hover:scale-110 transition-transform"}`,children:v?e.jsx("i",{className:"fas fa-spinner fa-spin text-2xl text-accent-primary"}):e.jsx("lottie-player",{src:Xe,background:"transparent",speed:"1",style:{width:"52px",height:"52px"},loop:!0,autoplay:!0})})]})]})})},Lt=({initialState:t,clearInitialState:g})=>{const[l,f]=s.useState("dashboard"),[i,c]=s.useState({keyword:"",tvbh:[],dongXe:[],version:[],exterior:[],trangThai:[]}),[r,v]=s.useState({keyword:"",tvbh:[],dongXe:[],version:[],exterior:[]}),[h,b]=s.useState({keyword:"",tvbh:[],dongXe:[],version:[],exterior:[]}),[T,p]=s.useState({keyword:"",nguoiyc:[],trangthai:[]}),[a,u]=s.useState({keyword:"",tvbh:[],dongXe:[],version:[],ngoaiThat:[]});s.useEffect(()=>{if(t){if(t.targetTab&&f(t.targetTab),t.orderToShow){const k=t.orderToShow;let S=t.targetTab;if(!S){const N=(k["Trạng thái xử lý"]||k["Kết quả"]||"N/A").toLowerCase();N.includes("chưa")?S="pending":N==="đã ghép"?S="paired":S="invoices"}f(S),c({keyword:"",tvbh:[],dongXe:[],version:[],exterior:[],trangThai:[]}),v({keyword:"",tvbh:[],dongXe:[],version:[],exterior:[]}),b({keyword:"",tvbh:[],dongXe:[],version:[],exterior:[]}),p({keyword:"",nguoiyc:[],trangthai:[]}),u({keyword:"",tvbh:[],dongXe:[],version:[],ngoaiThat:[]});const F=k["Số đơn hàng"];S==="invoices"?c(x=>({...x,keyword:F})):S==="pending"?v(x=>({...x,keyword:F})):S==="paired"?b(x=>({...x,keyword:F})):S==="matching"&&u(x=>({...x,keyword:F}))}g()}},[t,g]);const d=s.useCallback(k=>{l==="invoices"?c(S=>({...S,...k})):l==="pending"?v(S=>({...S,...k})):l==="paired"?b(S=>({...S,...k})):l==="vc"?p(S=>({...S,...k})):l==="matching"&&u(S=>({...S,...k}))},[l]),A=s.useCallback(()=>{l==="invoices"?c({keyword:"",tvbh:[],dongXe:[],version:[],exterior:[],trangThai:[]}):l==="pending"?v({keyword:"",tvbh:[],dongXe:[],version:[],exterior:[]}):l==="paired"?b({keyword:"",tvbh:[],dongXe:[],version:[],exterior:[]}):l==="vc"?p({keyword:"",nguoiyc:[],trangthai:[]}):l==="matching"&&u({keyword:"",tvbh:[],dongXe:[],version:[],ngoaiThat:[]})},[l]);return{adminView:l,setAdminView:f,invoiceFilters:i,pendingFilters:r,pairedFilters:h,vcFilters:T,matchingFilters:a,handleFilterChange:d,handleReset:A,setInvoiceFilters:c,setPendingFilters:v,setPairedFilters:b,setVcFilters:p,setMatchingFilters:u}},Et=({showToast:t,hideToast:g,refetchHistory:l,refetchStock:f,refetchXuathoadon:i,refetchAdminData:c,fetchVcData:r,teamData:v,allOrders:h,suggestionsMap:b,selectedRows:T,setSelectedRows:p,setShowMatchingModal:a})=>{const[u,d]=s.useState(null),[A,k]=s.useState(null),[S,F]=s.useState(null),[x,N]=s.useState(null),[m,H]=s.useState(null),[X,K]=s.useState(!1),[z,R]=s.useState(null),[J,Q]=s.useState(!1),[M,D]=s.useState(null),y=(M==null?void 0:M.id)||null,I=s.useCallback(async(V,B,_,O="history")=>{try{return await ut(V,B),d(null),N(null),F(null),p(new Set),k(null),a(!1),g(),t("Thành công!",_||"Thao tác thành công.","success"),(O==="history"||O==="both")&&(l(!0),i(!0)),(O==="stock"||O==="both")&&f(!0),O==="admin"&&c(!0),(V.toLowerCase().includes("vcrequest")||V.toLowerCase().includes("vc"))&&r(!0),!0}catch(C){g();const j=C instanceof Error?C.message:"Đã xảy ra lỗi.";return t("Thao tác thất bại",j,"error"),!1}},[t,g,l,i,f,c,r,p,a]),ee=s.useCallback(V=>{H(null),t("Thành công!",V,"success"),l(!0),i(!0)},[t,l,i]),ne=s.useCallback(async(V,B)=>I("updateRowData",{sheetName:"Xuathoadon",primaryKeyColumn:"SỐ ĐƠN HÀNG",primaryKeyValue:V,"SỐ ĐỘNG CƠ":B.engineNumber,"CHÍNH SÁCH":B.policy,"Hoa hồng ứng":B.commission,"Điểm Vpoint sử dụng":B.vpoint},"Đã cập nhật thông tin hóa đơn.","history"),[I]),Z=s.useCallback(async(V,B={})=>{if(T.size===0)return t("Lỗi","Không có mục nào được chọn.","error"),!1;const _=Array.from(T),O=`Đã thực hiện thao tác cho ${_.length} mục.`,j={approve:"approveSelectedInvoiceRequest",pendingSignature:"markAsPendingSignature",supplement:"requestSupplementForInvoice",cancel:"cancelRequest"}[V]||V,L=await I(j,{...B,orderNumbers:JSON.stringify(_)},O);return L&&(k(null),p(new Set)),L},[T,I,t,p]),ce=async(V,B,_)=>{if(V==="manualMatch"){const O=b.get(B["Số đơn hàng"])||[];F({order:B,cars:O})}else if(V==="pair"&&(_!=null&&_.vin)){D({id:B["Số đơn hàng"],type:V});try{await o(B["Số đơn hàng"],_.vin)}finally{D(null)}}else if(V==="requestInvoice")h.find(C=>C["Số đơn hàng"]===B["Số đơn hàng"])&&t("Chức năng đang phát triển","Yêu cầu xuất hóa đơn từ Admin Panel sẽ sớm được cập nhật.","info");else if(V==="approve"){D({id:B["Số đơn hàng"],type:V});try{await I("approveSelectedInvoiceRequest",{orderNumbers:JSON.stringify([B["Số đơn hàng"]])},"Đã phê duyệt yêu cầu.")}finally{D(null)}}else if(V==="pendingSignature"){D({id:B["Số đơn hàng"],type:V});try{await I("markAsPendingSignature",{orderNumbers:JSON.stringify([B["Số đơn hàng"]])},"Đã chuyển trạng thái.")}finally{D(null)}}else if(V==="uploadInvoice"&&(_!=null&&_.file)){D({id:B["Số đơn hàng"],type:V});try{const O=_.file,j=await(L=>new Promise((P,W)=>{const Y=new FileReader;Y.readAsDataURL(L),Y.onload=()=>P(Y.result.split(",")[1]),Y.onerror=n=>W(n)}))(O);await I("handleBulkUploadIssuedInvoices",{filesData:JSON.stringify([{orderNumber:B["Số đơn hàng"],base64Data:j,mimeType:O.type,fileName:O.name}])},"Đã tải lên hóa đơn thành công.")}catch{t("Lỗi","Không thể đọc file.","error")}finally{D(null)}}else if(V==="edit")H(B);else if(V==="approveVc"){D({id:B["Số đơn hàng"],type:V});try{await I("approveVcRequest",{orderNumber:B["Số đơn hàng"]},"Đã phê duyệt yêu cầu VC.")}finally{D(null)}}else d({type:V,order:B})},oe=async V=>{const B=C=>{if(!C||!C.includes("drive.google.com"))return C;const j=C.match(/id=([a-zA-Z0-9_-]{25,})/)||C.match(/\/d\/([a-zA-Z0-9_-]{25,})/);return j&&j[1]?`https://drive.google.com/uc?export=download&id=${j[1]}`:C};let _={};try{V.FileUrls?_=JSON.parse(V.FileUrls):V["URL hình ảnh"]&&(_={unc:V["URL hình ảnh"]})}catch{g(),t("Lỗi","Không thể đọc danh sách tệp.","error");return}const O=Object.entries(_);if(O.length===0){g(),t("Không có tệp","Không tìm thấy tệp nào để tải xuống.","info");return}for(let C=0;C<O.length;C++){const[,j]=O[C],L=B(j);if(L){const P=document.createElement("iframe");P.style.display="none",P.src=L,document.body.appendChild(P),setTimeout(()=>{P.parentNode&&P.parentNode.removeChild(P)},1e4),C<O.length-1&&await new Promise(W=>setTimeout(W,1e3))}}g(),t("Hoàn tất",`Đã bắt đầu tải xuống ${O.length} tệp.`,"success")},o=async(V,B)=>{await I("manualMatchCar",{orderNumber:V,vin:B},`Đã ghép thành công ĐH ${V}.`,"both")},$=async V=>{await I("updateTeams",{teams:JSON.stringify(V)},"Cập nhật phòng ban thành công.","admin"),R(null),Q(!1)},G=async V=>{if(window.confirm(`Bạn có chắc chắn muốn giải tán phòng của "${V}"? Các thành viên sẽ không bị xóa khỏi hệ thống.`)){const _={...v};delete _[V],await $(_)}},re=s.useCallback(()=>N(null),[]),me=s.useCallback(()=>k(null),[]),U=s.useCallback(()=>I("archiveInvoicedOrdersMonthly",{},"Đã lưu trữ hóa đơn thành công.","history"),[I]),le=s.useCallback(V=>I("findAndAddCarByVin",{vin:V.vin},"Thêm xe thành công.","stock"),[I]),ue=s.useCallback(V=>I("deleteCarFromStockLogic",V,"Đã xóa xe thành công.","stock"),[I]),he=s.useCallback(V=>I("restoreCarToStockLogic",V,"Đã phục hồi xe thành công.","stock"),[I]),ye=s.useCallback(V=>I("addUser",V,`Đã tạo tài khoản cho ${V.fullName} và gửi email.`,"admin"),[I]),de=s.useCallback(V=>I("deleteOrderLogic",V,"Đã xóa đơn hàng thành công.","history"),[I]),Ne=s.useCallback(V=>I("revertOrderStatus",V,"Đã hoàn tác trạng thái đơn hàng.","history"),[I]),ae=s.useCallback(()=>Z("approve"),[Z]),xe=s.useCallback(()=>Z("pendingSignature"),[Z]),ve=s.useCallback(V=>Z("cancel",{reason:V.reason}),[Z]),pe=s.useCallback((V,B)=>Z("supplement",{reason:V,pastedImagesBase64:JSON.stringify(B)}),[Z]);return{invoiceModalState:u,setInvoiceModalState:d,bulkActionModal:A,setBulkActionModal:k,suggestionModalState:S,setSuggestionModalState:F,adminModal:x,setAdminModal:N,editingOrder:m,setEditingOrder:H,isBulkUploadModalOpen:X,setIsBulkUploadModalOpen:K,editingTeam:z,setEditingTeam:R,isAddingNewTeam:J,setIsAddingNewTeam:Q,handleAdminSubmit:I,handleEditSuccess:ee,handleEditInvoiceDetails:ne,handleBulkActionSubmit:Z,handleAction:ce,handleDownloadAllVcImages:oe,handleConfirmSuggestion:o,handleSaveTeam:$,handleDeleteTeam:G,handleCloseAdminModal:re,handleCloseBulkActionModal:me,handleArchiveSubmit:U,handleAddCarSubmit:le,handleDeleteCarSubmit:ue,handleRestoreCarSubmit:he,handleAddUserSubmit:ye,handleDeleteOrderSubmit:de,handleRevertOrderSubmit:Ne,handleBulkApproveSubmit:ae,handleBulkPendingSignatureSubmit:xe,handleBulkCancelSubmit:ve,handleBulkSupplementSubmit:pe,processingId:y,processingActionType:(M==null?void 0:M.type)||null}},Kt=({allOrders:t,xuathoadonData:g,stockData:l,invoiceFilters:f,pendingFilters:i,pairedFilters:c,vcFilters:r,isSidebarCollapsed:v})=>{const h=v?14:12,[b,T]=s.useState({key:"Thời gian nhập",direction:"desc"}),[p,a]=s.useState({key:"Thời gian nhập",direction:"desc"}),[u,d]=s.useState({key:"Thời gian ghép",direction:"desc"}),[A,k]=s.useState({key:"Thời gian YC",direction:"desc"}),[S,F]=s.useState(1),[x,N]=s.useState([]),[m,H]=s.useState(!0),[X,K]=s.useState(null),[z,R]=s.useState(new Set),J=s.useCallback(async(U=!1)=>{U||H(!0),K(null);try{const le=await gt();N(le.data||[])}catch(le){const ue=le instanceof Error?le.message:"Lỗi không xác định khi tải yêu cầu VC.";K(ue)}finally{U||H(!1)}},[]);s.useEffect(()=>{J()},[J]),s.useEffect(()=>{Oe();const U=setInterval(()=>{Oe()},12e4);return()=>clearInterval(U)},[]);const{processedInvoices:Q,invoiceRequests:M,pendingData:D,pairedData:y,vcRequests:I,suggestionsMap:ee,filterOptions:ne,ordersWithMatches:Z}=s.useMemo(()=>{const U=new Map;t.forEach(C=>{C["Số đơn hàng"]&&U.set(C["Số đơn hàng"],C)});const le=g.filter(C=>C&&C["SỐ ĐƠN HÀNG"]).map(C=>{const j=C["SỐ ĐƠN HÀNG"],L=U.get(j),P={"Số đơn hàng":j,"Tên khách hàng":C["TÊN KHÁCH HÀNG"],"Dòng xe":C["DÒNG XE"],"Phiên bản":C["PHIÊN BẢN"],"Ngoại thất":C["NGOẠI THẤT"],"Nội thất":C["NỘI THẤT"],"Tên tư vấn bán hàng":C["TƯ VẤN BÁN HÀNG"],VIN:C["SỐ VIN"],"Số động cơ":C["SỐ ĐỘNG CƠ"],"Thời gian nhập":C["NGÀY YÊU CẦU XHĐ"],"Ngày xuất hóa đơn":C["NGÀY XUẤT HÓA ĐƠN"],"Hoa hồng ứng":C["Hoa hồng ứng"],"Điểm Vpoint sử dụng":C["Điểm Vpoint sử dụng"],"CHÍNH SÁCH":C["CHÍNH SÁCH"],"Ngày cọc":C["NGÀY CỌC"],"BÁO BÁN":C["BÁO BÁN"],"KẾT QUẢ GỬI MAIL":C["KẾT QUẢ GỬI MAIL"],LinkHopDong:C["URL Hợp Đồng"],LinkDeNghiXHD:C["URL Đề Nghị XHĐ"],LinkHoaDonDaXuat:C["URL Hóa Đơn Đã Xuất"],"Kết quả":"N/A"};return L?(P["Kết quả"]=L["Trạng thái VC"]||L["Kết quả"]||"Không rõ",Object.keys(L).forEach(W=>{P[W]||(P[W]=L[W])})):P["Kết quả"]="Đã xuất hóa đơn",P["Trạng thái xử lý"]=P["Kết quả"],P}),ue=x.map(C=>{const j=U.get(C["Số đơn hàng"]);return{...C,VIN:j==null?void 0:j.VIN,"Dòng xe":j==null?void 0:j["Dòng xe"],"Phiên bản":j==null?void 0:j["Phiên bản"],"Ngoại thất":j==null?void 0:j["Ngoại thất"],"Nội thất":j==null?void 0:j["Nội thất"]}}),he=t.filter(C=>String(C["Kết quả"]||"").toLowerCase().includes("chưa")),ye=t.filter(C=>String(C["Kết quả"]||"").toLowerCase()==="đã ghép"),de=new Map;if(l&&he.length>0){const C=l.filter(L=>{var P;return((P=L["Trạng thái"])==null?void 0:P.toLowerCase())==="chưa ghép"}),j=L=>(L||"").toLowerCase().trim().normalize("NFC");C.forEach(L=>{he.forEach(P=>{if(j(L["Dòng xe"])===j(P["Dòng xe"])&&j(L["Phiên bản"])===j(P["Phiên bản"])&&j(L["Ngoại thất"])===j(P["Ngoại thất"])&&j(P["Nội thất"]).includes(j(L["Nội thất"]))){const W=de.get(P["Số đơn hàng"])||[];de.set(P["Số đơn hàng"],[...W,L])}})}),de.forEach(L=>L.sort((P,W)=>new Date(P["Thời gian nhập"]||0).getTime()-new Date(W["Thời gian nhập"]||0).getTime()))}const Ne=he.filter(C=>de.has(C["Số đơn hàng"])).map(C=>({order:C,cars:de.get(C["Số đơn hàng"])||[]})),ae=(C,j,L)=>{var W;const P=((W=j.keyword)==null?void 0:W.toLowerCase())??"";return C.filter(Y=>{var Te,Me,De;const n=L==="vc"?j.nguoiyc.length===0||j.nguoiyc.includes(Y["Người YC"]):j.tvbh.length===0||j.tvbh.includes(Y["Tên tư vấn bán hàng"]),je=L!=="vc"?j.dongXe.length===0||j.dongXe.includes(Y["Dòng xe"]):!0,we=L!=="vc"?((Te=j.version)==null?void 0:Te.length)===0||!j.version||j.version.includes(Y["Phiên bản"]):!0;let Se=!0;L==="matching"?Se=((Me=j.ngoaiThat)==null?void 0:Me.length)===0||!j.ngoaiThat||j.ngoaiThat.includes(Y["Ngoại thất"]):L!=="vc"&&(Se=((De=j.exterior)==null?void 0:De.length)===0||!j.exterior||j.exterior.includes(Y["Ngoại thất"]));let fe=!0;L==="invoices"&&j.trangThai?fe=j.trangThai.length===0||j.trangThai.includes(Y["Trạng thái xử lý"]):L==="vc"&&j.trangthai&&(fe=j.trangthai.length===0||j.trangthai.includes(Y["Trạng thái xử lý"]));const ke=Y["Mã KH DMS"],Pe=!P||te(Y["Số đơn hàng"],P)||te(Y["Tên khách hàng"],P)||te(Y.VIN,P)||te(ke,P)||te(Y["Dòng xe"],P)||te(Y["Phiên bản"],P)||te(Y["Ngoại thất"],P)||te(Y["Nội thất"],P)||te(Y["Tên tư vấn bán hàng"],P)||te(Y["CHÍNH SÁCH"],P)||te(Y["Số động cơ"],P);return n&&je&&we&&Se&&fe&&Pe})},xe=ae(le,f,"invoices"),ve=ae(he,i,"pending"),pe=ae(ye,c,"paired"),V=ae(ue,r,"vc"),B=(C,j)=>{let L=[...C];return j&&L.sort((P,W)=>{const Y=P[j.key],n=W[j.key];if(["Thời gian nhập","Thời gian ghép","Thời gian YC"].includes(String(j.key))){const je=Y?new Date(Y).getTime():0,we=n?new Date(n).getTime():0;return je<we?j.direction==="asc"?-1:1:je>we?j.direction==="asc"?1:-1:0}return Y?n?String(Y)<String(n)?j.direction==="asc"?-1:1:String(Y)>String(n)?j.direction==="asc"?1:-1:0:-1:1}),L},_=B(ve,p);_.sort((C,j)=>{const L=de.has(C["Số đơn hàng"]),P=de.has(j["Số đơn hàng"]);return L&&!P?-1:!L&&P?1:0});const O=(C,j)=>{const L={};j.forEach(W=>L[W]=new Set),C.forEach(W=>{j.forEach(Y=>{const n=Y==="Kết quả"||Y==="Trạng thái xử lý"?W["Trạng thái xử lý"]:W[Y];n&&L[Y].add(n)})});const P={};return j.forEach(W=>P[W]=Array.from(L[W]).sort()),P};return{processedInvoices:le,invoiceRequests:B(xe,b),pendingData:_,pairedData:B(pe,u),vcRequests:B(V,A),suggestionsMap:de,ordersWithMatches:Ne,filterOptions:{invoices:O(le,["Tên tư vấn bán hàng","Dòng xe","Phiên bản","Ngoại thất","Kết quả"]),pending:O(he,["Tên tư vấn bán hàng","Dòng xe","Phiên bản","Ngoại thất"]),paired:O(ye,["Tên tư vấn bán hàng","Dòng xe","Phiên bản","Ngoại thất"]),vc:O(ue,["Người YC","Trạng thái xử lý"])}}},[t,g,l,b,p,u,A,f,i,c,r,x]),ce=s.useMemo(()=>M.slice((S-1)*h,S*h),[M,S,h]),oe=Math.ceil(M.length/h);s.useEffect(()=>{S>oe&&oe>0&&F(oe)},[S,oe]);const o=s.useMemo(()=>M.map(U=>U["Số đơn hàng"]),[M]),$=s.useMemo(()=>D.map(U=>U["Số đơn hàng"]),[D]),G=s.useMemo(()=>y.map(U=>U["Số đơn hàng"]),[y]),re=s.useMemo(()=>I.map(U=>U["Số đơn hàng"]),[I]);return{sortConfig:b,setSortConfig:T,pendingSortConfig:p,setPendingSortConfig:a,pairedSortConfig:u,setPairedSortConfig:d,vcSortConfig:A,setVcSortConfig:k,currentPage:S,setCurrentPage:F,vcRequestsData:x,isLoadingVc:m,errorVc:X,selectedRows:z,setSelectedRows:R,handleToggleAll:U=>{z.size>=U.length?R(new Set):R(new Set(U))},fetchVcData:J,processedInvoices:Q,invoiceRequests:M,pendingData:D,pairedData:y,vcRequests:I,suggestionsMap:ee,filterOptions:ne,ordersWithMatches:Z,paginatedInvoices:ce,totalInvoicePages:oe,allInvoiceOrderNumbers:o,allPendingOrderNumbers:$,allPairedOrderNumbers:G,allVcOrderNumbers:re}},Bt=({adminView:t,invoiceFilters:g,pendingFilters:l,pairedFilters:f,vcFilters:i,matchingFilters:c,handleFilterChange:r,handleReset:v,filterOptions:h,invoiceRequests:b,pendingData:T,pairedData:p,vcRequests:a,refetchXuathoadon:u,refetchHistory:d,fetchVcData:A,isLoadingXuathoadon:k,isLoadingHistory:S,isLoadingVc:F})=>{if(["dashboard","phongkd","activityLog","activeUsers"].includes(t))return null;let x,N=[],m="Tìm kiếm...",H=0,X=()=>{},K=!1;switch(t){case"invoices":x=g,N=[{id:"admin-filter-tvbh",key:"tvbh",label:"TVBH",options:h.invoices["Tên tư vấn bán hàng"],icon:"fa-user-tie"},{id:"admin-filter-dongxe",key:"dongXe",label:"Dòng Xe",options:h.invoices["Dòng xe"],icon:"fa-car"},{id:"admin-filter-version",key:"version",label:"Phiên Bản",options:h.invoices["Phiên bản"],icon:"fa-cogs"},{id:"admin-filter-exterior",key:"exterior",label:"Ngoại Thất",options:h.invoices["Ngoại thất"],icon:"fa-palette"},{id:"admin-filter-status",key:"trangThai",label:"Trạng Thái",options:h.invoices["Kết quả"],icon:"fa-tag"}],m="Tìm SĐH, Tên KH, VIN...",H=b.length,X=()=>u(),K=k;break;case"pending":x=l,N=[{id:"admin-filter-tvbh-pending",key:"tvbh",label:"TVBH",options:h.pending["Tên tư vấn bán hàng"],icon:"fa-user-tie"},{id:"admin-filter-dongxe-pending",key:"dongXe",label:"Dòng Xe",options:h.pending["Dòng xe"],icon:"fa-car"},{id:"admin-filter-version-pending",key:"version",label:"Phiên Bản",options:h.pending["Phiên bản"],icon:"fa-cogs"},{id:"admin-filter-exterior-pending",key:"exterior",label:"Ngoại Thất",options:h.pending["Ngoại thất"],icon:"fa-palette"}],m="Tìm SĐH, Tên KH...",H=T.length,X=()=>d(),K=S;break;case"paired":x=f,N=[{id:"admin-filter-tvbh-paired",key:"tvbh",label:"TVBH",options:h.paired["Tên tư vấn bán hàng"],icon:"fa-user-tie"},{id:"admin-filter-dongxe-paired",key:"dongXe",label:"Dòng Xe",options:h.paired["Dòng xe"],icon:"fa-car"},{id:"admin-filter-version-paired",key:"version",label:"Phiên Bản",options:h.paired["Phiên bản"],icon:"fa-cogs"},{id:"admin-filter-exterior-paired",key:"exterior",label:"Ngoại Thất",options:h.paired["Ngoại thất"],icon:"fa-palette"}],m="Tìm SĐH, Tên KH, VIN...",H=p.length,X=()=>d(),K=S;break;case"matching":x=c,N=[{id:"admin-filter-tvbh-matching",key:"tvbh",label:"TVBH",options:h.pending["Tên tư vấn bán hàng"],icon:"fa-user-tie"},{id:"admin-filter-dongxe-matching",key:"dongXe",label:"Dòng Xe",options:h.pending["Dòng xe"],icon:"fa-car"},{id:"admin-filter-version-matching",key:"version",label:"Phiên Bản",options:h.pending["Phiên bản"],icon:"fa-cogs"},{id:"admin-filter-ngoaithat-matching",key:"ngoaiThat",label:"Ngoại Thất",options:h.pending["Ngoại thất"],icon:"fa-palette"}],m="Tìm SĐH, Tên KH...",H=T.length,X=()=>d(),K=S;break;case"vc":x=i,N=[{id:"admin-filter-nguoiyc-vc",key:"nguoiyc",label:"Người YC",options:h.vc["Người YC"],icon:"fa-user-tie"},{id:"admin-filter-trangthai-vc",key:"trangthai",label:"Trạng Thái",options:h.vc["Trạng thái xử lý"],icon:"fa-tag"}],m="Tìm SĐH, Tên KH, VIN, Mã DMS...",H=a.length,X=()=>A(),K=F;break;default:return null}return e.jsx(pt,{filters:x,onFilterChange:r,onReset:v,dropdowns:N,searchPlaceholder:m,totalCount:H,onRefresh:X,isLoading:K,hideSearch:!1,size:"compact",dropdownClassName:"w-16 md:w-20 lg:w-24",searchable:!1})},Xt=({teamData:t,onEditTeam:g,onAddNewTeam:l,onDeleteTeam:f})=>{const[i,c]=s.useState("all"),[r,v]=s.useState(null),[h,b]=s.useState("folders"),T=s.useMemo(()=>Object.entries(t).sort(([k],[S])=>k.localeCompare(S)),[t]),p=s.useMemo(()=>T.filter(([k,S])=>i==="empty"?S.length===0:!0),[T,i]);s.useEffect(()=>{window.innerWidth>=768&&!r&&p.length>0&&v(p[0][0])},[p,r]);const a=s.useMemo(()=>r?t[r]:null,[t,r]),u=[{id:"all",label:"Tất Cả",icon:"fa-users",count:T.length},{id:"empty",label:"Trống",icon:"fa-user-slash",count:T.filter(([k,S])=>S.length===0).length}],d=k=>{c(k),b("list")},A=k=>{v(k),b("detail")};return e.jsxs("div",{className:"flex h-full bg-surface-card rounded-xl shadow-md border border-border-primary overflow-hidden animate-fade-in relative",children:[e.jsxs("div",{className:`w-full md:w-64 flex-shrink-0 border-r border-border-primary bg-surface-ground flex flex-col absolute md:relative inset-0 z-10 md:z-auto transition-transform duration-300 ${h==="folders"?"translate-x-0":"-translate-x-full md:translate-x-0"}`,children:[e.jsx("div",{className:"p-4 border-b border-border-primary",children:e.jsxs("button",{onClick:l,className:"w-full btn-primary flex items-center justify-center gap-2",children:[e.jsx("i",{className:"fas fa-plus"}),e.jsx("span",{children:"Tạo Phòng Mới"})]})}),e.jsx("nav",{className:"flex-1 p-2 space-y-1 overflow-y-auto",children:u.map(k=>e.jsxs("button",{onClick:()=>d(k.id),className:`w-full flex items-center justify-between px-3 py-2 rounded-lg text-xs font-medium transition-colors ${i===k.id?"bg-accent-primary/10 text-accent-primary":"text-text-secondary hover:bg-surface-hover hover:text-text-primary"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("i",{className:`fas ${k.icon} w-5 text-center`}),e.jsx("span",{children:k.label})]}),k.count>0&&e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${i===k.id?"bg-accent-primary text-white":"bg-surface-hover text-text-secondary"}`,children:k.count})]},k.id))})]}),e.jsxs("div",{className:`w-full md:w-80 flex-shrink-0 border-r border-border-primary flex flex-col bg-white absolute md:relative inset-0 z-20 md:z-auto transition-transform duration-300 ${h==="list"?"translate-x-0":h==="detail"?"-translate-x-full md:translate-x-0":"translate-x-full md:translate-x-0"}`,children:[e.jsxs("div",{className:"p-3 border-b border-border-secondary bg-surface-ground flex items-center gap-2",children:[e.jsx("button",{onClick:()=>b("folders"),className:"md:hidden w-8 h-8 flex items-center justify-center rounded-full hover:bg-surface-hover text-text-secondary",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsx("h3",{className:"text-xs font-bold text-text-secondary uppercase tracking-wider",children:"Danh Sách Phòng"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:p.length===0?e.jsx("div",{className:"p-8 text-center text-text-placeholder text-sm",children:"Không tìm thấy phòng nào."}):e.jsx("div",{className:"divide-y divide-border-secondary",children:p.map(([k,S])=>e.jsxs("div",{onClick:()=>A(k),className:`p-3 cursor-pointer hover:bg-surface-hover transition-colors ${r===k?"bg-accent-primary/5 border-l-4 border-accent-primary":"border-l-4 border-transparent"}`,children:[e.jsx("div",{className:"font-semibold text-text-primary text-sm truncate mb-1",children:k}),e.jsxs("div",{className:"text-xs text-text-secondary flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-user-friends text-[10px]"}),e.jsxs("span",{children:[S.length," thành viên"]})]})]},k))})})]}),e.jsx("div",{className:`flex-1 flex flex-col bg-surface-ground min-w-0 absolute md:relative inset-0 z-30 md:z-auto transition-transform duration-300 ${h==="detail"?"translate-x-0":"translate-x-full md:translate-x-0"}`,children:r&&a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-4 md:px-6 py-3 md:py-4 bg-white border-b border-border-primary flex justify-between items-center shadow-sm z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[e.jsx("button",{onClick:()=>b("list"),className:"md:hidden w-8 h-8 flex items-center justify-center rounded-full hover:bg-surface-hover text-text-secondary -ml-2",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsx("div",{className:"w-10 h-10 md:w-12 md:h-12 rounded-full bg-accent-primary/10 flex items-center justify-center text-accent-primary font-bold text-lg md:text-xl",children:r.charAt(0)}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg md:text-xl font-bold text-text-primary leading-tight truncate max-w-[150px] md:max-w-none",children:r}),e.jsx("div",{className:"text-xs md:text-sm text-text-secondary mt-0.5 md:mt-1",children:"Trưởng Phòng KD"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>g(r,a),className:"btn btn-secondary px-2 py-1.5 md:px-3 text-xs md:text-sm flex items-center gap-2 rounded-lg",children:[e.jsx("i",{className:"fas fa-pen"}),e.jsx("span",{className:"hidden md:inline",children:"Chỉnh Sửa"})]}),e.jsxs("button",{onClick:()=>f(r),className:"btn btn-danger px-2 py-1.5 md:px-3 text-xs md:text-sm flex items-center gap-2 rounded-lg",children:[e.jsx("i",{className:"fas fa-trash"}),e.jsx("span",{className:"hidden md:inline",children:"Xóa"})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col bg-surface-ground overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-white border-b border-border-primary flex justify-between items-center flex-shrink-0 shadow-sm z-10",children:[e.jsx("h3",{className:"font-bold text-text-primary text-xs md:text-sm uppercase tracking-wider",children:"Danh Sách Thành Viên"}),e.jsxs("span",{className:"text-xs font-medium px-2 py-0.5 bg-surface-ground border border-border-secondary text-text-secondary rounded-full shadow-sm",children:["Tổng: ",e.jsx("span",{className:"text-accent-primary font-bold ml-1",children:a.length})]})]}),e.jsx("div",{className:"flex-1 p-2 md:p-4 overflow-hidden flex flex-col",children:a.length>0?e.jsx("div",{className:"bg-white rounded-lg border border-border-primary shadow-sm flex-1 flex flex-col overflow-hidden",children:e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:e.jsxs("table",{className:"w-full text-left border-collapse relative",children:[e.jsx("thead",{className:"sticky top-0 z-10 shadow-sm bg-surface-ground",children:e.jsxs("tr",{className:"text-xs text-text-secondary border-b border-border-secondary uppercase tracking-wider",children:[e.jsx("th",{className:"font-semibold py-2 px-3 w-10 md:w-12 text-center bg-surface-ground",children:"#"}),e.jsx("th",{className:"font-semibold py-2 px-3 bg-surface-ground",children:"Họ và tên"}),e.jsx("th",{className:"font-semibold py-2 px-3 w-20 md:w-24 text-center bg-surface-ground",children:"Chức vụ"})]})}),e.jsx("tbody",{className:"text-sm divide-y divide-border-secondary",children:a.map((k,S)=>e.jsxs("tr",{className:"hover:bg-surface-hover transition-colors group",children:[e.jsx("td",{className:"py-2 px-3 text-text-secondary text-center text-xs",children:S+1}),e.jsx("td",{className:"py-2 px-3 font-medium text-text-primary",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-accent-primary/10 text-accent-primary flex items-center justify-center text-[10px] font-bold group-hover:bg-accent-primary group-hover:text-white transition-colors",children:k.charAt(0).toUpperCase()}),e.jsx("span",{className:"text-xs md:text-sm",children:k})]})}),e.jsx("td",{className:"py-2 px-3 text-center",children:e.jsx("span",{className:"px-1.5 py-0.5 rounded bg-gray-100 text-text-secondary text-[10px] font-medium border border-gray-200",children:"TVBH"})})]},S))})]})})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-placeholder bg-white rounded-lg border border-border-dashed border-border-secondary",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-surface-ground flex items-center justify-center mb-3",children:e.jsx("i",{className:"fas fa-user-plus text-2xl opacity-20"})}),e.jsx("p",{className:"text-sm",children:"Chưa có thành viên nào."}),e.jsx("button",{onClick:()=>g(r,a),className:"mt-4 text-sm text-accent-primary hover:underline",children:"Thêm thành viên ngay"})]})})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-text-placeholder",children:[e.jsx("i",{className:"fas fa-users text-6xl mb-4 opacity-20"}),e.jsx("p",{children:"Chọn một phòng để xem chi tiết"})]})})]})},Yt=({isOpen:t,onClose:g,onSave:l,teamData:f,allUsers:i,editingTeam:c})=>{const[r,v]=s.useState(c?c.leader:""),[h,b]=s.useState(c?c.members:[]),[T,p]=s.useState(!1),a=be();s.useEffect(()=>{t&&(v(c?c.leader:""),b(c?c.members:[]))},[t,c]);const u=!c,{potentialLeaders:d,availableMembers:A}=s.useMemo(()=>{const S=new Set(Object.keys(f)),F=new Set(Object.values(f).flat()),x=i.filter(m=>m.role==="Trưởng Phòng Kinh Doanh"&&(!S.has(m.name)||m.name===(c==null?void 0:c.leader))),N=i.filter(m=>m.role==="Tư vấn bán hàng"&&(!F.has(m.name)||(c==null?void 0:c.members.includes(m.name))));return{potentialLeaders:x.map(m=>m.name),availableMembers:N.map(m=>m.name)}},[i,f,c]),k=async()=>{if(!r){alert("Vui lòng chọn trưởng phòng.");return}p(!0);const S={...f};u||c.leader!==r&&delete S[c.leader],S[r]=h,await l(S),p(!1)};return t?e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-2",onClick:g,children:e.jsxs("div",{className:"bg-surface-card w-full max-w-2xl rounded-2xl shadow-xl animate-fade-in-scale-up flex flex-col max-h-[90vh]",onClick:S=>S.stopPropagation(),style:a,children:[e.jsx("header",{className:"p-2.5 border-b",children:e.jsx("h2",{className:"text-xl font-bold text-text-primary",children:u?"Tạo Phòng Mới":`Chỉnh Sửa Phòng: ${c.leader}`})}),e.jsxs("main",{className:"p-3 space-y-2 overflow-y-auto hidden-scrollbar",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Trưởng Phòng"}),u?e.jsxs("select",{value:r,onChange:S=>v(S.target.value),className:"w-full bg-surface-ground border border-border-primary rounded-lg p-2.5 futuristic-input",children:[e.jsx("option",{value:"",disabled:!0,children:"Chọn một trưởng phòng"}),d.map(S=>e.jsx("option",{value:S,children:S},S))]}):e.jsx("input",{type:"text",value:r,readOnly:!0,className:"w-full bg-surface-input border border-border-primary rounded-lg p-2.5 futuristic-input cursor-not-allowed"})]}),e.jsx("div",{children:e.jsx(ft,{id:"team-member-select",label:"Thành viên",options:A,selectedOptions:h,onChange:b,icon:"fa-users",displayMode:"selection"})})]}),e.jsxs("footer",{className:"p-2 border-t flex justify-end gap-2 bg-surface-ground rounded-b-2xl",children:[e.jsx("button",{onClick:g,disabled:T,className:"btn-secondary",children:"Hủy"}),e.jsx("button",{onClick:k,disabled:T||!r,className:"btn-primary",children:T?"Đang lưu...":"Lưu Thay Đổi"})]})]})}):null},zt={dashboard:[],invoices:[{type:"approve",label:"Phê duyệt",icon:"fa-check-double"},{type:"supplement",label:"Y/C Bổ sung",icon:"fa-exclamation-triangle"},{type:"pendingSignature",label:'Chuyển sang "Chờ ký HĐ"',icon:"fa-signature"},{type:"cancel",label:"Hủy Yêu cầu",icon:"fa-trash-alt",isDanger:!0}],pending:[{type:"cancel",label:"Hủy Yêu cầu (Xóa)",icon:"fa-trash-alt",isDanger:!0}],paired:[],matching:[],vc:[],phongkd:[]},Ge=({view:t,selectedRows:g,setSelectedRows:l,setBulkActionModal:f})=>{const[i,c]=s.useState(!1),r=s.useRef(null);s.useEffect(()=>{const h=b=>{r.current&&!r.current.contains(b.target)&&c(!1)};return document.addEventListener("mousedown",h),()=>document.removeEventListener("mousedown",h)},[]);const v=zt[t];return v.length===0?null:e.jsxs("div",{className:"relative z-10 p-1.5 border-b border-border-primary flex items-center justify-between bg-surface-accent animate-fade-in-down",children:[e.jsxs("span",{className:"text-sm font-semibold text-text-primary",children:["Đã chọn: ",e.jsx("span",{className:"font-bold text-accent-primary",children:g.size})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("button",{onClick:()=>l(new Set),className:"btn-secondary !text-xs !py-0.5 !px-2",children:[e.jsx("i",{className:"fas fa-times mr-1"})," Bỏ chọn"]}),e.jsxs("div",{className:"relative",ref:r,children:[e.jsxs("button",{onClick:()=>c(h=>!h),className:"btn-primary !text-xs !py-0.5 !px-2.5 flex items-center",children:["Thao tác hàng loạt ",e.jsx("i",{className:`fas fa-chevron-down ml-2 text-xs transition-transform ${i?"rotate-180":""}`})]}),i&&e.jsx("div",{className:"absolute right-0 mt-1 w-52 bg-surface-card border rounded-lg shadow-lg z-20 p-0.5",children:v.map(h=>e.jsxs("button",{onClick:()=>{f({type:h.type}),c(!1)},className:`flex items-center gap-2 w-full text-left px-2 py-1.5 text-sm font-medium rounded-md ${h.isDanger?"text-danger hover:bg-danger-bg":"text-text-primary hover:bg-surface-hover"}`,children:[e.jsx("i",{className:`fas ${h.icon} fa-fw w-5 text-center`}),e.jsx("span",{children:h.label})]},h.type))})]})]})]})},Rt=({isOpen:t,onClose:g,showToast:l})=>{const[f,i]=s.useState([]),[c,r]=s.useState(!1),v=async()=>{r(!0);try{const b=await bt();b.status==="SUCCESS"&&Array.isArray(b.data)?i(b.data):i([])}catch(b){console.error(b),l("Lỗi","Không thể tải danh sách người dùng online","error")}finally{r(!1)}};if(s.useEffect(()=>{t&&v()},[t]),!t)return null;const h=b=>{const T=new Date(b),a=Math.floor((new Date().getTime()-T.getTime())/1e3);if(a<60)return`${a} giây trước`;const u=Math.floor(a/60);if(u<60)return`${u} phút trước`;const d=Math.floor(u/60);return d<24?`${d} giờ trước`:T.toLocaleDateString("vi-VN")};return e.jsx("div",{className:"fixed inset-0 bg-black/50 z-[70] flex items-center justify-center animate-fade-in",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 overflow-hidden animate-scale-up",children:[e.jsxs("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-100 flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold text-gray-800 text-lg flex items-center gap-2",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-green-500 animate-pulse"}),"Người Dùng Đang Online",e.jsx("span",{className:"bg-blue-100 text-blue-700 text-xs px-2 py-0.5 rounded-full ml-1",children:f.length})]}),e.jsx("button",{onClick:g,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("i",{className:"fas fa-times text-xl"})})]}),e.jsx("div",{className:"p-0 max-h-[60vh] overflow-y-auto",children:c?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx("i",{className:"fas fa-spinner fa-spin text-2xl mb-2"}),e.jsx("p",{children:"Đang tải..."})]}):f.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx("i",{className:"fas fa-user-slash text-2xl mb-2"}),e.jsx("p",{children:"Không có người dùng nào trực tuyến."})]}):e.jsx("div",{className:"divide-y divide-gray-100",children:f.map((b,T)=>e.jsxs("div",{className:"flex items-center gap-3 px-6 py-3 hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-gradient-to-br from-blue-100 to-blue-50 text-blue-600 flex items-center justify-center font-bold text-sm shadow-sm border border-blue-100/50",children:(b.fullName||b.email||"?").charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-800 truncate text-sm",children:b.fullName||b.email}),e.jsx("p",{className:"text-xs text-gray-400 truncate flex items-center gap-1",children:b.fullName?b.email:""})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("p",{className:"text-[10px] font-medium text-green-600 bg-green-50 px-2 py-0.5 rounded-full",children:"Online"}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:h(b.lastSeen)})]})]},T))})}),e.jsxs("div",{className:"bg-gray-50 px-6 py-3 border-t border-gray-100 flex justify-end gap-3",children:[e.jsxs(ge,{onClick:v,className:"!bg-white !text-blue-600 !border !border-blue-200 hover:!bg-blue-50 !px-3 !py-1.5 !text-sm",isLoading:c,children:[e.jsx("i",{className:"fas fa-sync-alt mr-1"})," Làm mới"]}),e.jsx(ge,{onClick:g,variant:"secondary",className:"!px-4 !py-1.5 !text-sm",children:"Đóng"})]})]})})},Ot=({showToast:t,hideToast:g,refetchHistory:l,refetchStock:f,refetchXuathoadon:i,refetchAdminData:c,allOrders:r,xuathoadonData:v,stockData:h,soldData:b,teamData:T,allUsers:p,isLoadingXuathoadon:a,isLoadingHistory:u,errorXuathoadon:d,onOpenImagePreview:A,onOpenFilePreview:k,isSidebarCollapsed:S,initialState:F,clearInitialState:x,onNavigateTo:N,onShowOrderDetails:m})=>{const[H,X]=s.useState(!1),[K,z]=s.useState(!1),[R,J]=s.useState({invoices:{folder:"pending_approval",orderId:null},matching:{tab:"pending",orderId:null},vc:{folder:"pending",requestId:null}}),Q=w=>{J(E=>({...E,invoices:{...E.invoices,...w}}))},M=w=>{J(E=>({...E,matching:{...E.matching,...w}}))},D=w=>{J(E=>({...E,vc:{...E.vc,...w}}))},{adminView:y,setAdminView:I,invoiceFilters:ee,pendingFilters:ne,pairedFilters:Z,vcFilters:ce,matchingFilters:oe,handleFilterChange:o,handleReset:$,setInvoiceFilters:G,setPendingFilters:re,setPairedFilters:me}=Lt({initialState:F,clearInitialState:x}),{pendingSortConfig:U,setPendingSortConfig:le,pairedSortConfig:ue,setPairedSortConfig:he,vcRequestsData:ye,isLoadingVc:de,errorVc:Ne,selectedRows:ae,setSelectedRows:xe,handleToggleAll:ve,fetchVcData:pe,processedInvoices:V,invoiceRequests:B,pendingData:_,pairedData:O,vcRequests:C,suggestionsMap:j,filterOptions:L,ordersWithMatches:P,allPendingOrderNumbers:W,allPairedOrderNumbers:Y}=Kt({allOrders:r,xuathoadonData:v,stockData:h,invoiceFilters:ee,pendingFilters:ne,pairedFilters:Z,vcFilters:ce,isSidebarCollapsed:S}),n=Et({showToast:t,hideToast:g,refetchHistory:l,refetchStock:f,refetchXuathoadon:i,refetchAdminData:c,fetchVcData:pe,teamData:T,allOrders:r,suggestionsMap:j,selectedRows:ae,setSelectedRows:xe,setShowMatchingModal:X}),je=(w,E={})=>{I(w),w==="invoices"&&G(se=>({...se,...E})),w==="pending"&&(re(se=>({...se,...E})),P.length>0&&X(!0)),w==="paired"&&me(se=>({...se,...E}))},we=w=>{I(w),w==="pending"&&P.length>0&&X(!0)},[Se,fe]=s.useState(!1),ke=s.useRef(null);s.useEffect(()=>{const w=E=>{ke.current&&!ke.current.contains(E.target)&&fe(!1)};return document.addEventListener("mousedown",w),()=>document.removeEventListener("mousedown",w)},[]);const Pe=["dashboard","invoices","matching","vc","phongkd"],Te={dashboard:"Tổng Quan",invoices:"Hóa Đơn",pending:"Chờ Ghép",paired:"Đã Ghép",matching:"Ghép Xe",vc:"Xử Lý VC",phongkd:"Phòng KD"},Me={dashboard:null,invoices:B.length,pending:_.length,paired:O.length,matching:_.length+O.length,vc:C.length,phongkd:Object.keys(T).length},De=[{title:"Lưu Trữ Hóa Đơn",icon:"fa-archive",action:()=>n.setAdminModal("archive")},{title:"Tải Lên HĐ Hàng Loạt",icon:"fa-file-upload",action:()=>n.setIsBulkUploadModalOpen(!0)},{title:"Thêm Xe Mới",icon:"fa-plus-circle",action:()=>n.setAdminModal("addCar")},{title:"Xóa Xe Khỏi Kho",icon:"fa-trash-alt",action:()=>n.setAdminModal("deleteCar")},{title:"Phục Hồi Xe",icon:"fa-undo",action:()=>n.setAdminModal("restoreCar")},{title:"Thêm Nhân Viên",icon:"fa-user-plus",action:()=>n.setAdminModal("addUser")},{title:"Xóa Đơn Hàng",icon:"fa-times-circle",action:()=>n.setAdminModal("deleteOrder")},{title:"Hoàn Tác Trạng Thái",icon:"fa-history",action:()=>n.setAdminModal("revertOrder")},{title:"Tra Cứu Lịch Sử",icon:"fa-search",action:()=>n.setAdminModal("timeline")},{title:"Đang Online",icon:"fa-users",action:()=>z(!0)}],qe=[{id:"vin",label:"Số VIN (17 ký tự)",placeholder:"Nhập 17 ký tự VIN...",isVIN:!0}],Je=[{id:"vinToDelete",label:"Số VIN cần xóa (17 ký tự)",placeholder:"Nhập chính xác 17 ký tự VIN...",isVIN:!0},{id:"reason",label:"Lý do xóa (bắt buộc)",placeholder:"VD: Xe bán lô, xe điều chuyển...",type:"textarea"}],We=[{id:"vinToRestore",label:"Số VIN cần phục hồi (17 ký tự)",placeholder:"Nhập chính xác 17 ký tự VIN...",isVIN:!0}],Qe=[{id:"orderNumber",label:"Nhập Số đơn hàng để xác nhận",placeholder:"Ví dụ: SO-123456..."}],Ze=[{id:"orderNumber",label:"Nhập Số đơn hàng cần hoàn tác",placeholder:"Ví dụ: N31913-VSO-25-08-0019"}],et=[{id:"fullName",label:"Họ và Tên",placeholder:"VD: Nguyễn Văn A",type:"text"},{id:"email",label:"Email",placeholder:"VD: an.nguyen@email.com",type:"text"}],Ye=[{id:"reason",label:"Lý do hủy (bắt buộc)",placeholder:"VD: Khách hàng đổi ý, sai thông tin...",type:"textarea"}],tt=[{id:"reason",label:"Lý do hủy ghép (bắt buộc)",placeholder:"VD: Sai thông tin xe...",type:"textarea"}],nt=()=>y==="invoices"&&a&&v.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-4xl text-accent-primary"})}):y==="invoices"&&d?e.jsxs("div",{className:"flex items-center justify-center h-full text-center p-8 bg-surface-card rounded-lg shadow-xl",children:[e.jsx("i",{className:"fas fa-exclamation-triangle fa-3x text-danger"}),e.jsx("p",{className:"mt-4 text-lg font-semibold",children:"Không thể tải dữ liệu hóa đơn"}),e.jsx("p",{className:"mt-2 text-sm text-text-secondary max-w-sm",children:d}),e.jsx("button",{onClick:()=>i(),className:"mt-6 btn-primary",children:"Thử lại"})]}):y==="vc"&&de&&ye.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-4xl text-accent-primary"})}):y==="vc"&&Ne?e.jsxs("div",{className:"flex items-center justify-center h-full text-center p-8 bg-surface-card rounded-lg shadow-xl",children:[e.jsx("i",{className:"fas fa-exclamation-triangle fa-3x text-danger"}),e.jsx("p",{className:"mt-4 text-lg font-semibold",children:"Không thể tải Yêu cầu VC"}),e.jsx("p",{className:"mt-2 text-sm text-text-secondary max-w-sm",children:Ne}),e.jsx("button",{onClick:()=>pe(),className:"mt-6 btn-primary",children:"Thử lại"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:y==="dashboard"?"flex-1 flex flex-col min-h-0":"hidden",children:e.jsx(Mt,{allOrders:r,stockData:h,soldData:b,teamData:T,allUsers:p,onTabChange:je,onNavigateTo:N,onShowOrderDetails:m,invoiceData:V})}),e.jsx("div",{className:y==="invoices"?"flex-1 flex flex-col min-h-0":"hidden",children:e.jsx(wt,{orders:B,onAction:n.handleAction,showToast:t,onOpenFilePreview:k,onUpdateInvoiceDetails:n.handleEditInvoiceDetails,selectedFolder:R.invoices.folder,selectedOrderId:R.invoices.orderId,onFolderChange:w=>Q({folder:w}),onOrderSelect:w=>Q({orderId:w}),processingId:n.processingId,processingActionType:n.processingActionType})}),e.jsx("div",{className:y==="matching"?"flex-1 flex flex-col min-h-0":"hidden",children:e.jsx(St,{pendingOrders:_,pairedOrders:O,stockData:h,onAction:n.handleAction,filters:oe,showToast:t,activeTab:R.matching.tab,selectedOrderId:R.matching.orderId,onTabChange:w=>M({tab:w}),onOrderSelect:w=>M({orderId:w})})}),e.jsxs("div",{className:y==="pending"?"flex-1 bg-surface-card rounded-xl shadow-md border border-border-primary flex flex-col min-h-0":"hidden",children:[ae.size>0&&e.jsx(Ge,{view:"pending",selectedRows:ae,setSelectedRows:xe,setBulkActionModal:n.setBulkActionModal}),e.jsx("div",{className:"flex-grow overflow-hidden relative",children:e.jsx(Ue,{viewType:"pending",orders:_,sortConfig:U,onSort:w=>le(E=>({key:w,direction:(E==null?void 0:E.key)===w&&E.direction==="asc"?"desc":"asc"})),selectedRows:ae,onToggleRow:w=>xe(E=>{const se=new Set(E);return se.has(w)?se.delete(w):se.add(w),se}),onToggleAllRows:()=>ve(W),onAction:n.handleAction,showToast:t,suggestions:j,onShowSuggestions:(w,E)=>n.setSuggestionModalState({order:w,cars:E}),onOpenFilePreview:k,onUpdateInvoiceDetails:n.handleEditInvoiceDetails,processingId:n.processingId})})]}),e.jsxs("div",{className:y==="paired"?"flex-1 bg-surface-card rounded-xl shadow-md border border-border-primary flex flex-col min-h-0":"hidden",children:[ae.size>0&&e.jsx(Ge,{view:"paired",selectedRows:ae,setSelectedRows:xe,setBulkActionModal:n.setBulkActionModal}),e.jsx("div",{className:"flex-grow overflow-hidden relative",children:e.jsx(Ue,{viewType:"paired",orders:O,sortConfig:ue,onSort:w=>he(E=>({key:w,direction:(E==null?void 0:E.key)===w&&E.direction==="asc"?"desc":"asc"})),selectedRows:ae,onToggleRow:w=>xe(E=>{const se=new Set(E);return se.has(w)?se.delete(w):se.add(w),se}),onToggleAllRows:()=>ve(Y),onAction:n.handleAction,showToast:t,suggestions:j,onShowSuggestions:(w,E)=>n.setSuggestionModalState({order:w,cars:E}),onOpenFilePreview:k,onUpdateInvoiceDetails:n.handleEditInvoiceDetails,processingId:n.processingId})})]}),e.jsx("div",{className:y==="vc"?"flex-1 flex flex-col min-h-0":"hidden",children:e.jsx(Ct,{requests:C,onAction:n.handleAction,showToast:t,onOpenImagePreview:A,onDownloadAll:n.handleDownloadAllVcImages,selectedFolder:R.vc.folder,selectedRequestId:R.vc.requestId,onFolderChange:w=>D({folder:w}),onRequestSelect:w=>D({requestId:w})})}),e.jsx("div",{className:y==="phongkd"?"flex-1 flex flex-col min-h-0":"hidden",children:e.jsx(Xt,{teamData:T,onEditTeam:(w,E)=>n.setEditingTeam({leader:w,members:E}),onAddNewTeam:()=>n.setIsAddingNewTeam(!0),onDeleteTeam:n.handleDeleteTeam})})]});return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"flex-shrink-0 bg-white border-b border-border-primary shadow-sm z-20",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between px-2 py-0.5 border-b border-border-secondary/50 gap-1 md:gap-0",children:[e.jsx("div",{className:"flex p-0.5 bg-white rounded-lg shadow-[inset_2px_2px_5px_#e5e7eb,inset_-2px_-2px_5px_#ffffff] border border-gray-100 overflow-x-auto md:overflow-hidden no-scrollbar w-full md:w-auto",children:Pe.map(w=>{const E=Me[w],se=y===w;return e.jsxs("button",{onClick:()=>we(w),className:`relative px-2 py-1 text-[10px] uppercase transition-all rounded-md flex items-center justify-center gap-1.5 whitespace-nowrap flex-shrink-0 w-24 ${se?"bg-white text-[#6d5dfc] shadow-[-2px_-2px_5px_#ffffff,2px_2px_5px_#e5e7eb] font-bold":"text-gray-500 hover:text-[#6d5dfc] font-medium"}`,children:[Te[w],E!==null&&e.jsx("span",{className:`text-[10px] font-mono px-2 py-0.5 rounded-full ${se?"bg-white shadow-[inset_2px_2px_5px_#e5e7eb,inset_-2px_-2px_5px_#ffffff] text-[#6d5dfc]":"bg-transparent text-gray-400"}`,children:E})]},w)})}),e.jsx("div",{className:"hidden md:block h-8 w-px bg-border-secondary/50 mx-2"}),e.jsxs("div",{className:"flex items-center justify-between md:justify-end w-full md:w-auto gap-3",children:[e.jsx("div",{className:"flex-grow md:flex-grow-0 flex justify-end items-center min-w-0 md:mr-4",children:e.jsx(Bt,{adminView:y,invoiceFilters:ee,pendingFilters:ne,pairedFilters:Z,vcFilters:ce,matchingFilters:oe,handleFilterChange:o,handleReset:$,filterOptions:L,invoiceRequests:B,pendingData:_,pairedData:O,vcRequests:C,refetchXuathoadon:i,refetchHistory:l,fetchVcData:pe,isLoadingXuathoadon:a,isLoadingHistory:u,isLoadingVc:de})}),e.jsxs("div",{className:"relative",ref:ke,children:[e.jsx("button",{onClick:()=>fe(w=>!w),title:"Thao Tác Nhanh",className:`w-9 h-9 flex items-center justify-center rounded-lg transition-all ${Se?"bg-accent-primary text-white shadow-md":"bg-surface-ground text-text-secondary hover:text-accent-primary hover:bg-surface-accent border border-transparent hover:border-border-secondary"}`,children:e.jsx("i",{className:"fas fa-bolt text-sm"})}),Se&&e.jsx("div",{className:"absolute top-full right-0 mt-2 w-64 bg-white border border-border-primary shadow-xl rounded-xl z-30 p-1 animate-fade-in-scale-up origin-top-right",children:De.map(w=>e.jsxs("button",{onClick:()=>{w.action(),fe(!1)},className:"flex items-center gap-3 w-full text-left px-3 py-2.5 text-sm rounded-lg text-text-primary hover:bg-surface-hover transition-colors",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-surface-ground flex items-center justify-center text-accent-secondary",children:e.jsx("i",{className:`fas ${w.icon} text-xs`})}),e.jsx("span",{className:"font-medium",children:w.title})]},w.title))})]})]})]})}),e.jsx("div",{className:"flex-grow min-h-0 flex flex-col",children:nt()}),n.suggestionModalState&&e.jsx(Ht,{isOpen:!!n.suggestionModalState,onClose:()=>n.setSuggestionModalState(null),order:n.suggestionModalState.order,suggestedCars:n.suggestionModalState.cars,onConfirm:n.handleConfirmSuggestion,showToast:t}),e.jsx(Vt,{isOpen:H,onClose:()=>X(!1),matches:P,onConfirmMatch:n.handleConfirmSuggestion}),n.invoiceModalState&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{showToast:t,isOpen:n.invoiceModalState.type==="approve",onClose:()=>n.setInvoiceModalState(null),title:"Phê Duyệt Yêu Cầu",description:"Xác nhận phê duyệt yêu cầu xuất hóa đơn cho đơn hàng:",targetId:n.invoiceModalState.order["Số đơn hàng"],submitText:"Phê Duyệt",submitColor:"success",icon:"fa-check-double",onSubmit:()=>n.handleAdminSubmit("approveSelectedInvoiceRequest",{orderNumbers:JSON.stringify([n.invoiceModalState.order["Số đơn hàng"]])},"Đã phê duyệt yêu cầu.")}),e.jsx($e,{showToast:t,isOpen:n.invoiceModalState.type==="supplement",onClose:()=>n.setInvoiceModalState(null),title:"Yêu Cầu Bổ Sung",orderNumber:n.invoiceModalState.order["Số đơn hàng"],reasonLabel:"Nội dung yêu cầu (bắt buộc):",onSubmit:(w,E)=>n.handleAdminSubmit("requestSupplementForInvoice",{orderNumbers:JSON.stringify([n.invoiceModalState.order["Số đơn hàng"]]),reason:w,pastedImagesBase64:JSON.stringify(E)},"Đã gửi yêu cầu bổ sung."),icon:"fa-exclamation-triangle",theme:"warning"}),e.jsx(ie,{showToast:t,isOpen:n.invoiceModalState.type==="pendingSignature",onClose:()=>n.setInvoiceModalState(null),title:"Chuyển Trạng Thái",description:"Chuyển đơn hàng sang 'Chờ Ký Hóa Đơn'?",targetId:n.invoiceModalState.order["Số đơn hàng"],submitText:"Xác Nhận",submitColor:"primary",icon:"fa-signature",onSubmit:()=>n.handleAdminSubmit("markAsPendingSignature",{orderNumbers:JSON.stringify([n.invoiceModalState.order["Số đơn hàng"]])},"Đã chuyển trạng thái.")}),e.jsx(Dt,{showToast:t,isOpen:n.invoiceModalState.type==="uploadInvoice",onClose:()=>n.setInvoiceModalState(null),order:n.invoiceModalState.order,onSubmit:async w=>{const se=await(st=>new Promise((at,rt)=>{const Ie=new FileReader;Ie.readAsDataURL(st),Ie.onload=()=>at(Ie.result.split(",")[1]),Ie.onerror=lt=>rt(lt)}))(w);return n.handleAdminSubmit("handleBulkUploadIssuedInvoices",{filesData:JSON.stringify([{orderNumber:n.invoiceModalState.order["Số đơn hàng"],base64Data:se,mimeType:w.type,fileName:w.name}])},"Đã tải lên hóa đơn thành công.")}}),e.jsx(ie,{showToast:t,isOpen:n.invoiceModalState.type==="cancel",onClose:()=>n.setInvoiceModalState(null),title:"Hủy Yêu Cầu Xuất Hóa Đơn",description:"Hành động này sẽ hủy yêu cầu và thông báo cho TVBH.",targetId:n.invoiceModalState.order["Số đơn hàng"],inputs:Ye,submitText:"Xác Nhận Hủy",submitColor:"danger",icon:"fa-trash-alt",onSubmit:w=>n.handleAdminSubmit("cancelRequest",{orderNumbers:JSON.stringify([n.invoiceModalState.order["Số đơn hàng"]]),reason:w.reason},"Đã hủy yêu cầu.")}),e.jsx(ie,{showToast:t,isOpen:n.invoiceModalState.type==="unmatch",onClose:()=>n.setInvoiceModalState(null),title:"Hủy Ghép Xe",description:"Hủy ghép xe cho đơn hàng:",targetId:n.invoiceModalState.order["Số đơn hàng"],inputs:tt,submitText:"Xác Nhận Hủy Ghép",submitColor:"danger",icon:"fa-unlink",onSubmit:w=>n.handleAdminSubmit("unmatchOrder",{orderNumber:n.invoiceModalState.order["Số đơn hàng"],reason:w.reason},"Đã hủy ghép xe.","both")}),e.jsx(ie,{showToast:t,isOpen:n.invoiceModalState.type==="resend",onClose:()=>n.setInvoiceModalState(null),title:"Gửi Lại Email",description:"Gửi lại email thông báo cho đơn hàng:",targetId:n.invoiceModalState.order["Số đơn hàng"],submitText:"Gửi Lại",submitColor:"primary",icon:"fa-paper-plane",onSubmit:()=>n.handleAdminSubmit("resendEmail",{orderNumbers:JSON.stringify([n.invoiceModalState.order["Số đơn hàng"]]),emailType:"invoice_issued"},"Đã gửi lại email.")}),e.jsx(ie,{showToast:t,isOpen:n.invoiceModalState.type==="approveVc",onClose:()=>n.setInvoiceModalState(null),title:"Phê Duyệt Yêu Cầu VC",description:"Xác nhận phê duyệt yêu cầu cấp VinClub cho đơn hàng:",targetId:n.invoiceModalState.order["Số đơn hàng"],submitText:"Phê Duyệt",submitColor:"success",icon:"fa-check-circle",onSubmit:()=>n.handleAdminSubmit("approveVcRequest",{orderNumber:n.invoiceModalState.order["Số đơn hàng"]},"Đã phê duyệt yêu cầu VC.")}),e.jsx($e,{showToast:t,isOpen:n.invoiceModalState.type==="rejectVc",onClose:()=>n.setInvoiceModalState(null),title:"Từ Chối Yêu Cầu VC",orderNumber:n.invoiceModalState.order["Số đơn hàng"],reasonLabel:"Lý do từ chối (bắt buộc):",onSubmit:(w,E)=>n.handleAdminSubmit("rejectVcRequest",{orderNumber:n.invoiceModalState.order["Số đơn hàng"],reason:w,pastedImagesBase64:JSON.stringify(E)},"Đã từ chối yêu cầu VC."),icon:"fa-ban",theme:"danger"})]}),n.bulkActionModal&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{showToast:t,isOpen:n.bulkActionModal.type==="approve",onClose:n.handleCloseBulkActionModal,title:"Phê duyệt hàng loạt",description:`Xác nhận phê duyệt ${ae.size} yêu cầu đã chọn?`,submitText:"Phê duyệt",submitColor:"success",icon:"fa-check-double",onSubmit:n.handleBulkApproveSubmit}),e.jsx(ie,{showToast:t,isOpen:n.bulkActionModal.type==="pendingSignature",onClose:n.handleCloseBulkActionModal,title:"Chuyển trạng thái hàng loạt",description:`Chuyển ${ae.size} đơn hàng đã chọn sang "Chờ Ký Hóa Đơn"?`,submitText:"Xác Nhận",submitColor:"primary",icon:"fa-signature",onSubmit:n.handleBulkPendingSignatureSubmit}),e.jsx($e,{showToast:t,isOpen:n.bulkActionModal.type==="supplement",onClose:n.handleCloseBulkActionModal,title:"Y/C Bổ sung hàng loạt",orderNumber:`${ae.size} đơn hàng`,reasonLabel:"Nội dung yêu cầu (bắt buộc):",icon:"fa-exclamation-triangle",theme:"warning",onSubmit:n.handleBulkSupplementSubmit}),e.jsx(ie,{showToast:t,isOpen:n.bulkActionModal.type==="cancel",onClose:n.handleCloseBulkActionModal,title:"Hủy hàng loạt",description:`Bạn có chắc muốn hủy ${ae.size} yêu cầu đã chọn? Hành động này sẽ chuyển các mục vào phần "Đã Hủy".`,inputs:Ye,submitText:"Xác Nhận Hủy",submitColor:"danger",icon:"fa-trash-alt",onSubmit:n.handleBulkCancelSubmit})]}),e.jsx(ie,{showToast:t,isOpen:n.adminModal==="archive",onClose:n.handleCloseAdminModal,title:"Lưu Trữ Hóa Đơn",description:"Lưu trữ hóa đơn đã xuất của tháng trước sang một sheet riêng.",submitText:"Xác Nhận Lưu Trữ",submitColor:"primary",icon:"fa-archive",onSubmit:n.handleArchiveSubmit}),e.jsx(ie,{showToast:t,isOpen:n.adminModal==="addCar",onClose:n.handleCloseAdminModal,title:"Thêm Xe Mới vào Kho",description:"Hệ thống sẽ tự động tra cứu thông tin xe từ số VIN.",inputs:qe,submitText:"Thêm Xe",submitColor:"primary",icon:"fa-plus-circle",onSubmit:n.handleAddCarSubmit}),e.jsx(ie,{showToast:t,isOpen:n.adminModal==="deleteCar",onClose:n.handleCloseAdminModal,title:"Xóa Xe Khỏi Kho",description:"Xe sẽ bị xóa khỏi trang Kho Xe và thông tin sẽ được lưu vào nhật ký. Có thể phục hồi lại sau bằng chức năng 'Phục Hồi Xe'.",inputs:Je,submitText:"Xác Nhận Xóa",submitColor:"danger",icon:"fa-trash-alt",onSubmit:n.handleDeleteCarSubmit}),e.jsx(ie,{showToast:t,isOpen:n.adminModal==="restoreCar",onClose:n.handleCloseAdminModal,title:"Phục Hồi Xe Đã Xóa",description:"Dựa vào nhật ký xe đã xóa, hệ thống sẽ thêm xe trở lại Kho Xe với trạng thái 'Chưa ghép'.",inputs:We,submitText:"Phục Hồi Xe",submitColor:"primary",icon:"fa-undo",onSubmit:n.handleRestoreCarSubmit}),e.jsx(ie,{showToast:t,isOpen:n.adminModal==="addUser",onClose:n.handleCloseAdminModal,title:"Thêm Nhân Viên Mới",description:"Thêm một tài khoản nhân viên mới. Hệ thống sẽ tự động tạo tên đăng nhập, mật khẩu và gửi email thông báo.",inputs:et,submitText:"Thêm & Gửi Email",submitColor:"primary",icon:"fa-user-plus",onSubmit:n.handleAddUserSubmit}),e.jsx(ie,{showToast:t,isOpen:n.adminModal==="deleteOrder",onClose:n.handleCloseAdminModal,title:"Xóa Đơn Hàng",description:"CẢNH BÁO: Đơn hàng sẽ bị xóa vĩnh viễn và chuyển vào mục 'Đã Hủy'.",inputs:Qe,submitText:"Tôi hiểu, Xóa Đơn Hàng",submitColor:"danger",icon:"fa-times-circle",onSubmit:n.handleDeleteOrderSubmit}),e.jsx(ie,{showToast:t,isOpen:n.adminModal==="revertOrder",onClose:n.handleCloseAdminModal,title:"Hoàn Tác Trạng Thái",description:"Khôi phục lại trạng thái cuối cùng của đơn hàng trong nhật ký.",inputs:Ze,submitText:"Thực Hiện Hoàn Tác",submitColor:"primary",icon:"fa-history",onSubmit:n.handleRevertOrderSubmit}),e.jsx(At,{isOpen:n.adminModal==="timeline",onClose:()=>n.setAdminModal(null)}),e.jsx($t,{isOpen:n.isBulkUploadModalOpen,onClose:()=>n.setIsBulkUploadModalOpen(!1),showToast:t,hideToast:g,onSuccess:()=>{l(!0),i(!0)}}),e.jsx(yt,{isOpen:!!n.editingOrder,onClose:()=>n.setEditingOrder(null),onSuccess:n.handleEditSuccess,order:n.editingOrder,showToast:t,existingOrderNumbers:r.map(w=>w["Số đơn hàng"])}),e.jsx(Yt,{isOpen:!!n.editingTeam||n.isAddingNewTeam,onClose:()=>{n.setEditingTeam(null),n.setIsAddingNewTeam(!1)},onSave:n.handleSaveTeam,teamData:T,allUsers:p,editingTeam:n.editingTeam}),e.jsx(Rt,{isOpen:K,onClose:()=>z(!1),showToast:t})]})},qt=Ve.memo(Ot);export{qt as default};
