import{j as e}from"./vendor-pdf-Dyj7cThZ.js";import{r as n,R as _}from"./vendor-react-KfUPlHYY.js";import{F as oe,C as ce,g as de,a as xe,S as me,n as O,y as he,B as E,i as j,b as ue}from"./index-CT-jfnFE.js";import{h as S}from"./vendor-utils-C5S46NFB.js";const fe="/ordermanagement/assets/sand-timer-CZWI8spV.json",pe="/ordermanagement/assets/pair-animation-BaVk6tb1.json",ge=({vehicle:s,onHoldCar:b,onReleaseCar:V,onCreateRequestForVehicle:H,onShowDetails:o,currentUser:w,isAdmin:T,showToast:v,processingVin:D})=>{var m;const[M,p]=n.useState(null),[P,z]=n.useState("dao"),[G,F]=n.useState(0);_.useEffect(()=>{z(Math.random()>.5?"mai":"dao"),F(Math.random()*1e4)},[]);const l=(a,f)=>{a.stopPropagation(),navigator.clipboard.writeText(f).then(()=>{v("Đã Sao Chép",`Số VIN ${f} đã được sao chép thành công.`,"success",2e3)}).catch(R=>{console.error("Lỗi sao chép VIN: ",R),v("Sao Chép Thất Bại","Không thể truy cập vào clipboard của bạn.","error",3e3)})},k=s["Thời gian nhập"]?S().diff(S(s["Thời gian nhập"]),"days"):null,c=s["Trạng thái"]==="Đang giữ"&&((m=s["Người Giữ Xe"])==null?void 0:m.trim().toLowerCase().normalize("NFC"))===(w==null?void 0:w.trim().toLowerCase().normalize("NFC")),B=s["Trạng thái"]==="Chưa ghép",g=s["Trạng thái"]==="Đang giữ"&&!c,y=D===s.VIN,x=()=>y?e.jsx("div",{className:"flex items-center justify-center w-full h-9",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-accent-primary text-xl"})}):M?e.jsxs("div",{className:"flex justify-center items-center gap-2 w-full animate-fade-in",style:{animationDuration:"150ms"},children:[e.jsx("div",{onClick:a=>{a.stopPropagation(),p(null)},className:"cursor-pointer hover:scale-110 transition-transform",title:"Hủy",children:e.jsx("lottie-player",{src:O,background:"transparent",speed:"1",style:{width:"28px",height:"28px"},loop:!0,autoplay:!0})}),e.jsx("div",{onClick:a=>{a.stopPropagation(),M.action==="hold"?b(s.VIN):V(s.VIN),p(null)},className:"cursor-pointer hover:scale-110 transition-transform",title:"Xác nhận",children:e.jsx("lottie-player",{src:he,background:"transparent",speed:"1",style:{width:"28px",height:"28px"},loop:!0,autoplay:!0})})]}):B?e.jsx("div",{className:"cursor-pointer transition-transform hover:scale-110",onClick:a=>{a.stopPropagation(),p({action:"hold"})},title:"Giữ xe (tạm thời)",children:e.jsx("lottie-player",{src:fe,background:"transparent",speed:"1",style:{width:"28px",height:"28px"},loop:!0,autoplay:!0})}):c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"cursor-pointer transition-transform hover:scale-110",onClick:a=>{a.stopPropagation(),p({action:"release"})},title:"Hủy giữ xe",children:e.jsx("lottie-player",{src:O,background:"transparent",speed:"1",style:{width:"28px",height:"28px"},loop:!0,autoplay:!0})}),e.jsx("div",{className:"cursor-pointer transition-transform hover:scale-110",onClick:a=>{a.stopPropagation(),H(s)},title:"Tạo yêu cầu cho xe đã giữ",children:e.jsx("lottie-player",{src:pe,background:"transparent",speed:"1",style:{width:"28px",height:"28px"},loop:!0,autoplay:!0})})]}):g?e.jsxs(e.Fragment,{children:[e.jsx(E,{disabled:!0,variant:"ghost",className:"action-btn !p-0 w-7 h-7 rounded-full",title:`Đang được giữ bởi ${s["Người Giữ Xe"]}`,children:e.jsx("i",{className:"fas fa-lock text-xs"})}),T&&e.jsx(E,{variant:"danger",className:"action-btn admin-release-action !p-0 w-7 h-7 rounded-full",onClick:a=>{a.stopPropagation(),p({action:"release"})},title:"Admin Hủy Giữ",children:e.jsx("i",{className:"fas fa-user-shield text-xs"})})]}):null,C=new Date>=new Date("2026-01-05T00:00:00");return e.jsxs("div",{className:"relative flex flex-col gap-2 rounded-xl bg-white/70 backdrop-blur-sm p-2 shadow-md border border-light-border hover:shadow-lg transition-all duration-200 ease-out active:scale-[0.98] group",children:[C&&e.jsx(oe,{flowerType:P,delay:G}),e.jsxs("div",{className:"cursor-pointer",onClick:()=>o(s),children:[e.jsxs("div",{className:"car-image-container relative flex items-center justify-center py-2 overflow-hidden rounded-lg bg-gradient-to-br from-gray-50 to-white",children:[e.jsxs("div",{className:`relative z-10 w-full h-full flex items-center justify-center ${s["Người Giữ Xe"]?"group-hover:blur-[1px] group-hover:opacity-90":""}`,children:[e.jsxs("div",{className:"sparkle-container",children:[e.jsx("div",{className:"sparkle",style:{top:"30%",left:"30%",animationDelay:"0s",width:"8px",height:"8px"}}),e.jsx("div",{className:"sparkle",style:{top:"20%",left:"70%",animationDelay:"1.2s"}}),e.jsx("div",{className:"sparkle",style:{top:"60%",left:"20%",animationDelay:"0.5s",width:"6px",height:"6px"}}),e.jsx("div",{className:"sparkle",style:{top:"70%",left:"80%",animationDelay:"2.5s"}}),e.jsx("div",{className:"sparkle",style:{top:"40%",left:"50%",animationDelay:"3s",width:"10px",height:"10px"}})]}),e.jsx(ce,{model:s["Dòng xe"],exteriorColor:s["Ngoại thất"],className:"car-image object-contain max-h-full",alt:`VinFast ${s["Dòng xe"]}`})]}),s["Người Giữ Xe"]&&e.jsx("div",{className:"absolute inset-0 z-20 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300 pointer-events-none",children:e.jsxs("div",{className:"bg-black/60 backdrop-blur-sm text-white rounded-lg p-2 shadow-xl border border-white/10 flex flex-col items-center transform scale-95 group-hover:scale-100 transition-transform duration-300 min-w-[100px]",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-0.5",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-accent-primary/90 flex items-center justify-center shadow-sm",children:e.jsx("i",{className:"fas fa-user-shield text-white text-[8px]"})}),e.jsx("span",{className:"font-semibold text-[10px] text-accent-primary tracking-wide uppercase",children:"Đang Giữ"})]}),e.jsx("p",{className:"font-bold text-xs whitespace-nowrap mb-0.5 text-shadow-sm",children:s["Người Giữ Xe"]}),s["Thời Gian Hết Hạn Giữ"]&&e.jsxs("div",{className:"flex items-center gap-1 text-[9px] text-gray-200 bg-white/5 px-1.5 py-0.5 rounded-full mt-0.5",children:[e.jsx("i",{className:"fas fa-clock text-[8px]"}),e.jsx("span",{children:S(s["Thời Gian Hết Hạn Giữ"]).format("HH:mm DD/MM")})]})]})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/40 to-transparent skew-x-[-15deg] w-full h-full animate-shine opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"})]}),e.jsxs("div",{className:"flex flex-col gap-1 mt-1",children:[e.jsxs("div",{className:"flex items-baseline gap-1.5 overflow-hidden",children:[e.jsx("span",{className:"text-light-text-primary text-base font-bold whitespace-nowrap group-hover:text-accent-primary transition-colors",children:s["Dòng xe"]}),e.jsx("span",{className:"text-light-text-secondary text-xs font-medium truncate",title:s["Phiên bản"],children:s["Phiên bản"]})]}),e.jsx("div",{className:"cursor-pointer",title:"Click để sao chép VIN",onClick:a=>l(a,s.VIN),children:e.jsxs("p",{className:"text-light-text-secondary text-xs font-mono truncate",children:["VIN: ",e.jsx("span",{className:"text-sm font-bold text-accent-primary hover:text-accent-primary-hover hover:underline transition-colors",children:s.VIN})]})}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-light-text-secondary",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0 max-w-[50%]",title:`Ngoại thất: ${s["Ngoại thất"]}`,children:[e.jsx("span",{className:"material-symbols-outlined flex-shrink-0",style:{fontSize:"14px"},children:"palette"}),e.jsx("p",{className:"text-xs truncate font-medium",style:de(s["Ngoại thất"]),children:s["Ngoại thất"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0 max-w-[50%]",title:`Nội thất: ${s["Nội thất"]}`,children:[e.jsx("span",{className:"material-symbols-outlined flex-shrink-0",style:{fontSize:"14px"},children:"chair"}),e.jsx("p",{className:"text-xs truncate font-medium",style:xe(s["Nội thất"]),children:s["Nội thất"]})]})]}),s["Ngày vận tải"]&&e.jsxs("div",{className:"flex items-center gap-1.5 mt-1 text-light-text-secondary",title:`Ngày vận tải: ${S(s["Ngày vận tải"]).format("DD/MM/YYYY")}`,children:[e.jsx("span",{className:"material-symbols-outlined flex-shrink-0",style:{fontSize:"14px"},children:"local_shipping"}),e.jsxs("p",{className:"text-xs truncate",children:["VT: ",S(s["Ngày vận tải"]).format("DD/MM/YYYY")]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsx(me,{status:s["Trạng thái"]}),k!==null&&e.jsxs("div",{className:"flex items-center gap-1 text-light-text-secondary",children:[e.jsx("span",{className:"material-symbols-outlined",style:{fontSize:"14px"},children:"schedule"}),e.jsxs("p",{className:"text-xs",children:[k," ngày"]})]})]})]})]}),e.jsx("div",{className:"border-t border-dashed border-border-primary mt-auto pt-1 flex items-center justify-center gap-2 h-8",children:x()})]})},ye=s=>s.vehicles.length===0?e.jsxs("div",{className:"text-center py-16 text-text-secondary",children:[e.jsx("i",{className:"fas fa-box-open fa-3x mb-4 text-text-placeholder"}),e.jsx("p",{className:"font-semibold text-text-primary",children:"Không tìm thấy xe nào trong kho."}),e.jsx("p",{className:"text-sm",children:"Hãy thử thay đổi bộ lọc hoặc kiểm tra lại sau."})]}):e.jsx("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(190px,1fr))] gap-2",children:s.vehicles.map(b=>e.jsx(ge,{vehicle:b,...s},b.VIN))}),Ne=({showToast:s,currentUser:b,isAdmin:V,onCreateRequestForVehicle:H,stockData:o,isLoading:w,error:T,refetchStock:v,highlightedVins:D,onHoldCar:M,onReleaseCar:p,processingVin:P,allOrders:z,showOrderInAdmin:G,showAdminTab:F})=>{const[l,k]=n.useState({keyword:"",carModel:[],version:[],status:[],exterior:[]}),[c,B]=n.useState({key:"VIN",direction:"asc"}),[g,y]=n.useState(20),[x,C]=n.useState(20),m=n.useRef(null),a=n.useRef(null),f=n.useCallback(()=>{if(!m.current)return;const t=m.current.querySelector(".flex-grow.overflow-y-auto"),r=t==null?void 0:t.querySelector(".grid");if(!t||!r){C(20);return}const i=m.current.clientWidth,h=m.current.clientHeight;if(h===0||i===0){C(20);return}const I=190,u=8;let d=230,X=Math.floor((i-8+u)/(I+u));if(r){const $=window.getComputedStyle(r).gridTemplateColumns;$&&$!=="none"&&(X=$.split(" ").length);const W=r.querySelector(".relative.flex.flex-col");if(W){const L=W.getBoundingClientRect().height;L>0&&(d=L)}}const Y=h-50,ne=Y>=d?Math.ceil((Y-d/2)/(d+u)):0,ie=Math.max(2,ne),le=Math.max(1,X),q=Math.max(12,ie*le*2);C(q),y(K=>Math.max(K,q))},[]);n.useEffect(()=>{const t=m.current;if(!t)return;const r=new ResizeObserver(()=>{f()});return r.observe(t),f(),()=>r.disconnect()},[f]);const R=n.useCallback(t=>{y(x),k(r=>({...r,...t}))},[x]),U=n.useCallback(()=>{y(x),k({keyword:"",carModel:[],version:[],status:[],exterior:[]})},[x]),Z=t=>{y(x);let r="asc";c&&c.key===t&&c.direction==="asc"&&(r="desc"),B({key:t,direction:r})},J=t=>{const r=t["Trạng thái"];if(V&&r!=="Chưa ghép")if(r==="Đã ghép"){const i=z.find(h=>h.VIN===t.VIN);i?G(i,"paired"):s("Không Tìm Thấy",`Không tìm thấy đơn hàng đã ghép với xe VIN ${t.VIN}.`,"warning",4e3)}else r==="Đang giữ"&&F("pending")},N=n.useMemo(()=>{let t=[...o];if(l.keyword){const r=l.keyword.toLowerCase();t=t.filter(i=>j(i.VIN,r)||j(i["Dòng xe"],r)||j(i["Phiên bản"],r)||j(i["Ngoại thất"],r)||j(i["Nội thất"],r)||j(i["Vị trí"],r)||j(i["Người Giữ Xe"],r))}return l.carModel.length>0&&(t=t.filter(r=>l.carModel.includes(r["Dòng xe"]))),l.version.length>0&&(t=t.filter(r=>l.version.includes(r["Phiên bản"]))),l.status.length>0&&(t=t.filter(r=>l.status.includes(r["Trạng thái"]))),l.exterior.length>0&&(t=t.filter(r=>l.exterior.includes(r["Ngoại thất"]))),t.sort((r,i)=>{const h=r["Trạng thái"]==="Đang giữ",I=i["Trạng thái"]==="Đang giữ";if(h&&!I)return-1;if(!h&&I)return 1;if(c){const u=r[c.key],d=i[c.key];if(u==null||u==="")return 1;if(d==null||d==="")return-1;if(u<d)return c.direction==="asc"?-1:1;if(u>d)return c.direction==="asc"?1:-1}return 0}),t},[o,l,c]),A=n.useMemo(()=>N.slice(0,g),[N,g]);n.useEffect(()=>{const t=new IntersectionObserver(r=>{r[0].isIntersecting&&g<N.length&&y(i=>Math.min(i+x,N.length))},{threshold:.1,rootMargin:"100px"});return a.current&&t.observe(a.current),()=>{a.current&&t.unobserve(a.current)}},[g,N.length,x]),n.useEffect(()=>{const t=setTimeout(()=>{f()},200);return()=>clearTimeout(t)},[A.length,f]);const Q=n.useMemo(()=>[...new Set(o.map(t=>t["Dòng xe"]).filter(t=>t))].sort(),[o]),ee=n.useMemo(()=>[...new Set(o.map(t=>t["Phiên bản"]).filter(t=>t))].sort(),[o]),te=n.useMemo(()=>[...new Set(o.map(t=>t["Trạng thái"]).filter(t=>t))].sort(),[o]),se=n.useMemo(()=>[...new Set(o.map(t=>t["Ngoại thất"]).filter(t=>t))].sort(),[o]),re=[{id:"stock-filter-car-model",key:"carModel",label:"Dòng Xe",options:Q,icon:"fa-car"},{id:"stock-filter-version",key:"version",label:"Phiên Bản",options:ee,icon:"fa-cogs"},{id:"stock-filter-status",key:"status",label:"Trạng Thái",options:te,icon:"fa-tag"},{id:"stock-filter-exterior",key:"exterior",label:"Ngoại Thất",options:se,icon:"fa-palette"}].filter(t=>t.options.length>0),ae=()=>{const t="animate-fade-in-up";if(w&&o.length===0)return e.jsxs("div",{className:`flex flex-col h-full ${t}`,children:[e.jsx("div",{className:"flex-shrink-0 bg-surface-card rounded-xl shadow-md border border-border-primary p-3 mb-2",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("div",{className:"skeleton-item h-12 rounded-full",style:{flexBasis:"320px",flexGrow:1}}),e.jsx("div",{className:"skeleton-item h-12 w-32 rounded-full"}),e.jsx("div",{className:"skeleton-item h-12 w-32 rounded-full"}),e.jsx("div",{className:"skeleton-item h-12 w-12 !rounded-full ml-auto"})]})}),e.jsx("div",{className:"flex-1 bg-surface-card rounded-xl shadow-md border border-border-primary flex flex-col min-h-0",children:e.jsx("div",{className:"flex-grow overflow-auto",children:e.jsx("div",{className:"p-4 space-y-2",children:Array.from({length:7}).map((i,h)=>e.jsx("div",{className:"skeleton-item h-12 w-full"},h))})})})]});if(T)return e.jsx("div",{className:`flex items-center justify-center h-96 ${t}`,children:e.jsxs("div",{className:"text-center p-8 bg-surface-card rounded-lg shadow-xl",children:[e.jsx("i",{className:"fas fa-exclamation-triangle fa-3x text-danger"}),e.jsx("p",{className:"mt-4 text-lg font-semibold",children:"Không thể tải dữ liệu kho"}),e.jsx("p",{className:"mt-2 text-sm text-text-secondary max-w-sm",children:T}),e.jsx(E,{onClick:()=>v(),variant:"primary",className:"mt-6",children:"Thử lại"})]})});const r={sortConfig:c,onSort:Z,startIndex:0,onHoldCar:M,onReleaseCar:p,onCreateRequestForVehicle:H,onShowDetails:J,currentUser:b,isAdmin:V,showToast:s,highlightedVins:D,processingVin:P};return e.jsxs("div",{className:`flex flex-col h-full ${t}`,children:[e.jsx("div",{className:"flex-shrink-0 bg-surface-card rounded-xl shadow-md border border-border-primary p-3 mb-2 relative z-20",children:e.jsx(ue,{filters:l,onFilterChange:R,onReset:U,dropdowns:re,searchPlaceholder:"Tìm VIN, dòng xe, phiên bản, màu sắc...",totalCount:N.length,onRefresh:()=>v(),isLoading:w,plain:!0,size:"compact",viewSwitcherEnabled:!1,activeView:"grid",onViewChange:()=>{},searchable:!1})}),e.jsx("div",{ref:m,className:"flex-1 flex flex-col min-h-0",children:e.jsx("div",{className:"bg-surface-card rounded-xl shadow-md border border-border-primary flex flex-col h-full",children:e.jsxs("div",{className:"flex-grow overflow-y-auto relative hidden-scrollbar p-1",children:[e.jsx(ye,{vehicles:A,...r}),g<N.length&&e.jsx("div",{ref:a,className:"h-10 w-full flex items-center justify-center py-4",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-accent-primary text-xl"})})]})})})]})};return e.jsx(e.Fragment,{children:ae()})},ke=_.memo(Ne);export{ke as default};
