import{j as e}from"./vendor-pdf-Dyj7cThZ.js";import{r as f,R as ee}from"./vendor-react-KfUPlHYY.js";import{h as Y}from"./vendor-utils-C5S46NFB.js";import{B as S,g as O,S as te,M as _,i as D,b as se}from"./index-CT-jfnFE.js";const ae="/ordermanagement/assets/loading-animation-DF1z-Eb6.json",q=({order:t,onViewDetails:s,onCancel:n,onRequestInvoice:c,onSupplement:o,onRequestVC:r,onConfirmVC:u,onEdit:p,onToggle:g})=>{const[d,w]=f.useState(!1),h=f.useRef(null),j=x=>{w(x),g==null||g(x)};f.useEffect(()=>{const x=b=>{h.current&&!h.current.contains(b.target)&&j(!1)};return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[g]);const m=(t["Kết quả"]||"chưa ghép").toLowerCase().trim().normalize("NFC"),N=(t["Trạng thái VC"]||"").toLowerCase().trim().normalize("NFC"),a=N||m,y=["chưa ghép","đã ghép"].includes(m),T=m==="đã ghép",H=m==="yêu cầu bổ sung",z=!["đã xuất hóa đơn","đã hủy","chờ ký hóa đơn"].includes(m),B=(m==="đã xuất hóa đơn"||N==="từ chối ycvc")&&!["yêu cầu vinclub","chờ duyệt ycvc","chờ xác thực vc (tvbh)","đã có vc"].includes(N),I=a==="chờ xác thực vc (tvbh)",C=(x,b)=>{b.preventDefault(),b.stopPropagation(),x(t),j(!1)},$=[{label:"Xem chi tiết",icon:"fa-eye text-accent-primary",action:s,condition:!0,title:"Xem chi tiết đơn hàng"},{label:"Chỉnh Sửa",icon:"fa-pencil-alt text-blue-500",action:p,condition:!!p&&z,title:"Chỉnh sửa thông tin đơn hàng"},{label:"Yêu cầu Xuất Hóa Đơn",icon:"fa-file-invoice-dollar text-green-500",action:c,condition:T,title:"Tải lên hợp đồng và đề nghị để xuất hóa đơn"},{label:"Bổ Sung File",icon:"fa-edit text-orange-500",action:o,condition:H,title:"Bổ sung hoặc thay thế tệp đã gửi"},{label:"Yêu Cầu Cấp VC",icon:"fa-id-card text-blue-500",action:r,condition:!!r&&B,title:"Yêu cầu cấp tài khoản VinClub"},{label:"Xác Thực UNC VC",icon:"fa-check text-teal-500",action:u,condition:!!u&&I,title:"Xác thực đã nhận UNC cho VinClub"},{label:"Tải Hóa Đơn",icon:"fa-download text-sky-500",action:x=>{x.LinkHoaDonDaXuat&&window.open(x.LinkHoaDonDaXuat,"_blank")},condition:!!t.LinkHoaDonDaXuat,title:"Tải về hóa đơn đã xuất"},{label:"Hủy Yêu Cầu",icon:"fa-trash-alt text-danger",action:n,condition:y,isDanger:!0,title:"Hủy yêu cầu ghép xe này"}].filter(x=>x.condition);return e.jsxs("div",{className:"relative inline-block text-left",ref:h,children:[e.jsx(S,{onClick:x=>{x.stopPropagation(),j(!d)},variant:"ghost",className:`group w-9 h-9 flex items-center justify-center rounded-full transition-all duration-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-surface-card focus-visible:ring-accent-primary/50 !p-0
                   ${d?"bg-accent-primary/10":"bg-transparent hover:bg-surface-hover"}`,"aria-haspopup":"true","aria-expanded":d,"aria-controls":"action-menu",title:"Tùy chọn",children:e.jsx("lottie-player",{src:ae,background:"transparent",speed:"1",style:{width:"28px",height:"28px"},loop:!0,autoplay:!0,className:`transition-all duration-300 group-hover:scale-110 group-hover:[filter:drop-shadow(0_0_4px_rgba(66,165,245,0.7))] ${d?"scale-105 [filter:drop-shadow(0_0_2px_rgba(66,165,245,0.7))]":""}`})}),d&&e.jsx("div",{id:"action-menu",className:"origin-top-right absolute right-0 mt-2 w-56 rounded-lg shadow-2xl bg-surface-overlay border border-border-primary/70 z-30 focus:outline-none animate-fade-in-scale-up",style:{animationDuration:"0.15s"},children:e.jsx("div",{className:"p-1.5",role:"menu","aria-orientation":"vertical",children:$.map(x=>e.jsxs(ee.Fragment,{children:[x.isDanger&&$.some(b=>!b.isDanger&&b.condition)&&e.jsx("div",{className:"border-t border-border-primary/70 my-1 mx-1.5"}),x.isDanger&&$.some(b=>!b.isDanger&&b.condition)&&e.jsx("div",{className:"border-t border-border-primary/70 my-1 mx-1.5"}),e.jsx(S,{onClick:b=>C(x.action,b),title:x.title,variant:x.isDanger?"danger":"ghost",fullWidth:!0,className:`justify-start px-3 py-2.5 text-sm font-medium rounded-md transition-colors duration-150 
                                ${x.isDanger?"hover:bg-danger-bg":"text-text-primary hover:bg-surface-hover"}`,role:"menuitem",leftIcon:e.jsx("i",{className:`fas ${x.icon} fa-fw w-5 text-center text-base mr-1`}),children:e.jsx("span",{children:x.label})})]},x.label))})})]})},L=({columnKey:t,title:s,sortConfig:n,onSort:c,className:o})=>{const r=(n==null?void 0:n.key)===t,u=(n==null?void 0:n.direction)==="asc"?"▲":"▼";return e.jsxs("th",{scope:"col",onClick:()=>c(t),className:`py-2 px-2 text-left text-xs font-bold text-text-secondary cursor-pointer hover:bg-surface-hover transition-colors whitespace-nowrap uppercase tracking-wider ${o}`,children:[s," ",r&&e.jsx("span",{className:"text-xs ml-1",children:u})]})},ne=({order:t,index:s,onViewDetails:n,onCancel:c,onRequestInvoice:o,onSupplement:r,onEdit:u,onRequestVC:p,onConfirmVC:g,onRowClick:d,selectedOrder:w,viewMode:h,processingOrder:j})=>{const[m,N]=f.useState(!1),a=t["Trạng thái VC"]||t["Kết quả"]||"Chưa ghép",y=w&&w["Số đơn hàng"]===t["Số đơn hàng"],T=j===t["Số đơn hàng"];return e.jsxs("tr",{className:`hover:bg-surface-hover transition-colors duration-200 animate-fade-in-up ${d?"cursor-pointer":""} ${y?"selected-row-highlight":""} ${m?"relative z-20":""}`,style:{animationDelay:`${s*20}ms`},onClick:()=>d?d(t):n==null?void 0:n(t),children:[e.jsx("td",{className:"whitespace-nowrap py-2 pl-2 pr-2 text-sm text-center text-text-secondary font-medium sm:pl-3","data-label":"#",children:s+1}),e.jsxs("td",{className:"whitespace-nowrap px-2 py-2 text-sm","data-label":"Khách hàng / SĐH",children:[e.jsx("div",{className:"font-semibold text-text-primary",children:t["Tên khách hàng"]||"N/A"}),e.jsx("div",{className:"text-text-secondary font-mono text-xs",children:t["Số đơn hàng"]})]}),e.jsxs("td",{className:"whitespace-nowrap px-2 py-2 text-sm","data-label":"Thông Tin Xe",children:[e.jsxs("div",{className:"text-text-primary",children:[t["Dòng xe"]," / ",t["Phiên bản"]]}),e.jsxs("div",{className:"text-text-secondary text-xs",style:O(t["Ngoại thất"]),children:[t["Ngoại thất"]," / ",t["Nội thất"]]})]}),h==="full"&&e.jsxs("td",{className:"whitespace-nowrap px-2 py-2 text-sm","data-label":"Ngày Yêu Cầu",children:[e.jsx("div",{className:"text-text-primary",title:Y(t["Thời gian nhập"]).format("DD/MM/YYYY HH:mm:ss"),children:Y(t["Thời gian nhập"]).format("DD/MM/YY HH:mm")}),e.jsx("div",{className:"text-text-secondary text-xs",children:Y(t["Thời gian nhập"]).fromNow()})]}),e.jsx("td",{className:"whitespace-nowrap px-2 py-2 text-sm text-text-primary truncate","data-label":"Tư vấn",title:t["Tên tư vấn bán hàng"],children:t["Tên tư vấn bán hàng"]||"N/A"}),h==="full"&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"whitespace-nowrap px-2 py-2 text-sm text-text-primary","data-label":"Trạng thái",children:e.jsx(te,{status:a})}),e.jsx("td",{className:"relative whitespace-nowrap py-2 pl-2 pr-2 text-center text-sm font-medium sm:pr-3","data-label":"Hành động",onClick:H=>H.stopPropagation(),children:T?e.jsx("div",{className:"flex items-center justify-center h-9",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-accent-primary text-xl"})}):e.jsx(q,{order:t,onViewDetails:n,onCancel:c,onRequestInvoice:o,onSupplement:r,onEdit:u,onRequestVC:p,onConfirmVC:g,onToggle:N})})]})]})},re=({orders:t,onViewDetails:s,onCancel:n,onRequestInvoice:c,onSupplement:o,onEdit:r,onRequestVC:u,onConfirmVC:p,sortConfig:g,onSort:d,startIndex:w,onRowClick:h,selectedOrder:j,viewMode:m="full",processingOrder:N})=>t.length===0?e.jsxs("div",{className:"text-center py-8 text-text-secondary",children:[e.jsx("i",{className:"fas fa-folder-open fa-3x mb-4 text-text-placeholder"}),e.jsx("p",{className:"font-semibold text-text-primary",children:"Không tìm thấy yêu cầu nào."}),e.jsx("p",{className:"text-sm",children:"Hãy thử thay đổi bộ lọc hoặc tạo yêu cầu mới."})]}):e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"md:hidden space-y-3",children:t.map((a,y)=>e.jsxs("div",{className:`relative overflow-hidden rounded-xl bg-slate-50 p-3 shadow-sm border border-gray-200 hover:shadow-md transition-all duration-200 ease-out active:scale-[0.98] cursor-pointer flex flex-col group ${j&&j["Số đơn hàng"]===a["Số đơn hàng"]?"ring-2 ring-accent-primary":""}`,onClick:()=>h?h(a):s==null?void 0:s(a),children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-slate-800 text-sm font-bold uppercase leading-tight truncate",title:a["Tên khách hàng"],children:a["Tên khách hàng"]||"N/A"}),e.jsx("p",{className:"text-gray-500 text-[10px] font-mono truncate mt-0.5",title:a["Số đơn hàng"],children:a["Số đơn hàng"]})]}),e.jsx("div",{className:"flex-shrink-0",onClick:T=>T.stopPropagation(),children:N===a["Số đơn hàng"]?e.jsx("div",{className:"flex items-center justify-center w-8 h-8",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-accent-primary text-lg"})}):m==="full"&&e.jsx(q,{order:a,onViewDetails:s,onCancel:n,onRequestInvoice:c,onSupplement:o,onEdit:r,onRequestVC:u,onConfirmVC:p})})]}),e.jsx("div",{className:"my-2 border-t border-dashed border-gray-300"}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("p",{className:"text-slate-800 text-sm font-medium truncate",title:`${a["Dòng xe"]} / ${a["Phiên bản"]}`,children:[a["Dòng xe"]," / ",a["Phiên bản"]]}),e.jsxs("p",{className:"text-slate-500 text-xs truncate",title:`${a["Ngoại thất"]} / ${a["Nội thất"]}`,children:[e.jsx("span",{style:O(a["Ngoại thất"]),children:a["Ngoại thất"]}),e.jsx("span",{className:"text-gray-400",children:" / "}),e.jsx("span",{children:a["Nội thất"]})]})]}),e.jsx("div",{className:"my-2 border-t border-dashed border-gray-300"}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500 mt-auto",children:[e.jsx("span",{children:"Tư vấn"}),e.jsx("span",{className:"font-medium uppercase text-slate-700 truncate",children:a["Tên tư vấn bán hàng"]||"N/A"})]})]},a["Số đơn hàng"]||y))}),e.jsx("div",{className:"hidden md:block min-w-full py-1 align-middle",children:e.jsxs("table",{className:"min-w-full divide-y divide-border-primary responsive-table",children:[e.jsx("thead",{className:"bg-surface-hover sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"py-2 pl-2 pr-2 text-center text-xs font-bold text-text-secondary sm:pl-3 w-12 uppercase tracking-wider",children:"#"}),e.jsx(L,{columnKey:"Tên khách hàng",title:"Khách hàng / SĐH",sortConfig:g,onSort:d}),e.jsx(L,{columnKey:"Dòng xe",title:"Thông Tin Xe",sortConfig:g,onSort:d}),m==="full"&&e.jsx(L,{columnKey:"Thời gian nhập",title:"Ngày Yêu Cầu",sortConfig:g,onSort:d}),e.jsx(L,{columnKey:"Tên tư vấn bán hàng",title:"Tư vấn",sortConfig:g,onSort:d}),m==="full"&&e.jsx(L,{columnKey:"Kết quả",title:"Trạng thái",sortConfig:g,onSort:d}),m==="full"&&e.jsx("th",{scope:"col",className:"relative py-2 pl-2 pr-2 sm:pr-3 text-center text-xs font-bold text-text-secondary uppercase tracking-wider",children:"Hành động"})]})}),e.jsx("tbody",{className:"divide-y divide-border-primary bg-surface-card",children:t.map((a,y)=>e.jsx(ne,{order:a,index:w+y,onViewDetails:s,onCancel:n,onRequestInvoice:c,onSupplement:o,onEdit:r,onRequestVC:u,onConfirmVC:p,onRowClick:h,selectedOrder:j,viewMode:m,processingOrder:N},a["Số đơn hàng"]||y))})]})})]}),le=({currentPage:t,totalPages:s,onPageChange:n,onLoadMore:c,isLoadingArchives:o,isLastArchive:r})=>{if(s<=1&&r)return null;const u=[],p=3;let g,d;s<=p?(g=1,d=s):t<=Math.ceil(p/2)?(g=1,d=p):t+Math.floor(p/2)>=s?(g=s-p+1,d=s):(g=t-Math.floor(p/2),d=t+Math.floor(p/2));for(let a=g;a<=d;a++)u.push(a);const w="flex items-center justify-center text-xs font-medium rounded-md transition-colors duration-200",h=`${w} w-7 h-7 text-gray-500 hover:bg-gray-100 hover:text-gray-700`,j=`${w} px-2.5 py-1 text-blue-600 bg-blue-50 hover:bg-blue-100 font-semibold`,m="disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-transparent disabled:hover:text-gray-500",N=(s===0||t===s)&&!r;return e.jsxs("nav",{className:"px-4 py-2 flex items-center justify-center space-x-0.5 flex-wrap gap-y-1",children:[s>1&&e.jsx("button",{onClick:()=>n(t-1),disabled:t===1,className:`${h} ${m}`,"aria-label":"Trang trước",children:e.jsx("svg",{className:"w-4 h-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),s>1&&g>1&&e.jsxs(e.Fragment,{children:[e.jsx(S,{onClick:()=>n(1),variant:"ghost",className:`w-9 h-9 flex items-center justify-center rounded-lg text-sm font-medium transition-colors !p-0 ${t===1?"bg-blue-100 text-blue-700 font-bold":"hover:bg-surface-hover"}`,children:"1"}),g>2&&e.jsx(S,{disabled:!0,variant:"ghost",className:"w-9 h-9 flex items-center justify-center rounded-lg text-text-secondary !p-0",children:"..."})]}),s>1&&u.map(a=>e.jsx(S,{onClick:()=>n(a),variant:"ghost",className:`w-9 h-9 flex items-center justify-center rounded-lg text-sm font-medium transition-colors !p-0 ${t===a?"bg-blue-100 text-blue-700 font-bold":"hover:bg-surface-hover"}`,children:a},a)),s>1&&d<s&&e.jsxs(e.Fragment,{children:[d<s-1&&e.jsx(S,{disabled:!0,variant:"ghost",className:"w-9 h-9 flex items-center justify-center rounded-lg text-text-secondary !p-0",children:"..."}),e.jsx(S,{onClick:()=>n(s),variant:"ghost",className:`w-9 h-9 flex items-center justify-center rounded-lg text-sm font-medium transition-colors !p-0 ${t===s?"bg-blue-100 text-blue-700 font-bold":"hover:bg-surface-hover"}`,children:s})]}),s>1&&e.jsx(S,{onClick:()=>n(t+1),disabled:t===s,variant:"ghost",className:"w-9 h-9 flex items-center justify-center rounded-lg hover:bg-surface-hover disabled:opacity-50 disabled:cursor-not-allowed transition-colors !p-0","aria-label":"Trang sau",children:e.jsx("svg",{className:"w-4 h-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})}),N&&e.jsx("button",{onClick:c,disabled:o,className:`${j} ${m} ml-2`,children:o?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"})," Đang tải..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-archive mr-2"})," Tải thêm"]})})]})},M=({icon:t,label:s,value:n,valueClassName:c})=>e.jsxs("div",{className:"flex items-start gap-2 py-2 border-b border-dashed border-border-primary/50",children:[e.jsx("i",{className:`fas ${t} text-accent-secondary text-base w-5 text-center mt-1`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-text-secondary",children:s}),e.jsx("p",{className:`text-sm text-text-primary font-semibold break-words ${c}`,children:n||"—"})]})]}),ie=({order:t,showToast:s})=>{const[n,c]=f.useState(!1),o=r=>{r&&navigator.clipboard.writeText(r).then(()=>{c(!0),s("Đã Sao Chép",`Số VIN ${r} đã được sao chép.`,"success",2e3),setTimeout(()=>c(!1),2e3)}).catch(()=>{s("Lỗi Sao Chép","Không thể truy cập clipboard.","error")})};return e.jsxs("div",{className:"detail-panel h-full",children:[e.jsxs("h3",{className:"text-lg font-bold text-text-primary mb-0 p-2 border-b border-border-primary flex items-center gap-3 flex-shrink-0",children:[e.jsx("i",{className:"fas fa-file-invoice text-accent-primary"}),"Chi Tiết Đơn Hàng"]}),e.jsx("div",{className:"detail-panel-body flex-grow hidden-scrollbar",children:t?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative p-2 my-1 rounded-lg bg-slate-800 text-center shadow-lg cursor-pointer hover:bg-slate-700 transition-colors",onClick:()=>o(t.VIN||""),title:"Click để sao chép VIN",children:[e.jsx("p",{className:"text-xs text-slate-400 uppercase tracking-widest",children:"Số Khung (VIN)"}),e.jsx("p",{className:"text-white font-mono tracking-wider text-xl break-all",children:t.VIN}),n&&e.jsx("div",{className:"absolute top-1 right-1 text-xs font-semibold text-success bg-success-bg/20 px-1.5 py-0.5 rounded-full animate-fade-in",children:"✓"})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-text-primary mb-1 mt-1",children:[e.jsx("i",{className:"fas fa-user-circle mr-2 text-accent-secondary"}),"Thông tin Khách Hàng"]}),e.jsxs("div",{className:"pl-2",children:[e.jsx(M,{icon:"fa-user",label:"Tên Khách Hàng",value:t["Tên khách hàng"]}),e.jsx(M,{icon:"fa-barcode",label:"Số Đơn Hàng",value:t["Số đơn hàng"],valueClassName:"font-mono"}),e.jsx(M,{icon:"fa-user-tie",label:"Tư Vấn Bán Hàng",value:t["Tên tư vấn bán hàng"]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-text-primary mb-1 mt-2",children:[e.jsx("i",{className:"fas fa-car mr-2 text-accent-secondary"}),"Chi tiết Xe"]}),e.jsxs("div",{className:"pl-2",children:[e.jsx(M,{icon:"fa-car-side",label:"Dòng Xe",value:t["Dòng xe"]}),e.jsx(M,{icon:"fa-cogs",label:"Phiên Bản",value:t["Phiên bản"]}),e.jsx(M,{icon:"fa-palette",label:"Ngoại Thất",value:t["Ngoại thất"]}),e.jsx(M,{icon:"fa-chair",label:"Nội Thất",value:t["Nội thất"]})]})]})]}):e.jsxs("div",{className:"text-center text-text-secondary p-8 flex flex-col items-center justify-center h-full min-h-[200px]",children:[e.jsx("i",{className:"fas fa-mouse-pointer fa-2x mb-4 text-text-placeholder"}),e.jsx("p",{className:"font-semibold",children:"Chưa chọn đơn hàng"}),e.jsx("p",{className:"text-sm",children:"Chọn một mục từ bảng để xem chi tiết."})]})})]})},X=({icon:t,title:s,value:n,iconBgClass:c="bg-accent-primary/10",valueClassName:o="",className:r="",colorClass:u="text-accent-primary",size:p="default"})=>p==="compact"?e.jsxs("div",{className:`bg-surface-card p-2 rounded-xl border border-border-primary flex items-center gap-2 transition-all duration-300 hover:shadow-glow-accent hover:-translate-y-1 ${r}`,children:[e.jsx("div",{className:`flex-shrink-0 w-10 h-10 rounded-md flex items-center justify-center ${c}`,children:e.jsx("i",{className:`fas ${t} ${u} text-lg`})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs text-text-secondary font-medium truncate",children:s}),e.jsx("p",{className:`font-bold text-text-primary truncate text-xl ${o}`,children:n})]})]}):e.jsxs("div",{className:`bg-surface-card p-2 rounded-xl border border-border-primary flex items-center gap-2 transition-all duration-300 hover:shadow-glow-accent hover:-translate-y-1 ${r}`,children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${c}`,children:e.jsx("i",{className:`fas ${t} ${u} text-xl`})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm text-text-secondary font-medium truncate",children:s}),e.jsx("p",{className:`font-bold text-text-primary truncate text-2xl ${o}`,children:n})]})]}),ce=({selectedMonth:t,selectedYear:s,onMonthChange:n,onYearChange:c,years:o=[2023,2024,2025]})=>e.jsxs("div",{className:"flex items-center space-x-2 bg-surface-card border border-border-primary rounded-lg p-1 shadow-sm",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:t===null?"all":t,onChange:r=>n(r.target.value==="all"?null:parseInt(r.target.value)),className:"appearance-none bg-transparent border-none text-sm font-semibold text-text-primary py-1 pl-3 pr-8 focus:ring-0 cursor-pointer hover:text-accent-primary transition-colors",children:[e.jsx("option",{value:"all",children:"Cả Năm"}),_.map((r,u)=>e.jsx("option",{value:u,children:r},u))]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-text-secondary",children:e.jsx("i",{className:"fas fa-chevron-down text-xs"})})]}),e.jsx("div",{className:"h-4 w-px bg-border-primary"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:s,onChange:r=>c(parseInt(r.target.value)),className:"appearance-none bg-transparent border-none text-sm font-semibold text-text-primary py-1 pl-3 pr-8 focus:ring-0 cursor-pointer hover:text-accent-primary transition-colors",children:o.map(r=>e.jsx("option",{value:r,children:r},r))}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-text-secondary",children:e.jsx("i",{className:"fas fa-chevron-down text-xs"})})]})]}),K=t=>!t||typeof t!="string"?"N/A":String(t).normalize("NFC").trim().toLowerCase().split(/\s+/).filter(Boolean).map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "),E=(t,s)=>{const n={};return t?(t.forEach(c=>{let o=c[s];s==="Tên tư vấn bán hàng"&&(o=K(o));const r=String(o).trim();r&&r!=="N/A"&&(n[r]=(n[r]||0)+1)}),Object.entries(n).map(([c,o])=>({key:c,count:o})).sort((c,o)=>o.count-c.count)):[]},me=({showToast:t,soldData:s,isLoading:n,error:c,refetch:o,isSidebarCollapsed:r})=>{const u=r?14:12,[p,g]=f.useState(null),[d,w]=f.useState(new Date().getFullYear()),[h,j]=f.useState({keyword:"",tvbh:[],carModel:[],version:[],exterior:[]}),[m,N]=f.useState({key:"Thời gian nhập",direction:"desc"}),[a,y]=f.useState(1),[T,H]=f.useState(null),[z,B]=f.useState(!1),I=f.useMemo(()=>s.filter(l=>{if(!l["Thời gian nhập"])return!1;const i=Y(l["Thời gian nhập"]),v=i.year(),k=i.month();return!(v!==d||p!==null&&k!==p)}),[s,p,d]),C=f.useMemo(()=>{let l=[...I];if(h.keyword){const i=h.keyword.toLowerCase();l=l.filter(v=>D(v["Tên khách hàng"],i)||D(v["Số đơn hàng"],i)||D(v.VIN,i)||D(v["Dòng xe"],i)||D(v["Phiên bản"],i)||D(v["Ngoại thất"],i)||D(v["Tên tư vấn bán hàng"],i))}return h.carModel.length>0&&(l=l.filter(i=>h.carModel.includes(i["Dòng xe"]))),h.version.length>0&&(l=l.filter(i=>h.version.includes(i["Phiên bản"]))),h.exterior.length>0&&(l=l.filter(i=>h.exterior.includes(i["Ngoại thất"]))),h.tvbh.length>0&&(l=l.filter(i=>h.tvbh.includes(K(i["Tên tư vấn bán hàng"])))),l},[I,h]),$=f.useMemo(()=>{const l=E(C,"Dòng xe"),i=E(C,"Tên tư vấn bán hàng"),v=l[0]||{key:"—",count:0},k=i[0]||{key:"—",count:0};return{total:C.length,topCarDisplay:`${v.key} (${v.count})`,topTvbhDisplay:`${k.key} (${k.count})`,topCars:l.slice(0,5),topTvbh:i.slice(0,5)}},[C]),x=l=>{y(1),N(i=>({key:l,direction:(i==null?void 0:i.key)===l&&i.direction==="asc"?"desc":"asc"}))},b=f.useMemo(()=>{let l=[...C];return m&&l.sort((i,v)=>{const k=i[m.key],F=v[m.key];return k==null||k===""?1:F==null||F===""?-1:k<F?m.direction==="asc"?-1:1:k>F?m.direction==="asc"?1:-1:0}),l},[C,m]),A=Math.ceil(b.length/u),R=f.useMemo(()=>b.slice((a-1)*u,a*u),[b,a,u]),V=f.useCallback(l=>{y(1),j(i=>({...i,...l}))},[]),U=f.useCallback(()=>{y(1),j({keyword:"",tvbh:[],carModel:[],version:[],exterior:[]})},[]),W=l=>{H(l),B(!0)},G=f.useMemo(()=>[...new Set(s.map(l=>K(l["Tên tư vấn bán hàng"])).filter(Boolean))].sort(),[s]),Z=f.useMemo(()=>[...new Set(s.map(l=>l["Dòng xe"]).filter(Boolean))].sort(),[s]),J=f.useMemo(()=>[...new Set(s.map(l=>l["Phiên bản"]).filter(Boolean))].sort(),[s]),Q=f.useMemo(()=>[...new Set(s.map(l=>l["Ngoại thất"]).filter(Boolean))].sort(),[s]),P=[{id:"sold-filter-tvbh",key:"tvbh",label:"Tư vấn",options:G,icon:"fa-user-tie"},{id:"sold-filter-car-model",key:"carModel",label:"Dòng Xe",options:Z,icon:"fa-car"},{id:"sold-filter-version",key:"version",label:"Phiên Bản",options:J,icon:"fa-cogs"},{id:"sold-filter-exterior",key:"exterior",label:"Ngoại Thất",options:Q,icon:"fa-palette"}];return c?e.jsxs("div",{className:"flex items-center justify-center h-full text-center p-8 bg-surface-card rounded-lg shadow-xl",children:[e.jsx("i",{className:"fas fa-exclamation-triangle fa-3x text-danger"}),e.jsx("p",{className:"mt-4 text-lg font-semibold",children:"Không thể tải dữ liệu"}),e.jsx("p",{className:"mt-2 text-sm text-text-secondary max-w-sm",children:c}),e.jsx("button",{onClick:o,className:"mt-6 btn-primary",children:"Thử lại"})]}):e.jsxs("div",{className:"flex flex-col h-full animate-fade-in space-y-3 p-2 md:p-0",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-3 bg-surface-card p-3 rounded-xl shadow-sm border border-border-primary",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-accent-primary/10 rounded-lg",children:e.jsx("i",{className:"fa-solid fa-chart-line text-accent-primary text-xl"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-text-primary",children:"Lịch Sử Bán Hàng"}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Theo dõi doanh số và hiệu quả kinh doanh"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(ce,{selectedMonth:p,selectedYear:d,onMonthChange:g,onYearChange:w})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx(X,{icon:"fa-car",title:`Tổng Xe (${p!==null?_[p]:"Năm"})`,value:$.total,size:"compact"}),e.jsx(X,{icon:"fa-trophy",title:"Xe Bán Chạy Nhất",value:$.topCarDisplay,size:"compact"}),e.jsx(X,{icon:"fa-crown",title:"TVBH Xuất Sắc Nhất",value:$.topTvbhDisplay,size:"compact"})]}),e.jsxs("div",{className:"flex-grow flex flex-col lg:flex-row gap-3 min-h-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col bg-surface-card rounded-xl shadow-md border border-border-primary min-w-0",children:[e.jsx("div",{className:"p-3 border-b border-border-primary",children:e.jsx(se,{filters:h,onFilterChange:V,onReset:U,dropdowns:P,searchPlaceholder:"Tìm kiếm...",totalCount:b.length,onRefresh:o,isLoading:n,plain:!0,size:"compact",searchable:!1})}),e.jsx("div",{className:"flex-grow overflow-auto hidden-scrollbar p-1",children:e.jsx(re,{orders:R,onRowClick:W,selectedOrder:T,sortConfig:m,onSort:x,startIndex:(a-1)*u,viewMode:"sold"})}),e.jsx("div",{className:"p-2 border-t border-border-primary",children:A>0&&e.jsx(le,{currentPage:a,totalPages:A,onPageChange:y,onLoadMore:()=>{},isLoadingArchives:!1,isLastArchive:!0})})]}),e.jsxs("div",{className:`
                    fixed inset-y-0 right-0 w-full md:w-[400px] bg-surface-card shadow-2xl z-50 transform transition-transform duration-300 ease-in-out
                    lg:relative lg:transform-none lg:w-[450px] lg:shadow-none lg:z-0 lg:flex lg:flex-col lg:bg-transparent
                    ${z?"translate-x-0":"translate-x-full lg:translate-x-0"}
                `,children:[e.jsx("div",{className:"lg:hidden absolute top-4 right-4 z-50",children:e.jsx("button",{onClick:()=>B(!1),className:"p-2 bg-surface-ground rounded-full shadow-md text-text-secondary",children:e.jsx("i",{className:"fas fa-times"})})}),e.jsxs("div",{className:"h-full flex flex-col bg-surface-card lg:rounded-xl lg:border lg:border-border-primary lg:shadow-md overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-border-primary bg-surface-ground/50",children:e.jsx("h3",{className:"font-bold text-text-primary",children:"Chi Tiết Đơn Hàng"})}),e.jsx("div",{className:"flex-grow overflow-y-auto hidden-scrollbar p-0",children:e.jsx(ie,{order:T,showToast:t})})]})]})]}),z&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 lg:hidden",onClick:()=>B(!1)})]})};export{me as default};
