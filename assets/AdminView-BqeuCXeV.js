import{j as e}from"./vendor-pdf-Dyj7cThZ.js";import{r as s,R as He}from"./vendor-react-KfUPlHYY.js";import{h as q}from"./vendor-utils-C5S46NFB.js";import{S as Ke,B as je,C as Le,t as Ee,c as ze,P as rt,d as it,i as te,e as Re,u as Ne,n as Be,y as Xe,f as lt,h as ct,g as ot,a as dt,j as ht,p as xt,k as mt,r as Fe,b as ut,l as gt,A as ie,E as pt}from"./index-CT-jfnFE.js";const Oe=({text:t,showToast:g,className:i,label:f,wrap:c=!1})=>{if(!t||t==="N/A")return e.jsxs("div",{className:i,children:[f?`${f}: `:"","N/A"]});const o=r=>{r.stopPropagation(),navigator.clipboard.writeText(t).then(()=>{g("Đã sao chép!",`${t} đã được sao chép.`,"success",2e3)}).catch(()=>g("Lỗi","Không thể sao chép.","error"))};return e.jsxs("div",{className:`cursor-pointer ${i}`,title:`Click để sao chép: ${t}`,onClick:o,children:[e.jsx("span",{children:f?`${f}: `:""}),e.jsx("span",{className:c?"break-words":"truncate",children:t})]})},ft=({status:t,viewType:g,onAction:i,onToggle:f,isProcessing:c})=>{const[o,r]=s.useState(!1),N=He.useRef(null),m=a=>{r(a),f(a)};s.useEffect(()=>{const a=p=>{N.current&&!N.current.contains(p.target)&&m(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[f]);const w=t.toLowerCase(),I=(g==="invoices"?[{type:"approve",label:"Phê Duyệt",icon:"fa-check-double",condition:w==="chờ phê duyệt"||w==="đã bổ sung"},{type:"supplement",label:"Y/C Bổ Sung",icon:"fa-exclamation-triangle",condition:w==="chờ phê duyệt"||w==="đã bổ sung"},{type:"pendingSignature",label:"Chờ Ký HĐ",icon:"fa-signature",condition:w==="đã phê duyệt"},{type:"uploadInvoice",label:"Tải Lên HĐ",icon:"fa-upload",condition:w==="chờ ký hóa đơn"},{type:"resend",label:"Gửi lại Email",icon:"fa-paper-plane",condition:w==="yêu cầu bổ sung"||w==="đã xuất hóa đơn"},{type:"cancel",label:"Hủy Yêu Cầu",icon:"fa-trash-alt",isDanger:!0,condition:w!=="đã xuất hóa đơn"&&w!=="đã hủy"}]:g==="pending"?[{type:"manualMatch",label:"Ghép Thủ Công",icon:"fa-link",condition:!0},{type:"cancel",label:"Hủy Yêu Cầu",icon:"fa-trash-alt",isDanger:!0,condition:!0}]:g==="paired"?[{type:"requestInvoice",label:"Y/C Xuất Hóa Đơn",icon:"fa-file-invoice-dollar",condition:!0},{type:"unmatch",label:"Hủy Ghép Xe",icon:"fa-unlink",isDanger:!0,condition:!0}]:[]).filter(a=>a.condition),u=a=>{i(a.type),m(!1)};return e.jsxs("div",{className:"relative",ref:N,onClick:a=>a.stopPropagation(),children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),!c&&m(!o)},className:`w-8 h-8 rounded-full ${c?"bg-surface-ground cursor-wait":"hover:bg-surface-hover"} flex items-center justify-center`,children:c?e.jsx("i",{className:"fas fa-spinner fa-spin text-accent-primary"}):e.jsx("i",{className:"fas fa-ellipsis-h text-text-secondary"})}),o&&e.jsxs("div",{className:"absolute right-0 mt-1 w-48 bg-surface-card border border-border-secondary rounded-lg shadow-2xl z-20 p-0.5 animate-fade-in-scale-up",style:{animationDuration:"150ms"},children:[I.map(a=>e.jsxs("button",{onClick:()=>u(a),className:`flex items-center gap-3 w-full text-left px-2 py-1.5 text-sm font-medium rounded-md ${a.isDanger?"text-danger hover:bg-danger-bg":"text-text-primary hover:bg-surface-hover"}`,children:[e.jsx("i",{className:`fas ${a.icon} fa-fw w-5 text-center`}),e.jsx("span",{children:a.label})]},a.type)),I.length===0&&e.jsx("div",{className:"px-3 py-2 text-sm text-text-secondary text-center",children:"Không có hành động"})]})]})},bt=({order:t,index:g,viewType:i,selectedRows:f,onToggleRow:c,onAction:o,showToast:r,suggestions:N,onShowSuggestions:m,processingId:w})=>{const I=t["Số đơn hàng"],u=t["Trạng thái xử lý"]||t["Kết quả"]||"N/A",a=N==null?void 0:N.get(I),p=f.has(I),x=w===I,H=C=>{o(C,t)};return e.jsxs("div",{className:`bg-white rounded-xl border transition-all duration-200 group relative ${p?"border-accent-primary shadow-md bg-accent-primary/5":"border-border-primary hover:border-accent-primary/50 hover:shadow-sm"}`,onClick:()=>c(I),children:[e.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-1 rounded-l-xl transition-colors ${p?"bg-accent-primary":"bg-transparent group-hover:bg-accent-primary/30"}`}),e.jsxs("div",{className:"p-3 pl-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0 pr-2",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("h3",{className:"font-bold text-text-primary truncate",title:t["Tên khách hàng"],children:t["Tên khách hàng"]}),e.jsx("span",{className:"text-[10px] font-mono text-text-secondary bg-surface-ground px-1.5 rounded border border-border-secondary",children:g+1})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-secondary",children:[e.jsx(Oe,{text:I,showToast:r,className:"font-mono hover:text-accent-primary transition-colors"}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"truncate",title:t["Tên tư vấn bán hàng"],children:t["Tên tư vấn bán hàng"]})]})]}),e.jsx("div",{className:"flex-shrink-0",onClick:C=>C.stopPropagation(),children:e.jsx(Ke,{status:u,size:"sm"})})]}),e.jsxs("div",{className:"bg-surface-ground rounded-lg p-2 mb-2 border border-border-secondary/50",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm text-text-primary",children:t["Dòng xe"]}),e.jsx("div",{className:"text-xs text-text-secondary",children:t["Phiên bản"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs font-medium text-text-primary",children:t["Ngoại thất"]}),e.jsx("div",{className:"text-xs text-text-secondary",children:t["Nội thất"]})]})]}),i==="paired"&&e.jsxs("div",{className:"mt-1.5 pt-1.5 border-t border-border-secondary/50 flex justify-between items-center",children:[e.jsx("span",{className:"text-[10px] text-text-secondary uppercase font-bold",children:"VIN"}),e.jsx(Oe,{text:t.VIN||"",showToast:r,className:"font-mono font-bold text-accent-primary text-xs"})]})]}),e.jsxs("div",{className:"flex justify-between items-end",children:[e.jsx("div",{className:"text-xs text-text-secondary space-y-0.5",children:i==="pending"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5",title:"Ngày cọc",children:[e.jsx("i",{className:"fas fa-money-bill-wave text-text-placeholder w-3"}),e.jsx("span",{children:t["Ngày cọc"]?q(t["Ngày cọc"]).format("DD/MM"):"--"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",title:"Ngày yêu cầu",children:[e.jsx("i",{className:"fas fa-clock text-text-placeholder w-3"}),e.jsx("span",{className:q(t["Thời gian nhập"]).isBefore(q().subtract(3,"days"))?"text-danger font-medium":"",children:t["Thời gian nhập"]?q(t["Thời gian nhập"]).format("DD/MM"):"--"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1.5",title:"Ngày cọc",children:[e.jsx("i",{className:"fas fa-money-bill-wave text-text-placeholder w-3"}),e.jsx("span",{children:t["Ngày cọc"]?q(t["Ngày cọc"]).format("DD/MM"):"--"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",title:"Ngày ghép",children:[e.jsx("i",{className:"fas fa-link text-text-placeholder w-3"}),e.jsx("span",{children:t["Thời gian ghép"]?q(t["Thời gian ghép"]).format("DD/MM"):"--"})]})]})}),e.jsxs("div",{className:"flex items-center gap-1",onClick:C=>C.stopPropagation(),children:[i==="pending"&&a&&a.length>0&&m&&e.jsx("button",{onClick:C=>{C.stopPropagation(),m(t,a)},className:"w-8 h-8 rounded-full bg-yellow-100 text-yellow-600 hover:bg-yellow-200 flex items-center justify-center transition-colors shadow-sm animate-pulse",title:`Có ${a.length} xe gợi ý`,children:e.jsx("i",{className:"fas fa-lightbulb"})}),e.jsx(ft,{status:u,viewType:i,onAction:H,onToggle:()=>{},isProcessing:x})]})]})]})]})},Ue=({orders:t,viewType:g,sortConfig:i,onSort:f,selectedRows:c,onToggleRow:o,onToggleAllRows:r,onAction:N,showToast:m,suggestions:w,onShowSuggestions:I,processingId:u})=>{const a=t.length>0&&c.size===t.length,p=[{key:"Thời gian nhập",label:"Ngày Yêu Cầu"},{key:"Tên khách hàng",label:"Tên Khách Hàng"},{key:"Dòng xe",label:"Dòng Xe"},{key:"Kết quả",label:"Trạng Thái"}];return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white border-b border-border-secondary sticky top-0 z-10 shadow-sm",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none group",children:[e.jsx("input",{type:"checkbox",className:"custom-checkbox",checked:a,onChange:r}),e.jsx("span",{className:"text-sm font-medium text-text-secondary group-hover:text-text-primary transition-colors",children:c.size>0?`Đã chọn ${c.size}`:"Chọn tất cả"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-text-secondary hidden sm:inline",children:"Sắp xếp:"}),e.jsx("select",{className:"text-xs border-none bg-surface-ground rounded-lg py-1.5 pl-2 pr-8 font-medium text-text-primary focus:ring-1 focus:ring-accent-primary cursor-pointer",value:(i==null?void 0:i.key)||"",onChange:x=>f(x.target.value),children:p.map(x=>e.jsx("option",{value:x.key,children:x.label},x.key))}),e.jsx("button",{onClick:()=>f(i==null?void 0:i.key),className:"w-7 h-7 flex items-center justify-center rounded-lg bg-surface-ground hover:bg-surface-hover text-text-secondary transition-colors",title:(i==null?void 0:i.direction)==="asc"?"Tăng dần":"Giảm dần",children:e.jsx("i",{className:`fas fa-sort-amount-${(i==null?void 0:i.direction)==="asc"?"down-alt":"down"}`})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 custom-scrollbar bg-surface-ground",children:t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-text-placeholder",children:[e.jsx("i",{className:"fas fa-box-open text-4xl mb-3 opacity-50"}),e.jsx("p",{children:"Không có đơn hàng nào"})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:t.map((x,H)=>e.jsx(bt,{order:x,index:H,viewType:g,selectedRows:c,onToggleRow:o,onAction:N,showToast:m,suggestions:w,onShowSuggestions:I,processingId:u},x["Số đơn hàng"]))})})]})},Ie=({text:t,showToast:g,className:i,label:f,wrap:c=!1})=>{if(!t||t==="N/A")return e.jsxs("div",{className:i,children:[f?`${f}: `:"","N/A"]});const o=r=>{r.stopPropagation(),navigator.clipboard.writeText(t).then(()=>{g("Đã sao chép!",`${t} đã được sao chép.`,"success",2e3)}).catch(()=>g("Lỗi","Không thể sao chép.","error"))};return e.jsxs("div",{className:`cursor-pointer ${i}`,title:`Click để sao chép: ${t}`,onClick:o,children:[e.jsx("span",{children:f?`${f}: `:""}),e.jsx("span",{className:c?"break-words":"truncate",children:t})]})},yt=({url:t,label:g,icon:i,onPreview:f})=>{const[c,o]=s.useState(null),[r,N]=s.useState(!1),[m,w]=s.useState(0),[I,u]=s.useState(!1),a=s.useMemo(()=>{if(!t)return"unknown";const H=t.toLowerCase();return H.includes("drive.google.com")?"drive":H.includes(".pdf")?"pdf":/\.(jpg|jpeg|png|gif|webp|bmp|svg)/.test(H)?"image":"other"},[t]);s.useEffect(()=>{N(!1),w(0),u(!1),o(a==="drive"&&t?Ee(t,500):a==="image"&&t?t:null)},[t,a]);const p=()=>{if(a!=="drive"||!t){N(!0);return}const H=ze(t);if(!H){N(!0);return}m===0?(w(1),o(`https://lh3.googleusercontent.com/d/${H}=w500`)):m===1?(w(2),u(!0)):N(!0)},x=s.useMemo(()=>{if(a==="drive"&&t){const H=ze(t);if(H)return`https://drive.google.com/file/d/${H}/preview`}return null},[t,a]);return e.jsxs("div",{className:`flex flex-col rounded-lg border transition-all overflow-hidden group ${t?"border-border-secondary bg-surface-ground cursor-pointer hover:shadow-md hover:border-accent-primary":"border-border-secondary/50 bg-surface-ground/50 opacity-60"}`,onClick:()=>t&&f(),children:[e.jsx("div",{className:`w-full h-24 md:h-40 flex items-center justify-center overflow-hidden border-b border-border-secondary relative ${t?"bg-white":"bg-gray-100"}`,children:(a==="pdf"||a==="drive"&&g.toLowerCase().includes("pdf"))&&t?e.jsx(rt,{url:t,width:200,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"}):I&&x?e.jsxs(e.Fragment,{children:[e.jsx("iframe",{src:x,className:"w-full h-full border-0 pointer-events-none scale-[1.5] origin-top-left",title:g,tabIndex:-1}),e.jsx("div",{className:"absolute inset-0 bg-transparent z-10"})]}):c&&!r?e.jsx("img",{src:c,alt:g,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110",onError:p}):e.jsx("i",{className:`fas ${a==="pdf"?"fa-file-pdf text-red-500":i+(t?" text-accent-primary":" text-gray-400")} text-5xl`})}),e.jsxs("div",{className:"p-1",children:[e.jsx("div",{className:"font-bold text-[10px] md:text-xs text-text-primary truncate",title:g,children:g}),e.jsxs("div",{className:"flex items-center justify-between h-5",children:[t?e.jsx("div",{}):e.jsx("span",{className:"text-[10px] px-1.5 rounded-full bg-gray-100 text-gray-400",children:"Chưa có"}),t&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{href:it(t),target:"_blank",rel:"noopener noreferrer",className:"text-text-placeholder hover:text-accent-primary transition-colors",title:"Tải xuống",onClick:H=>H.stopPropagation(),children:e.jsx("i",{className:"fas fa-download text-xs"})}),e.jsx("i",{className:"fas fa-external-link-alt text-xs text-text-placeholder group-hover:text-accent-primary transition-colors"})]})]})]})]})},vt=({orders:t,onAction:g,showToast:i,onOpenFilePreview:f,onUpdateInvoiceDetails:c,selectedFolder:o,selectedOrderId:r,onFolderChange:N,onOrderSelect:m,processingId:w,processingActionType:I})=>{const[u,a]=s.useState(!1),[p,x]=s.useState(!1),[H,C]=s.useState({engineNumber:"",policy:"",commission:"",vpoint:""}),k=He.useRef(null),R=l=>{var _;const $=(_=l.target.files)==null?void 0:_[0];$&&b&&g("uploadInvoice",b,{file:$}),l.target&&(l.target.value="")},d=s.useMemo(()=>t.filter(l=>{const $=(l["Trạng thái xử lý"]||l["Kết quả"]||"").toLowerCase();switch(o){case"pending_approval":return $==="chờ phê duyệt";case"approved":return $==="đã phê duyệt";case"request_supplement":return $==="yêu cầu bổ sung";case"supplemented":return $==="đã bổ sung";case"pending_signature":return $==="chờ ký hóa đơn"||$==="chờ ký hóa đơn";case"completed":return $==="đã xuất hóa đơn";case"all":return!0;default:return!0}}),[t,o]),b=s.useMemo(()=>t.find(l=>l["Số đơn hàng"]===r),[t,r]);s.useEffect(()=>{if(d.length>0){const l=d[0]["Số đơn hàng"];m(l)}},[o]),s.useEffect(()=>{b&&!u&&C({engineNumber:b["Số động cơ"]||"",policy:b["CHÍNH SÁCH"]||"",commission:b["Hoa hồng ứng"]||"",vpoint:b["Điểm Vpoint sử dụng"]||""})},[b,u]);const h=async()=>{if(!b||!c)return;x(!0);const l=await c(b["Số đơn hàng"],H);x(!1),l&&a(!1)},V=[{id:"pending_approval",label:"Chờ Phê Duyệt",icon:"fa-clock",count:t.filter(l=>(l["Trạng thái xử lý"]||l["Kết quả"]||"").toLowerCase()==="chờ phê duyệt").length},{id:"approved",label:"Đã Phê Duyệt",icon:"fa-check",count:t.filter(l=>(l["Trạng thái xử lý"]||l["Kết quả"]||"").toLowerCase()==="đã phê duyệt").length},{id:"request_supplement",label:"Yêu Cầu Bổ Sung",icon:"fa-exclamation-circle",count:t.filter(l=>(l["Trạng thái xử lý"]||l["Kết quả"]||"").toLowerCase()==="yêu cầu bổ sung").length},{id:"supplemented",label:"Đã Bổ Sung",icon:"fa-plus-circle",count:t.filter(l=>(l["Trạng thái xử lý"]||l["Kết quả"]||"").toLowerCase()==="đã bổ sung").length},{id:"pending_signature",label:"Chờ Ký Hóa Đơn",icon:"fa-file-signature",count:t.filter(l=>["chờ ký hóa đơn","chờ ký hóa đơn"].includes((l["Trạng thái xử lý"]||l["Kết quả"]||"").toLowerCase())).length},{id:"completed",label:"Đã Xuất Hóa Đơn",icon:"fa-check-double",count:t.filter(l=>(l["Trạng thái xử lý"]||l["Kết quả"]||"").toLowerCase()==="đã xuất hóa đơn").length},{id:"all",label:"Tất Cả",icon:"fa-list",count:t.length}],X=l=>{const $=l.toLowerCase();return[{type:"approve",label:"Phê Duyệt",icon:"fa-check-double",variant:"primary",condition:$==="chờ phê duyệt"||$==="đã bổ sung"},{type:"supplement",label:"Yêu Cầu Bổ Sung",icon:"fa-exclamation-triangle",variant:"secondary",condition:$==="chờ phê duyệt"||$==="đã bổ sung"},{type:"pendingSignature",label:"Chuyển Chờ Ký",icon:"fa-signature",variant:"primary",condition:$==="đã phê duyệt"},{type:"uploadInvoice",label:"Tải Lên Hóa Đơn",icon:"fa-upload",variant:"success",condition:$==="chờ ký hóa đơn",onClick:()=>{var _;return(_=k.current)==null?void 0:_.click()}},{type:"resend",label:"Gửi Lại Email",icon:"fa-paper-plane",variant:"secondary",condition:$==="yêu cầu bổ sung"||$==="đã xuất hóa đơn"},{type:"cancel",label:"Hủy Yêu Cầu",icon:"fa-trash-alt",variant:"danger",condition:$!=="đã xuất hóa đơn"&&$!=="đã hủy"}].filter(_=>_.condition)},[L,Y]=s.useState("folders"),U=l=>{N(l),Y("list")},J=l=>{m(l),l&&Y("detail")},[W,v]=s.useState(null),[T,y]=s.useState(null),D=50,Z=l=>{y(null),v(l.targetTouches[0].clientX)},ne=l=>{y(l.targetTouches[0].clientX)},Q=()=>{if(!W||!T)return;const l=W-T,$=l>D,_=l<-D;if($||_){const ae=d.findIndex(me=>me["Số đơn hàng"]===r);if(ae===-1)return;$&&ae<d.length-1?J(d[ae+1]["Số đơn hàng"]):_&&ae>0&&J(d[ae-1]["Số đơn hàng"])}},le=s.useMemo(()=>{if(o!=="pending_signature")return null;const l={};return d.forEach($=>{const _=$["Ngày xuất hóa đơn"],ae=_?q(_).format("DD/MM/YYYY"):"Chưa có ngày";l[ae]||(l[ae]=[]),l[ae].push($)}),Object.entries(l).sort(($,_)=>$[0]==="Chưa có ngày"?1:_[0]==="Chưa có ngày"?-1:q($[0],"DD/MM/YYYY").valueOf()-q(_[0],"DD/MM/YYYY").valueOf())},[d,o]),ce=l=>e.jsx("div",{onClick:()=>J(l["Số đơn hàng"]),className:`p-3 cursor-pointer hover:bg-surface-hover transition-all duration-200 group ${r===l["Số đơn hàng"]?"bg-accent-primary/10 border-l-4 border-accent-primary shadow-inner":"border-l-4 border-transparent"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0 pr-3",children:[e.jsx("div",{className:"text-text-primary text-sm truncate mb-0.5",children:l["Tên khách hàng"]}),e.jsxs("div",{className:"text-xs text-text-secondary truncate",children:[l["Dòng xe"]," ",e.jsx("span",{className:"text-text-placeholder",children:"•"})," ",l["Phiên bản"]]})]}),e.jsx("div",{className:"w-16 h-10 flex-shrink-0",children:e.jsx(Le,{model:l["Dòng xe"],exteriorColor:l["Ngoại thất"],className:"w-full h-full object-contain opacity-50 group-hover:opacity-100 group-hover:scale-110 transition-all duration-300"})})]})},l["Số đơn hàng"]);return e.jsxs("div",{className:"flex h-full bg-surface-card rounded-xl shadow-md border border-border-primary overflow-hidden animate-fade-in relative",children:[e.jsx("div",{className:`w-full md:w-64 flex-shrink-0 border-r border-border-primary bg-surface-ground flex flex-col ${L!=="folders"?"hidden md:flex":"flex"}`,children:e.jsx("nav",{className:"flex-1 p-2 space-y-1 overflow-y-auto",children:V.map(l=>e.jsxs("button",{onClick:()=>U(l.id),className:`w-full flex items-center justify-between px-3 py-2 rounded-lg text-xs font-medium transition-colors ${o===l.id?"bg-accent-primary/10 text-accent-primary":"text-text-secondary hover:bg-surface-hover hover:text-text-primary"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("i",{className:`fas ${l.icon} w-5 text-center`}),e.jsx("span",{children:l.label})]}),l.count>0&&e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${o===l.id?"bg-accent-primary text-white":"bg-surface-hover text-text-secondary"}`,children:l.count})]},l.id))})}),e.jsxs("div",{className:`w-full md:w-64 flex-shrink-0 border-r border-border-primary flex flex-col bg-white ${L!=="list"?"hidden md:flex":"flex"}`,children:[e.jsxs("div",{className:"md:hidden p-2 border-b border-border-secondary flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Y("folders"),className:"p-2 hover:bg-surface-ground rounded-full",children:e.jsx("i",{className:"fas fa-arrow-left text-text-secondary"})}),e.jsx("span",{className:"font-bold text-sm",children:"Danh sách"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:d.length===0?e.jsx("div",{className:"p-8 text-center text-text-placeholder text-sm",children:"Không tìm thấy đơn hàng nào."}):e.jsx("div",{className:"divide-y divide-border-secondary",children:le?le.map(([l,$])=>e.jsxs(He.Fragment,{children:[e.jsxs("div",{className:"bg-surface-ground px-3 py-2 text-xs font-bold text-text-secondary sticky top-0 z-10 border-b border-border-secondary flex justify-between items-center shadow-sm",children:[e.jsx("span",{children:l}),e.jsx("span",{className:"bg-surface-card px-1.5 py-0.5 rounded-full text-[10px] border border-border-secondary",children:$.length})]}),$.map(_=>ce(_))]},l)):d.map(l=>ce(l))})})]}),e.jsx("div",{className:`flex-1 flex flex-col bg-surface-ground min-w-0 ${L!=="detail"?"hidden md:flex":"flex"}`,onTouchStart:Z,onTouchMove:ne,onTouchEnd:Q,children:b?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-4 py-3 bg-white border-b border-border-primary flex flex-col md:flex-row justify-between items-start md:items-center shadow-sm z-10 gap-3 md:gap-0",children:[e.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto",children:[e.jsx("button",{onClick:()=>Y("list"),className:"md:hidden p-1 hover:bg-surface-ground rounded-full mr-1",children:e.jsx("i",{className:"fas fa-arrow-left text-text-secondary"})}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-accent-primary/10 flex items-center justify-center text-accent-primary font-bold text-base flex-shrink-0",children:b["Tên khách hàng"].charAt(0)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h2",{className:"text-base font-bold text-text-primary leading-tight cursor-pointer hover:text-accent-primary transition-colors truncate",title:"Click để sao chép tên khách hàng",onClick:l=>{l.stopPropagation(),navigator.clipboard.writeText(b["Tên khách hàng"]),i("Đã sao chép","Tên khách hàng đã được sao chép","success")},children:b["Tên khách hàng"]}),e.jsxs("div",{className:"text-xs text-text-secondary flex items-center gap-2 mt-0.5",children:[e.jsx("span",{className:"font-mono cursor-pointer hover:text-accent-primary border-b border-dashed border-transparent hover:border-accent-primary transition-all truncate",title:"Click để sao chép số đơn hàng",onClick:l=>{l.stopPropagation(),navigator.clipboard.writeText(b["Số đơn hàng"]),i("Đã sao chép","Số đơn hàng đã được sao chép","success")},children:b["Số đơn hàng"]}),e.jsx("span",{children:"•"}),e.jsx("span",{className:"truncate",children:b["Tên tư vấn bán hàng"]})]})]})]}),e.jsx("div",{className:"flex gap-2 w-full md:w-auto overflow-x-auto pb-1 md:pb-0 no-scrollbar",children:X(b["Trạng thái xử lý"]||b["Kết quả"]||"").map(l=>e.jsx(je,{onClick:l.onClick?l.onClick:()=>g(l.type,b),variant:l.variant,size:"sm",leftIcon:e.jsx("i",{className:`fas ${l.icon}`}),className:"whitespace-nowrap",isLoading:w===b["Số đơn hàng"]&&I===l.type,disabled:!!w,children:l.label},l.type))})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 custom-scrollbar",children:e.jsxs("div",{className:"max-w-5xl mx-auto space-y-2",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-border-primary px-3 py-2 flex items-center justify-between shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-xs text-text-secondary",children:"Trạng thái:"}),e.jsx(Ke,{status:b["Trạng thái xử lý"]||b["Kết quả"]||"",size:"sm"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"text-text-secondary",children:"Ngày yêu cầu:"}),e.jsx("span",{className:"font-medium text-text-primary",children:q(b["Thời gian nhập"]).format("HH:mm DD/MM/YYYY")})]}),b["Ngày xuất hóa đơn"]&&e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"text-text-secondary",children:"Ngày XHĐ:"}),e.jsx("span",{className:"font-medium text-text-primary",children:q(b["Ngày xuất hóa đơn"]).format("DD/MM/YYYY")})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-border-primary shadow-sm",children:[e.jsx("div",{className:"bg-gray-100 px-3 py-1.5 border-b border-border-secondary",children:e.jsx("h3",{className:"text-xs font-bold text-text-secondary uppercase tracking-wider",children:"Thông Tin Xe"})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 p-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-text-secondary block mb-0.5 uppercase",children:"Dòng xe / Phiên bản"}),e.jsxs("div",{className:"text-sm font-medium truncate",title:`${b["Dòng xe"]} - ${b["Phiên bản"]}`,children:[b["Dòng xe"]," - ",b["Phiên bản"]]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-text-secondary block mb-0.5 uppercase",children:"Màu sắc"}),e.jsxs("div",{className:"text-sm font-medium truncate",title:`${b["Ngoại thất"]} / ${b["Nội thất"]}`,children:[b["Ngoại thất"]," / ",b["Nội thất"]]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-text-secondary block mb-0.5 uppercase",children:"Số VIN"}),e.jsx(Ie,{text:b.VIN||"",showToast:i,className:"font-mono font-bold text-accent-primary text-sm truncate"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-text-secondary block mb-0.5 uppercase",children:"Số Máy"}),u?e.jsx("input",{type:"text",value:H.engineNumber,onChange:l=>C({...H,engineNumber:l.target.value}),className:"w-full text-xs border border-accent-primary rounded px-2 py-1"}):e.jsx(Ie,{text:b["Số động cơ"]||"",showToast:i,className:"font-mono text-sm truncate"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-border-primary shadow-sm",children:[e.jsxs("div",{className:"bg-gray-100 px-3 py-1.5 border-b border-border-secondary flex justify-between items-center rounded-t-lg",children:[e.jsx("h3",{className:"text-xs font-bold text-text-secondary uppercase tracking-wider",children:"Thanh Toán & Chính Sách"}),u?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(je,{onClick:h,disabled:p,variant:"success",size:"sm",className:"!p-1 h-auto",leftIcon:e.jsx("i",{className:"fas fa-save"}),children:"Lưu"}),e.jsx(je,{onClick:()=>a(!1),disabled:p,variant:"danger",size:"sm",className:"!p-1 h-auto",leftIcon:e.jsx("i",{className:"fas fa-times"}),children:"Hủy"})]}):e.jsx(je,{onClick:()=>a(!0),variant:"ghost",size:"sm",className:"!p-1 h-auto text-accent-primary hover:text-accent-primary-hover",leftIcon:e.jsx("i",{className:"fas fa-edit"}),children:"Sửa"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 p-2",children:[e.jsxs("div",{className:"md:col-span-2 flex flex-col",children:[e.jsx("label",{className:"text-[10px] text-text-secondary block mb-0.5 uppercase font-semibold",children:"Chính Sách"}),u?e.jsx("textarea",{value:H.policy,onChange:l=>C({...H,policy:l.target.value}),className:"w-full text-xs border border-accent-primary rounded px-2 py-1.5 flex-1 min-h-[80px] resize-none focus:outline-none focus:ring-1 focus:ring-accent-primary leading-tight",placeholder:"Nhập nội dung chính sách..."}):e.jsx("div",{className:"text-xs bg-surface-ground rounded border border-border-secondary flex-1 min-h-[60px] max-h-[100px] overflow-y-auto",children:(()=>{const l=b["CHÍNH SÁCH"];if(!l)return e.jsx("div",{className:"p-2 text-gray-400",children:"Không có chính sách"});const $=String(l).split(", ").filter(F=>F.trim()),_=Math.ceil($.length/2),ae=$.slice(0,_),me=$.slice(_);return e.jsxs("div",{className:"grid grid-cols-2 h-full divide-x divide-border-secondary",children:[e.jsx("div",{className:"flex flex-col gap-1 p-2",children:ae.map((F,re)=>e.jsxs("div",{className:"leading-tight flex items-start",children:[e.jsx("span",{className:"mr-1.5 font-bold text-text-secondary",children:"-"}),e.jsx("span",{children:F})]},`l-${re}`))}),e.jsx("div",{className:"flex flex-col gap-1 p-2",children:me.map((F,re)=>e.jsxs("div",{className:"leading-tight flex items-start",children:[e.jsx("span",{className:"mr-1.5 font-bold text-text-secondary",children:"-"}),e.jsx("span",{children:F})]},`r-${re}`))})]})})()})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("label",{className:"text-[10px] text-text-secondary block mb-0.5 uppercase font-semibold",children:"Hoa Hồng Ứng"}),u?e.jsx("input",{type:"text",value:H.commission,onChange:l=>C({...H,commission:l.target.value}),className:"w-full text-xs border border-accent-primary rounded px-2 py-1 font-semibold h-full focus:outline-none focus:ring-1 focus:ring-accent-primary",placeholder:"Nhập số tiền..."}):e.jsx("div",{className:"h-full",children:e.jsx(Ie,{text:b["Hoa hồng ứng"]?Number(String(b["Hoa hồng ứng"]).replace(/[^0-9]/g,"")).toLocaleString("en-US")+" đ":"0 đ",showToast:i,className:"text-xs font-bold bg-surface-ground p-0 rounded border border-border-secondary w-full h-full flex items-center justify-center text-green-600 hover:bg-surface-hover transition-colors",wrap:!0})})]}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("label",{className:"text-[10px] text-text-secondary block mb-0.5 uppercase font-semibold",children:"Điểm Vpoint Sử Dụng"}),u?e.jsx("input",{type:"text",value:H.vpoint,onChange:l=>C({...H,vpoint:l.target.value}),className:"w-full text-xs border border-accent-primary rounded px-2 py-1 font-semibold h-full focus:outline-none focus:ring-1 focus:ring-accent-primary",placeholder:"Nhập điểm..."}):e.jsx("div",{className:"h-full",children:e.jsx(Ie,{text:b["Điểm Vpoint sử dụng"]?Number(String(b["Điểm Vpoint sử dụng"]).replace(/[^0-9]/g,"")).toLocaleString("en-US")+" Điểm":"0 Điểm",showToast:i,className:"text-xs font-bold bg-surface-ground p-0 rounded border border-border-secondary w-full h-full flex items-center justify-center text-blue-600 hover:bg-surface-hover transition-colors",wrap:!0})})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-border-primary shadow-sm flex flex-col h-full",children:[e.jsx("div",{className:"bg-gray-100 px-3 py-1.5 border-b border-border-secondary",children:e.jsx("h3",{className:"text-xs font-bold text-text-secondary uppercase tracking-wider",children:"Hồ Sơ Đính Kèm"})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 p-2",children:[{key:"LinkHopDong",label:"Hợp đồng",icon:"fa-file-contract"},{key:"LinkDeNghiXHD",label:"Đề nghị XHĐ",icon:"fa-file-invoice"},{key:"LinkHoaDonDaXuat",label:"Hóa Đơn Đã Xuất",icon:"fa-file-invoice-dollar"}].map(l=>{const $=b[l.key];return e.jsx(yt,{url:$,label:l.label,icon:l.icon,onPreview:()=>$&&f($,`${l.label} - ${b["Tên khách hàng"]}`)},l.key)})})]})]})})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-text-placeholder",children:[e.jsx("i",{className:"fas fa-inbox text-6xl mb-4 opacity-20"}),e.jsx("p",{children:"Chọn một đơn hàng để xem chi tiết"})]})}),e.jsx("input",{type:"file",ref:k,className:"hidden",accept:".pdf,.jpeg,.png,.jpg",onChange:R})]})},Nt=({pendingOrders:t,pairedOrders:g,stockData:i,onAction:f,filters:c,showToast:o,activeTab:r,selectedOrderId:N,onTabChange:m,onOrderSelect:w})=>{const[I,u]=s.useState("requests"),a=d=>!d.VIN||String(d["Kết quả"]||"").toLowerCase().includes("chưa"),p=s.useMemo(()=>{const d=(c==null?void 0:c.keyword)||"";let b=r==="pending"?t:g;return d&&(b=[...t,...g]),b.filter(h=>!(!(!d||te(h["Tên khách hàng"],d)||te(h["Số đơn hàng"],d)||te(h["Dòng xe"],d)||te(h.VIN,d)||te(h["Phiên bản"],d)||te(h["Ngoại thất"],d)||te(h["Nội thất"],d)||te(h["Tên tư vấn bán hàng"],d)||te(h["CHÍNH SÁCH"],d)||te(h["Số động cơ"],d))||c&&(c.tvbh&&c.tvbh.length>0&&!c.tvbh.includes(h["Tên tư vấn bán hàng"])||c.dongXe&&c.dongXe.length>0&&!c.dongXe.includes(h["Dòng xe"])||c.version&&c.version.length>0&&!c.version.includes(h["Phiên bản"])||c.ngoaiThat&&c.ngoaiThat.length>0&&!c.ngoaiThat.includes(h["Ngoại thất"]))))},[r,t,g,c]),x=s.useMemo(()=>p.find(d=>d["Số đơn hàng"]===N),[p,N]);s.useEffect(()=>{p.length>0&&!N&&w(p[0]["Số đơn hàng"])},[p,N,w]);const H=s.useMemo(()=>!x||!a(x)?[]:i.filter(d=>{const b=d["Dòng xe"]===x["Dòng xe"],h=d["Ngoại thất"]===x["Ngoại thất"],V=d["Nội thất"]===x["Nội thất"],X=!x["Phiên bản"]||d["Phiên bản"]===x["Phiên bản"],L=!d["Trạng thái"]||d["Trạng thái"]==="Chưa ghép";return b&&h&&V&&X&&L}).map(d=>({...d,matchScore:100})),[x,i]),C=d=>i.some(V=>V["Dòng xe"]===d["Dòng xe"]&&V["Ngoại thất"]===d["Ngoại thất"]&&V["Nội thất"]===d["Nội thất"]&&(!V["Trạng thái"]||V["Trạng thái"]==="Chưa ghép"))?"success":i.some(V=>V["Dòng xe"]===d["Dòng xe"]&&(!V["Trạng thái"]||V["Trạng thái"]==="Chưa ghép"))?"warning":"danger",k=(d,b)=>{d&&(navigator.clipboard.writeText(d),o("Đã sao chép!",`${b} đã được sao chép.`,"success",2e3))},R=d=>{w(d),u("radar")};return e.jsxs("div",{className:"flex flex-col h-full bg-surface-card rounded-xl shadow-md border border-border-primary overflow-hidden animate-fade-in relative",children:[e.jsxs("div",{className:"md:hidden flex border-b border-border-primary bg-white flex-shrink-0",children:[e.jsxs("button",{onClick:()=>u("requests"),className:`flex-1 py-3 text-sm font-bold text-center border-b-2 transition-colors ${I==="requests"?"border-accent-primary text-accent-primary bg-accent-primary/5":"border-transparent text-text-secondary"}`,children:["Danh Sách (",p.length,")"]}),e.jsxs("button",{onClick:()=>u("radar"),className:`flex-1 py-3 text-sm font-bold text-center border-b-2 transition-colors ${I==="radar"?"border-accent-primary text-accent-primary bg-accent-primary/5":"border-transparent text-text-secondary"}`,children:["Chi Tiết (",x?"1":"0",")"]})]}),e.jsxs("div",{className:"flex-1 flex min-h-0 relative",children:[e.jsxs("div",{className:`w-full md:w-[30%] flex flex-col border-r border-border-primary bg-surface-ground absolute md:relative inset-0 z-10 md:z-auto transition-transform duration-300 ${I==="requests"?"translate-x-0":"-translate-x-full md:translate-x-0"}`,children:[e.jsxs("div",{className:"flex border-b border-border-primary bg-white flex-shrink-0",children:[e.jsxs("button",{onClick:()=>m("pending"),className:`flex-1 py-3 text-xs font-bold transition-colors uppercase tracking-wider ${r==="pending"?"text-accent-primary border-b-2 border-accent-primary bg-accent-primary/5":"text-text-secondary hover:bg-surface-hover border-b-2 border-transparent"}`,children:["Chờ Ghép (",t.length,")"]}),e.jsxs("button",{onClick:()=>m("paired"),className:`flex-1 py-3 text-xs font-bold transition-colors uppercase tracking-wider ${r==="paired"?"text-success border-b-2 border-success bg-success/5":"text-text-secondary hover:bg-surface-hover border-b-2 border-transparent"}`,children:["Đã Ghép (",g.length,")"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-2 space-y-2",children:[p.map(d=>{var L;const b=N===d["Số đơn hàng"],h=a(d),V=h?C(d):null,X=h?i.filter(Y=>Y["Dòng xe"]===d["Dòng xe"]&&Y["Ngoại thất"]===d["Ngoại thất"]&&Y["Nội thất"]===d["Nội thất"]&&(!d["Phiên bản"]||Y["Phiên bản"]===d["Phiên bản"])&&(!Y["Trạng thái"]||Y["Trạng thái"]==="Chưa ghép")).length:0;return e.jsxs("div",{onClick:()=>R(d["Số đơn hàng"]),className:`p-3 rounded-lg cursor-pointer transition-all duration-200 relative border ${b?"bg-white border-accent-primary shadow-md ring-1 ring-accent-primary/20":"bg-white border-border-secondary hover:border-accent-primary/50 hover:shadow-sm"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("h3",{className:`text-sm font-bold truncate pr-2 ${b?"text-accent-primary":"text-text-primary"}`,children:d["Tên khách hàng"]}),h&&e.jsxs("div",{className:"flex items-center gap-1",children:[X>0&&e.jsx("span",{className:"text-[9px] font-bold text-white bg-success px-1.5 py-0.5 rounded shadow-sm animate-pulse",children:"CÓ XE"}),e.jsx("div",{className:`w-2.5 h-2.5 rounded-full flex-shrink-0 ${V==="success"?"bg-success shadow-[0_0_8px_rgba(34,197,94,0.6)]":V==="warning"?"bg-warning":"bg-danger"}`})]}),!h&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[10px] font-mono font-bold text-success bg-success/10 px-1.5 py-0.5 rounded border border-success/20",children:(L=d.VIN)==null?void 0:L.slice(-6)}),e.jsx("i",{className:"fas fa-check-circle text-success text-xs"})]})]}),e.jsxs("div",{className:"text-xs text-text-secondary mb-1 truncate",children:[e.jsx("span",{className:"font-medium text-text-primary",children:d["Dòng xe"]}),e.jsx("span",{className:"mx-1 text-text-placeholder",children:"|"}),e.jsx("span",{children:d["Phiên bản"]})]}),e.jsxs("div",{className:"flex justify-between items-center text-[10px] text-text-secondary mt-2 pt-2 border-t border-border-secondary/30",children:[e.jsx("span",{className:"truncate max-w-[60%]",children:d["Tên tư vấn bán hàng"]}),e.jsx("span",{className:"font-mono",children:q(d["Thời gian nhập"]).format("DD/MM")})]})]},d["Số đơn hàng"])}),p.length===0&&e.jsx("div",{className:"text-center py-8 text-text-placeholder text-sm",children:"Không tìm thấy đơn hàng"})]})]}),e.jsx("div",{className:`w-full md:w-[70%] flex flex-col bg-surface-ground min-w-0 absolute md:relative inset-0 z-0 md:z-auto transition-transform duration-300 ${I==="radar"?"translate-x-0":"translate-x-full md:translate-x-0"}`,children:x?e.jsxs("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:"m-3 md:m-4 p-4 bg-white rounded-2xl border border-border-primary shadow-sm flex flex-col md:flex-row justify-between items-start md:items-center gap-4 flex-shrink-0 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-accent-primary/5 rounded-full blur-3xl -mr-10 -mt-10 pointer-events-none"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("h2",{className:"text-xl md:text-2xl font-bold text-text-primary",children:x["Tên khách hàng"]}),e.jsx("span",{className:"px-2 py-0.5 rounded text-[10px] font-mono bg-surface-ground border border-border-secondary text-text-secondary",children:x["Số đơn hàng"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsx("span",{className:"px-2.5 py-1 rounded-lg bg-accent-primary/10 text-accent-primary text-xs font-bold border border-accent-primary/20",children:x["Dòng xe"]}),e.jsx("span",{className:"px-2.5 py-1 rounded-lg bg-surface-ground text-text-primary text-xs font-medium border border-border-secondary",children:x["Phiên bản"]}),e.jsxs("span",{className:"px-2.5 py-1 rounded-lg bg-surface-ground text-text-primary text-xs font-medium border border-border-secondary flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-gray-800"}),x["Ngoại thất"]," / ",x["Nội thất"]]})]})]}),e.jsxs("div",{className:"flex gap-4 text-right relative z-10",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-text-secondary uppercase tracking-wider font-bold",children:"Ngày Yêu Cầu"}),e.jsx("div",{className:"text-sm font-bold text-text-primary",children:q(x["Thời gian nhập"]).format("DD/MM/YYYY")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-text-secondary uppercase tracking-wider font-bold",children:"Ngày Cọc"}),e.jsx("div",{className:"text-sm font-bold text-text-primary",children:x["Ngày cọc"]?q(x["Ngày cọc"]).format("DD/MM/YYYY"):"--"})]})]})]}),a(x)?e.jsxs("div",{className:"flex-1 flex flex-col min-h-0 overflow-hidden px-3 md:px-4 pb-3 md:pb-4",children:[e.jsxs("div",{className:"flex-1 bg-gradient-to-b from-gray-900 to-gray-800 rounded-2xl shadow-inner border border-gray-700 relative overflow-hidden flex items-center justify-center mb-3 group",children:[e.jsx("div",{className:"absolute inset-0 opacity-20",style:{backgroundImage:"radial-gradient(circle, #4ade80 1px, transparent 1px)",backgroundSize:"30px 30px"}}),e.jsx("div",{className:"absolute w-[500px] h-[500px] border border-emerald-500/20 rounded-full animate-[ping_3s_linear_infinite]"}),e.jsx("div",{className:"absolute w-[350px] h-[350px] border border-emerald-500/30 rounded-full"}),e.jsx("div",{className:"absolute w-[200px] h-[200px] border border-emerald-500/50 rounded-full"}),e.jsx("div",{className:"absolute w-full h-1/2 top-0 bg-gradient-to-b from-transparent to-emerald-500/10 origin-bottom animate-[spin_4s_linear_infinite] border-b border-emerald-500/50"}),e.jsx("div",{className:"relative z-10 flex flex-col items-center",children:H.length>0?e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-emerald-500/20 blur-xl rounded-full animate-pulse"}),e.jsx("div",{className:"bg-white p-2 rounded-full shadow-[0_0_30px_rgba(16,185,129,0.4)] border-4 border-emerald-500 relative z-10 w-32 h-32 flex items-center justify-center overflow-hidden",children:e.jsx(Le,{model:x["Dòng xe"],exteriorColor:x["Ngoại thất"],className:"w-full h-full object-contain transform scale-125"})}),e.jsx("div",{className:"absolute -bottom-4 left-1/2 transform -translate-x-1/2 bg-emerald-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg whitespace-nowrap z-20",children:"Best Match"})]}):e.jsxs("div",{className:"flex flex-col items-center text-emerald-500/50",children:[e.jsx("i",{className:"fas fa-satellite-dish text-4xl mb-2 animate-bounce"}),e.jsx("span",{className:"text-sm font-mono tracking-widest",children:"SCANNING..."})]})}),e.jsxs("div",{className:"absolute top-4 left-4 text-emerald-500/80 font-mono text-xs",children:[e.jsx("div",{children:"RADAR: ACTIVE"}),e.jsxs("div",{children:["TARGET: ",x["Dòng xe"]]})]}),e.jsxs("div",{className:"absolute bottom-4 right-4 text-emerald-500/80 font-mono text-xs text-right",children:[e.jsxs("div",{children:["MATCHES: ",H.length]}),e.jsxs("div",{children:["STATUS: ",H.length>0?"FOUND":"SEARCHING"]})]})]}),e.jsxs("div",{className:"h-48 md:h-60 bg-white rounded-2xl border border-border-primary shadow-sm flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-2 border-b border-border-secondary bg-surface-ground flex justify-between items-center",children:[e.jsxs("h3",{className:"text-xs font-bold text-text-secondary uppercase tracking-wider",children:["Kho Xe Phù Hợp (",H.length,")"]}),e.jsx("button",{className:"text-accent-primary text-xs hover:underline",children:"Xem tất cả kho"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 custom-scrollbar",children:H.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:H.map(d=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white border border-border-secondary rounded-xl hover:border-accent-primary hover:shadow-md transition-all group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-10 h-10 rounded-full bg-emerald-50 text-emerald-600 flex items-center justify-center font-bold text-sm border border-emerald-100",children:[d.matchScore,"%"]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-text-primary",children:d.VIN}),e.jsxs("div",{className:"text-[10px] text-text-secondary",children:[d["Ngoại thất"]," / ",d["Nội thất"]]})]})]}),e.jsx(je,{onClick:()=>f("pair",x,{vin:d.VIN}),variant:"primary",size:"sm",className:"opacity-0 group-hover:opacity-100 transition-opacity",children:"Ghép"})]},d.VIN))}):e.jsx("div",{className:"flex flex-col items-center justify-center h-full text-text-placeholder",children:e.jsx("p",{className:"text-sm",children:"Chưa tìm thấy xe phù hợp trong kho."})})})]})]}):e.jsxs("div",{className:"flex-1 p-4 flex flex-col items-center justify-center relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-success/5 to-accent-primary/5 pointer-events-none"}),e.jsx("div",{className:"absolute top-1/4 left-1/4 w-64 h-64 bg-success/10 rounded-full blur-3xl pointer-events-none animate-pulse"}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl p-8 rounded-3xl border border-white/50 shadow-2xl text-center max-w-2xl w-full relative z-10 animate-scale-in",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-success/10 text-success font-bold text-sm mb-6 border border-success/20 shadow-sm",children:[e.jsx("i",{className:"fas fa-check-circle"}),"ĐÃ GHÉP XE THÀNH CÔNG"]}),e.jsxs("div",{className:"relative mb-8 group h-48 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-x-0 bottom-0 h-4 bg-black/20 blur-xl rounded-[100%] transform scale-x-75 opacity-0 group-hover:opacity-100 transition-opacity duration-500"}),e.jsx(Le,{model:x["Dòng xe"],exteriorColor:x["Ngoại thất"],className:"w-full h-full object-contain drop-shadow-2xl transform transition-transform duration-500 hover:scale-110"})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"text-xs text-text-secondary uppercase tracking-widest font-bold mb-2",children:"Số Khung (VIN)"}),e.jsx("div",{className:"text-3xl md:text-5xl font-mono font-black text-transparent bg-clip-text bg-gradient-to-r from-text-primary to-text-secondary tracking-wider cursor-pointer hover:opacity-80 transition-opacity select-all",onClick:()=>k(x.VIN||"","VIN"),title:"Click để sao chép",children:x.VIN})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs(je,{onClick:()=>f("unmatch",x),variant:"danger",className:"px-8 py-3 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all",children:[e.jsx("i",{className:"fas fa-unlink mr-2"}),"Hủy Ghép Xe"]})})]})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-text-placeholder bg-surface-ground",children:[e.jsx("i",{className:"fas fa-satellite text-6xl mb-4 opacity-10"}),e.jsx("p",{className:"text-lg font-medium opacity-50",children:"Chọn đơn hàng để bắt đầu"})]})})]})]})},_e=({text:t,showToast:g,className:i,label:f,wrap:c=!1})=>{if(!t||t==="N/A")return e.jsxs("div",{className:i,children:[f?`${f}: `:"","N/A"]});const o=r=>{r.stopPropagation(),navigator.clipboard.writeText(t).then(()=>{g("Đã sao chép!",`${t} đã được sao chép.`,"success",2e3)}).catch(()=>g("Lỗi","Không thể sao chép.","error"))};return e.jsxs("div",{className:`cursor-pointer ${i}`,title:`Click để sao chép: ${t}`,onClick:o,children:[e.jsx("span",{children:f?`${f}: `:""}),e.jsx("span",{className:c?"break-words":"truncate",children:t})]})},jt=({url:t,label:g,icon:i,onClick:f})=>{const[c,o]=s.useState(Ee(t,320)),[r,N]=s.useState(!1);return s.useEffect(()=>{o(Ee(t,320)),N(!1)},[t]),e.jsxs("div",{className:"flex flex-col rounded border border-border-secondary bg-surface-ground cursor-pointer hover:bg-surface-hover transition-all overflow-hidden group",onClick:m=>{m.stopPropagation(),f()},children:[e.jsxs("div",{className:"h-32 bg-white flex items-center justify-center overflow-hidden relative",children:[r?e.jsx("div",{className:"w-12 h-12 rounded-full bg-surface-ground shadow-sm flex items-center justify-center text-accent-primary",children:e.jsx("i",{className:`fas ${i} text-2xl opacity-50`})}):e.jsx("img",{src:c,alt:g,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110",onError:()=>N(!0)}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center",children:e.jsx("i",{className:"fas fa-search-plus text-white opacity-0 group-hover:opacity-100 transform scale-50 group-hover:scale-100 transition-all duration-300 drop-shadow-md"})})]}),e.jsxs("div",{className:"p-2 text-center border-t border-border-secondary bg-surface-ground",children:[e.jsx("div",{className:"font-medium text-xs text-text-primary truncate",title:g,children:g}),e.jsx("div",{className:"text-[10px] text-text-secondary mt-0.5",children:"Nhấn để xem"})]})]})},wt=({requests:t,onAction:g,showToast:i,onOpenImagePreview:f,onDownloadAll:c,selectedFolder:o,selectedRequestId:r,onFolderChange:N,onRequestSelect:m})=>{var T;const[w,I]=s.useState("folders"),[u,a]=s.useState(null),p=s.useMemo(()=>t.filter(y=>{const D=(y["Trạng thái xử lý"]||"").toLowerCase();switch(o){case"pending":return D==="chờ duyệt ycvc";case"approved":return D.includes("đã duyệt")||D.includes("hoàn thành")||D.includes("đã phê duyệt");case"rejected":return D.includes("từ chối")||D.includes("hủy");case"all":return!0;default:return!0}}),[t,o]),x=s.useMemo(()=>t.find(y=>y["Số đơn hàng"]===r),[t,r]);s.useEffect(()=>{if(p.length>0){const y=p[0]["Số đơn hàng"];m(y)}},[o]),s.useEffect(()=>{!r&&p.length>0&&m(p[0]["Số đơn hàng"])},[p,r,m]);const H=[{id:"pending",label:"Chờ Duyệt",icon:"fa-clock",count:t.filter(y=>(y["Trạng thái xử lý"]||"").toLowerCase()==="chờ duyệt ycvc").length},{id:"approved",label:"Đã phê duyệt",icon:"fa-check-circle",count:t.filter(y=>{const D=(y["Trạng thái xử lý"]||"").toLowerCase();return D.includes("đã duyệt")||D.includes("hoàn thành")||D.includes("đã phê duyệt")}).length},{id:"rejected",label:"Đã Từ Chối",icon:"fa-ban",count:t.filter(y=>(y["Trạng thái xử lý"]||"").toLowerCase().includes("từ chối")).length},{id:"all",label:"Tất Cả",icon:"fa-list",count:t.length}],C=y=>{const D=y.toLowerCase();return[{type:"approveVc",label:"Phê Duyệt",icon:"fa-check-circle",className:"btn-success",condition:D==="chờ duyệt ycvc"},{type:"rejectVc",label:"Từ Chối",icon:"fa-ban",className:"btn-danger",condition:D==="chờ duyệt ycvc"}].filter(Z=>Z.condition)},k={idCardFront:{label:"CCCD Trước",icon:"fa-id-card"},idCardBack:{label:"CCCD Sau",icon:"fa-id-card"},businessLicense:{label:"GPKD",icon:"fa-file-alt"},regFront:{label:"Cavet Trước",icon:"fa-car"},regBack:{label:"Cavet Sau",icon:"fa-car"},unc:{label:"UNC",icon:"fa-file-invoice-dollar"}},R=y=>{let D={};try{y.FileUrls?D=JSON.parse(y.FileUrls):y["URL hình ảnh"]&&(D={unc:y["URL hình ảnh"]})}catch(Q){console.error("Failed to parse FileUrls",Q)}const Z=Object.entries(D),ne=Z.map(([Q,le])=>{const ce=k[Q]||{label:Q};return{src:le,originalUrl:le,label:ce.label}});return{docEntries:Z,allImageSources:ne,fileUrls:D}},d=y=>{N(y),I("list")},b=y=>{m(y),I("detail")},h=async(y,D)=>{a({id:D["Số đơn hàng"],type:y});try{await g(y,D)}catch(Z){console.error(Z)}finally{a(null)}},[V,X]=s.useState(null),[L,Y]=s.useState(null),U=50,J=y=>{Y(null),X(y.targetTouches[0].clientX)},W=y=>{Y(y.targetTouches[0].clientX)},v=()=>{if(!V||!L)return;const y=V-L,D=y>U,Z=y<-U;if(D||Z){const ne=p.findIndex(Q=>Q["Số đơn hàng"]===r);if(ne===-1)return;D&&ne<p.length-1?b(p[ne+1]["Số đơn hàng"]):Z&&ne>0&&b(p[ne-1]["Số đơn hàng"])}};return e.jsxs("div",{className:"flex h-full bg-surface-card rounded-xl shadow-md border border-border-primary overflow-hidden animate-fade-in relative",children:[e.jsxs("div",{className:`w-full md:w-64 flex-shrink-0 border-r border-border-primary bg-surface-ground flex flex-col absolute md:relative inset-0 z-20 md:z-auto transition-transform duration-300 ${w==="folders"?"translate-x-0":"-translate-x-full md:translate-x-0"}`,children:[e.jsx("div",{className:"p-4 border-b border-border-primary md:hidden flex items-center justify-between bg-white",children:e.jsx("span",{className:"font-bold text-lg",children:"Danh Mục"})}),e.jsx("nav",{className:"flex-1 p-2 space-y-1 overflow-y-auto",children:H.map(y=>e.jsxs("button",{onClick:()=>d(y.id),className:`w-full flex items-center justify-between px-3 py-2 rounded-lg text-xs font-medium transition-colors ${o===y.id?"bg-accent-primary/10 text-accent-primary":"text-text-secondary hover:bg-surface-hover hover:text-text-primary"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("i",{className:`fas ${y.icon} w-5 text-center`}),e.jsx("span",{children:y.label})]}),y.count>0&&e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${o===y.id?"bg-accent-primary text-white":"bg-surface-hover text-text-secondary"}`,children:y.count})]},y.id))})]}),e.jsxs("div",{className:`w-full md:w-80 flex-shrink-0 border-r border-border-primary flex flex-col bg-white absolute md:relative inset-0 z-20 md:z-auto transition-transform duration-300 ${w==="list"?"translate-x-0":w==="detail"?"-translate-x-full md:translate-x-0":"translate-x-full md:translate-x-0"}`,children:[e.jsxs("div",{className:"p-3 border-b border-border-primary md:hidden flex items-center gap-3 bg-white shadow-sm",children:[e.jsx("button",{onClick:()=>I("folders"),className:"w-8 h-8 rounded-full bg-surface-ground flex items-center justify-center text-text-secondary hover:bg-surface-hover",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsx("span",{className:"font-bold text-text-primary",children:(T=H.find(y=>y.id===o))==null?void 0:T.label})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:p.length===0?e.jsx("div",{className:"p-8 text-center text-text-placeholder text-sm",children:"Không tìm thấy yêu cầu nào."}):e.jsx("div",{className:"divide-y divide-border-secondary",children:p.map(y=>e.jsxs("div",{onClick:()=>b(y["Số đơn hàng"]),className:`px-3 py-2 cursor-pointer hover:bg-surface-hover transition-all duration-200 flex items-center justify-between ${r===y["Số đơn hàng"]?"bg-accent-primary/10 border-l-4 border-accent-primary shadow-inner":"border-l-4 border-transparent"}`,children:[e.jsx("span",{className:"text-text-primary text-sm truncate pr-2",children:y["Tên khách hàng"]}),e.jsx("div",{className:"flex-shrink-0",children:(()=>{const D=(y["Trạng thái xử lý"]||"").toLowerCase();return D.includes("chờ")?e.jsx("i",{className:"fas fa-clock text-warning text-base",title:y["Trạng thái xử lý"]}):D.includes("đã duyệt")||D.includes("hoàn thành")||D.includes("phê duyệt")?e.jsx("i",{className:"fas fa-check-circle text-blue-400 text-sm",title:y["Trạng thái xử lý"]}):D.includes("từ chối")?e.jsx("i",{className:"fas fa-ban text-danger text-base",title:y["Trạng thái xử lý"]}):e.jsx("i",{className:"fas fa-question-circle text-text-secondary text-base",title:y["Trạng thái xử lý"]})})()})]},y["Số đơn hàng"]))})})]}),e.jsx("div",{className:`w-full flex-1 flex flex-col bg-surface-ground min-w-0 absolute md:relative inset-0 z-30 md:z-auto transition-transform duration-300 ${w==="detail"?"translate-x-0":"translate-x-full md:translate-x-0"}`,onTouchStart:J,onTouchMove:W,onTouchEnd:v,children:x?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-4 py-3 bg-white border-b border-border-primary flex justify-between items-center shadow-sm z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>I("list"),className:"md:hidden w-8 h-8 rounded-full bg-surface-ground flex items-center justify-center text-text-secondary hover:bg-surface-hover",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-accent-primary/10 flex items-center justify-center text-accent-primary font-bold text-base hidden sm:flex",children:x["Tên khách hàng"].charAt(0)}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{className:"text-base font-bold text-text-primary leading-tight cursor-pointer hover:text-accent-primary transition-colors truncate",title:"Click để sao chép tên khách hàng",onClick:y=>{y.stopPropagation(),navigator.clipboard.writeText(x["Tên khách hàng"]),i("Đã sao chép","Tên khách hàng đã được sao chép","success")},children:x["Tên khách hàng"]}),e.jsxs("div",{className:"text-xs text-text-secondary flex items-center gap-2 mt-0.5",children:[e.jsx("span",{className:"font-mono cursor-pointer hover:text-accent-primary border-b border-dashed border-transparent hover:border-accent-primary transition-all",title:"Click để sao chép số đơn hàng",onClick:y=>{y.stopPropagation(),navigator.clipboard.writeText(x["Số đơn hàng"]),i("Đã sao chép","Số đơn hàng đã được sao chép","success")},children:x["Số đơn hàng"]}),e.jsx("span",{className:"hidden sm:inline",children:"•"}),e.jsx("span",{className:"hidden sm:inline",children:x["Người YC"]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>c(x),className:"btn btn-secondary px-2.5 py-1 text-xs flex items-center gap-1.5 rounded",title:"Tải tất cả hồ sơ",children:[e.jsx("i",{className:"fas fa-file-archive"}),e.jsx("span",{className:"hidden xl:inline",children:"Tải Hồ Sơ"})]}),C(x["Trạng thái xử lý"]||"").map(y=>e.jsx("button",{onClick:()=>h(y.type,x),disabled:u!==null,className:`btn ${y.className} px-2.5 py-1 text-xs flex items-center gap-1.5 rounded w-[100px] justify-center ${(u==null?void 0:u.id)===x["Số đơn hàng"]&&u.type===y.type?"opacity-80 cursor-wait":""}`,children:(u==null?void 0:u.id)===x["Số đơn hàng"]&&u.type===y.type?e.jsx("i",{className:"fas fa-spinner fa-spin"}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:`fas ${y.icon}`}),e.jsx("span",{className:"hidden xl:inline",children:y.label})]})},y.type))]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar",children:e.jsxs("div",{className:"max-w-5xl mx-auto space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-border-primary px-4 py-3 flex items-center justify-between shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"text-xs text-text-secondary",children:"Trạng thái:"}),e.jsx(Ke,{status:x["Trạng thái xử lý"]||"",size:"sm"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"text-text-secondary",children:"Ngày yêu cầu:"}),e.jsx("span",{className:"font-medium text-text-primary",children:q(x["Thời gian YC"]).format("HH:mm DD/MM/YYYY")})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-border-primary p-3 shadow-sm",children:[e.jsx("h3",{className:"text-xs font-bold text-text-secondary uppercase tracking-wider mb-2 border-b border-border-secondary pb-1.5",children:"Thông Tin Yêu Cầu"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-text-secondary block mb-0.5 uppercase",children:"Loại Yêu Cầu"}),e.jsx("div",{className:"text-sm font-medium truncate",children:x["Loại YC"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-text-secondary block mb-0.5 uppercase",children:"Mã KH DMS"}),e.jsx(_e,{text:x["Mã KH DMS"]||"",showToast:i,className:"font-mono text-sm truncate"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-text-secondary block mb-0.5 uppercase",children:"Số VIN"}),e.jsx(_e,{text:x.VIN||"",showToast:i,className:"font-mono font-bold text-accent-primary text-sm truncate"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-text-secondary block mb-0.5 uppercase",children:"Ghi chú"}),e.jsx("div",{className:"text-sm truncate",title:x["Ghi chú"],children:x["Ghi chú"]||"—"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-border-primary p-3 shadow-sm flex flex-col h-full",children:[e.jsx("h3",{className:"text-xs font-bold text-text-secondary uppercase tracking-wider mb-2 border-b border-border-secondary pb-1.5",children:"Hồ Sơ Đính Kèm"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:(()=>{const{docEntries:y,allImageSources:D}=R(x);return y.length===0?e.jsx("div",{className:"col-span-full text-center py-4 text-text-placeholder text-sm",children:"Không có hồ sơ đính kèm"}):y.map(([Z,ne],Q)=>{const le=k[Z]||{label:Z,icon:"fa-file"};return e.jsx(jt,{url:ne,label:le.label,icon:le.icon,onClick:()=>f(D,Q,x["Tên khách hàng"])},Z)})})()})]})]})})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-text-placeholder",children:[e.jsx("i",{className:"fas fa-inbox text-6xl mb-4 opacity-20"}),e.jsx("p",{children:"Chọn một yêu cầu để xem chi tiết"})]})})]})};q.locale("vi");const ke=({title:t,icon:g,color:i="text-gray-800",action:f})=>e.jsxs("div",{className:"flex justify-between items-center mb-0 p-3 bg-gray-100 border-b border-gray-200 rounded-t-xl",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[g&&e.jsx("i",{className:`fas ${g} ${i} text-sm`}),e.jsx("h3",{className:`font-bold text-sm tracking-widest uppercase ${i}`,children:t})]}),f]}),Ae=({label:t,value:g,icon:i,color:f,onClick:c})=>e.jsxs("div",{onClick:c,className:"flex items-center justify-between p-3 rounded-xl bg-white border border-gray-100 shadow-sm hover:shadow-md hover:-translate-y-0.5 transition-all group cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg ${f} bg-opacity-10 flex items-center justify-center`,children:e.jsx("i",{className:`fas ${i} ${f} text-sm`})}),e.jsx("span",{className:"text-sm text-gray-600 font-medium group-hover:text-gray-900 transition-colors",children:t})]}),e.jsx("span",{className:"text-xl font-bold text-gray-900",children:g})]}),St=({title:t,count:g,icon:i,color:f,onClick:c})=>e.jsxs("div",{onClick:c,className:"flex items-center justify-between py-2.5 px-3 rounded-lg cursor-pointer hover:bg-white hover:shadow-sm transition-all group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${g>0?`${f} text-white shadow-md`:"bg-gray-200 text-gray-400"}`,children:e.jsx("i",{className:`fas ${i} text-xs`})}),e.jsx("span",{className:`text-sm font-bold ${g>0?"text-gray-800":"text-gray-400"}`,children:t})]}),e.jsx("span",{className:`text-sm font-mono font-bold px-2 py-0.5 rounded-md ${g>0?"bg-white text-gray-900 shadow-sm border border-gray-100":"text-gray-300"}`,children:g})]}),kt=({allOrders:t,stockData:g,soldData:i,invoiceData:f,teamData:c,allUsers:o,onTabChange:r,onNavigateTo:N,onShowOrderDetails:m})=>{const[w,I]=s.useState("pending"),u=s.useMemo(()=>{const a=t.filter(v=>{var T;return(T=v["Kết quả"])==null?void 0:T.toLowerCase().includes("chưa")}),p=g.filter(v=>{var T;return((T=v["Trạng thái"])==null?void 0:T.toLowerCase())==="chưa ghép"}).length,x=i.length,H=Object.keys(c).length,C=o.filter(v=>v.role==="Tư vấn bán hàng").length,k=[{title:"Chờ Ghép",count:a.length,icon:"fa-hourglass-start",color:"bg-amber-500",action:()=>r("pending")},{title:"Đã Ghép",count:t.filter(v=>{var T;return((T=v["Kết quả"])==null?void 0:T.toLowerCase())==="đã ghép"}).length,icon:"fa-link",color:"bg-blue-500",action:()=>r("paired")},{title:"Chờ Duyệt",count:t.filter(v=>{var T;return((T=v["Kết quả"])==null?void 0:T.toLowerCase())==="chờ phê duyệt"}).length,icon:"fa-user-check",color:"bg-indigo-500",action:()=>r("invoices",{trangThai:["Chờ phê duyệt"]})},{title:"Chờ Ký",count:t.filter(v=>{var T;return((T=v["Kết quả"])==null?void 0:T.toLowerCase())==="chờ ký hóa đơn"}).length,icon:"fa-file-signature",color:"bg-purple-500",action:()=>r("invoices",{trangThai:["Chờ ký hóa đơn"]})},{title:"Đã Xuất",count:t.filter(v=>{var T;return((T=v["Kết quả"])==null?void 0:T.toLowerCase())==="đã xuất hóa đơn"}).length,icon:"fa-check-circle",color:"bg-emerald-500",action:()=>r("invoices",{trangThai:["Đã xuất hóa đơn"]})}],R=[...a].sort((v,T)=>new Date(v["Thời gian nhập"]).getTime()-new Date(T["Thời gian nhập"]).getTime()).slice(0,10),d=t.filter(v=>{var T;return["đã ghép","chờ phê duyệt","đã phê duyệt","chờ ký hóa đơn","yêu cầu bổ sung"].includes(((T=v["Kết quả"])==null?void 0:T.toLowerCase())??"")}).sort((v,T)=>new Date(v["Thời gian ghép"]||v["Thời gian nhập"]).getTime()-new Date(T["Thời gian ghép"]||T["Thời gian nhập"]).getTime()).slice(0,10),b={};a.forEach(v=>{const T=`${v["Dòng xe"]||"N/A"}|${v["Phiên bản"]||"N/A"}|${v["Ngoại thất"]||"N/A"}|${v["Nội thất"]||"N/A"}`;b[T]=(b[T]||0)+1});const h=Object.entries(b).map(([v,T])=>{const[y,D,Z,ne]=v.split("|");return{model:`${y} - ${D}`,colors:`${Z} / ${ne}`,count:T}}).sort((v,T)=>T.count-v.count).slice(0,10),V=Math.max(...h.map(v=>v.count),1),X=q().month(),L=q().year(),Y=f.filter(v=>{if(!v["Ngày xuất hóa đơn"])return!1;const T=q(v["Ngày xuất hóa đơn"],["YYYY-MM-DD","DD/MM/YYYY","D/M/YYYY",q.ISO_8601]);return T.isValid()&&T.month()===X&&T.year()===L}),U={};Y.forEach(v=>{const T=v["Tên tư vấn bán hàng"];if(T){const y=Re(T);U[y]=(U[y]||0)+1}});const W=o.filter(v=>v.role==="Tư vấn bán hàng").map(v=>{const T=Re(v.name);return{name:v.name,count:U[T]||0}}).sort((v,T)=>T.count!==v.count?T.count-v.count:v.name.localeCompare(T.name));return{pendingRequests:a.length,availableStock:p,totalSold:x,totalTeams:H,totalTVBH:C,pipeline:k,oldestPendingRequests:R,pairedButNotSold:d,pendingRequestsByModel:h,maxPendingCount:V,monthlySalesData:W}},[t,g,i,c,o,f]);return e.jsxs("div",{className:"h-auto md:h-[calc(100vh-140px)] min-h-[500px] animate-fade-in flex flex-col md:flex-row gap-4 p-4 rounded-xl shadow-xl overflow-y-auto md:overflow-hidden relative bg-white",children:[e.jsxs("div",{className:"w-full md:w-[280px] h-auto md:h-full flex-shrink-0 !bg-white rounded-xl border border-gray-200 shadow-sm flex flex-col relative overflow-hidden z-20",style:{backgroundColor:"#ffffff"},children:[e.jsxs("div",{className:"relative z-10",children:[e.jsx(ke,{title:"Quy Trình",icon:"fa-stream",color:"text-blue-600"}),e.jsx("div",{className:"space-y-1 p-4 pt-2",children:u.pipeline.map((a,p)=>e.jsx(St,{title:a.title,count:a.count,icon:a.icon,color:a.color,onClick:a.action},p))})]}),e.jsxs("div",{className:"flex-grow relative z-10",children:[e.jsx(ke,{title:"Chỉ Số",icon:"fa-chart-pie",color:"text-purple-600"}),e.jsxs("div",{className:"space-y-2 p-4 pt-2",children:[e.jsx(Ae,{label:"Kho Xe",value:u.availableStock,icon:"fa-warehouse",color:"text-indigo-600",onClick:()=>N==null?void 0:N("stock")}),e.jsx(Ae,{label:"Đã Bán (Năm)",value:u.totalSold,icon:"fa-hand-holding-dollar",color:"text-emerald-600"}),e.jsx(Ae,{label:"Nhân Sự",value:u.totalTVBH,icon:"fa-users",color:"text-blue-600"}),e.jsx(Ae,{label:"Phòng KD",value:u.totalTeams,icon:"fa-briefcase",color:"text-amber-600",onClick:()=>r("phongkd")})]})]}),e.jsx("div",{className:"mt-auto pt-4 border-t border-gray-100 relative z-10",children:e.jsxs("p",{className:"text-[10px] text-gray-400 text-center flex items-center justify-center gap-1",children:[e.jsx("i",{className:"fas fa-clock"}),"Cập nhật: ",q().format("HH:mm")]})})]}),e.jsxs("div",{className:"flex-grow flex flex-col min-w-0 gap-4 relative z-10",children:[e.jsxs("div",{className:"h-auto min-h-[250px] md:h-[45%] !bg-white rounded-xl border border-gray-200 shadow-sm flex flex-col z-20 relative",style:{backgroundColor:"#ffffff"},children:[e.jsx(ke,{title:"Cần Xử Lý",icon:"fa-bell",color:"text-red-500",action:e.jsxs("div",{className:"flex bg-gray-100 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>I("pending"),className:`px-3 py-1 text-xs font-bold uppercase tracking-wider rounded-md transition-all flex items-center gap-2 ${w==="pending"?"bg-white text-red-600 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx("i",{className:"fas fa-clock"})," Chờ Lâu"]}),e.jsxs("button",{onClick:()=>I("stuck"),className:`px-3 py-1 text-xs font-bold uppercase tracking-wider rounded-md transition-all flex items-center gap-2 ${w==="stuck"?"bg-white text-orange-600 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx("i",{className:"fas fa-exclamation-triangle"})," Kẹt Xe"]})]})}),e.jsx("div",{className:"flex-grow overflow-x-auto hidden-scrollbar pb-2 p-4",children:e.jsx("div",{className:"flex gap-3 h-full",children:w==="pending"?e.jsxs(e.Fragment,{children:[u.oldestPendingRequests.map(a=>e.jsx("div",{onClick:()=>m(a),className:"min-w-[200px] w-[200px] bg-white rounded-xl border border-gray-100 shadow-sm hover:shadow-md hover:-translate-y-1 transition-all cursor-pointer group flex flex-col relative overflow-hidden",children:e.jsxs("div",{className:"p-3 flex-grow flex flex-col relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"text-xs font-bold text-gray-500 bg-gray-100 px-1.5 py-0.5 rounded uppercase tracking-wider",children:a["Số đơn hàng"]}),e.jsx("i",{className:"fas fa-clock text-red-400 text-sm"})]}),e.jsx("h4",{className:"text-sm font-bold text-gray-900 line-clamp-2 mb-1",title:a["Tên khách hàng"],children:a["Tên khách hàng"]}),e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:a["Dòng xe"]}),e.jsxs("div",{className:"mt-auto pt-2 border-t border-gray-50 flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] text-gray-400",children:"Chờ đợi"}),e.jsx("span",{className:"text-xs font-bold text-red-600 bg-red-50 px-2 py-0.5 rounded-full",children:q(a["Thời gian nhập"]).fromNow(!0)})]})]})},a["Số đơn hàng"])),u.oldestPendingRequests.length===0&&e.jsxs("div",{className:"w-full flex flex-col items-center justify-center text-gray-400",children:[e.jsx("i",{className:"fas fa-check-circle text-3xl text-green-100 mb-2"}),e.jsx("span",{className:"text-xs",children:"Không có yêu cầu chờ lâu"})]})]}):e.jsxs(e.Fragment,{children:[u.pairedButNotSold.map(a=>e.jsx("div",{onClick:()=>m(a),className:"min-w-[200px] w-[200px] bg-white rounded-xl border border-gray-100 shadow-sm hover:shadow-md hover:-translate-y-1 transition-all cursor-pointer group flex flex-col relative overflow-hidden",children:e.jsxs("div",{className:"p-3 flex-grow flex flex-col relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:"text-xs font-bold text-gray-500 bg-gray-100 px-1.5 py-0.5 rounded font-mono",children:a.VIN||"N/A"}),e.jsx("i",{className:"fas fa-car-crash text-orange-400 text-sm"})]}),e.jsx("h4",{className:"text-sm font-bold text-gray-900 line-clamp-2 mb-1",title:a["Kết quả"],children:a["Kết quả"]}),e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:a["Dòng xe"]}),e.jsxs("div",{className:"mt-auto pt-2 border-t border-gray-50 flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] text-gray-400",children:"Tồn đọng"}),e.jsx("span",{className:"text-xs font-bold text-orange-600 bg-orange-50 px-2 py-0.5 rounded-full",children:q(a["Thời gian ghép"]||a["Thời gian nhập"]).fromNow(!0)})]})]})},a.VIN||a["Số đơn hàng"])),u.pairedButNotSold.length===0&&e.jsxs("div",{className:"w-full flex flex-col items-center justify-center text-gray-400",children:[e.jsx("i",{className:"fas fa-check-circle text-3xl text-green-100 mb-2"}),e.jsx("span",{className:"text-xs",children:"Không có xe bị kẹt"})]})]})})})]}),e.jsxs("div",{className:"flex-grow flex flex-col md:flex-row min-h-0 gap-4",children:[e.jsxs("div",{className:"w-full md:w-1/2 !bg-white rounded-xl border border-gray-200 shadow-sm flex flex-col z-20 relative",style:{backgroundColor:"#ffffff"},children:[e.jsx(ke,{title:"Nhu Cầu",icon:"fa-chart-bar",color:"text-teal-600"}),e.jsxs("div",{className:"flex-grow overflow-y-auto hidden-scrollbar pr-1 p-4",children:[e.jsx("div",{className:"grid grid-cols-2 gap-3",children:u.pendingRequestsByModel.map((a,p)=>e.jsx("div",{className:"bg-white p-3 rounded-xl border border-gray-100 shadow-sm hover:shadow-md hover:-translate-y-0.5 transition-all relative overflow-hidden group",children:e.jsxs("div",{className:"relative z-10",children:[e.jsx("h4",{className:"font-bold text-gray-800 text-xs uppercase truncate pr-2",title:a.model,children:a.model}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-0.5 truncate",title:a.colors,children:a.colors}),e.jsxs("div",{className:"mt-3 flex items-end justify-between",children:[e.jsx("div",{className:"h-1 w-12 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-teal-500",style:{width:`${a.count/u.maxPendingCount*100}%`}})}),e.jsx("span",{className:"text-xl font-bold text-teal-600 leading-none",children:a.count})]})]})},p))}),u.pendingRequestsByModel.length===0&&e.jsx("div",{className:"text-center text-gray-400 text-xs py-8",children:"Chưa có yêu cầu"})]})]}),e.jsxs("div",{className:"w-full md:w-1/2 !bg-white rounded-xl border border-gray-200 shadow-sm flex flex-col z-20 relative",style:{backgroundColor:"#ffffff"},children:[e.jsx(ke,{title:"Top Sales",icon:"fa-trophy",color:"text-yellow-500"}),e.jsxs("div",{className:"flex-grow overflow-y-auto hidden-scrollbar pr-2 p-4",children:[u.monthlySalesData.length>0&&e.jsxs("div",{className:"flex items-end justify-center gap-2 mb-6 mt-2",children:[u.monthlySalesData[1]&&e.jsxs("div",{className:"flex flex-col items-center w-1/3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-100 border-2 border-gray-300 flex items-center justify-center mb-2 shadow-sm relative z-10",children:e.jsx("span",{className:"font-bold text-gray-500 text-xs",children:"2"})}),e.jsxs("div",{className:"bg-white p-2 rounded-lg shadow-sm border border-gray-100 text-center w-full relative -mt-4 pt-5",children:[e.jsx("p",{className:"text-[10px] font-bold truncate text-gray-700",children:u.monthlySalesData[1].name}),e.jsx("p",{className:"text-sm font-bold text-gray-900 mt-0.5",children:u.monthlySalesData[1].count})]})]}),u.monthlySalesData[0]&&e.jsxs("div",{className:"flex flex-col items-center w-1/3 -mb-1",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-yellow-100 border-2 border-yellow-400 flex items-center justify-center mb-2 shadow-md relative z-10",children:e.jsx("i",{className:"fas fa-crown text-yellow-500 text-sm"})}),e.jsxs("div",{className:"bg-white p-2 rounded-lg shadow-md border border-yellow-200 text-center w-full relative -mt-4 pt-6",children:[e.jsx("p",{className:"text-[10px] font-bold truncate text-yellow-900",children:u.monthlySalesData[0].name}),e.jsx("p",{className:"text-base font-bold text-yellow-600 mt-0.5",children:u.monthlySalesData[0].count})]})]}),u.monthlySalesData[2]&&e.jsxs("div",{className:"flex flex-col items-center w-1/3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-50 border-2 border-orange-200 flex items-center justify-center mb-2 shadow-sm relative z-10",children:e.jsx("span",{className:"font-bold text-orange-400 text-xs",children:"3"})}),e.jsxs("div",{className:"bg-white p-2 rounded-lg shadow-sm border border-gray-100 text-center w-full relative -mt-4 pt-5",children:[e.jsx("p",{className:"text-[10px] font-bold truncate text-gray-700",children:u.monthlySalesData[2].name}),e.jsx("p",{className:"text-sm font-bold text-gray-900 mt-0.5",children:u.monthlySalesData[2].count})]})]})]}),e.jsx("div",{className:"space-y-1.5",children:u.monthlySalesData.slice(3).map((a,p)=>e.jsxs("div",{className:"flex items-center gap-3 py-1.5 px-2 rounded-lg hover:bg-gray-50 transition-colors border border-transparent hover:border-gray-100",children:[e.jsx("span",{className:"text-xs font-bold text-gray-400 w-4 text-center",children:p+4}),e.jsx("div",{className:"flex-grow min-w-0",children:e.jsx("p",{className:"text-xs font-medium text-gray-700 truncate",children:a.name})}),e.jsx("span",{className:"text-xs font-mono font-bold text-gray-900 bg-gray-100 px-1.5 py-0.5 rounded",children:a.count})]},a.name))}),u.monthlySalesData.length===0&&e.jsx("div",{className:"text-center text-gray-400 text-xs py-8",children:"Chưa có dữ liệu"})]})]})]})]})]})},$e=({isOpen:t,onClose:g,onSubmit:i,title:f,orderNumber:c,reasonLabel:o,icon:r,theme:N,showToast:m})=>{const[w,I]=s.useState(""),[u,a]=s.useState([]),[p,x]=s.useState(!1),H=Ne();s.useEffect(()=>{t&&x(!1)},[t]);const C=s.useCallback(async h=>{const V=h.clipboardData.items;for(const X of V)if(X.type.indexOf("image")!==-1){h.preventDefault();const L=X.getAsFile();if(L){const Y=new File([L],"pasted_image.jpg",{type:L.type});try{const U=new FileReader;U.onload=J=>a(W=>{var v;return[...W,(v=J.target)==null?void 0:v.result]}),U.readAsDataURL(Y)}catch(U){console.error("Paste handling failed",U);const J=new FileReader;J.onload=W=>a(v=>{var T;return[...v,(T=W.target)==null?void 0:T.result]}),J.readAsDataURL(L)}}}},[]),k=h=>{a(V=>V.filter((X,L)=>L!==h))},R=async()=>{if(!w.trim()&&o.includes("bắt buộc")){m?m("Thông tin không hợp lệ","Vui lòng nhập nội dung yêu cầu.","warning"):alert("Vui lòng nhập nội dung yêu cầu.");return}x(!0),await i(w,u)||x(!1)};if(!t)return null;const d={primary:{iconBg:"bg-blue-100",iconText:"text-accent-primary",btn:"btn-primary",barBg:"bg-accent-primary"},danger:{iconBg:"bg-danger-bg",iconText:"text-danger",btn:"btn-danger",barBg:"bg-danger"},warning:{iconBg:"bg-warning-bg",iconText:"text-warning",btn:"btn-primary",barBg:"bg-warning"}},b=d[N]||d.primary;return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-0 md:p-4",onClick:g,children:e.jsxs("div",{className:"bg-surface-card w-full md:max-w-lg h-full md:h-auto rounded-none md:rounded-2xl shadow-xl animate-fade-in-scale-up flex flex-col",onClick:h=>h.stopPropagation(),style:H,children:[e.jsx("div",{className:`h-1.5 rounded-t-none md:rounded-t-2xl ${b.barBg} flex-shrink-0`}),e.jsxs("header",{className:"flex items-start justify-between p-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:`flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center ${b.iconBg}`,children:e.jsx("i",{className:`fas ${r} text-2xl ${b.iconText}`})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-text-primary",children:f}),e.jsxs("p",{className:"text-sm text-text-secondary mt-1",children:["Đang thực hiện cho: ",e.jsx("strong",{className:"font-mono text-text-primary",children:c})]})]})]}),e.jsx("button",{onClick:g,className:"w-9 h-9 rounded-full flex items-center justify-center text-text-secondary hover:bg-surface-hover -mt-1 -mr-1",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("main",{className:"p-4 md:p-6 space-y-4 overflow-y-auto flex-grow min-h-0",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"modal-reason-input",className:"block text-sm font-medium text-text-primary mb-1.5",children:o}),e.jsx("textarea",{id:"modal-reason-input",value:w,onChange:h=>I(h.target.value),rows:3,className:"w-full bg-surface-ground border border-border-primary rounded-lg p-2 futuristic-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-1.5",children:"Dán ảnh minh họa (Tùy chọn)"}),e.jsx("div",{onPaste:C,contentEditable:!0,suppressContentEditableWarning:!0,className:"p-2 border-2 border-dashed border-border-primary rounded-lg min-h-[60px] text-center text-text-placeholder focus:outline-none focus:border-accent-primary",children:"Click và nhấn Ctrl+V để dán"}),u.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:u.map((h,V)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:h,className:"h-20 w-20 object-cover rounded-md",alt:`Pasted ${V}`}),e.jsx("button",{onClick:()=>k(V),className:"absolute top-0 right-0 w-5 h-5 bg-danger text-white rounded-full text-xs hidden group-hover:flex items-center justify-center",children:"×"})]},V))})]})]}),e.jsxs("footer",{className:"px-3 py-2 flex justify-end items-center gap-1.5 bg-surface-ground rounded-none md:rounded-b-2xl border-t border-border-primary flex-shrink-0",children:[e.jsx("div",{onClick:p?void 0:g,title:"Hủy",className:`cursor-pointer ${p?"opacity-50 cursor-not-allowed":"hover:scale-110 transition-transform"}`,children:e.jsx("lottie-player",{src:Be,background:"transparent",speed:"1",style:{width:"52px",height:"52px"},loop:!0,autoplay:!0})}),e.jsx("div",{onClick:p?void 0:R,title:"Gửi Yêu Cầu",className:`cursor-pointer flex items-center justify-center w-[52px] h-[52px] ${p?"opacity-50 cursor-not-allowed":"hover:scale-110 transition-transform"}`,children:p?e.jsx("i",{className:"fas fa-spinner fa-spin text-2xl text-accent-primary"}):e.jsx("lottie-player",{src:Xe,background:"transparent",speed:"1",style:{width:"52px",height:"52px"},loop:!0,autoplay:!0})})]})]})})},Ct=({isOpen:t,onClose:g,onSubmit:i,order:f,showToast:c})=>{const[o,r]=s.useState(null),[N,m]=s.useState(!1),w=Ne(),I=async()=>{if(!o){c?c("Chưa chọn tệp","Vui lòng chọn một tệp hóa đơn.","warning"):alert("Vui lòng chọn một tệp hóa đơn.");return}m(!0),await i(o)?(r(null),g()):m(!1)};return t?e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-0 md:p-4",onClick:g,children:e.jsxs("div",{className:"bg-surface-card w-full md:max-w-lg h-full md:h-auto rounded-none md:rounded-2xl shadow-xl animate-fade-in-scale-up flex flex-col",onClick:u=>u.stopPropagation(),style:w,children:[e.jsx("div",{className:"h-1.5 rounded-t-none md:rounded-t-2xl bg-success flex-shrink-0"}),e.jsxs("header",{className:"flex items-start justify-between p-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center bg-success-bg",children:e.jsx("i",{className:"fas fa-upload text-2xl text-success"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-text-primary",children:"Tải Lên Hóa Đơn Đã Xuất"}),e.jsxs("p",{className:"text-sm text-text-secondary mt-1",children:["Tải file hóa đơn (PDF, ảnh...) cho ĐH: ",e.jsx("strong",{className:"font-mono text-text-primary",children:f["Số đơn hàng"]}),"."]})]})]}),e.jsx("button",{onClick:g,className:"w-9 h-9 rounded-full flex items-center justify-center text-text-secondary hover:bg-surface-hover -mt-1 -mr-1",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsx("main",{className:"px-3 pb-3 space-y-2",children:e.jsx(lt,{id:"issued-invoice-upload",label:"File Hóa Đơn",onFileSelect:r,required:!0,accept:".pdf,.jpeg,.png,.jpg",disableCompression:!0})}),e.jsxs("footer",{className:"px-3 py-2 flex justify-end items-center gap-1.5 bg-surface-ground rounded-none md:rounded-b-2xl border-t border-border-primary flex-shrink-0",children:[e.jsx("div",{onClick:N?void 0:g,title:"Hủy",className:`cursor-pointer ${N?"opacity-50 cursor-not-allowed":"hover:scale-110 transition-transform"}`,children:e.jsx("lottie-player",{src:Be,background:"transparent",speed:"1",style:{width:"52px",height:"52px"},loop:!0,autoplay:!0})}),e.jsx("div",{onClick:!N&&o?I:void 0,title:"Tải Lên & Hoàn Tất",className:`cursor-pointer flex items-center justify-center w-[52px] h-[52px] ${N||!o?"opacity-50 cursor-not-allowed":"hover:scale-110 transition-transform"}`,children:N?e.jsx("i",{className:"fas fa-spinner fa-spin text-2xl text-accent-primary"}):e.jsx("lottie-player",{src:Xe,background:"transparent",speed:"1",style:{width:"52px",height:"52px"},loop:!0,autoplay:!0})})]})]})}):null},Tt=({item:t})=>e.jsxs("div",{className:"relative pl-6 py-2 group",children:[e.jsx("div",{className:"absolute top-2 left-0 w-4 h-4 rounded-full bg-accent-primary/20 border-4 border-surface-card group-hover:bg-accent-primary transition-colors"}),e.jsxs("div",{className:"pl-2",children:[e.jsx("p",{className:"font-bold text-text-primary",children:t["Hành động"]}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:t["Chi tiết"]}),e.jsxs("div",{className:"text-xs text-text-secondary mt-2 flex items-center gap-2",children:[e.jsxs("span",{children:[e.jsx("i",{className:"fas fa-user fa-fw mr-1.5"}),t["Người thực hiện"]]}),e.jsxs("span",{children:[e.jsx("i",{className:"fas fa-clock fa-fw mr-1.5"}),q(t["Thời gian"]).format("HH:mm DD/MM/YYYY")]})]})]}),e.jsx("div",{className:"absolute top-4 left-[7px] h-full border-l-2 border-dashed border-border-primary group-last:border-none"})]}),Mt=({isOpen:t,onClose:g})=>{const[i,f]=s.useState(""),[c,o]=s.useState(!1),[r,N]=s.useState(null),[m,w]=s.useState(null),I=Ne(),u=s.useCallback(async()=>{if(!i.trim()){N("Vui lòng nhập số đơn hàng.");return}o(!0),N(null),w(null);try{const p=await ct(i.trim());p.history&&p.history.length>0?w(p.history):N(`Không tìm thấy lịch sử cho đơn hàng "${i.trim()}".`)}catch(p){const x=p instanceof Error?p.message:"Đã xảy ra lỗi không xác định.";N(x)}finally{o(!1)}},[i]),a=()=>{f(""),w(null),N(null),o(!1),g()};return t?e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-0 md:p-4",onClick:g,children:e.jsxs("div",{className:"bg-surface-card w-full md:max-w-3xl h-[100dvh] md:h-auto md:max-h-[85vh] rounded-none md:rounded-2xl shadow-xl animate-fade-in-scale-up flex flex-col",onClick:p=>p.stopPropagation(),style:I,children:[e.jsxs("header",{className:"flex items-center justify-between p-2.5 border-b border-border-primary flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center bg-blue-100",children:e.jsx("i",{className:"fas fa-history text-lg text-accent-primary"})}),e.jsx("h2",{className:"text-xl font-bold text-text-primary",children:"Tra Cứu Lịch Sử Đơn Hàng"})]}),e.jsx("button",{onClick:a,className:"w-9 h-9 rounded-full flex items-center justify-center text-text-secondary hover:bg-surface-hover",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("main",{className:"p-4 md:p-6 overflow-y-auto flex-grow min-h-0 hidden-scrollbar",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("input",{type:"text",value:i,onChange:p=>f(p.target.value),onKeyPress:p=>p.key==="Enter"&&u(),placeholder:"Nhập Số đơn hàng...",className:"flex-grow bg-surface-ground border border-border-primary rounded-lg p-2 focus:ring-accent-primary focus:border-accent-primary transition futuristic-input"}),e.jsx("button",{onClick:u,disabled:c,className:"btn-primary flex-shrink-0",children:c?e.jsx("i",{className:"fas fa-spinner fa-spin"}):e.jsx("i",{className:"fas fa-search"})})]}),e.jsxs("div",{className:"min-h-[20rem]",children:[c&&e.jsx("div",{className:"flex justify-center items-center h-full pt-16",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-3xl text-accent-primary"})}),r&&e.jsx("div",{className:"text-center pt-16 text-danger bg-danger-bg p-4 rounded-lg",children:r}),!c&&!r&&!m&&e.jsxs("div",{className:"text-center pt-16 text-text-secondary",children:[e.jsx("i",{className:"fas fa-history text-4xl mb-4"}),e.jsx("p",{children:"Nhập số đơn hàng để bắt đầu tra cứu."})]}),m&&e.jsx("div",{className:"mt-4 border-t border-border-primary",children:m.map((p,x)=>e.jsx(Tt,{item:p},x))})]})]}),e.jsx("footer",{className:"p-2 border-t border-border-primary flex justify-end items-center gap-2 bg-surface-ground rounded-b-2xl flex-shrink-0",children:e.jsx("button",{onClick:a,className:"btn-secondary",children:"Đóng"})})]})}):null},Dt=({isOpen:t,onClose:g,onConfirm:i,order:f,suggestedCars:c,showToast:o})=>{const[r,N]=s.useState(c.length>0?c[0].VIN:""),[m,w]=s.useState(!1),I=Ne();if(!t)return null;const u=(p,x)=>{p.stopPropagation(),navigator.clipboard.writeText(x).then(()=>{o("Đã Sao Chép",`Số VIN ${x} đã được sao chép thành công.`,"success",2e3)}).catch(H=>{console.error("Lỗi sao chép VIN: ",H),o("Sao Chép Thất Bại","Không thể truy cập vào clipboard của bạn.","error",3e3)})},a=async()=>{r&&(w(!0),await i(f["Số đơn hàng"],r),w(!1))};return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-0 md:p-4",onClick:g,children:e.jsxs("div",{className:"bg-surface-card w-full md:max-w-2xl h-full md:h-auto md:max-h-[90vh] rounded-none md:rounded-2xl shadow-xl animate-fade-in-scale-up flex flex-col",onClick:p=>p.stopPropagation(),style:I,children:[e.jsx("div",{className:"h-1.5 rounded-t-2xl bg-warning"}),e.jsxs("header",{className:"flex-shrink-0 flex items-start justify-between p-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center bg-yellow-100",children:e.jsx("i",{className:"fas fa-lightbulb text-2xl text-amber-500"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-text-primary",children:"Gợi Ý & Ghép Xe Thủ Công"}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:"Chọn xe phù hợp từ kho để ghép vào đơn hàng."})]})]}),e.jsx("button",{onClick:g,className:"w-9 h-9 rounded-full flex items-center justify-center text-text-secondary hover:bg-surface-hover -mt-2 -mr-2",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("main",{className:"p-3 space-y-2 overflow-y-auto",children:[e.jsx("div",{className:"p-2 bg-surface-ground rounded-lg border border-border-primary space-y-1",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-text-secondary",children:"Khách hàng:"})," ",e.jsx("strong",{className:"text-text-primary",children:f["Tên khách hàng"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-secondary",children:"Số ĐH:"})," ",e.jsx("strong",{className:"text-text-primary font-mono",children:f["Số đơn hàng"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-secondary",children:"Dòng xe:"})," ",e.jsxs("strong",{className:"text-text-primary",children:[f["Dòng xe"]," - ",f["Phiên bản"]]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-text-secondary",children:"Màu:"})," ",e.jsxs("strong",{className:"text-text-primary",children:[f["Ngoại thất"]," / ",f["Nội thất"]]})]})]})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-text-primary mb-2",children:["Tìm thấy ",c.length," xe phù hợp trong kho (ưu tiên xe nhập sớm):"]}),c.length>0?e.jsx("div",{className:"max-h-64 overflow-y-auto border border-border-primary rounded-lg hidden-scrollbar",children:e.jsxs("table",{className:"min-w-full text-sm responsive-table",children:[e.jsx("thead",{className:"bg-surface-hover sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-1 px-1.5 text-left w-10",children:"Chọn"}),e.jsx("th",{className:"py-1 px-1.5 text-left",children:"Số VIN"}),e.jsx("th",{className:"py-1 px-1.5 text-left",children:"Nội Thất"}),e.jsx("th",{className:"py-1 px-1.5 text-left",children:"Ngày Nhập Kho"})]})}),e.jsx("tbody",{className:"divide-y divide-border-primary bg-surface-card",children:c.map(p=>e.jsxs("tr",{className:"hover:bg-surface-hover",children:[e.jsx("td",{className:"py-1.5 px-1.5","data-label":"Chọn",children:e.jsx("input",{type:"radio",name:"suggested-vin",value:p.VIN,checked:r===p.VIN,onChange:()=>N(p.VIN),className:"h-4 w-4 text-accent-primary focus:ring-accent-primary border-border-secondary"})}),e.jsx("td",{className:"py-1.5 px-1.5 font-mono text-text-primary","data-label":"Số VIN",children:e.jsxs("div",{className:"group relative inline-flex items-center gap-2 cursor-pointer",title:"Click để sao chép VIN",onClick:x=>u(x,p.VIN),children:[e.jsx("span",{className:"text-accent-primary group-hover:text-accent-primary-hover font-semibold transition-colors",children:p.VIN}),e.jsx("i",{className:"fas fa-copy text-text-placeholder opacity-0 group-hover:opacity-100 transition-opacity"})]})}),e.jsx("td",{className:"py-1.5 px-1.5 text-text-secondary","data-label":"Nội Thất",children:p["Nội thất"]}),e.jsx("td",{className:"py-1.5 px-1.5 text-text-secondary","data-label":"Ngày Nhập Kho",children:p["Thời gian nhập"]?q(p["Thời gian nhập"]).format("DD/MM/YYYY"):"N/A"})]},p.VIN))})]})}):e.jsxs("div",{className:"text-center py-8 text-text-secondary bg-surface-ground rounded-lg",children:[e.jsx("i",{className:"fas fa-box-open fa-2x mb-3"}),e.jsx("p",{children:"Không tìm thấy xe nào phù hợp trong kho."})]})]})]}),e.jsxs("footer",{className:"flex-shrink-0 px-3 py-2 flex justify-end items-center gap-1.5 bg-surface-ground rounded-b-2xl border-t border-border-primary",children:[e.jsx("button",{onClick:g,disabled:m,className:"btn-secondary",children:"Hủy"}),e.jsx("button",{onClick:a,disabled:m||!r||c.length===0,className:"btn-primary",children:m?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"})," Đang ghép..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-link mr-2"})," Xác Nhận Ghép"]})})]})]})})},It=({isOpen:t,onClose:g,matches:i,onConfirmMatch:f})=>{const c=Ne(),o=s.useMemo(()=>[...i].sort((r,N)=>{const m=u=>{if(!u)return Number.MAX_SAFE_INTEGER;const a=q(u);return a.isValid()?a.valueOf():Number.MAX_SAFE_INTEGER},w=m(r.order["Ngày cọc"]),I=m(N.order["Ngày cọc"]);return w-I}),[i]);return t?e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-0 md:p-4",onClick:g,children:e.jsxs("div",{className:"bg-surface-card w-full md:max-w-3xl h-[100dvh] md:h-auto md:max-h-[85vh] rounded-none md:rounded-2xl shadow-xl animate-fade-in-scale-up flex flex-col",onClick:r=>r.stopPropagation(),style:c,children:[e.jsxs("header",{className:"flex-shrink-0 flex items-center justify-between p-3 border-b border-border-primary bg-surface-card/80 backdrop-blur-sm rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-accent-primary/10 flex items-center justify-center text-accent-primary animate-pulse",children:e.jsx("i",{className:"fas fa-magic text-sm"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gradient leading-tight",children:"Gợi Ý Ghép Xe"}),e.jsxs("p",{className:"text-xs text-text-secondary",children:["Tìm thấy ",e.jsx("strong",{className:"text-accent-primary",children:i.length})," đơn hàng phù hợp."]})]})]}),e.jsx("button",{onClick:g,className:"w-8 h-8 rounded-full flex items-center justify-center text-text-secondary hover:bg-surface-hover transition-colors",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsx("main",{className:"flex-grow min-h-0 overflow-y-auto p-2 bg-surface-ground/50 hidden-scrollbar",children:e.jsx("div",{className:"space-y-2",children:o.map(({order:r,cars:N},m)=>{const w=N[0];return e.jsxs("div",{className:"bg-surface-card border border-border-primary rounded-lg p-2.5 shadow-sm hover:shadow-md transition-all flex flex-col sm:flex-row gap-3 items-center animate-fade-in-up",style:{animationDelay:`${m*30}ms`},children:[e.jsxs("div",{className:"flex-1 min-w-0 w-full relative",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("span",{className:"text-[10px] font-mono text-text-secondary bg-surface-ground px-1 rounded border border-border-secondary/50",children:r["Số đơn hàng"]}),r["Ngày cọc"]&&e.jsxs("span",{className:"text-[10px] text-accent-secondary font-medium",children:[e.jsx("i",{className:"fas fa-money-bill-wave mr-1"}),q(r["Ngày cọc"]).format("DD/MM")]})]}),e.jsx("h3",{className:"font-bold text-text-primary text-sm truncate",children:r["Tên khách hàng"]}),e.jsxs("div",{className:"text-xs text-text-secondary mt-0.5 flex flex-wrap gap-x-2",children:[e.jsxs("span",{className:"font-medium text-text-primary",children:[r["Dòng xe"]," ",r["Phiên bản"]]}),e.jsxs("span",{className:"flex items-center gap-1",style:ot(r["Ngoại thất"]),children:["• ",r["Ngoại thất"]]}),e.jsxs("span",{className:"flex items-center gap-1",style:dt(r["Nội thất"]),children:["/ ",r["Nội thất"]]})]})]}),e.jsx("div",{className:"hidden sm:flex flex-col items-center justify-center text-border-secondary",children:e.jsx("i",{className:"fas fa-chevron-right text-sm"})}),e.jsxs("div",{className:"flex-shrink-0 w-full sm:w-auto border-t sm:border-t-0 sm:border-l border-border-primary pt-2 sm:pt-0 sm:pl-3 flex sm:flex-col items-center sm:items-end justify-between sm:justify-center gap-2",children:[e.jsxs("div",{className:"text-left sm:text-right",children:[e.jsx("div",{className:"flex items-center sm:justify-end gap-1.5 mb-0.5",children:e.jsxs("span",{className:"text-[10px] font-bold text-success bg-success-bg px-1.5 rounded-full",children:["Kho: ",N.length]})}),e.jsx("p",{className:"font-mono font-bold text-base text-text-primary tracking-wide",children:w.VIN})]}),e.jsxs("button",{onClick:()=>f(r["Số đơn hàng"],w.VIN),className:"btn-primary !px-3 !py-1.5 !text-xs !h-auto shadow-sm hover:shadow transition-all active:scale-95 flex-shrink-0 whitespace-nowrap",children:[e.jsx("i",{className:"fas fa-link mr-1.5"}),"Ghép Ngay"]})]})]},r["Số đơn hàng"])})})}),e.jsx("footer",{className:"flex-shrink-0 p-2.5 border-t border-border-primary bg-surface-card rounded-b-2xl flex justify-end",children:e.jsx("button",{onClick:g,className:"btn-secondary !py-1.5 !px-4 !text-sm",children:"Đóng"})})]})}):null},At=t=>new Promise((g,i)=>{const f=new FileReader;f.readAsDataURL(t),f.onload=()=>g(f.result.split(",")[1]),f.onerror=c=>i(c)}),Ht=({isOpen:t,onClose:g,onSuccess:i,showToast:f,hideToast:c})=>{const[o,r]=s.useState([]),[N,m]=s.useState(!1),[w,I]=s.useState(!1),u=s.useRef(null),a=Ne();s.useEffect(()=>{t&&(r([]),m(!1))},[t]);const p=s.useCallback(()=>{r([]),m(!1),g()},[g]),x=s.useCallback(async h=>{if(!h)return;f("Đang xử lý",`Đang chuẩn bị ${h.length} tệp...`,"loading");const V=Array.from(h),X=await Promise.all(V.map(async Y=>Y));c();const L=X.map(Y=>{const U=/^(N\d{5}-VSO-\d{2}-\d{2}-\d{4})/i,J=Y.name.match(U),W=J?J[1].toUpperCase():null;return{file:Y,orderNumber:W,status:W?"valid":"invalid_name"}});r(Y=>{const U=new Set(Y.map(W=>W.file.name)),J=L.filter(W=>!U.has(W.file.name));return[...Y,...J]})},[f,c]),H=h=>{h.preventDefault(),h.stopPropagation(),h.type==="dragenter"||h.type==="dragover"?I(!0):h.type==="dragleave"&&I(!1)},C=h=>{h.preventDefault(),h.stopPropagation(),I(!1),h.dataTransfer.files&&x(h.dataTransfer.files)},k=h=>{h.preventDefault(),h.target.files&&x(h.target.files)},R=h=>{r(V=>V.filter(X=>X.file.name!==h))},d=async()=>{const h=o.filter(V=>V.status==="valid");if(h.length===0){f("Không có tệp hợp lệ","Vui lòng chọn các tệp có tên đúng định dạng.","warning");return}m(!0),f("Đang tải lên...",`Chuẩn bị tải lên ${h.length} hóa đơn.`,"loading");try{const V=await Promise.all(h.map(async({file:L,orderNumber:Y})=>({orderNumber:Y,base64Data:await At(L),mimeType:L.type,fileName:L.name}))),X=await ht(V);c(),f("Hoàn tất!",X.message,X.status==="SUCCESS"?"success":"warning",1e4),X.status==="SUCCESS"&&(i(),p())}catch(V){c();const X=V instanceof Error?V.message:"Lỗi không xác định.";f("Tải lên thất bại",X,"error")}finally{m(!1)}};if(!t)return null;const b=o.filter(h=>h.status==="valid");return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-0 md:p-4",onClick:g,children:e.jsxs("div",{className:"bg-surface-card w-full md:max-w-4xl h-full md:h-auto md:max-h-[90vh] rounded-none md:rounded-2xl shadow-xl animate-fade-in-scale-up flex flex-col",onClick:h=>h.stopPropagation(),style:a,children:[e.jsx("div",{className:"h-1.5 rounded-t-none md:rounded-t-2xl bg-accent-primary flex-shrink-0"}),e.jsxs("header",{className:"flex-shrink-0 p-3 border-b border-border-primary flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-text-primary",children:"Tải Lên Hóa Đơn Hàng Loạt"}),e.jsx("button",{onClick:p,className:"w-9 h-9 rounded-full flex items-center justify-center text-text-secondary hover:bg-surface-hover -mt-1 -mr-1",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("main",{className:"p-4 md:p-6 overflow-y-auto flex-grow min-h-0",children:[e.jsxs("div",{onDragEnter:H,onDragOver:H,onDragLeave:H,onDrop:C,className:"w-full",children:[e.jsx("input",{ref:u,type:"file",multiple:!0,className:"hidden",accept:".pdf,.png,.jpg,.jpeg",onChange:k}),e.jsx("div",{className:`relative w-full h-40 border-2 border-dashed rounded-lg flex items-center justify-center transition-all duration-300 group cursor-pointer overflow-hidden bg-surface-ground ${w?"border-accent-primary bg-surface-accent":"border-border-primary"}`,onClick:()=>{var h;return(h=u.current)==null?void 0:h.click()},children:e.jsxs("div",{className:"text-center text-text-placeholder group-hover:text-text-primary transition-colors",children:[e.jsx("i",{className:"fas fa-file-upload fa-3x mb-2 group-hover:text-accent-primary"}),e.jsx("p",{className:"font-semibold text-text-primary",children:"Kéo & thả hoặc nhấn để tải file"}),e.jsx("p",{className:"text-xs",children:"Định dạng tên file: SỐ_ĐƠN_HÀNG.pdf (VD: N31913-VSO-25-01-0001.pdf)"})]})})]}),o.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("h3",{className:"text-sm font-semibold mb-2",children:["Tệp đã chọn: (",o.length,")"]}),e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-2 border p-1 rounded-lg bg-surface-ground hidden-scrollbar",children:o.map((h,V)=>e.jsxs("div",{className:`flex items-center gap-1.5 p-1 rounded-md border ${h.status==="invalid_name"?"bg-danger-bg border-danger-bg":"bg-white border-border-secondary"}`,children:[e.jsx("i",{className:`fas ${h.status==="invalid_name"?"fa-exclamation-triangle text-danger":"fa-file-alt text-accent-secondary"}`}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:h.file.name}),e.jsx("p",{className:`text-xs ${h.status==="invalid_name"?"text-danger font-semibold":"text-text-secondary"}`,children:h.status==="invalid_name"?"Sai định dạng SĐH":`SĐH: ${h.orderNumber}`})]}),e.jsx("button",{onClick:()=>R(h.file.name),className:"flex-shrink-0 w-6 h-6 rounded-full hover:bg-surface-hover flex items-center justify-center",children:e.jsx("i",{className:"fas fa-times text-xs"})})]},V))})]})]}),e.jsxs("footer",{className:"flex-shrink-0 px-3 py-2 border-t border-border-primary flex justify-end items-center gap-1.5 bg-surface-ground rounded-none md:rounded-b-2xl",children:[e.jsx("div",{onClick:N?void 0:p,title:"Hủy",className:`cursor-pointer ${N?"opacity-50 cursor-not-allowed":"hover:scale-110 transition-transform"}`,children:e.jsx("lottie-player",{src:Be,background:"transparent",speed:"1",style:{width:"52px",height:"52px"},loop:!0,autoplay:!0})}),e.jsx("div",{onClick:!N&&b.length>0?d:void 0,title:"Tải Lên & Hoàn Tất",className:`cursor-pointer flex items-center justify-center w-[52px] h-[52px] ${N||b.length===0?"opacity-50 cursor-not-allowed":"hover:scale-110 transition-transform"}`,children:N?e.jsx("i",{className:"fas fa-spinner fa-spin text-2xl text-accent-primary"}):e.jsx("lottie-player",{src:Xe,background:"transparent",speed:"1",style:{width:"52px",height:"52px"},loop:!0,autoplay:!0})})]})]})})},Vt=({initialState:t,clearInitialState:g})=>{const[i,f]=s.useState("dashboard"),[c,o]=s.useState({keyword:"",tvbh:[],dongXe:[],version:[],exterior:[],trangThai:[]}),[r,N]=s.useState({keyword:"",tvbh:[],dongXe:[],version:[],exterior:[]}),[m,w]=s.useState({keyword:"",tvbh:[],dongXe:[],version:[],exterior:[]}),[I,u]=s.useState({keyword:"",nguoiyc:[],trangthai:[]}),[a,p]=s.useState({keyword:"",tvbh:[],dongXe:[],version:[],ngoaiThat:[]});s.useEffect(()=>{if(t){if(t.targetTab&&f(t.targetTab),t.orderToShow){const C=t.orderToShow;let k=t.targetTab;if(!k){const b=(C["Trạng thái xử lý"]||C["Kết quả"]||"N/A").toLowerCase();b.includes("chưa")?k="pending":b==="đã ghép"?k="paired":k="invoices"}f(k),o({keyword:"",tvbh:[],dongXe:[],version:[],exterior:[],trangThai:[]}),N({keyword:"",tvbh:[],dongXe:[],version:[],exterior:[]}),w({keyword:"",tvbh:[],dongXe:[],version:[],exterior:[]}),u({keyword:"",nguoiyc:[],trangthai:[]}),p({keyword:"",tvbh:[],dongXe:[],version:[],ngoaiThat:[]});const R=C["Số đơn hàng"];k==="invoices"?o(d=>({...d,keyword:R})):k==="pending"?N(d=>({...d,keyword:R})):k==="paired"?w(d=>({...d,keyword:R})):k==="matching"&&p(d=>({...d,keyword:R}))}g()}},[t,g]);const x=s.useCallback(C=>{i==="invoices"?o(k=>({...k,...C})):i==="pending"?N(k=>({...k,...C})):i==="paired"?w(k=>({...k,...C})):i==="vc"?u(k=>({...k,...C})):i==="matching"&&p(k=>({...k,...C}))},[i]),H=s.useCallback(()=>{i==="invoices"?o({keyword:"",tvbh:[],dongXe:[],version:[],exterior:[],trangThai:[]}):i==="pending"?N({keyword:"",tvbh:[],dongXe:[],version:[],exterior:[]}):i==="paired"?w({keyword:"",tvbh:[],dongXe:[],version:[],exterior:[]}):i==="vc"?u({keyword:"",nguoiyc:[],trangthai:[]}):i==="matching"&&p({keyword:"",tvbh:[],dongXe:[],version:[],ngoaiThat:[]})},[i]);return{adminView:i,setAdminView:f,invoiceFilters:c,pendingFilters:r,pairedFilters:m,vcFilters:I,matchingFilters:a,handleFilterChange:x,handleReset:H,setInvoiceFilters:o,setPendingFilters:N,setPairedFilters:w,setVcFilters:u,setMatchingFilters:p}},Pt=({showToast:t,hideToast:g,refetchHistory:i,refetchStock:f,refetchXuathoadon:c,refetchAdminData:o,fetchVcData:r,teamData:N,allOrders:m,suggestionsMap:w,selectedRows:I,setSelectedRows:u,setShowMatchingModal:a})=>{const[p,x]=s.useState(null),[H,C]=s.useState(null),[k,R]=s.useState(null),[d,b]=s.useState(null),[h,V]=s.useState(null),[X,L]=s.useState(!1),[Y,U]=s.useState(null),[J,W]=s.useState(!1),[v,T]=s.useState(null),y=(v==null?void 0:v.id)||null,D=s.useCallback(async(A,K,G,O="history")=>{try{return await xt(A,K),x(null),b(null),R(null),u(new Set),C(null),a(!1),g(),t("Thành công!",G||"Thao tác thành công.","success"),(O==="history"||O==="both")&&(i(!0),c(!0)),(O==="stock"||O==="both")&&f(!0),O==="admin"&&o(!0),(A.toLowerCase().includes("vcrequest")||A.toLowerCase().includes("vc"))&&r(!0),!0}catch(M){g();const j=M instanceof Error?M.message:"Đã xảy ra lỗi.";return t("Thao tác thất bại",j,"error"),!1}},[t,g,i,c,f,o,r,u,a]),Z=s.useCallback(A=>{V(null),t("Thành công!",A,"success"),i(!0),c(!0)},[t,i,c]),ne=s.useCallback(async(A,K)=>D("updateRowData",{sheetName:"Xuathoadon",primaryKeyColumn:"SỐ ĐƠN HÀNG",primaryKeyValue:A,"SỐ ĐỘNG CƠ":K.engineNumber,"CHÍNH SÁCH":K.policy,"Hoa hồng ứng":K.commission,"Điểm Vpoint sử dụng":K.vpoint},"Đã cập nhật thông tin hóa đơn.","history"),[D]),Q=s.useCallback(async(A,K={})=>{if(I.size===0)return t("Lỗi","Không có mục nào được chọn.","error"),!1;const G=Array.from(I),O=`Đã thực hiện thao tác cho ${G.length} mục.`,j={approve:"approveSelectedInvoiceRequest",pendingSignature:"markAsPendingSignature",supplement:"requestSupplementForInvoice",cancel:"cancelRequest"}[A]||A,E=await D(j,{...K,orderNumbers:JSON.stringify(G)},O);return E&&(C(null),u(new Set)),E},[I,D,t,u]),le=async(A,K,G)=>{if(A==="manualMatch"){const O=w.get(K["Số đơn hàng"])||[];R({order:K,cars:O})}else if(A==="pair"&&(G!=null&&G.vin)){T({id:K["Số đơn hàng"],type:A});try{await l(K["Số đơn hàng"],G.vin)}finally{T(null)}}else if(A==="requestInvoice")m.find(M=>M["Số đơn hàng"]===K["Số đơn hàng"])&&t("Chức năng đang phát triển","Yêu cầu xuất hóa đơn từ Admin Panel sẽ sớm được cập nhật.","info");else if(A==="approve"){T({id:K["Số đơn hàng"],type:A});try{await D("approveSelectedInvoiceRequest",{orderNumbers:JSON.stringify([K["Số đơn hàng"]])},"Đã phê duyệt yêu cầu.")}finally{T(null)}}else if(A==="pendingSignature"){T({id:K["Số đơn hàng"],type:A});try{await D("markAsPendingSignature",{orderNumbers:JSON.stringify([K["Số đơn hàng"]])},"Đã chuyển trạng thái.")}finally{T(null)}}else if(A==="uploadInvoice"&&(G!=null&&G.file)){T({id:K["Số đơn hàng"],type:A});try{const O=G.file,j=await(E=>new Promise((P,n)=>{const z=new FileReader;z.readAsDataURL(E),z.onload=()=>P(z.result.split(",")[1]),z.onerror=oe=>n(oe)}))(O);await D("handleBulkUploadIssuedInvoices",{filesData:JSON.stringify([{orderNumber:K["Số đơn hàng"],base64Data:j,mimeType:O.type,fileName:O.name}])},"Đã tải lên hóa đơn thành công.")}catch{t("Lỗi","Không thể đọc file.","error")}finally{T(null)}}else if(A==="edit")V(K);else if(A==="approveVc"){T({id:K["Số đơn hàng"],type:A});try{await D("approveVcRequest",{orderNumber:K["Số đơn hàng"]},"Đã phê duyệt yêu cầu VC.")}finally{T(null)}}else x({type:A,order:K})},ce=async A=>{const K=M=>{if(!M||!M.includes("drive.google.com"))return M;const j=M.match(/id=([a-zA-Z0-9_-]{25,})/)||M.match(/\/d\/([a-zA-Z0-9_-]{25,})/);return j&&j[1]?`https://drive.google.com/uc?export=download&id=${j[1]}`:M};let G={};try{A.FileUrls?G=JSON.parse(A.FileUrls):A["URL hình ảnh"]&&(G={unc:A["URL hình ảnh"]})}catch{g(),t("Lỗi","Không thể đọc danh sách tệp.","error");return}const O=Object.entries(G);if(O.length===0){g(),t("Không có tệp","Không tìm thấy tệp nào để tải xuống.","info");return}for(let M=0;M<O.length;M++){const[,j]=O[M],E=K(j);if(E){const P=document.createElement("iframe");P.style.display="none",P.src=E,document.body.appendChild(P),setTimeout(()=>{P.parentNode&&P.parentNode.removeChild(P)},1e4),M<O.length-1&&await new Promise(n=>setTimeout(n,1e3))}}g(),t("Hoàn tất",`Đã bắt đầu tải xuống ${O.length} tệp.`,"success")},l=async(A,K)=>{await D("manualMatchCar",{orderNumber:A,vin:K},`Đã ghép thành công ĐH ${A}.`,"both")},$=async A=>{await D("updateTeams",{teams:JSON.stringify(A)},"Cập nhật phòng ban thành công.","admin"),U(null),W(!1)},_=async A=>{if(window.confirm(`Bạn có chắc chắn muốn giải tán phòng của "${A}"? Các thành viên sẽ không bị xóa khỏi hệ thống.`)){const G={...N};delete G[A],await $(G)}},ae=s.useCallback(()=>b(null),[]),me=s.useCallback(()=>C(null),[]),F=s.useCallback(()=>D("archiveInvoicedOrdersMonthly",{},"Đã lưu trữ hóa đơn thành công.","history"),[D]),re=s.useCallback(A=>D("findAndAddCarByVin",{vin:A.vin},"Thêm xe thành công.","stock"),[D]),ue=s.useCallback(A=>D("deleteCarFromStockLogic",A,"Đã xóa xe thành công.","stock"),[D]),de=s.useCallback(A=>D("restoreCarToStockLogic",A,"Đã phục hồi xe thành công.","stock"),[D]),pe=s.useCallback(A=>D("addUser",A,`Đã tạo tài khoản cho ${A.fullName} và gửi email.`,"admin"),[D]),ee=s.useCallback(A=>D("deleteOrderLogic",A,"Đã xóa đơn hàng thành công.","history"),[D]),he=s.useCallback(A=>D("revertOrderStatus",A,"Đã hoàn tác trạng thái đơn hàng.","history"),[D]),xe=s.useCallback(()=>Q("approve"),[Q]),fe=s.useCallback(()=>Q("pendingSignature"),[Q]),we=s.useCallback(A=>Q("cancel",{reason:A.reason}),[Q]),be=s.useCallback((A,K)=>Q("supplement",{reason:A,pastedImagesBase64:JSON.stringify(K)}),[Q]);return{invoiceModalState:p,setInvoiceModalState:x,bulkActionModal:H,setBulkActionModal:C,suggestionModalState:k,setSuggestionModalState:R,adminModal:d,setAdminModal:b,editingOrder:h,setEditingOrder:V,isBulkUploadModalOpen:X,setIsBulkUploadModalOpen:L,editingTeam:Y,setEditingTeam:U,isAddingNewTeam:J,setIsAddingNewTeam:W,handleAdminSubmit:D,handleEditSuccess:Z,handleEditInvoiceDetails:ne,handleBulkActionSubmit:Q,handleAction:le,handleDownloadAllVcImages:ce,handleConfirmSuggestion:l,handleSaveTeam:$,handleDeleteTeam:_,handleCloseAdminModal:ae,handleCloseBulkActionModal:me,handleArchiveSubmit:F,handleAddCarSubmit:re,handleDeleteCarSubmit:ue,handleRestoreCarSubmit:de,handleAddUserSubmit:pe,handleDeleteOrderSubmit:ee,handleRevertOrderSubmit:he,handleBulkApproveSubmit:xe,handleBulkPendingSignatureSubmit:fe,handleBulkCancelSubmit:we,handleBulkSupplementSubmit:be,processingId:y,processingActionType:(v==null?void 0:v.type)||null}},$t=({allOrders:t,xuathoadonData:g,stockData:i,invoiceFilters:f,pendingFilters:c,pairedFilters:o,vcFilters:r,isSidebarCollapsed:N})=>{const m=N?14:12,[w,I]=s.useState({key:"Thời gian nhập",direction:"desc"}),[u,a]=s.useState({key:"Thời gian nhập",direction:"desc"}),[p,x]=s.useState({key:"Thời gian ghép",direction:"desc"}),[H,C]=s.useState({key:"Thời gian YC",direction:"desc"}),[k,R]=s.useState(1),[d,b]=s.useState([]),[h,V]=s.useState(!0),[X,L]=s.useState(null),[Y,U]=s.useState(new Set),J=s.useCallback(async(F=!1)=>{F||V(!0),L(null);try{const re=await mt();b(re.data||[])}catch(re){const ue=re instanceof Error?re.message:"Lỗi không xác định khi tải yêu cầu VC.";L(ue)}finally{F||V(!1)}},[]);s.useEffect(()=>{J()},[J]),s.useEffect(()=>{Fe();const F=setInterval(()=>{Fe()},12e4);return()=>clearInterval(F)},[]);const{processedInvoices:W,invoiceRequests:v,pendingData:T,pairedData:y,vcRequests:D,suggestionsMap:Z,filterOptions:ne,ordersWithMatches:Q}=s.useMemo(()=>{const F=new Map;t.forEach(M=>{M["Số đơn hàng"]&&F.set(M["Số đơn hàng"],M)});const re=g.filter(M=>M&&M["SỐ ĐƠN HÀNG"]).map(M=>{const j=M["SỐ ĐƠN HÀNG"],E=F.get(j),P={"Số đơn hàng":j,"Tên khách hàng":M["TÊN KHÁCH HÀNG"],"Dòng xe":M["DÒNG XE"],"Phiên bản":M["PHIÊN BẢN"],"Ngoại thất":M["NGOẠI THẤT"],"Nội thất":M["NỘI THẤT"],"Tên tư vấn bán hàng":M["TƯ VẤN BÁN HÀNG"],VIN:M["SỐ VIN"],"Số động cơ":M["SỐ ĐỘNG CƠ"],"Thời gian nhập":M["NGÀY YÊU CẦU XHĐ"],"Ngày xuất hóa đơn":M["NGÀY XUẤT HÓA ĐƠN"],"Hoa hồng ứng":M["Hoa hồng ứng"],"Điểm Vpoint sử dụng":M["Điểm Vpoint sử dụng"],"CHÍNH SÁCH":M["CHÍNH SÁCH"],"Ngày cọc":M["NGÀY CỌC"],"BÁO BÁN":M["BÁO BÁN"],"KẾT QUẢ GỬI MAIL":M["KẾT QUẢ GỬI MAIL"],LinkHopDong:M["URL Hợp Đồng"],LinkDeNghiXHD:M["URL Đề Nghị XHĐ"],LinkHoaDonDaXuat:M["URL Hóa Đơn Đã Xuất"],"Kết quả":"N/A"};return E?(P["Kết quả"]=E["Trạng thái VC"]||E["Kết quả"]||"Không rõ",Object.keys(E).forEach(n=>{P[n]||(P[n]=E[n])})):P["Kết quả"]="Đã xuất hóa đơn",P["Trạng thái xử lý"]=P["Kết quả"],P}),ue=d.map(M=>{const j=F.get(M["Số đơn hàng"]);return{...M,VIN:j==null?void 0:j.VIN,"Dòng xe":j==null?void 0:j["Dòng xe"],"Phiên bản":j==null?void 0:j["Phiên bản"],"Ngoại thất":j==null?void 0:j["Ngoại thất"],"Nội thất":j==null?void 0:j["Nội thất"]}}),de=t.filter(M=>String(M["Kết quả"]||"").toLowerCase().includes("chưa")),pe=t.filter(M=>String(M["Kết quả"]||"").toLowerCase()==="đã ghép"),ee=new Map;if(i&&de.length>0){const M=i.filter(E=>{var P;return((P=E["Trạng thái"])==null?void 0:P.toLowerCase())==="chưa ghép"}),j=E=>(E||"").toLowerCase().trim().normalize("NFC");M.forEach(E=>{de.forEach(P=>{if(j(E["Dòng xe"])===j(P["Dòng xe"])&&j(E["Phiên bản"])===j(P["Phiên bản"])&&j(E["Ngoại thất"])===j(P["Ngoại thất"])&&j(P["Nội thất"]).includes(j(E["Nội thất"]))){const n=ee.get(P["Số đơn hàng"])||[];ee.set(P["Số đơn hàng"],[...n,E])}})}),ee.forEach(E=>E.sort((P,n)=>new Date(P["Thời gian nhập"]||0).getTime()-new Date(n["Thời gian nhập"]||0).getTime()))}const he=de.filter(M=>ee.has(M["Số đơn hàng"])).map(M=>({order:M,cars:ee.get(M["Số đơn hàng"])||[]})),xe=(M,j,E)=>{var n;const P=((n=j.keyword)==null?void 0:n.toLowerCase())??"";return M.filter(z=>{var Ce,Te,Me;const oe=E==="vc"?j.nguoiyc.length===0||j.nguoiyc.includes(z["Người YC"]):j.tvbh.length===0||j.tvbh.includes(z["Tên tư vấn bán hàng"]),ye=E!=="vc"?j.dongXe.length===0||j.dongXe.includes(z["Dòng xe"]):!0,ge=E!=="vc"?((Ce=j.version)==null?void 0:Ce.length)===0||!j.version||j.version.includes(z["Phiên bản"]):!0;let ve=!0;E==="matching"?ve=((Te=j.ngoaiThat)==null?void 0:Te.length)===0||!j.ngoaiThat||j.ngoaiThat.includes(z["Ngoại thất"]):E!=="vc"&&(ve=((Me=j.exterior)==null?void 0:Me.length)===0||!j.exterior||j.exterior.includes(z["Ngoại thất"]));let Se=!0;E==="invoices"&&j.trangThai?Se=j.trangThai.length===0||j.trangThai.includes(z["Trạng thái xử lý"]):E==="vc"&&j.trangthai&&(Se=j.trangthai.length===0||j.trangthai.includes(z["Trạng thái xử lý"]));const Ve=z["Mã KH DMS"],Pe=!P||te(z["Số đơn hàng"],P)||te(z["Tên khách hàng"],P)||te(z.VIN,P)||te(Ve,P)||te(z["Dòng xe"],P)||te(z["Phiên bản"],P)||te(z["Ngoại thất"],P)||te(z["Nội thất"],P)||te(z["Tên tư vấn bán hàng"],P)||te(z["CHÍNH SÁCH"],P)||te(z["Số động cơ"],P);return oe&&ye&&ge&&ve&&Se&&Pe})},fe=xe(re,f,"invoices"),we=xe(de,c,"pending"),be=xe(pe,o,"paired"),A=xe(ue,r,"vc"),K=(M,j)=>{let E=[...M];return j&&E.sort((P,n)=>{const z=P[j.key],oe=n[j.key];if(["Thời gian nhập","Thời gian ghép","Thời gian YC"].includes(String(j.key))){const ye=z?new Date(z).getTime():0,ge=oe?new Date(oe).getTime():0;return ye<ge?j.direction==="asc"?-1:1:ye>ge?j.direction==="asc"?1:-1:0}return z?oe?String(z)<String(oe)?j.direction==="asc"?-1:1:String(z)>String(oe)?j.direction==="asc"?1:-1:0:-1:1}),E},G=K(we,u);G.sort((M,j)=>{const E=ee.has(M["Số đơn hàng"]),P=ee.has(j["Số đơn hàng"]);return E&&!P?-1:!E&&P?1:0});const O=(M,j)=>{const E={};j.forEach(n=>E[n]=new Set),M.forEach(n=>{j.forEach(z=>{const oe=z==="Kết quả"||z==="Trạng thái xử lý"?n["Trạng thái xử lý"]:n[z];oe&&E[z].add(oe)})});const P={};return j.forEach(n=>P[n]=Array.from(E[n]).sort()),P};return{processedInvoices:re,invoiceRequests:K(fe,w),pendingData:G,pairedData:K(be,p),vcRequests:K(A,H),suggestionsMap:ee,ordersWithMatches:he,filterOptions:{invoices:O(re,["Tên tư vấn bán hàng","Dòng xe","Phiên bản","Ngoại thất","Kết quả"]),pending:O(de,["Tên tư vấn bán hàng","Dòng xe","Phiên bản","Ngoại thất"]),paired:O(pe,["Tên tư vấn bán hàng","Dòng xe","Phiên bản","Ngoại thất"]),vc:O(ue,["Người YC","Trạng thái xử lý"])}}},[t,g,i,w,u,p,H,f,c,o,r,d]),le=s.useMemo(()=>v.slice((k-1)*m,k*m),[v,k,m]),ce=Math.ceil(v.length/m);s.useEffect(()=>{k>ce&&ce>0&&R(ce)},[k,ce]);const l=s.useMemo(()=>v.map(F=>F["Số đơn hàng"]),[v]),$=s.useMemo(()=>T.map(F=>F["Số đơn hàng"]),[T]),_=s.useMemo(()=>y.map(F=>F["Số đơn hàng"]),[y]),ae=s.useMemo(()=>D.map(F=>F["Số đơn hàng"]),[D]);return{sortConfig:w,setSortConfig:I,pendingSortConfig:u,setPendingSortConfig:a,pairedSortConfig:p,setPairedSortConfig:x,vcSortConfig:H,setVcSortConfig:C,currentPage:k,setCurrentPage:R,vcRequestsData:d,isLoadingVc:h,errorVc:X,selectedRows:Y,setSelectedRows:U,handleToggleAll:F=>{Y.size>=F.length?U(new Set):U(new Set(F))},fetchVcData:J,processedInvoices:W,invoiceRequests:v,pendingData:T,pairedData:y,vcRequests:D,suggestionsMap:Z,filterOptions:ne,ordersWithMatches:Q,paginatedInvoices:le,totalInvoicePages:ce,allInvoiceOrderNumbers:l,allPendingOrderNumbers:$,allPairedOrderNumbers:_,allVcOrderNumbers:ae}},Lt=({adminView:t,invoiceFilters:g,pendingFilters:i,pairedFilters:f,vcFilters:c,matchingFilters:o,handleFilterChange:r,handleReset:N,filterOptions:m,invoiceRequests:w,pendingData:I,pairedData:u,vcRequests:a,refetchXuathoadon:p,refetchHistory:x,fetchVcData:H,isLoadingXuathoadon:C,isLoadingHistory:k,isLoadingVc:R})=>{if(["dashboard","phongkd","activityLog","activeUsers"].includes(t))return null;let d,b=[],h="Tìm kiếm...",V=0,X=()=>{},L=!1;switch(t){case"invoices":d=g,b=[{id:"admin-filter-tvbh",key:"tvbh",label:"TVBH",options:m.invoices["Tên tư vấn bán hàng"],icon:"fa-user-tie"},{id:"admin-filter-dongxe",key:"dongXe",label:"Dòng Xe",options:m.invoices["Dòng xe"],icon:"fa-car"},{id:"admin-filter-version",key:"version",label:"Phiên Bản",options:m.invoices["Phiên bản"],icon:"fa-cogs"},{id:"admin-filter-exterior",key:"exterior",label:"Ngoại Thất",options:m.invoices["Ngoại thất"],icon:"fa-palette"},{id:"admin-filter-status",key:"trangThai",label:"Trạng Thái",options:m.invoices["Kết quả"],icon:"fa-tag"}],h="Tìm SĐH, Tên KH, VIN...",V=w.length,X=()=>p(),L=C;break;case"pending":d=i,b=[{id:"admin-filter-tvbh-pending",key:"tvbh",label:"TVBH",options:m.pending["Tên tư vấn bán hàng"],icon:"fa-user-tie"},{id:"admin-filter-dongxe-pending",key:"dongXe",label:"Dòng Xe",options:m.pending["Dòng xe"],icon:"fa-car"},{id:"admin-filter-version-pending",key:"version",label:"Phiên Bản",options:m.pending["Phiên bản"],icon:"fa-cogs"},{id:"admin-filter-exterior-pending",key:"exterior",label:"Ngoại Thất",options:m.pending["Ngoại thất"],icon:"fa-palette"}],h="Tìm SĐH, Tên KH...",V=I.length,X=()=>x(),L=k;break;case"paired":d=f,b=[{id:"admin-filter-tvbh-paired",key:"tvbh",label:"TVBH",options:m.paired["Tên tư vấn bán hàng"],icon:"fa-user-tie"},{id:"admin-filter-dongxe-paired",key:"dongXe",label:"Dòng Xe",options:m.paired["Dòng xe"],icon:"fa-car"},{id:"admin-filter-version-paired",key:"version",label:"Phiên Bản",options:m.paired["Phiên bản"],icon:"fa-cogs"},{id:"admin-filter-exterior-paired",key:"exterior",label:"Ngoại Thất",options:m.paired["Ngoại thất"],icon:"fa-palette"}],h="Tìm SĐH, Tên KH, VIN...",V=u.length,X=()=>x(),L=k;break;case"matching":d=o,b=[{id:"admin-filter-tvbh-matching",key:"tvbh",label:"TVBH",options:m.pending["Tên tư vấn bán hàng"],icon:"fa-user-tie"},{id:"admin-filter-dongxe-matching",key:"dongXe",label:"Dòng Xe",options:m.pending["Dòng xe"],icon:"fa-car"},{id:"admin-filter-version-matching",key:"version",label:"Phiên Bản",options:m.pending["Phiên bản"],icon:"fa-cogs"},{id:"admin-filter-ngoaithat-matching",key:"ngoaiThat",label:"Ngoại Thất",options:m.pending["Ngoại thất"],icon:"fa-palette"}],h="Tìm SĐH, Tên KH...",V=I.length,X=()=>x(),L=k;break;case"vc":d=c,b=[{id:"admin-filter-nguoiyc-vc",key:"nguoiyc",label:"Người YC",options:m.vc["Người YC"],icon:"fa-user-tie"},{id:"admin-filter-trangthai-vc",key:"trangthai",label:"Trạng Thái",options:m.vc["Trạng thái xử lý"],icon:"fa-tag"}],h="Tìm SĐH, Tên KH, VIN, Mã DMS...",V=a.length,X=()=>H(),L=R;break;default:return null}return e.jsx(ut,{filters:d,onFilterChange:r,onReset:N,dropdowns:b,searchPlaceholder:h,totalCount:V,onRefresh:X,isLoading:L,hideSearch:!1,size:"compact",dropdownClassName:"w-16 md:w-20 lg:w-24",searchable:!1})},Et=({teamData:t,onEditTeam:g,onAddNewTeam:i,onDeleteTeam:f})=>{const[c,o]=s.useState("all"),[r,N]=s.useState(null),[m,w]=s.useState("folders"),I=s.useMemo(()=>Object.entries(t).sort(([C],[k])=>C.localeCompare(k)),[t]),u=s.useMemo(()=>I.filter(([C,k])=>c==="empty"?k.length===0:!0),[I,c]);s.useEffect(()=>{window.innerWidth>=768&&!r&&u.length>0&&N(u[0][0])},[u,r]);const a=s.useMemo(()=>r?t[r]:null,[t,r]),p=[{id:"all",label:"Tất Cả",icon:"fa-users",count:I.length},{id:"empty",label:"Trống",icon:"fa-user-slash",count:I.filter(([C,k])=>k.length===0).length}],x=C=>{o(C),w("list")},H=C=>{N(C),w("detail")};return e.jsxs("div",{className:"flex h-full bg-surface-card rounded-xl shadow-md border border-border-primary overflow-hidden animate-fade-in relative",children:[e.jsxs("div",{className:`w-full md:w-64 flex-shrink-0 border-r border-border-primary bg-surface-ground flex flex-col absolute md:relative inset-0 z-10 md:z-auto transition-transform duration-300 ${m==="folders"?"translate-x-0":"-translate-x-full md:translate-x-0"}`,children:[e.jsx("div",{className:"p-4 border-b border-border-primary",children:e.jsxs("button",{onClick:i,className:"w-full btn-primary flex items-center justify-center gap-2",children:[e.jsx("i",{className:"fas fa-plus"}),e.jsx("span",{children:"Tạo Phòng Mới"})]})}),e.jsx("nav",{className:"flex-1 p-2 space-y-1 overflow-y-auto",children:p.map(C=>e.jsxs("button",{onClick:()=>x(C.id),className:`w-full flex items-center justify-between px-3 py-2 rounded-lg text-xs font-medium transition-colors ${c===C.id?"bg-accent-primary/10 text-accent-primary":"text-text-secondary hover:bg-surface-hover hover:text-text-primary"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("i",{className:`fas ${C.icon} w-5 text-center`}),e.jsx("span",{children:C.label})]}),C.count>0&&e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${c===C.id?"bg-accent-primary text-white":"bg-surface-hover text-text-secondary"}`,children:C.count})]},C.id))})]}),e.jsxs("div",{className:`w-full md:w-80 flex-shrink-0 border-r border-border-primary flex flex-col bg-white absolute md:relative inset-0 z-20 md:z-auto transition-transform duration-300 ${m==="list"?"translate-x-0":m==="detail"?"-translate-x-full md:translate-x-0":"translate-x-full md:translate-x-0"}`,children:[e.jsxs("div",{className:"p-3 border-b border-border-secondary bg-surface-ground flex items-center gap-2",children:[e.jsx("button",{onClick:()=>w("folders"),className:"md:hidden w-8 h-8 flex items-center justify-center rounded-full hover:bg-surface-hover text-text-secondary",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsx("h3",{className:"text-xs font-bold text-text-secondary uppercase tracking-wider",children:"Danh Sách Phòng"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:u.length===0?e.jsx("div",{className:"p-8 text-center text-text-placeholder text-sm",children:"Không tìm thấy phòng nào."}):e.jsx("div",{className:"divide-y divide-border-secondary",children:u.map(([C,k])=>e.jsxs("div",{onClick:()=>H(C),className:`p-3 cursor-pointer hover:bg-surface-hover transition-colors ${r===C?"bg-accent-primary/5 border-l-4 border-accent-primary":"border-l-4 border-transparent"}`,children:[e.jsx("div",{className:"font-semibold text-text-primary text-sm truncate mb-1",children:C}),e.jsxs("div",{className:"text-xs text-text-secondary flex items-center gap-2",children:[e.jsx("i",{className:"fas fa-user-friends text-[10px]"}),e.jsxs("span",{children:[k.length," thành viên"]})]})]},C))})})]}),e.jsx("div",{className:`flex-1 flex flex-col bg-surface-ground min-w-0 absolute md:relative inset-0 z-30 md:z-auto transition-transform duration-300 ${m==="detail"?"translate-x-0":"translate-x-full md:translate-x-0"}`,children:r&&a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-4 md:px-6 py-3 md:py-4 bg-white border-b border-border-primary flex justify-between items-center shadow-sm z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 md:gap-4",children:[e.jsx("button",{onClick:()=>w("list"),className:"md:hidden w-8 h-8 flex items-center justify-center rounded-full hover:bg-surface-hover text-text-secondary -ml-2",children:e.jsx("i",{className:"fas fa-arrow-left"})}),e.jsx("div",{className:"w-10 h-10 md:w-12 md:h-12 rounded-full bg-accent-primary/10 flex items-center justify-center text-accent-primary font-bold text-lg md:text-xl",children:r.charAt(0)}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg md:text-xl font-bold text-text-primary leading-tight truncate max-w-[150px] md:max-w-none",children:r}),e.jsx("div",{className:"text-xs md:text-sm text-text-secondary mt-0.5 md:mt-1",children:"Trưởng Phòng KD"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>g(r,a),className:"btn btn-secondary px-2 py-1.5 md:px-3 text-xs md:text-sm flex items-center gap-2 rounded-lg",children:[e.jsx("i",{className:"fas fa-pen"}),e.jsx("span",{className:"hidden md:inline",children:"Chỉnh Sửa"})]}),e.jsxs("button",{onClick:()=>f(r),className:"btn btn-danger px-2 py-1.5 md:px-3 text-xs md:text-sm flex items-center gap-2 rounded-lg",children:[e.jsx("i",{className:"fas fa-trash"}),e.jsx("span",{className:"hidden md:inline",children:"Xóa"})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col bg-surface-ground overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 bg-white border-b border-border-primary flex justify-between items-center flex-shrink-0 shadow-sm z-10",children:[e.jsx("h3",{className:"font-bold text-text-primary text-xs md:text-sm uppercase tracking-wider",children:"Danh Sách Thành Viên"}),e.jsxs("span",{className:"text-xs font-medium px-2 py-0.5 bg-surface-ground border border-border-secondary text-text-secondary rounded-full shadow-sm",children:["Tổng: ",e.jsx("span",{className:"text-accent-primary font-bold ml-1",children:a.length})]})]}),e.jsx("div",{className:"flex-1 p-2 md:p-4 overflow-hidden flex flex-col",children:a.length>0?e.jsx("div",{className:"bg-white rounded-lg border border-border-primary shadow-sm flex-1 flex flex-col overflow-hidden",children:e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:e.jsxs("table",{className:"w-full text-left border-collapse relative",children:[e.jsx("thead",{className:"sticky top-0 z-10 shadow-sm bg-surface-ground",children:e.jsxs("tr",{className:"text-xs text-text-secondary border-b border-border-secondary uppercase tracking-wider",children:[e.jsx("th",{className:"font-semibold py-2 px-3 w-10 md:w-12 text-center bg-surface-ground",children:"#"}),e.jsx("th",{className:"font-semibold py-2 px-3 bg-surface-ground",children:"Họ và tên"}),e.jsx("th",{className:"font-semibold py-2 px-3 w-20 md:w-24 text-center bg-surface-ground",children:"Chức vụ"})]})}),e.jsx("tbody",{className:"text-sm divide-y divide-border-secondary",children:a.map((C,k)=>e.jsxs("tr",{className:"hover:bg-surface-hover transition-colors group",children:[e.jsx("td",{className:"py-2 px-3 text-text-secondary text-center text-xs",children:k+1}),e.jsx("td",{className:"py-2 px-3 font-medium text-text-primary",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-accent-primary/10 text-accent-primary flex items-center justify-center text-[10px] font-bold group-hover:bg-accent-primary group-hover:text-white transition-colors",children:C.charAt(0).toUpperCase()}),e.jsx("span",{className:"text-xs md:text-sm",children:C})]})}),e.jsx("td",{className:"py-2 px-3 text-center",children:e.jsx("span",{className:"px-1.5 py-0.5 rounded bg-gray-100 text-text-secondary text-[10px] font-medium border border-gray-200",children:"TVBH"})})]},k))})]})})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-placeholder bg-white rounded-lg border border-border-dashed border-border-secondary",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-surface-ground flex items-center justify-center mb-3",children:e.jsx("i",{className:"fas fa-user-plus text-2xl opacity-20"})}),e.jsx("p",{className:"text-sm",children:"Chưa có thành viên nào."}),e.jsx("button",{onClick:()=>g(r,a),className:"mt-4 text-sm text-accent-primary hover:underline",children:"Thêm thành viên ngay"})]})})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-text-placeholder",children:[e.jsx("i",{className:"fas fa-users text-6xl mb-4 opacity-20"}),e.jsx("p",{children:"Chọn một phòng để xem chi tiết"})]})})]})},Kt=({isOpen:t,onClose:g,onSave:i,teamData:f,allUsers:c,editingTeam:o})=>{const[r,N]=s.useState(o?o.leader:""),[m,w]=s.useState(o?o.members:[]),[I,u]=s.useState(!1),a=Ne();s.useEffect(()=>{t&&(N(o?o.leader:""),w(o?o.members:[]))},[t,o]);const p=!o,{potentialLeaders:x,availableMembers:H}=s.useMemo(()=>{const k=new Set(Object.keys(f)),R=new Set(Object.values(f).flat()),d=c.filter(h=>h.role==="Trưởng Phòng Kinh Doanh"&&(!k.has(h.name)||h.name===(o==null?void 0:o.leader))),b=c.filter(h=>h.role==="Tư vấn bán hàng"&&(!R.has(h.name)||(o==null?void 0:o.members.includes(h.name))));return{potentialLeaders:d.map(h=>h.name),availableMembers:b.map(h=>h.name)}},[c,f,o]),C=async()=>{if(!r){alert("Vui lòng chọn trưởng phòng.");return}u(!0);const k={...f};p||o.leader!==r&&delete k[o.leader],k[r]=m,await i(k),u(!1)};return t?e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-2",onClick:g,children:e.jsxs("div",{className:"bg-surface-card w-full max-w-2xl rounded-2xl shadow-xl animate-fade-in-scale-up flex flex-col max-h-[90vh]",onClick:k=>k.stopPropagation(),style:a,children:[e.jsx("header",{className:"p-2.5 border-b",children:e.jsx("h2",{className:"text-xl font-bold text-text-primary",children:p?"Tạo Phòng Mới":`Chỉnh Sửa Phòng: ${o.leader}`})}),e.jsxs("main",{className:"p-3 space-y-2 overflow-y-auto hidden-scrollbar",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Trưởng Phòng"}),p?e.jsxs("select",{value:r,onChange:k=>N(k.target.value),className:"w-full bg-surface-ground border border-border-primary rounded-lg p-2.5 futuristic-input",children:[e.jsx("option",{value:"",disabled:!0,children:"Chọn một trưởng phòng"}),x.map(k=>e.jsx("option",{value:k,children:k},k))]}):e.jsx("input",{type:"text",value:r,readOnly:!0,className:"w-full bg-surface-input border border-border-primary rounded-lg p-2.5 futuristic-input cursor-not-allowed"})]}),e.jsx("div",{children:e.jsx(gt,{id:"team-member-select",label:"Thành viên",options:H,selectedOptions:m,onChange:w,icon:"fa-users",displayMode:"selection"})})]}),e.jsxs("footer",{className:"p-2 border-t flex justify-end gap-2 bg-surface-ground rounded-b-2xl",children:[e.jsx("button",{onClick:g,disabled:I,className:"btn-secondary",children:"Hủy"}),e.jsx("button",{onClick:C,disabled:I||!r,className:"btn-primary",children:I?"Đang lưu...":"Lưu Thay Đổi"})]})]})}):null},Bt={dashboard:[],invoices:[{type:"approve",label:"Phê duyệt",icon:"fa-check-double"},{type:"supplement",label:"Y/C Bổ sung",icon:"fa-exclamation-triangle"},{type:"pendingSignature",label:'Chuyển sang "Chờ ký HĐ"',icon:"fa-signature"},{type:"cancel",label:"Hủy Yêu cầu",icon:"fa-trash-alt",isDanger:!0}],pending:[{type:"cancel",label:"Hủy Yêu cầu (Xóa)",icon:"fa-trash-alt",isDanger:!0}],paired:[],matching:[],vc:[],phongkd:[]},Ge=({view:t,selectedRows:g,setSelectedRows:i,setBulkActionModal:f})=>{const[c,o]=s.useState(!1),r=s.useRef(null);s.useEffect(()=>{const m=w=>{r.current&&!r.current.contains(w.target)&&o(!1)};return document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[]);const N=Bt[t];return N.length===0?null:e.jsxs("div",{className:"relative z-10 p-1.5 border-b border-border-primary flex items-center justify-between bg-surface-accent animate-fade-in-down",children:[e.jsxs("span",{className:"text-sm font-semibold text-text-primary",children:["Đã chọn: ",e.jsx("span",{className:"font-bold text-accent-primary",children:g.size})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("button",{onClick:()=>i(new Set),className:"btn-secondary !text-xs !py-0.5 !px-2",children:[e.jsx("i",{className:"fas fa-times mr-1"})," Bỏ chọn"]}),e.jsxs("div",{className:"relative",ref:r,children:[e.jsxs("button",{onClick:()=>o(m=>!m),className:"btn-primary !text-xs !py-0.5 !px-2.5 flex items-center",children:["Thao tác hàng loạt ",e.jsx("i",{className:`fas fa-chevron-down ml-2 text-xs transition-transform ${c?"rotate-180":""}`})]}),c&&e.jsx("div",{className:"absolute right-0 mt-1 w-52 bg-surface-card border rounded-lg shadow-lg z-20 p-0.5",children:N.map(m=>e.jsxs("button",{onClick:()=>{f({type:m.type}),o(!1)},className:`flex items-center gap-2 w-full text-left px-2 py-1.5 text-sm font-medium rounded-md ${m.isDanger?"text-danger hover:bg-danger-bg":"text-text-primary hover:bg-surface-hover"}`,children:[e.jsx("i",{className:`fas ${m.icon} fa-fw w-5 text-center`}),e.jsx("span",{children:m.label})]},m.type))})]})]})]})},Xt=({showToast:t,hideToast:g,refetchHistory:i,refetchStock:f,refetchXuathoadon:c,refetchAdminData:o,allOrders:r,xuathoadonData:N,stockData:m,soldData:w,teamData:I,allUsers:u,isLoadingXuathoadon:a,isLoadingHistory:p,errorXuathoadon:x,onOpenImagePreview:H,onOpenFilePreview:C,isSidebarCollapsed:k,initialState:R,clearInitialState:d,onNavigateTo:b,onShowOrderDetails:h})=>{const[V,X]=s.useState(!1),[L,Y]=s.useState({invoices:{folder:"pending_approval",orderId:null},matching:{tab:"pending",orderId:null},vc:{folder:"pending",requestId:null}}),U=S=>{Y(B=>({...B,invoices:{...B.invoices,...S}}))},J=S=>{Y(B=>({...B,matching:{...B.matching,...S}}))},W=S=>{Y(B=>({...B,vc:{...B.vc,...S}}))},{adminView:v,setAdminView:T,invoiceFilters:y,pendingFilters:D,pairedFilters:Z,vcFilters:ne,matchingFilters:Q,handleFilterChange:le,handleReset:ce,setInvoiceFilters:l,setPendingFilters:$,setPairedFilters:_}=Vt({initialState:R,clearInitialState:d}),{pendingSortConfig:ae,setPendingSortConfig:me,pairedSortConfig:F,setPairedSortConfig:re,vcRequestsData:ue,isLoadingVc:de,errorVc:pe,selectedRows:ee,setSelectedRows:he,handleToggleAll:xe,fetchVcData:fe,processedInvoices:we,invoiceRequests:be,pendingData:A,pairedData:K,vcRequests:G,suggestionsMap:O,filterOptions:M,ordersWithMatches:j,allPendingOrderNumbers:E,allPairedOrderNumbers:P}=$t({allOrders:r,xuathoadonData:N,stockData:m,invoiceFilters:y,pendingFilters:D,pairedFilters:Z,vcFilters:ne,isSidebarCollapsed:k}),n=Pt({showToast:t,hideToast:g,refetchHistory:i,refetchStock:f,refetchXuathoadon:c,refetchAdminData:o,fetchVcData:fe,teamData:I,allOrders:r,suggestionsMap:O,selectedRows:ee,setSelectedRows:he,setShowMatchingModal:X}),z=(S,B={})=>{T(S),S==="invoices"&&l(se=>({...se,...B})),S==="pending"&&($(se=>({...se,...B})),j.length>0&&X(!0)),S==="paired"&&_(se=>({...se,...B}))},oe=S=>{T(S),S==="pending"&&j.length>0&&X(!0)},[ye,ge]=s.useState(!1),ve=s.useRef(null);s.useEffect(()=>{const S=B=>{ve.current&&!ve.current.contains(B.target)&&ge(!1)};return document.addEventListener("mousedown",S),()=>document.removeEventListener("mousedown",S)},[]);const Se=["dashboard","invoices","matching","vc","phongkd"],Ve={dashboard:"Tổng Quan",invoices:"Hóa Đơn",pending:"Chờ Ghép",paired:"Đã Ghép",matching:"Ghép Xe",vc:"Xử Lý VC",phongkd:"Phòng KD"},Pe={dashboard:null,invoices:be.length,pending:A.length,paired:K.length,matching:A.length+K.length,vc:G.length,phongkd:Object.keys(I).length},Ce=[{title:"Lưu Trữ Hóa Đơn",icon:"fa-archive",action:()=>n.setAdminModal("archive")},{title:"Tải Lên HĐ Hàng Loạt",icon:"fa-file-upload",action:()=>n.setIsBulkUploadModalOpen(!0)},{title:"Thêm Xe Mới",icon:"fa-plus-circle",action:()=>n.setAdminModal("addCar")},{title:"Xóa Xe Khỏi Kho",icon:"fa-trash-alt",action:()=>n.setAdminModal("deleteCar")},{title:"Phục Hồi Xe",icon:"fa-undo",action:()=>n.setAdminModal("restoreCar")},{title:"Thêm Nhân Viên",icon:"fa-user-plus",action:()=>n.setAdminModal("addUser")},{title:"Xóa Đơn Hàng",icon:"fa-times-circle",action:()=>n.setAdminModal("deleteOrder")},{title:"Hoàn Tác Trạng Thái",icon:"fa-history",action:()=>n.setAdminModal("revertOrder")},{title:"Tra Cứu Lịch Sử",icon:"fa-search",action:()=>n.setAdminModal("timeline")}],Te=[{id:"vin",label:"Số VIN (17 ký tự)",placeholder:"Nhập 17 ký tự VIN...",isVIN:!0}],Me=[{id:"vinToDelete",label:"Số VIN cần xóa (17 ký tự)",placeholder:"Nhập chính xác 17 ký tự VIN...",isVIN:!0},{id:"reason",label:"Lý do xóa (bắt buộc)",placeholder:"VD: Xe bán lô, xe điều chuyển...",type:"textarea"}],qe=[{id:"vinToRestore",label:"Số VIN cần phục hồi (17 ký tự)",placeholder:"Nhập chính xác 17 ký tự VIN...",isVIN:!0}],Je=[{id:"orderNumber",label:"Nhập Số đơn hàng để xác nhận",placeholder:"Ví dụ: SO-123456..."}],We=[{id:"orderNumber",label:"Nhập Số đơn hàng cần hoàn tác",placeholder:"Ví dụ: N31913-VSO-25-08-0019"}],Qe=[{id:"fullName",label:"Họ và Tên",placeholder:"VD: Nguyễn Văn A",type:"text"},{id:"email",label:"Email",placeholder:"VD: an.nguyen@email.com",type:"text"}],Ye=[{id:"reason",label:"Lý do hủy (bắt buộc)",placeholder:"VD: Khách hàng đổi ý, sai thông tin...",type:"textarea"}],Ze=[{id:"reason",label:"Lý do hủy ghép (bắt buộc)",placeholder:"VD: Sai thông tin xe...",type:"textarea"}],et=()=>v==="invoices"&&a&&N.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-4xl text-accent-primary"})}):v==="invoices"&&x?e.jsxs("div",{className:"flex items-center justify-center h-full text-center p-8 bg-surface-card rounded-lg shadow-xl",children:[e.jsx("i",{className:"fas fa-exclamation-triangle fa-3x text-danger"}),e.jsx("p",{className:"mt-4 text-lg font-semibold",children:"Không thể tải dữ liệu hóa đơn"}),e.jsx("p",{className:"mt-2 text-sm text-text-secondary max-w-sm",children:x}),e.jsx("button",{onClick:()=>c(),className:"mt-6 btn-primary",children:"Thử lại"})]}):v==="vc"&&de&&ue.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-4xl text-accent-primary"})}):v==="vc"&&pe?e.jsxs("div",{className:"flex items-center justify-center h-full text-center p-8 bg-surface-card rounded-lg shadow-xl",children:[e.jsx("i",{className:"fas fa-exclamation-triangle fa-3x text-danger"}),e.jsx("p",{className:"mt-4 text-lg font-semibold",children:"Không thể tải Yêu cầu VC"}),e.jsx("p",{className:"mt-2 text-sm text-text-secondary max-w-sm",children:pe}),e.jsx("button",{onClick:()=>fe(),className:"mt-6 btn-primary",children:"Thử lại"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:v==="dashboard"?"flex-1 flex flex-col min-h-0 animate-fade-in":"hidden",children:e.jsx(kt,{allOrders:r,stockData:m,soldData:w,teamData:I,allUsers:u,onTabChange:z,onNavigateTo:b,onShowOrderDetails:h,invoiceData:we})}),e.jsx("div",{className:v==="invoices"?"flex-1 flex flex-col min-h-0 animate-fade-in":"hidden",children:e.jsx(vt,{orders:be,onAction:n.handleAction,showToast:t,onOpenFilePreview:C,onUpdateInvoiceDetails:n.handleEditInvoiceDetails,selectedFolder:L.invoices.folder,selectedOrderId:L.invoices.orderId,onFolderChange:S=>U({folder:S}),onOrderSelect:S=>U({orderId:S}),processingId:n.processingId,processingActionType:n.processingActionType})}),e.jsx("div",{className:v==="matching"?"flex-1 flex flex-col min-h-0 animate-fade-in":"hidden",children:e.jsx(Nt,{pendingOrders:A,pairedOrders:K,stockData:m,onAction:n.handleAction,filters:Q,showToast:t,activeTab:L.matching.tab,selectedOrderId:L.matching.orderId,onTabChange:S=>J({tab:S}),onOrderSelect:S=>J({orderId:S})})}),e.jsxs("div",{className:v==="pending"?"flex-1 bg-surface-card rounded-xl shadow-md border border-border-primary flex flex-col min-h-0 animate-fade-in":"hidden",children:[ee.size>0&&e.jsx(Ge,{view:"pending",selectedRows:ee,setSelectedRows:he,setBulkActionModal:n.setBulkActionModal}),e.jsx("div",{className:"flex-grow overflow-hidden relative",children:e.jsx(Ue,{viewType:"pending",orders:A,sortConfig:ae,onSort:S=>me(B=>({key:S,direction:(B==null?void 0:B.key)===S&&B.direction==="asc"?"desc":"asc"})),selectedRows:ee,onToggleRow:S=>he(B=>{const se=new Set(B);return se.has(S)?se.delete(S):se.add(S),se}),onToggleAllRows:()=>xe(E),onAction:n.handleAction,showToast:t,suggestions:O,onShowSuggestions:(S,B)=>n.setSuggestionModalState({order:S,cars:B}),onOpenFilePreview:C,onUpdateInvoiceDetails:n.handleEditInvoiceDetails,processingId:n.processingId})})]}),e.jsxs("div",{className:v==="paired"?"flex-1 bg-surface-card rounded-xl shadow-md border border-border-primary flex flex-col min-h-0 animate-fade-in":"hidden",children:[ee.size>0&&e.jsx(Ge,{view:"paired",selectedRows:ee,setSelectedRows:he,setBulkActionModal:n.setBulkActionModal}),e.jsx("div",{className:"flex-grow overflow-hidden relative",children:e.jsx(Ue,{viewType:"paired",orders:K,sortConfig:F,onSort:S=>re(B=>({key:S,direction:(B==null?void 0:B.key)===S&&B.direction==="asc"?"desc":"asc"})),selectedRows:ee,onToggleRow:S=>he(B=>{const se=new Set(B);return se.has(S)?se.delete(S):se.add(S),se}),onToggleAllRows:()=>xe(P),onAction:n.handleAction,showToast:t,suggestions:O,onShowSuggestions:(S,B)=>n.setSuggestionModalState({order:S,cars:B}),onOpenFilePreview:C,onUpdateInvoiceDetails:n.handleEditInvoiceDetails,processingId:n.processingId})})]}),e.jsx("div",{className:v==="vc"?"flex-1 flex flex-col min-h-0 animate-fade-in":"hidden",children:e.jsx(wt,{requests:G,onAction:n.handleAction,showToast:t,onOpenImagePreview:H,onDownloadAll:n.handleDownloadAllVcImages,selectedFolder:L.vc.folder,selectedRequestId:L.vc.requestId,onFolderChange:S=>W({folder:S}),onRequestSelect:S=>W({requestId:S})})}),e.jsx("div",{className:v==="phongkd"?"flex-1 flex flex-col min-h-0 animate-fade-in":"hidden",children:e.jsx(Et,{teamData:I,onEditTeam:(S,B)=>n.setEditingTeam({leader:S,members:B}),onAddNewTeam:()=>n.setIsAddingNewTeam(!0),onDeleteTeam:n.handleDeleteTeam})})]});return e.jsxs("div",{className:"flex flex-col h-full animate-fade-in-up",children:[e.jsx("div",{className:"flex-shrink-0 bg-white border-b border-border-primary shadow-sm z-20",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between px-2 py-0.5 border-b border-border-secondary/50 gap-1 md:gap-0",children:[e.jsx("div",{className:"flex p-0.5 bg-white rounded-lg shadow-[inset_2px_2px_5px_#e5e7eb,inset_-2px_-2px_5px_#ffffff] border border-gray-100 overflow-x-auto md:overflow-hidden no-scrollbar w-full md:w-auto",children:Se.map(S=>{const B=Pe[S],se=v===S;return e.jsxs("button",{onClick:()=>oe(S),className:`relative px-2 py-1 text-[10px] uppercase transition-all rounded-md flex items-center justify-center gap-1.5 whitespace-nowrap flex-shrink-0 w-24 ${se?"bg-white text-[#6d5dfc] shadow-[-2px_-2px_5px_#ffffff,2px_2px_5px_#e5e7eb] font-bold":"text-gray-500 hover:text-[#6d5dfc] font-medium"}`,children:[Ve[S],B!==null&&e.jsx("span",{className:`text-[10px] font-mono px-2 py-0.5 rounded-full ${se?"bg-white shadow-[inset_2px_2px_5px_#e5e7eb,inset_-2px_-2px_5px_#ffffff] text-[#6d5dfc]":"bg-transparent text-gray-400"}`,children:B})]},S)})}),e.jsx("div",{className:"hidden md:block h-8 w-px bg-border-secondary/50 mx-2"}),e.jsxs("div",{className:"flex items-center justify-between md:justify-end w-full md:w-auto gap-3",children:[e.jsx("div",{className:"flex-grow md:flex-grow-0 flex justify-end items-center min-w-0 md:mr-4",children:e.jsx(Lt,{adminView:v,invoiceFilters:y,pendingFilters:D,pairedFilters:Z,vcFilters:ne,matchingFilters:Q,handleFilterChange:le,handleReset:ce,filterOptions:M,invoiceRequests:be,pendingData:A,pairedData:K,vcRequests:G,refetchXuathoadon:c,refetchHistory:i,fetchVcData:fe,isLoadingXuathoadon:a,isLoadingHistory:p,isLoadingVc:de})}),e.jsxs("div",{className:"relative",ref:ve,children:[e.jsx("button",{onClick:()=>ge(S=>!S),title:"Thao Tác Nhanh",className:`w-9 h-9 flex items-center justify-center rounded-lg transition-all ${ye?"bg-accent-primary text-white shadow-md":"bg-surface-ground text-text-secondary hover:text-accent-primary hover:bg-surface-accent border border-transparent hover:border-border-secondary"}`,children:e.jsx("i",{className:"fas fa-bolt text-sm"})}),ye&&e.jsx("div",{className:"absolute top-full right-0 mt-2 w-64 bg-white border border-border-primary shadow-xl rounded-xl z-30 p-1 animate-fade-in-scale-up origin-top-right",children:Ce.map(S=>e.jsxs("button",{onClick:()=>{S.action(),ge(!1)},className:"flex items-center gap-3 w-full text-left px-3 py-2.5 text-sm rounded-lg text-text-primary hover:bg-surface-hover transition-colors",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-surface-ground flex items-center justify-center text-accent-secondary",children:e.jsx("i",{className:`fas ${S.icon} text-xs`})}),e.jsx("span",{className:"font-medium",children:S.title})]},S.title))})]})]})]})}),e.jsx("div",{className:"flex-grow min-h-0 flex flex-col",children:et()}),n.suggestionModalState&&e.jsx(Dt,{isOpen:!!n.suggestionModalState,onClose:()=>n.setSuggestionModalState(null),order:n.suggestionModalState.order,suggestedCars:n.suggestionModalState.cars,onConfirm:n.handleConfirmSuggestion,showToast:t}),e.jsx(It,{isOpen:V,onClose:()=>X(!1),matches:j,onConfirmMatch:n.handleConfirmSuggestion}),n.invoiceModalState&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{showToast:t,isOpen:n.invoiceModalState.type==="approve",onClose:()=>n.setInvoiceModalState(null),title:"Phê Duyệt Yêu Cầu",description:"Xác nhận phê duyệt yêu cầu xuất hóa đơn cho đơn hàng:",targetId:n.invoiceModalState.order["Số đơn hàng"],submitText:"Phê Duyệt",submitColor:"success",icon:"fa-check-double",onSubmit:()=>n.handleAdminSubmit("approveSelectedInvoiceRequest",{orderNumbers:JSON.stringify([n.invoiceModalState.order["Số đơn hàng"]])},"Đã phê duyệt yêu cầu.")}),e.jsx($e,{showToast:t,isOpen:n.invoiceModalState.type==="supplement",onClose:()=>n.setInvoiceModalState(null),title:"Yêu Cầu Bổ Sung",orderNumber:n.invoiceModalState.order["Số đơn hàng"],reasonLabel:"Nội dung yêu cầu (bắt buộc):",onSubmit:(S,B)=>n.handleAdminSubmit("requestSupplementForInvoice",{orderNumbers:JSON.stringify([n.invoiceModalState.order["Số đơn hàng"]]),reason:S,pastedImagesBase64:JSON.stringify(B)},"Đã gửi yêu cầu bổ sung."),icon:"fa-exclamation-triangle",theme:"warning"}),e.jsx(ie,{showToast:t,isOpen:n.invoiceModalState.type==="pendingSignature",onClose:()=>n.setInvoiceModalState(null),title:"Chuyển Trạng Thái",description:"Chuyển đơn hàng sang 'Chờ Ký Hóa Đơn'?",targetId:n.invoiceModalState.order["Số đơn hàng"],submitText:"Xác Nhận",submitColor:"primary",icon:"fa-signature",onSubmit:()=>n.handleAdminSubmit("markAsPendingSignature",{orderNumbers:JSON.stringify([n.invoiceModalState.order["Số đơn hàng"]])},"Đã chuyển trạng thái.")}),e.jsx(Ct,{showToast:t,isOpen:n.invoiceModalState.type==="uploadInvoice",onClose:()=>n.setInvoiceModalState(null),order:n.invoiceModalState.order,onSubmit:async S=>{const se=await(tt=>new Promise((nt,st)=>{const De=new FileReader;De.readAsDataURL(tt),De.onload=()=>nt(De.result.split(",")[1]),De.onerror=at=>st(at)}))(S);return n.handleAdminSubmit("handleBulkUploadIssuedInvoices",{filesData:JSON.stringify([{orderNumber:n.invoiceModalState.order["Số đơn hàng"],base64Data:se,mimeType:S.type,fileName:S.name}])},"Đã tải lên hóa đơn thành công.")}}),e.jsx(ie,{showToast:t,isOpen:n.invoiceModalState.type==="cancel",onClose:()=>n.setInvoiceModalState(null),title:"Hủy Yêu Cầu Xuất Hóa Đơn",description:"Hành động này sẽ hủy yêu cầu và thông báo cho TVBH.",targetId:n.invoiceModalState.order["Số đơn hàng"],inputs:Ye,submitText:"Xác Nhận Hủy",submitColor:"danger",icon:"fa-trash-alt",onSubmit:S=>n.handleAdminSubmit("cancelRequest",{orderNumbers:JSON.stringify([n.invoiceModalState.order["Số đơn hàng"]]),reason:S.reason},"Đã hủy yêu cầu.")}),e.jsx(ie,{showToast:t,isOpen:n.invoiceModalState.type==="unmatch",onClose:()=>n.setInvoiceModalState(null),title:"Hủy Ghép Xe",description:"Hủy ghép xe cho đơn hàng:",targetId:n.invoiceModalState.order["Số đơn hàng"],inputs:Ze,submitText:"Xác Nhận Hủy Ghép",submitColor:"danger",icon:"fa-unlink",onSubmit:S=>n.handleAdminSubmit("unmatchOrder",{orderNumber:n.invoiceModalState.order["Số đơn hàng"],reason:S.reason},"Đã hủy ghép xe.","both")}),e.jsx(ie,{showToast:t,isOpen:n.invoiceModalState.type==="resend",onClose:()=>n.setInvoiceModalState(null),title:"Gửi Lại Email",description:"Gửi lại email thông báo cho đơn hàng:",targetId:n.invoiceModalState.order["Số đơn hàng"],submitText:"Gửi Lại",submitColor:"primary",icon:"fa-paper-plane",onSubmit:()=>n.handleAdminSubmit("resendEmail",{orderNumbers:JSON.stringify([n.invoiceModalState.order["Số đơn hàng"]]),emailType:"invoice_issued"},"Đã gửi lại email.")}),e.jsx(ie,{showToast:t,isOpen:n.invoiceModalState.type==="approveVc",onClose:()=>n.setInvoiceModalState(null),title:"Phê Duyệt Yêu Cầu VC",description:"Xác nhận phê duyệt yêu cầu cấp VinClub cho đơn hàng:",targetId:n.invoiceModalState.order["Số đơn hàng"],submitText:"Phê Duyệt",submitColor:"success",icon:"fa-check-circle",onSubmit:()=>n.handleAdminSubmit("approveVcRequest",{orderNumber:n.invoiceModalState.order["Số đơn hàng"]},"Đã phê duyệt yêu cầu VC.")}),e.jsx($e,{showToast:t,isOpen:n.invoiceModalState.type==="rejectVc",onClose:()=>n.setInvoiceModalState(null),title:"Từ Chối Yêu Cầu VC",orderNumber:n.invoiceModalState.order["Số đơn hàng"],reasonLabel:"Lý do từ chối (bắt buộc):",onSubmit:(S,B)=>n.handleAdminSubmit("rejectVcRequest",{orderNumber:n.invoiceModalState.order["Số đơn hàng"],reason:S,pastedImagesBase64:JSON.stringify(B)},"Đã từ chối yêu cầu VC."),icon:"fa-ban",theme:"danger"})]}),n.bulkActionModal&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{showToast:t,isOpen:n.bulkActionModal.type==="approve",onClose:n.handleCloseBulkActionModal,title:"Phê duyệt hàng loạt",description:`Xác nhận phê duyệt ${ee.size} yêu cầu đã chọn?`,submitText:"Phê duyệt",submitColor:"success",icon:"fa-check-double",onSubmit:n.handleBulkApproveSubmit}),e.jsx(ie,{showToast:t,isOpen:n.bulkActionModal.type==="pendingSignature",onClose:n.handleCloseBulkActionModal,title:"Chuyển trạng thái hàng loạt",description:`Chuyển ${ee.size} đơn hàng đã chọn sang "Chờ Ký Hóa Đơn"?`,submitText:"Xác Nhận",submitColor:"primary",icon:"fa-signature",onSubmit:n.handleBulkPendingSignatureSubmit}),e.jsx($e,{showToast:t,isOpen:n.bulkActionModal.type==="supplement",onClose:n.handleCloseBulkActionModal,title:"Y/C Bổ sung hàng loạt",orderNumber:`${ee.size} đơn hàng`,reasonLabel:"Nội dung yêu cầu (bắt buộc):",icon:"fa-exclamation-triangle",theme:"warning",onSubmit:n.handleBulkSupplementSubmit}),e.jsx(ie,{showToast:t,isOpen:n.bulkActionModal.type==="cancel",onClose:n.handleCloseBulkActionModal,title:"Hủy hàng loạt",description:`Bạn có chắc muốn hủy ${ee.size} yêu cầu đã chọn? Hành động này sẽ chuyển các mục vào phần "Đã Hủy".`,inputs:Ye,submitText:"Xác Nhận Hủy",submitColor:"danger",icon:"fa-trash-alt",onSubmit:n.handleBulkCancelSubmit})]}),e.jsx(ie,{showToast:t,isOpen:n.adminModal==="archive",onClose:n.handleCloseAdminModal,title:"Lưu Trữ Hóa Đơn",description:"Lưu trữ hóa đơn đã xuất của tháng trước sang một sheet riêng.",submitText:"Xác Nhận Lưu Trữ",submitColor:"primary",icon:"fa-archive",onSubmit:n.handleArchiveSubmit}),e.jsx(ie,{showToast:t,isOpen:n.adminModal==="addCar",onClose:n.handleCloseAdminModal,title:"Thêm Xe Mới vào Kho",description:"Hệ thống sẽ tự động tra cứu thông tin xe từ số VIN.",inputs:Te,submitText:"Thêm Xe",submitColor:"primary",icon:"fa-plus-circle",onSubmit:n.handleAddCarSubmit}),e.jsx(ie,{showToast:t,isOpen:n.adminModal==="deleteCar",onClose:n.handleCloseAdminModal,title:"Xóa Xe Khỏi Kho",description:"Xe sẽ bị xóa khỏi trang Kho Xe và thông tin sẽ được lưu vào nhật ký. Có thể phục hồi lại sau bằng chức năng 'Phục Hồi Xe'.",inputs:Me,submitText:"Xác Nhận Xóa",submitColor:"danger",icon:"fa-trash-alt",onSubmit:n.handleDeleteCarSubmit}),e.jsx(ie,{showToast:t,isOpen:n.adminModal==="restoreCar",onClose:n.handleCloseAdminModal,title:"Phục Hồi Xe Đã Xóa",description:"Dựa vào nhật ký xe đã xóa, hệ thống sẽ thêm xe trở lại Kho Xe với trạng thái 'Chưa ghép'.",inputs:qe,submitText:"Phục Hồi Xe",submitColor:"primary",icon:"fa-undo",onSubmit:n.handleRestoreCarSubmit}),e.jsx(ie,{showToast:t,isOpen:n.adminModal==="addUser",onClose:n.handleCloseAdminModal,title:"Thêm Nhân Viên Mới",description:"Thêm một tài khoản nhân viên mới. Hệ thống sẽ tự động tạo tên đăng nhập, mật khẩu và gửi email thông báo.",inputs:Qe,submitText:"Thêm & Gửi Email",submitColor:"primary",icon:"fa-user-plus",onSubmit:n.handleAddUserSubmit}),e.jsx(ie,{showToast:t,isOpen:n.adminModal==="deleteOrder",onClose:n.handleCloseAdminModal,title:"Xóa Đơn Hàng",description:"CẢNH BÁO: Đơn hàng sẽ bị xóa vĩnh viễn và chuyển vào mục 'Đã Hủy'.",inputs:Je,submitText:"Tôi hiểu, Xóa Đơn Hàng",submitColor:"danger",icon:"fa-times-circle",onSubmit:n.handleDeleteOrderSubmit}),e.jsx(ie,{showToast:t,isOpen:n.adminModal==="revertOrder",onClose:n.handleCloseAdminModal,title:"Hoàn Tác Trạng Thái",description:"Khôi phục lại trạng thái cuối cùng của đơn hàng trong nhật ký.",inputs:We,submitText:"Thực Hiện Hoàn Tác",submitColor:"primary",icon:"fa-history",onSubmit:n.handleRevertOrderSubmit}),e.jsx(Mt,{isOpen:n.adminModal==="timeline",onClose:()=>n.setAdminModal(null)}),e.jsx(Ht,{isOpen:n.isBulkUploadModalOpen,onClose:()=>n.setIsBulkUploadModalOpen(!1),showToast:t,hideToast:g,onSuccess:()=>{i(!0),c(!0)}}),e.jsx(pt,{isOpen:!!n.editingOrder,onClose:()=>n.setEditingOrder(null),onSuccess:n.handleEditSuccess,order:n.editingOrder,showToast:t,existingOrderNumbers:r.map(S=>S["Số đơn hàng"])}),e.jsx(Kt,{isOpen:!!n.editingTeam||n.isAddingNewTeam,onClose:()=>{n.setEditingTeam(null),n.setIsAddingNewTeam(!1)},onSave:n.handleSaveTeam,teamData:I,allUsers:u,editingTeam:n.editingTeam})]})},Ot=He.memo(Xt);export{Ot as default};
