import{j as e}from"./vendor-pdf-Dyj7cThZ.js";import{r as p,R as ee}from"./vendor-react-KfUPlHYY.js";import{h as Y}from"./vendor-utils-C5S46NFB.js";import{B as T,g as _,S as te,M as O,u as se,i as $,b as ae}from"./index-BYD0uLnE.js";const ne="/ordermanagement/assets/loading-animation-DF1z-Eb6.json",q=({order:t,onViewDetails:s,onCancel:n,onRequestInvoice:i,onSupplement:c,onRequestVC:r,onConfirmVC:f,onEdit:o,onToggle:g})=>{const[x,y]=p.useState(!1),m=p.useRef(null),j=h=>{y(h),g==null||g(h)};p.useEffect(()=>{const h=b=>{m.current&&!m.current.contains(b.target)&&j(!1)};return document.addEventListener("mousedown",h),()=>document.removeEventListener("mousedown",h)},[g]);const u=(t["Kết quả"]||"chưa ghép").toLowerCase().trim().normalize("NFC"),N=(t["Trạng thái VC"]||"").toLowerCase().trim().normalize("NFC"),a=N||u,v=["chưa ghép","đã ghép"].includes(u),k=u==="đã ghép",H=u==="yêu cầu bổ sung",z=!["đã xuất hóa đơn","đã hủy","chờ ký hóa đơn"].includes(u),B=(u==="đã xuất hóa đơn"||N==="từ chối ycvc")&&!["yêu cầu vinclub","chờ duyệt ycvc","chờ xác thực vc (tvbh)","đã có vc"].includes(N),I=a==="chờ xác thực vc (tvbh)",C=(h,b)=>{b.preventDefault(),b.stopPropagation(),h(t),j(!1)},D=[{label:"Xem chi tiết",icon:"fa-eye text-accent-primary",action:s,condition:!0,title:"Xem chi tiết đơn hàng"},{label:"Chỉnh Sửa",icon:"fa-pencil-alt text-blue-500",action:o,condition:!!o&&z,title:"Chỉnh sửa thông tin đơn hàng"},{label:"Yêu cầu Xuất Hóa Đơn",icon:"fa-file-invoice-dollar text-green-500",action:i,condition:k,title:"Tải lên hợp đồng và đề nghị để xuất hóa đơn"},{label:"Bổ Sung File",icon:"fa-edit text-orange-500",action:c,condition:H,title:"Bổ sung hoặc thay thế tệp đã gửi"},{label:"Yêu Cầu Cấp VC",icon:"fa-id-card text-blue-500",action:r,condition:!!r&&B,title:"Yêu cầu cấp tài khoản VinClub"},{label:"Xác Thực UNC VC",icon:"fa-check text-teal-500",action:f,condition:!!f&&I,title:"Xác thực đã nhận UNC cho VinClub"},{label:"Tải Hóa Đơn",icon:"fa-download text-sky-500",action:h=>{h.LinkHoaDonDaXuat&&window.open(h.LinkHoaDonDaXuat,"_blank")},condition:!!t.LinkHoaDonDaXuat,title:"Tải về hóa đơn đã xuất"},{label:"Hủy Yêu Cầu",icon:"fa-trash-alt text-danger",action:n,condition:v,isDanger:!0,title:"Hủy yêu cầu ghép xe này"}].filter(h=>h.condition);return e.jsxs("div",{className:"relative inline-block text-left",ref:m,children:[e.jsx(T,{onClick:h=>{h.stopPropagation(),j(!x)},variant:"ghost",className:`group w-9 h-9 flex items-center justify-center rounded-full transition-all duration-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-surface-card focus-visible:ring-accent-primary/50 !p-0
                   ${x?"bg-accent-primary/10":"bg-transparent hover:bg-surface-hover"}`,"aria-haspopup":"true","aria-expanded":x,"aria-controls":"action-menu",title:"Tùy chọn",children:e.jsx("lottie-player",{src:ne,background:"transparent",speed:"1",style:{width:"28px",height:"28px"},loop:!0,autoplay:!0,className:`transition-all duration-300 group-hover:scale-110 group-hover:[filter:drop-shadow(0_0_4px_rgba(66,165,245,0.7))] ${x?"scale-105 [filter:drop-shadow(0_0_2px_rgba(66,165,245,0.7))]":""}`})}),x&&e.jsx("div",{id:"action-menu",className:"origin-top-right absolute right-0 mt-2 w-56 rounded-lg shadow-2xl bg-surface-overlay border border-border-primary/70 z-30 focus:outline-none animate-fade-in-scale-up",style:{animationDuration:"0.15s"},children:e.jsx("div",{className:"p-1.5",role:"menu","aria-orientation":"vertical",children:D.map(h=>e.jsxs(ee.Fragment,{children:[h.isDanger&&D.some(b=>!b.isDanger&&b.condition)&&e.jsx("div",{className:"border-t border-border-primary/70 my-1 mx-1.5"}),h.isDanger&&D.some(b=>!b.isDanger&&b.condition)&&e.jsx("div",{className:"border-t border-border-primary/70 my-1 mx-1.5"}),e.jsx(T,{onClick:b=>C(h.action,b),title:h.title,variant:h.isDanger?"danger":"ghost",fullWidth:!0,className:`justify-start px-3 py-2.5 text-sm font-medium rounded-md transition-colors duration-150 
                                ${h.isDanger?"hover:bg-danger-bg":"text-text-primary hover:bg-surface-hover"}`,role:"menuitem",leftIcon:e.jsx("i",{className:`fas ${h.icon} fa-fw w-5 text-center text-base mr-1`}),children:e.jsx("span",{children:h.label})})]},h.label))})})]})},L=({columnKey:t,title:s,sortConfig:n,onSort:i,className:c})=>{const r=(n==null?void 0:n.key)===t,f=(n==null?void 0:n.direction)==="asc"?"▲":"▼";return e.jsxs("th",{scope:"col",onClick:()=>i(t),className:`py-2 px-2 text-left text-xs font-bold text-text-secondary cursor-pointer hover:bg-surface-hover transition-colors whitespace-nowrap uppercase tracking-wider ${c}`,children:[s," ",r&&e.jsx("span",{className:"text-xs ml-1",children:f})]})},re=({order:t,index:s,onViewDetails:n,onCancel:i,onRequestInvoice:c,onSupplement:r,onEdit:f,onRequestVC:o,onConfirmVC:g,onRowClick:x,selectedOrder:y,viewMode:m,processingOrder:j})=>{const[u,N]=p.useState(!1),a=t["Trạng thái VC"]||t["Kết quả"]||"Chưa ghép",v=y&&y["Số đơn hàng"]===t["Số đơn hàng"],k=j===t["Số đơn hàng"];return e.jsxs("tr",{className:`hover:bg-surface-hover transition-colors duration-200 animate-fade-in-up ${x?"cursor-pointer":""} ${v?"selected-row-highlight":""} ${u?"relative z-20":""}`,style:{animationDelay:`${s*20}ms`},onClick:()=>x?x(t):n==null?void 0:n(t),children:[e.jsx("td",{className:"whitespace-nowrap py-2 pl-2 pr-2 text-sm text-center text-text-secondary font-medium sm:pl-3","data-label":"#",children:s+1}),e.jsxs("td",{className:"whitespace-nowrap px-2 py-2 text-sm","data-label":"Khách hàng / SĐH",children:[e.jsx("div",{className:"font-semibold text-text-primary",children:t["Tên khách hàng"]||"N/A"}),e.jsx("div",{className:"text-text-secondary font-mono text-xs",children:t["Số đơn hàng"]})]}),e.jsxs("td",{className:"whitespace-nowrap px-2 py-2 text-sm","data-label":"Thông Tin Xe",children:[e.jsxs("div",{className:"text-text-primary",children:[t["Dòng xe"]," / ",t["Phiên bản"]]}),e.jsxs("div",{className:"text-text-secondary text-xs",style:_(t["Ngoại thất"]),children:[t["Ngoại thất"]," / ",t["Nội thất"]]})]}),m==="full"&&e.jsxs("td",{className:"whitespace-nowrap px-2 py-2 text-sm","data-label":"Ngày Yêu Cầu",children:[e.jsx("div",{className:"text-text-primary",title:Y(t["Thời gian nhập"]).format("DD/MM/YYYY HH:mm:ss"),children:Y(t["Thời gian nhập"]).format("DD/MM/YY HH:mm")}),e.jsx("div",{className:"text-text-secondary text-xs",children:Y(t["Thời gian nhập"]).fromNow()})]}),e.jsx("td",{className:"whitespace-nowrap px-2 py-2 text-sm text-text-primary truncate","data-label":"Tư vấn",title:t["Tên tư vấn bán hàng"],children:t["Tên tư vấn bán hàng"]||"N/A"}),m==="full"&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"whitespace-nowrap px-2 py-2 text-sm text-text-primary","data-label":"Trạng thái",children:e.jsx(te,{status:a})}),e.jsx("td",{className:"relative whitespace-nowrap py-2 pl-2 pr-2 text-center text-sm font-medium sm:pr-3","data-label":"Hành động",onClick:H=>H.stopPropagation(),children:k?e.jsx("div",{className:"flex items-center justify-center h-9",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-accent-primary text-xl"})}):e.jsx(q,{order:t,onViewDetails:n,onCancel:i,onRequestInvoice:c,onSupplement:r,onEdit:f,onRequestVC:o,onConfirmVC:g,onToggle:N})})]})]})},le=({orders:t,onViewDetails:s,onCancel:n,onRequestInvoice:i,onSupplement:c,onEdit:r,onRequestVC:f,onConfirmVC:o,sortConfig:g,onSort:x,startIndex:y,onRowClick:m,selectedOrder:j,viewMode:u="full",processingOrder:N})=>t.length===0?e.jsxs("div",{className:"text-center py-8 text-text-secondary",children:[e.jsx("i",{className:"fas fa-folder-open fa-3x mb-4 text-text-placeholder"}),e.jsx("p",{className:"font-semibold text-text-primary",children:"Không tìm thấy yêu cầu nào."}),e.jsx("p",{className:"text-sm",children:"Hãy thử thay đổi bộ lọc hoặc tạo yêu cầu mới."})]}):e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"md:hidden space-y-3",children:t.map((a,v)=>e.jsxs("div",{className:`relative overflow-hidden rounded-xl bg-slate-50 p-3 shadow-sm border border-gray-200 hover:shadow-md transition-all duration-200 ease-out active:scale-[0.98] cursor-pointer flex flex-col group ${j&&j["Số đơn hàng"]===a["Số đơn hàng"]?"ring-2 ring-accent-primary":""}`,onClick:()=>m?m(a):s==null?void 0:s(a),children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-slate-800 text-sm font-bold uppercase leading-tight truncate",title:a["Tên khách hàng"],children:a["Tên khách hàng"]||"N/A"}),e.jsx("p",{className:"text-gray-500 text-[10px] font-mono truncate mt-0.5",title:a["Số đơn hàng"],children:a["Số đơn hàng"]})]}),e.jsx("div",{className:"flex-shrink-0",onClick:k=>k.stopPropagation(),children:N===a["Số đơn hàng"]?e.jsx("div",{className:"flex items-center justify-center w-8 h-8",children:e.jsx("i",{className:"fas fa-spinner fa-spin text-accent-primary text-lg"})}):u==="full"&&e.jsx(q,{order:a,onViewDetails:s,onCancel:n,onRequestInvoice:i,onSupplement:c,onEdit:r,onRequestVC:f,onConfirmVC:o})})]}),e.jsx("div",{className:"my-2 border-t border-dashed border-gray-300"}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("p",{className:"text-slate-800 text-sm font-medium truncate",title:`${a["Dòng xe"]} / ${a["Phiên bản"]}`,children:[a["Dòng xe"]," / ",a["Phiên bản"]]}),e.jsxs("p",{className:"text-slate-500 text-xs truncate",title:`${a["Ngoại thất"]} / ${a["Nội thất"]}`,children:[e.jsx("span",{style:_(a["Ngoại thất"]),children:a["Ngoại thất"]}),e.jsx("span",{className:"text-gray-400",children:" / "}),e.jsx("span",{children:a["Nội thất"]})]})]}),e.jsx("div",{className:"my-2 border-t border-dashed border-gray-300"}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500 mt-auto",children:[e.jsx("span",{children:"Tư vấn"}),e.jsx("span",{className:"font-medium uppercase text-slate-700 truncate",children:a["Tên tư vấn bán hàng"]||"N/A"})]})]},a["Số đơn hàng"]||v))}),e.jsx("div",{className:"hidden md:block min-w-full py-1 align-middle",children:e.jsxs("table",{className:"min-w-full divide-y divide-border-primary responsive-table",children:[e.jsx("thead",{className:"bg-surface-hover sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"py-2 pl-2 pr-2 text-center text-xs font-bold text-text-secondary sm:pl-3 w-12 uppercase tracking-wider",children:"#"}),e.jsx(L,{columnKey:"Tên khách hàng",title:"Khách hàng / SĐH",sortConfig:g,onSort:x}),e.jsx(L,{columnKey:"Dòng xe",title:"Thông Tin Xe",sortConfig:g,onSort:x}),u==="full"&&e.jsx(L,{columnKey:"Thời gian nhập",title:"Ngày Yêu Cầu",sortConfig:g,onSort:x}),e.jsx(L,{columnKey:"Tên tư vấn bán hàng",title:"Tư vấn",sortConfig:g,onSort:x}),u==="full"&&e.jsx(L,{columnKey:"Kết quả",title:"Trạng thái",sortConfig:g,onSort:x}),u==="full"&&e.jsx("th",{scope:"col",className:"relative py-2 pl-2 pr-2 sm:pr-3 text-center text-xs font-bold text-text-secondary uppercase tracking-wider",children:"Hành động"})]})}),e.jsx("tbody",{className:"divide-y divide-border-primary bg-surface-card",children:t.map((a,v)=>e.jsx(re,{order:a,index:y+v,onViewDetails:s,onCancel:n,onRequestInvoice:i,onSupplement:c,onEdit:r,onRequestVC:f,onConfirmVC:o,onRowClick:m,selectedOrder:j,viewMode:u,processingOrder:N},a["Số đơn hàng"]||v))})]})})]}),ie=({currentPage:t,totalPages:s,onPageChange:n,onLoadMore:i,isLoadingArchives:c,isLastArchive:r})=>{if(s<=1&&r)return null;const f=[],o=3;let g,x;s<=o?(g=1,x=s):t<=Math.ceil(o/2)?(g=1,x=o):t+Math.floor(o/2)>=s?(g=s-o+1,x=s):(g=t-Math.floor(o/2),x=t+Math.floor(o/2));for(let a=g;a<=x;a++)f.push(a);const y="flex items-center justify-center text-xs font-medium rounded-md transition-colors duration-200",m=`${y} w-7 h-7 text-gray-500 hover:bg-gray-100 hover:text-gray-700`,j=`${y} px-2.5 py-1 text-blue-600 bg-blue-50 hover:bg-blue-100 font-semibold`,u="disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-transparent disabled:hover:text-gray-500",N=(s===0||t===s)&&!r;return e.jsxs("nav",{className:"px-4 py-2 flex items-center justify-center space-x-0.5 flex-wrap gap-y-1",children:[s>1&&e.jsx("button",{onClick:()=>n(t-1),disabled:t===1,className:`${m} ${u}`,"aria-label":"Trang trước",children:e.jsx("svg",{className:"w-4 h-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),s>1&&g>1&&e.jsxs(e.Fragment,{children:[e.jsx(T,{onClick:()=>n(1),variant:"ghost",className:`w-9 h-9 flex items-center justify-center rounded-lg text-sm font-medium transition-colors !p-0 ${t===1?"bg-blue-100 text-blue-700 font-bold":"hover:bg-surface-hover"}`,children:"1"}),g>2&&e.jsx(T,{disabled:!0,variant:"ghost",className:"w-9 h-9 flex items-center justify-center rounded-lg text-text-secondary !p-0",children:"..."})]}),s>1&&f.map(a=>e.jsx(T,{onClick:()=>n(a),variant:"ghost",className:`w-9 h-9 flex items-center justify-center rounded-lg text-sm font-medium transition-colors !p-0 ${t===a?"bg-blue-100 text-blue-700 font-bold":"hover:bg-surface-hover"}`,children:a},a)),s>1&&x<s&&e.jsxs(e.Fragment,{children:[x<s-1&&e.jsx(T,{disabled:!0,variant:"ghost",className:"w-9 h-9 flex items-center justify-center rounded-lg text-text-secondary !p-0",children:"..."}),e.jsx(T,{onClick:()=>n(s),variant:"ghost",className:`w-9 h-9 flex items-center justify-center rounded-lg text-sm font-medium transition-colors !p-0 ${t===s?"bg-blue-100 text-blue-700 font-bold":"hover:bg-surface-hover"}`,children:s})]}),s>1&&e.jsx(T,{onClick:()=>n(t+1),disabled:t===s,variant:"ghost",className:"w-9 h-9 flex items-center justify-center rounded-lg hover:bg-surface-hover disabled:opacity-50 disabled:cursor-not-allowed transition-colors !p-0","aria-label":"Trang sau",children:e.jsx("svg",{className:"w-4 h-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})})}),N&&e.jsx("button",{onClick:i,disabled:c,className:`${j} ${u} ml-2`,children:c?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin mr-2"})," Đang tải..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-archive mr-2"})," Tải thêm"]})})]})},M=({icon:t,label:s,value:n,valueClassName:i})=>e.jsxs("div",{className:"flex items-start gap-2 py-2 border-b border-dashed border-border-primary/50",children:[e.jsx("i",{className:`fas ${t} text-accent-secondary text-base w-5 text-center mt-1`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-text-secondary",children:s}),e.jsx("p",{className:`text-sm text-text-primary font-semibold break-words ${i}`,children:n||"—"})]})]}),ce=({order:t,showToast:s})=>{const[n,i]=p.useState(!1),c=r=>{r&&navigator.clipboard.writeText(r).then(()=>{i(!0),s("Đã Sao Chép",`Số VIN ${r} đã được sao chép.`,"success",2e3),setTimeout(()=>i(!1),2e3)}).catch(()=>{s("Lỗi Sao Chép","Không thể truy cập clipboard.","error")})};return e.jsxs("div",{className:"detail-panel h-full",children:[e.jsxs("h3",{className:"text-lg font-bold text-text-primary mb-0 p-2 border-b border-border-primary flex items-center gap-3 flex-shrink-0",children:[e.jsx("i",{className:"fas fa-file-invoice text-accent-primary"}),"Chi Tiết Đơn Hàng"]}),e.jsx("div",{className:"detail-panel-body flex-grow hidden-scrollbar",children:t?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative p-2 my-1 rounded-lg bg-slate-800 text-center shadow-lg cursor-pointer hover:bg-slate-700 transition-colors",onClick:()=>c(t.VIN||""),title:"Click để sao chép VIN",children:[e.jsx("p",{className:"text-xs text-slate-400 uppercase tracking-widest",children:"Số Khung (VIN)"}),e.jsx("p",{className:"text-white font-mono tracking-wider text-xl break-all",children:t.VIN}),n&&e.jsx("div",{className:"absolute top-1 right-1 text-xs font-semibold text-success bg-success-bg/20 px-1.5 py-0.5 rounded-full animate-fade-in",children:"✓"})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-text-primary mb-1 mt-1",children:[e.jsx("i",{className:"fas fa-user-circle mr-2 text-accent-secondary"}),"Thông tin Khách Hàng"]}),e.jsxs("div",{className:"pl-2",children:[e.jsx(M,{icon:"fa-user",label:"Tên Khách Hàng",value:t["Tên khách hàng"]}),e.jsx(M,{icon:"fa-barcode",label:"Số Đơn Hàng",value:t["Số đơn hàng"],valueClassName:"font-mono"}),e.jsx(M,{icon:"fa-user-tie",label:"Tư Vấn Bán Hàng",value:t["Tên tư vấn bán hàng"]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-text-primary mb-1 mt-2",children:[e.jsx("i",{className:"fas fa-car mr-2 text-accent-secondary"}),"Chi tiết Xe"]}),e.jsxs("div",{className:"pl-2",children:[e.jsx(M,{icon:"fa-car-side",label:"Dòng Xe",value:t["Dòng xe"]}),e.jsx(M,{icon:"fa-cogs",label:"Phiên Bản",value:t["Phiên bản"]}),e.jsx(M,{icon:"fa-palette",label:"Ngoại Thất",value:t["Ngoại thất"]}),e.jsx(M,{icon:"fa-chair",label:"Nội Thất",value:t["Nội thất"]})]})]})]}):e.jsxs("div",{className:"text-center text-text-secondary p-8 flex flex-col items-center justify-center h-full min-h-[200px]",children:[e.jsx("i",{className:"fas fa-mouse-pointer fa-2x mb-4 text-text-placeholder"}),e.jsx("p",{className:"font-semibold",children:"Chưa chọn đơn hàng"}),e.jsx("p",{className:"text-sm",children:"Chọn một mục từ bảng để xem chi tiết."})]})})]})},X=({icon:t,title:s,value:n,iconBgClass:i="bg-accent-primary/10",valueClassName:c="",className:r="",colorClass:f="text-accent-primary",size:o="default"})=>o==="compact"?e.jsxs("div",{className:`bg-surface-card p-2 rounded-xl border border-border-primary flex items-center gap-2 transition-all duration-300 hover:shadow-glow-accent hover:-translate-y-1 ${r}`,children:[e.jsx("div",{className:`flex-shrink-0 w-10 h-10 rounded-md flex items-center justify-center ${i}`,children:e.jsx("i",{className:`fas ${t} ${f} text-lg`})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs text-text-secondary font-medium truncate",children:s}),e.jsx("p",{className:`font-bold text-text-primary truncate text-xl ${c}`,children:n})]})]}):e.jsxs("div",{className:`bg-surface-card p-2 rounded-xl border border-border-primary flex items-center gap-2 transition-all duration-300 hover:shadow-glow-accent hover:-translate-y-1 ${r}`,children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${i}`,children:e.jsx("i",{className:`fas ${t} ${f} text-xl`})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm text-text-secondary font-medium truncate",children:s}),e.jsx("p",{className:`font-bold text-text-primary truncate text-2xl ${c}`,children:n})]})]}),oe=({selectedMonth:t,selectedYear:s,onMonthChange:n,onYearChange:i,years:c=Array.from({length:5},(r,f)=>new Date().getFullYear()-1+f)})=>e.jsxs("div",{className:"flex items-center space-x-2 bg-surface-card border border-border-primary rounded-lg p-1 shadow-sm",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:t===null?"all":t,onChange:r=>n(r.target.value==="all"?null:parseInt(r.target.value)),className:"appearance-none bg-transparent border-none text-sm font-semibold text-text-primary py-1 pl-3 pr-8 focus:ring-0 cursor-pointer hover:text-accent-primary transition-colors",children:[e.jsx("option",{value:"all",children:"Cả Năm"}),O.map((r,f)=>e.jsx("option",{value:f,children:r},f))]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-text-secondary",children:e.jsx("i",{className:"fas fa-chevron-down text-xs"})})]}),e.jsx("div",{className:"h-4 w-px bg-border-primary"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:s,onChange:r=>i(parseInt(r.target.value)),className:"appearance-none bg-transparent border-none text-sm font-semibold text-text-primary py-1 pl-3 pr-8 focus:ring-0 cursor-pointer hover:text-accent-primary transition-colors",children:c.map(r=>e.jsx("option",{value:r,children:r},r))}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-text-secondary",children:e.jsx("i",{className:"fas fa-chevron-down text-xs"})})]})]}),A=t=>!t||typeof t!="string"?"N/A":String(t).normalize("NFC").trim().toLowerCase().split(/\s+/).filter(Boolean).map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "),E=(t,s)=>{const n={};return t?(t.forEach(i=>{let c=i[s];s==="Tên tư vấn bán hàng"&&(c=A(c));const r=String(c).trim();r&&r!=="N/A"&&(n[r]=(n[r]||0)+1)}),Object.entries(n).map(([i,c])=>({key:i,count:c})).sort((i,c)=>c.count-i.count)):[]},ue=({showToast:t,isSidebarCollapsed:s})=>{const n=s?14:12,[i,c]=p.useState(new Date().getMonth()),[r,f]=p.useState(new Date().getFullYear()),{soldData:o,isLoading:g,error:x,refetch:y}=se(i,r),[m,j]=p.useState({keyword:"",tvbh:[],carModel:[],version:[],exterior:[]}),[u,N]=p.useState({key:"Thời gian nhập",direction:"desc"}),[a,v]=p.useState(1),[k,H]=p.useState(null),[z,B]=p.useState(!1),I=p.useMemo(()=>o,[o]),C=p.useMemo(()=>{let l=[...I];if(m.keyword){const d=m.keyword.toLowerCase();l=l.filter(w=>$(w["Tên khách hàng"],d)||$(w["Số đơn hàng"],d)||$(w.VIN,d)||$(w["Dòng xe"],d)||$(w["Phiên bản"],d)||$(w["Ngoại thất"],d)||$(w["Tên tư vấn bán hàng"],d))}return m.carModel.length>0&&(l=l.filter(d=>m.carModel.includes(d["Dòng xe"]))),m.version.length>0&&(l=l.filter(d=>m.version.includes(d["Phiên bản"]))),m.exterior.length>0&&(l=l.filter(d=>m.exterior.includes(d["Ngoại thất"]))),m.tvbh.length>0&&(l=l.filter(d=>m.tvbh.includes(A(d["Tên tư vấn bán hàng"])))),l},[I,m]),D=p.useMemo(()=>{const l=E(C,"Dòng xe"),d=E(C,"Tên tư vấn bán hàng"),w=l[0]||{key:"—",count:0},S=d[0]||{key:"—",count:0};return{total:C.length,topCarDisplay:`${w.key} (${w.count})`,topTvbhDisplay:`${S.key} (${S.count})`,topCars:l.slice(0,5),topTvbh:d.slice(0,5)}},[C]),h=l=>{v(1),N(d=>({key:l,direction:(d==null?void 0:d.key)===l&&d.direction==="asc"?"desc":"asc"}))},b=p.useMemo(()=>{let l=[...C];return u&&l.sort((d,w)=>{const S=d[u.key],F=w[u.key];return S==null||S===""?1:F==null||F===""?-1:S<F?u.direction==="asc"?-1:1:S>F?u.direction==="asc"?1:-1:0}),l},[C,u]),K=Math.ceil(b.length/n),R=p.useMemo(()=>b.slice((a-1)*n,a*n),[b,a,n]),V=p.useCallback(l=>{v(1),j(d=>({...d,...l}))},[]),U=p.useCallback(()=>{v(1),j({keyword:"",tvbh:[],carModel:[],version:[],exterior:[]})},[]),W=l=>{H(l),B(!0)},G=p.useMemo(()=>[...new Set(o.map(l=>A(l["Tên tư vấn bán hàng"])).filter(Boolean))].sort(),[o]),Z=p.useMemo(()=>[...new Set(o.map(l=>l["Dòng xe"]).filter(Boolean))].sort(),[o]),J=p.useMemo(()=>[...new Set(o.map(l=>l["Phiên bản"]).filter(Boolean))].sort(),[o]),Q=p.useMemo(()=>[...new Set(o.map(l=>l["Ngoại thất"]).filter(Boolean))].sort(),[o]),P=[{id:"sold-filter-tvbh",key:"tvbh",label:"Tư vấn",options:G,icon:"fa-user-tie"},{id:"sold-filter-car-model",key:"carModel",label:"Dòng Xe",options:Z,icon:"fa-car"},{id:"sold-filter-version",key:"version",label:"Phiên Bản",options:J,icon:"fa-cogs"},{id:"sold-filter-exterior",key:"exterior",label:"Ngoại Thất",options:Q,icon:"fa-palette"}];return x?e.jsxs("div",{className:"flex items-center justify-center h-full text-center p-8 bg-surface-card rounded-lg shadow-xl",children:[e.jsx("i",{className:"fas fa-exclamation-triangle fa-3x text-danger"}),e.jsx("p",{className:"mt-4 text-lg font-semibold",children:"Không thể tải dữ liệu"}),e.jsx("p",{className:"mt-2 text-sm text-text-secondary max-w-sm",children:x}),e.jsx("button",{onClick:y,className:"mt-6 btn-primary",children:"Thử lại"})]}):e.jsxs("div",{className:"flex flex-col h-full animate-fade-in space-y-3 p-2 md:p-0",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-3 bg-surface-card p-3 rounded-xl shadow-sm border border-border-primary",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-accent-primary/10 rounded-lg",children:e.jsx("i",{className:"fa-solid fa-chart-line text-accent-primary text-xl"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-text-primary",children:"Lịch Sử Bán Hàng"}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Theo dõi doanh số và hiệu quả kinh doanh"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(oe,{selectedMonth:i,selectedYear:r,onMonthChange:c,onYearChange:f})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx(X,{icon:"fa-car",title:`Tổng Xe (${i!==null?O[i]:"Năm"})`,value:D.total,size:"compact"}),e.jsx(X,{icon:"fa-trophy",title:"Xe Bán Chạy Nhất",value:D.topCarDisplay,size:"compact"}),e.jsx(X,{icon:"fa-crown",title:"TVBH Xuất Sắc Nhất",value:D.topTvbhDisplay,size:"compact"})]}),e.jsxs("div",{className:"flex-grow flex flex-col lg:flex-row gap-3 min-h-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col bg-surface-card rounded-xl shadow-md border border-border-primary min-w-0",children:[e.jsx("div",{className:"p-3 border-b border-border-primary",children:e.jsx(ae,{filters:m,onFilterChange:V,onReset:U,dropdowns:P,searchPlaceholder:"Tìm kiếm...",totalCount:b.length,onRefresh:y,isLoading:g,plain:!0,size:"compact",searchable:!1})}),e.jsx("div",{className:"flex-grow overflow-auto hidden-scrollbar p-1",children:e.jsx(le,{orders:R,onRowClick:W,selectedOrder:k,sortConfig:u,onSort:h,startIndex:(a-1)*n,viewMode:"sold"})}),e.jsx("div",{className:"p-2 border-t border-border-primary",children:K>0&&e.jsx(ie,{currentPage:a,totalPages:K,onPageChange:v,onLoadMore:()=>{},isLoadingArchives:!1,isLastArchive:!0})})]}),e.jsxs("div",{className:`
                    fixed inset-y-0 right-0 w-full md:w-[400px] bg-surface-card shadow-2xl z-50 transform transition-transform duration-300 ease-in-out
                    lg:relative lg:transform-none lg:w-[450px] lg:shadow-none lg:z-0 lg:flex lg:flex-col lg:bg-transparent
                    ${z?"translate-x-0":"translate-x-full lg:translate-x-0"}
                `,children:[e.jsx("div",{className:"lg:hidden absolute top-4 right-4 z-50",children:e.jsx("button",{onClick:()=>B(!1),className:"p-2 bg-surface-ground rounded-full shadow-md text-text-secondary",children:e.jsx("i",{className:"fas fa-times"})})}),e.jsxs("div",{className:"h-full flex flex-col bg-surface-card lg:rounded-xl lg:border lg:border-border-primary lg:shadow-md overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-border-primary bg-surface-ground/50",children:e.jsx("h3",{className:"font-bold text-text-primary",children:"Chi Tiết Đơn Hàng"})}),e.jsx("div",{className:"flex-grow overflow-y-auto hidden-scrollbar p-0",children:e.jsx(ce,{order:k,showToast:t})})]})]})]}),z&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 lg:hidden",onClick:()=>B(!1)})]})};export{ue as default};
