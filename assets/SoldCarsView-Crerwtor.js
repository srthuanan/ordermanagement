import{j as e}from"./vendor-pdf-DusBkRB3.js";import{r as l}from"./vendor-react-DJ1oPbzn.js";import Z from"./HistoryTable-fPxPZ98m.js";import{M as z,i as p,b as _,P as J}from"./index-CVDse7oq.js";import{h as Q}from"./vendor-utils-C5S46NFB.js";const g=({icon:r,label:a,value:c,valueClassName:i})=>e.jsxs("div",{className:"flex items-start gap-2 py-2 border-b border-dashed border-border-primary/50",children:[e.jsx("i",{className:`fas ${r} text-accent-secondary text-base w-5 text-center mt-1`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-text-secondary",children:a}),e.jsx("p",{className:`text-sm text-text-primary font-semibold break-words ${i}`,children:c||"—"})]})]}),W=({order:r,showToast:a})=>{const[c,i]=l.useState(!1),o=n=>{n&&navigator.clipboard.writeText(n).then(()=>{i(!0),a("Đã Sao Chép",`Số VIN ${n} đã được sao chép.`,"success",2e3),setTimeout(()=>i(!1),2e3)}).catch(()=>{a("Lỗi Sao Chép","Không thể truy cập clipboard.","error")})};return e.jsxs("div",{className:"detail-panel h-full",children:[e.jsxs("h3",{className:"text-lg font-bold text-text-primary mb-0 p-2 border-b border-border-primary flex items-center gap-3 flex-shrink-0",children:[e.jsx("i",{className:"fas fa-file-invoice text-accent-primary"}),"Chi Tiết Đơn Hàng"]}),e.jsx("div",{className:"detail-panel-body flex-grow hidden-scrollbar",children:r?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative p-2 my-1 rounded-lg bg-slate-800 text-center shadow-lg cursor-pointer hover:bg-slate-700 transition-colors",onClick:()=>o(r.VIN||""),title:"Click để sao chép VIN",children:[e.jsx("p",{className:"text-xs text-slate-400 uppercase tracking-widest",children:"Số Khung (VIN)"}),e.jsx("p",{className:"text-white font-mono tracking-wider text-xl break-all",children:r.VIN}),c&&e.jsx("div",{className:"absolute top-1 right-1 text-xs font-semibold text-success bg-success-bg/20 px-1.5 py-0.5 rounded-full animate-fade-in",children:"✓"})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-text-primary mb-1 mt-1",children:[e.jsx("i",{className:"fas fa-user-circle mr-2 text-accent-secondary"}),"Thông tin Khách Hàng"]}),e.jsxs("div",{className:"pl-2",children:[e.jsx(g,{icon:"fa-user",label:"Tên Khách Hàng",value:r["Tên khách hàng"]}),e.jsx(g,{icon:"fa-barcode",label:"Số Đơn Hàng",value:r["Số đơn hàng"],valueClassName:"font-mono"}),e.jsx(g,{icon:"fa-user-tie",label:"Tư Vấn Bán Hàng",value:r["Tên tư vấn bán hàng"]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-text-primary mb-1 mt-2",children:[e.jsx("i",{className:"fas fa-car mr-2 text-accent-secondary"}),"Chi tiết Xe"]}),e.jsxs("div",{className:"pl-2",children:[e.jsx(g,{icon:"fa-car-side",label:"Dòng Xe",value:r["Dòng xe"]}),e.jsx(g,{icon:"fa-cogs",label:"Phiên Bản",value:r["Phiên bản"]}),e.jsx(g,{icon:"fa-palette",label:"Ngoại Thất",value:r["Ngoại thất"]}),e.jsx(g,{icon:"fa-chair",label:"Nội Thất",value:r["Nội thất"]})]})]})]}):e.jsxs("div",{className:"text-center text-text-secondary p-8 flex flex-col items-center justify-center h-full min-h-[200px]",children:[e.jsx("i",{className:"fas fa-mouse-pointer fa-2x mb-4 text-text-placeholder"}),e.jsx("p",{className:"font-semibold",children:"Chưa chọn đơn hàng"}),e.jsx("p",{className:"text-sm",children:"Chọn một mục từ bảng để xem chi tiết."})]})})]})},S=({icon:r,title:a,value:c,iconBgClass:i="bg-accent-primary/10",valueClassName:o="",className:n="",colorClass:h="text-accent-primary",size:f="default"})=>f==="compact"?e.jsxs("div",{className:`bg-surface-card p-2 rounded-xl border border-border-primary flex items-center gap-2 transition-all duration-300 hover:shadow-glow-accent hover:-translate-y-1 ${n}`,children:[e.jsx("div",{className:`flex-shrink-0 w-10 h-10 rounded-md flex items-center justify-center ${i}`,children:e.jsx("i",{className:`fas ${r} ${h} text-lg`})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs text-text-secondary font-medium truncate",children:a}),e.jsx("p",{className:`font-bold text-text-primary truncate text-xl ${o}`,children:c})]})]}):e.jsxs("div",{className:`bg-surface-card p-2 rounded-xl border border-border-primary flex items-center gap-2 transition-all duration-300 hover:shadow-glow-accent hover:-translate-y-1 ${n}`,children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${i}`,children:e.jsx("i",{className:`fas ${r} ${h} text-xl`})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm text-text-secondary font-medium truncate",children:a}),e.jsx("p",{className:`font-bold text-text-primary truncate text-2xl ${o}`,children:c})]})]}),ee=({selectedMonth:r,selectedYear:a,onMonthChange:c,onYearChange:i,years:o=[2023,2024,2025]})=>e.jsxs("div",{className:"flex items-center space-x-2 bg-surface-card border border-border-primary rounded-lg p-1 shadow-sm",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:r===null?"all":r,onChange:n=>c(n.target.value==="all"?null:parseInt(n.target.value)),className:"appearance-none bg-transparent border-none text-sm font-semibold text-text-primary py-1 pl-3 pr-8 focus:ring-0 cursor-pointer hover:text-accent-primary transition-colors",children:[e.jsx("option",{value:"all",children:"Cả Năm"}),z.map((n,h)=>e.jsx("option",{value:h,children:n},h))]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-text-secondary",children:e.jsx("i",{className:"fas fa-chevron-down text-xs"})})]}),e.jsx("div",{className:"h-4 w-px bg-border-primary"}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:a,onChange:n=>i(parseInt(n.target.value)),className:"appearance-none bg-transparent border-none text-sm font-semibold text-text-primary py-1 pl-3 pr-8 focus:ring-0 cursor-pointer hover:text-accent-primary transition-colors",children:o.map(n=>e.jsx("option",{value:n,children:n},n))}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-text-secondary",children:e.jsx("i",{className:"fas fa-chevron-down text-xs"})})]})]}),T=r=>!r||typeof r!="string"?"N/A":String(r).normalize("NFC").trim().toLowerCase().split(/\s+/).filter(Boolean).map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" "),V=(r,a)=>{const c={};return r?(r.forEach(i=>{let o=i[a];a==="Tên tư vấn bán hàng"&&(o=T(o));const n=String(o).trim();n&&n!=="N/A"&&(c[n]=(c[n]||0)+1)}),Object.entries(c).map(([i,o])=>({key:i,count:o})).sort((i,o)=>o.count-i.count)):[]},le=({showToast:r,soldData:a,isLoading:c,error:i,refetch:o,isSidebarCollapsed:n})=>{const h=n?14:12,[f,B]=l.useState(null),[w,H]=l.useState(new Date().getFullYear()),[x,M]=l.useState({keyword:"",tvbh:[],carModel:[],version:[],exterior:[]}),[u,F]=l.useState({key:"Thời gian nhập",direction:"desc"}),[v,N]=l.useState(1),[D,A]=l.useState(null),[$,C]=l.useState(!1),P=l.useMemo(()=>a.filter(t=>{if(!t["Thời gian nhập"])return!1;const s=Q(t["Thời gian nhập"]),d=s.year(),m=s.month();return!(d!==w||f!==null&&m!==f)}),[a,f,w]),b=l.useMemo(()=>{let t=[...P];if(x.keyword){const s=x.keyword.toLowerCase();t=t.filter(d=>p(d["Tên khách hàng"],s)||p(d["Số đơn hàng"],s)||p(d.VIN,s)||p(d["Dòng xe"],s)||p(d["Phiên bản"],s)||p(d["Ngoại thất"],s)||p(d["Tên tư vấn bán hàng"],s))}return x.carModel.length>0&&(t=t.filter(s=>x.carModel.includes(s["Dòng xe"]))),x.version.length>0&&(t=t.filter(s=>x.version.includes(s["Phiên bản"]))),x.exterior.length>0&&(t=t.filter(s=>x.exterior.includes(s["Ngoại thất"]))),x.tvbh.length>0&&(t=t.filter(s=>x.tvbh.includes(T(s["Tên tư vấn bán hàng"])))),t},[P,x]),k=l.useMemo(()=>{const t=V(b,"Dòng xe"),s=V(b,"Tên tư vấn bán hàng"),d=t[0]||{key:"—",count:0},m=s[0]||{key:"—",count:0};return{total:b.length,topCarDisplay:`${d.key} (${d.count})`,topTvbhDisplay:`${m.key} (${m.count})`,topCars:t.slice(0,5),topTvbh:s.slice(0,5)}},[b]),L=t=>{N(1),F(s=>({key:t,direction:(s==null?void 0:s.key)===t&&s.direction==="asc"?"desc":"asc"}))},y=l.useMemo(()=>{let t=[...b];return u&&t.sort((s,d)=>{const m=s[u.key],j=d[u.key];return m==null||m===""?1:j==null||j===""?-1:m<j?u.direction==="asc"?-1:1:m>j?u.direction==="asc"?1:-1:0}),t},[b,u]),I=Math.ceil(y.length/h),O=l.useMemo(()=>y.slice((v-1)*h,v*h),[y,v,h]),R=l.useCallback(t=>{N(1),M(s=>({...s,...t}))},[]),E=l.useCallback(()=>{N(1),M({keyword:"",tvbh:[],carModel:[],version:[],exterior:[]})},[]),X=t=>{A(t),C(!0)},q=l.useMemo(()=>[...new Set(a.map(t=>T(t["Tên tư vấn bán hàng"])).filter(Boolean))].sort(),[a]),K=l.useMemo(()=>[...new Set(a.map(t=>t["Dòng xe"]).filter(Boolean))].sort(),[a]),Y=l.useMemo(()=>[...new Set(a.map(t=>t["Phiên bản"]).filter(Boolean))].sort(),[a]),G=l.useMemo(()=>[...new Set(a.map(t=>t["Ngoại thất"]).filter(Boolean))].sort(),[a]),U=[{id:"sold-filter-tvbh",key:"tvbh",label:"Tư vấn",options:q,icon:"fa-user-tie"},{id:"sold-filter-car-model",key:"carModel",label:"Dòng Xe",options:K,icon:"fa-car"},{id:"sold-filter-version",key:"version",label:"Phiên Bản",options:Y,icon:"fa-cogs"},{id:"sold-filter-exterior",key:"exterior",label:"Ngoại Thất",options:G,icon:"fa-palette"}];return i?e.jsxs("div",{className:"flex items-center justify-center h-full text-center p-8 bg-surface-card rounded-lg shadow-xl",children:[e.jsx("i",{className:"fas fa-exclamation-triangle fa-3x text-danger"}),e.jsx("p",{className:"mt-4 text-lg font-semibold",children:"Không thể tải dữ liệu"}),e.jsx("p",{className:"mt-2 text-sm text-text-secondary max-w-sm",children:i}),e.jsx("button",{onClick:o,className:"mt-6 btn-primary",children:"Thử lại"})]}):e.jsxs("div",{className:"flex flex-col h-full animate-fade-in space-y-3 p-2 md:p-0",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-3 bg-surface-card p-3 rounded-xl shadow-sm border border-border-primary",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-accent-primary/10 rounded-lg",children:e.jsx("i",{className:"fa-solid fa-chart-line text-accent-primary text-xl"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-text-primary",children:"Lịch Sử Bán Hàng"}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Theo dõi doanh số và hiệu quả kinh doanh"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(ee,{selectedMonth:f,selectedYear:w,onMonthChange:B,onYearChange:H})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx(S,{icon:"fa-car",title:`Tổng Xe (${f!==null?z[f]:"Năm"})`,value:k.total,size:"compact"}),e.jsx(S,{icon:"fa-trophy",title:"Xe Bán Chạy Nhất",value:k.topCarDisplay,size:"compact"}),e.jsx(S,{icon:"fa-crown",title:"TVBH Xuất Sắc Nhất",value:k.topTvbhDisplay,size:"compact"})]}),e.jsxs("div",{className:"flex-grow flex flex-col lg:flex-row gap-3 min-h-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col bg-surface-card rounded-xl shadow-md border border-border-primary min-w-0",children:[e.jsx("div",{className:"p-3 border-b border-border-primary",children:e.jsx(_,{filters:x,onFilterChange:R,onReset:E,dropdowns:U,searchPlaceholder:"Tìm kiếm...",totalCount:y.length,onRefresh:o,isLoading:c,plain:!0,size:"compact",searchable:!1})}),e.jsx("div",{className:"flex-grow overflow-auto hidden-scrollbar p-1",children:e.jsx(Z,{orders:O,onRowClick:X,selectedOrder:D,sortConfig:u,onSort:L,startIndex:(v-1)*h,viewMode:"sold"})}),e.jsx("div",{className:"p-2 border-t border-border-primary",children:I>0&&e.jsx(J,{currentPage:v,totalPages:I,onPageChange:N,onLoadMore:()=>{},isLoadingArchives:!1,isLastArchive:!0})})]}),e.jsxs("div",{className:`
                    fixed inset-y-0 right-0 w-full md:w-[400px] bg-surface-card shadow-2xl z-50 transform transition-transform duration-300 ease-in-out
                    lg:relative lg:transform-none lg:w-[450px] lg:shadow-none lg:z-0 lg:flex lg:flex-col lg:bg-transparent
                    ${$?"translate-x-0":"translate-x-full lg:translate-x-0"}
                `,children:[e.jsx("div",{className:"lg:hidden absolute top-4 right-4 z-50",children:e.jsx("button",{onClick:()=>C(!1),className:"p-2 bg-surface-ground rounded-full shadow-md text-text-secondary",children:e.jsx("i",{className:"fas fa-times"})})}),e.jsxs("div",{className:"h-full flex flex-col bg-surface-card lg:rounded-xl lg:border lg:border-border-primary lg:shadow-md overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-border-primary bg-surface-ground/50",children:e.jsx("h3",{className:"font-bold text-text-primary",children:"Chi Tiết Đơn Hàng"})}),e.jsx("div",{className:"flex-grow overflow-y-auto hidden-scrollbar p-0",children:e.jsx(W,{order:D,showToast:r})})]})]})]}),$&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 lg:hidden",onClick:()=>C(!1)})]})};export{le as default};
