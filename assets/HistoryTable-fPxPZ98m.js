import{j as t}from"./vendor-pdf-DusBkRB3.js";import{r as N,R as X}from"./vendor-react-DJ1oPbzn.js";import{h as w}from"./vendor-utils-C5S46NFB.js";import{B as S,g as H,S as P}from"./index-CVDse7oq.js";const A="/ordermanagement/assets/loading-animation-DF1z-Eb6.json",D=({order:e,onViewDetails:l,onCancel:s,onRequestInvoice:p,onSupplement:u,onRequestVC:x,onConfirmVC:d,onEdit:f,onToggle:r})=>{const[i,b]=N.useState(!1),o=N.useRef(null),m=n=>{b(n),r==null||r(n)};N.useEffect(()=>{const n=h=>{o.current&&!o.current.contains(h.target)&&m(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[r]);const c=(e["Kết quả"]||"chưa ghép").toLowerCase().trim().normalize("NFC"),g=(e["Trạng thái VC"]||"").toLowerCase().trim().normalize("NFC"),a=g||c,y=["chưa ghép","đã ghép"].includes(c),j=c==="đã ghép",T=c==="yêu cầu bổ sung",$=!["đã xuất hóa đơn","đã hủy","chờ ký hóa đơn"].includes(c),Y=(c==="đã xuất hóa đơn"||g==="từ chối ycvc")&&!["yêu cầu vinclub","chờ duyệt ycvc","chờ xác thực vc (tvbh)","đã có vc"].includes(g),C=a==="chờ xác thực vc (tvbh)",K=(n,h)=>{h.preventDefault(),h.stopPropagation(),n(e),m(!1)},k=[{label:"Xem chi tiết",icon:"fa-eye text-accent-primary",action:l,condition:!0,title:"Xem chi tiết đơn hàng"},{label:"Chỉnh Sửa",icon:"fa-pencil-alt text-blue-500",action:f,condition:!!f&&$,title:"Chỉnh sửa thông tin đơn hàng"},{label:"Yêu cầu Xuất Hóa Đơn",icon:"fa-file-invoice-dollar text-green-500",action:p,condition:j,title:"Tải lên hợp đồng và đề nghị để xuất hóa đơn"},{label:"Bổ Sung File",icon:"fa-edit text-orange-500",action:u,condition:T,title:"Bổ sung hoặc thay thế tệp đã gửi"},{label:"Yêu Cầu Cấp VC",icon:"fa-id-card text-blue-500",action:x,condition:!!x&&Y,title:"Yêu cầu cấp tài khoản VinClub"},{label:"Xác Thực UNC VC",icon:"fa-check text-teal-500",action:d,condition:!!d&&C,title:"Xác thực đã nhận UNC cho VinClub"},{label:"Tải Hóa Đơn",icon:"fa-download text-sky-500",action:n=>{n.LinkHoaDonDaXuat&&window.open(n.LinkHoaDonDaXuat,"_blank")},condition:!!e.LinkHoaDonDaXuat,title:"Tải về hóa đơn đã xuất"},{label:"Hủy Yêu Cầu",icon:"fa-trash-alt text-danger",action:s,condition:y,isDanger:!0,title:"Hủy yêu cầu ghép xe này"}].filter(n=>n.condition);return t.jsxs("div",{className:"relative inline-block text-left",ref:o,children:[t.jsx(S,{onClick:n=>{n.stopPropagation(),m(!i)},variant:"ghost",className:`group w-9 h-9 flex items-center justify-center rounded-full transition-all duration-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-surface-card focus-visible:ring-accent-primary/50 !p-0
                   ${i?"bg-accent-primary/10":"bg-transparent hover:bg-surface-hover"}`,"aria-haspopup":"true","aria-expanded":i,"aria-controls":"action-menu",title:"Tùy chọn",children:t.jsx("lottie-player",{src:A,background:"transparent",speed:"1",style:{width:"28px",height:"28px"},loop:!0,autoplay:!0,className:`transition-all duration-300 group-hover:scale-110 group-hover:[filter:drop-shadow(0_0_4px_rgba(66,165,245,0.7))] ${i?"scale-105 [filter:drop-shadow(0_0_2px_rgba(66,165,245,0.7))]":""}`})}),i&&t.jsx("div",{id:"action-menu",className:"origin-top-right absolute right-0 mt-2 w-56 rounded-lg shadow-2xl bg-surface-overlay border border-border-primary/70 z-30 focus:outline-none animate-fade-in-scale-up",style:{animationDuration:"0.15s"},children:t.jsx("div",{className:"p-1.5",role:"menu","aria-orientation":"vertical",children:k.map(n=>t.jsxs(X.Fragment,{children:[n.isDanger&&k.some(h=>!h.isDanger&&h.condition)&&t.jsx("div",{className:"border-t border-border-primary/70 my-1 mx-1.5"}),n.isDanger&&k.some(h=>!h.isDanger&&h.condition)&&t.jsx("div",{className:"border-t border-border-primary/70 my-1 mx-1.5"}),t.jsx(S,{onClick:h=>K(n.action,h),title:n.title,variant:n.isDanger?"danger":"ghost",fullWidth:!0,className:`justify-start px-3 py-2.5 text-sm font-medium rounded-md transition-colors duration-150 
                                ${n.isDanger?"hover:bg-danger-bg":"text-text-primary hover:bg-surface-hover"}`,role:"menuitem",leftIcon:t.jsx("i",{className:`fas ${n.icon} fa-fw w-5 text-center text-base mr-1`}),children:t.jsx("span",{children:n.label})})]},n.label))})})]})},v=({columnKey:e,title:l,sortConfig:s,onSort:p,className:u})=>{const x=(s==null?void 0:s.key)===e,d=(s==null?void 0:s.direction)==="asc"?"▲":"▼";return t.jsxs("th",{scope:"col",onClick:()=>p(e),className:`py-2 px-2 text-left text-xs font-bold text-text-secondary cursor-pointer hover:bg-surface-hover transition-colors whitespace-nowrap uppercase tracking-wider ${u}`,children:[l," ",x&&t.jsx("span",{className:"text-xs ml-1",children:d})]})},L=({order:e,index:l,onViewDetails:s,onCancel:p,onRequestInvoice:u,onSupplement:x,onEdit:d,onRequestVC:f,onConfirmVC:r,onRowClick:i,selectedOrder:b,viewMode:o,processingOrder:m})=>{const[c,g]=N.useState(!1),a=e["Trạng thái VC"]||e["Kết quả"]||"Chưa ghép",y=b&&b["Số đơn hàng"]===e["Số đơn hàng"],j=m===e["Số đơn hàng"];return t.jsxs("tr",{className:`hover:bg-surface-hover transition-colors duration-200 animate-fade-in-up ${i?"cursor-pointer":""} ${y?"selected-row-highlight":""} ${c?"relative z-20":""}`,style:{animationDelay:`${l*20}ms`},onClick:()=>i?i(e):s==null?void 0:s(e),children:[t.jsx("td",{className:"whitespace-nowrap py-2 pl-2 pr-2 text-sm text-center text-text-secondary font-medium sm:pl-3","data-label":"#",children:l+1}),t.jsxs("td",{className:"whitespace-nowrap px-2 py-2 text-sm","data-label":"Khách hàng / SĐH",children:[t.jsx("div",{className:"font-semibold text-text-primary",children:e["Tên khách hàng"]||"N/A"}),t.jsx("div",{className:"text-text-secondary font-mono text-xs",children:e["Số đơn hàng"]})]}),t.jsxs("td",{className:"whitespace-nowrap px-2 py-2 text-sm","data-label":"Thông Tin Xe",children:[t.jsxs("div",{className:"text-text-primary",children:[e["Dòng xe"]," / ",e["Phiên bản"]]}),t.jsxs("div",{className:"text-text-secondary text-xs",style:H(e["Ngoại thất"]),children:[e["Ngoại thất"]," / ",e["Nội thất"]]})]}),o==="full"&&t.jsxs("td",{className:"whitespace-nowrap px-2 py-2 text-sm","data-label":"Ngày Yêu Cầu",children:[t.jsx("div",{className:"text-text-primary",title:w(e["Thời gian nhập"]).format("DD/MM/YYYY HH:mm:ss"),children:w(e["Thời gian nhập"]).format("DD/MM/YY HH:mm")}),t.jsx("div",{className:"text-text-secondary text-xs",children:w(e["Thời gian nhập"]).fromNow()})]}),t.jsx("td",{className:"whitespace-nowrap px-2 py-2 text-sm text-text-primary truncate","data-label":"Tư vấn",title:e["Tên tư vấn bán hàng"],children:e["Tên tư vấn bán hàng"]||"N/A"}),o==="full"&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"whitespace-nowrap px-2 py-2 text-sm text-text-primary","data-label":"Trạng thái",children:t.jsx(P,{status:a})}),t.jsx("td",{className:"relative whitespace-nowrap py-2 pl-2 pr-2 text-center text-sm font-medium sm:pr-3","data-label":"Hành động",onClick:T=>T.stopPropagation(),children:j?t.jsx("div",{className:"flex items-center justify-center h-9",children:t.jsx("i",{className:"fas fa-spinner fa-spin text-accent-primary text-xl"})}):t.jsx(D,{order:e,onViewDetails:s,onCancel:p,onRequestInvoice:u,onSupplement:x,onEdit:d,onRequestVC:f,onConfirmVC:r,onToggle:g})})]})]})},B=({orders:e,onViewDetails:l,onCancel:s,onRequestInvoice:p,onSupplement:u,onEdit:x,onRequestVC:d,onConfirmVC:f,sortConfig:r,onSort:i,startIndex:b,onRowClick:o,selectedOrder:m,viewMode:c="full",processingOrder:g})=>e.length===0?t.jsxs("div",{className:"text-center py-8 text-text-secondary",children:[t.jsx("i",{className:"fas fa-folder-open fa-3x mb-4 text-text-placeholder"}),t.jsx("p",{className:"font-semibold text-text-primary",children:"Không tìm thấy yêu cầu nào."}),t.jsx("p",{className:"text-sm",children:"Hãy thử thay đổi bộ lọc hoặc tạo yêu cầu mới."})]}):t.jsxs("div",{className:"w-full",children:[t.jsx("div",{className:"md:hidden space-y-3",children:e.map((a,y)=>t.jsxs("div",{className:`relative overflow-hidden rounded-xl bg-slate-50 p-3 shadow-sm border border-gray-200 hover:shadow-md transition-all duration-200 ease-out active:scale-[0.98] cursor-pointer flex flex-col group ${m&&m["Số đơn hàng"]===a["Số đơn hàng"]?"ring-2 ring-accent-primary":""}`,onClick:()=>o?o(a):l==null?void 0:l(a),children:[t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("p",{className:"text-slate-800 text-sm font-bold uppercase leading-tight truncate",title:a["Tên khách hàng"],children:a["Tên khách hàng"]||"N/A"}),t.jsx("p",{className:"text-gray-500 text-[10px] font-mono truncate mt-0.5",title:a["Số đơn hàng"],children:a["Số đơn hàng"]})]}),t.jsx("div",{className:"flex-shrink-0",onClick:j=>j.stopPropagation(),children:g===a["Số đơn hàng"]?t.jsx("div",{className:"flex items-center justify-center w-8 h-8",children:t.jsx("i",{className:"fas fa-spinner fa-spin text-accent-primary text-lg"})}):c==="full"&&t.jsx(D,{order:a,onViewDetails:l,onCancel:s,onRequestInvoice:p,onSupplement:u,onEdit:x,onRequestVC:d,onConfirmVC:f})})]}),t.jsx("div",{className:"my-2 border-t border-dashed border-gray-300"}),t.jsxs("div",{className:"space-y-0.5",children:[t.jsxs("p",{className:"text-slate-800 text-sm font-medium truncate",title:`${a["Dòng xe"]} / ${a["Phiên bản"]}`,children:[a["Dòng xe"]," / ",a["Phiên bản"]]}),t.jsxs("p",{className:"text-slate-500 text-xs truncate",title:`${a["Ngoại thất"]} / ${a["Nội thất"]}`,children:[t.jsx("span",{style:H(a["Ngoại thất"]),children:a["Ngoại thất"]}),t.jsx("span",{className:"text-gray-400",children:" / "}),t.jsx("span",{children:a["Nội thất"]})]})]}),t.jsx("div",{className:"my-2 border-t border-dashed border-gray-300"}),t.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500 mt-auto",children:[t.jsx("span",{children:"Tư vấn"}),t.jsx("span",{className:"font-medium uppercase text-slate-700 truncate",children:a["Tên tư vấn bán hàng"]||"N/A"})]})]},a["Số đơn hàng"]||y))}),t.jsx("div",{className:"hidden md:block min-w-full py-1 align-middle",children:t.jsxs("table",{className:"min-w-full divide-y divide-border-primary responsive-table",children:[t.jsx("thead",{className:"bg-surface-hover sticky top-0 z-10",children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",className:"py-2 pl-2 pr-2 text-center text-xs font-bold text-text-secondary sm:pl-3 w-12 uppercase tracking-wider",children:"#"}),t.jsx(v,{columnKey:"Tên khách hàng",title:"Khách hàng / SĐH",sortConfig:r,onSort:i}),t.jsx(v,{columnKey:"Dòng xe",title:"Thông Tin Xe",sortConfig:r,onSort:i}),c==="full"&&t.jsx(v,{columnKey:"Thời gian nhập",title:"Ngày Yêu Cầu",sortConfig:r,onSort:i}),t.jsx(v,{columnKey:"Tên tư vấn bán hàng",title:"Tư vấn",sortConfig:r,onSort:i}),c==="full"&&t.jsx(v,{columnKey:"Kết quả",title:"Trạng thái",sortConfig:r,onSort:i}),c==="full"&&t.jsx("th",{scope:"col",className:"relative py-2 pl-2 pr-2 sm:pr-3 text-center text-xs font-bold text-text-secondary uppercase tracking-wider",children:"Hành động"})]})}),t.jsx("tbody",{className:"divide-y divide-border-primary bg-surface-card",children:e.map((a,y)=>t.jsx(L,{order:a,index:b+y,onViewDetails:l,onCancel:s,onRequestInvoice:p,onSupplement:u,onEdit:x,onRequestVC:d,onConfirmVC:f,onRowClick:o,selectedOrder:m,viewMode:c,processingOrder:g},a["Số đơn hàng"]||y))})]})})]});export{B as default};
